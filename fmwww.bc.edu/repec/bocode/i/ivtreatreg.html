<pre>
<b>help ivtreatreg</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>ivtreatreg</b> - Estimation of binary treatment models with idiosyncratic
                   average effect
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>ivtreatreg</b><i> outcome treatment</i> [<i> varlist</i>] [<i>if</i>] [<i>in</i>] [<i>weight</i>]<b>,</b>
                 <b>model(</b><i>modeltype</i><b>)</b> [<b>hetero(</b><i>varlist_h</i><b>)</b> <b>iv(</b><i>varlist_iv</i><b>)</b>
                 <b>conf(</b><i>number</i><b>)</b> <b>graphic</b> <b>vce(robust)</b> <b>const(noconstant)</b>
                 <b>head(noheader)</b>]
<p>
<p>
    <b>fweight</b>s, <b>iweight</b>s, and <b>pweight</b>s are allowed; see weight.
<p>
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>ivtreatreg</b> estimates five different (binary) treatment models <i>with</i> and
    <i>without</i> idiosyncratic (or heterogeneous) average effect.  Depending on
    the model specified, <b>ivtreatreg</b> provides consistent estimation of average
    treatment effects either under the hypothesis of "selection on
    observables" or "selection on unobservables" by suitably using Ordinary
    Least Squares (OLS), Instrumental-Variables (IV) and Selection-Model
    regression depending on the case.  Conditional on a pre-specified subset
    of exogenous variables - thought of as those driving the heterogeneous
    response to treatment - <b>ivtreatreg</b> calculates for each specific model the
    Average Treatment Effect (ATE), the Average Treatment Effect on Treated
    (ATET) and the Average Treatment Effect on Non-Treated (ATENT), as well
    as the estimates of these parameters conditional on the observable
    factors x (i.e., ATE(x), ATET(x) and ATENT(x)).
<p>
     
<b><u>Options</u></b>
    
    <b>model(</b><i>modeltype</i><b>)</b> specifies the treatment model to be estimated, where
        <i>modeltype</i> must be one of the following five models: "cf-ols",
        "direct-2sls", "probit-2sls", "probit-ols", "heckit".  it is always
        required to specify one model.
<p>
    <b>hetero(</b><i>varlist_h</i><b>)</b> specifies the variables over which to calculate the
        idyosincratic Average Treatment Effect ATE(x), ATET(x) and ATENT(x),
        where x=<i>varlist_h</i>. It is optional for all models. When this option is
        not specified, the command estimates the specified model without
        heterogeneous average effect. Observe that <i>varlist_h</i> should be the
        same set or a subset of the variables specified in <i>varlist</i>.
<p>
    <b>iv(</b><i>varlist_iv</i><b>)</b> specifies the variable(s) to be used as instruments.  This
        option is strictly required only for "direct-2sls", "probit-2sls" and
        "probit-ols", while it is optional for "heckit".
<p>
    <b>graphic</b> allows for a graphical representation of the density
        distributions of ATE(x), ATET(x) and ATENT(x). It is optional for all
        models and gives an outcome only if variables into <b>hetero()</b> are
        specified.
<p>
    <b>vce(robust)</b> allows for robust regression standard errors. It is optional
        for all models.
<p>
    <b>beta</b> reports standardized beta coefficients. It is optional for all
        models.
<p>
    <b>const(noconstant)</b> suppresses regression constant term. It is optional for
        all models.
<p>
    <b>conf(</b><i>number</i><b>)</b> sets the confidence level equal to the specified <i>number</i>.
        The default is <i>number</i>=95.
<p>
<p>
<a name="modeltype"></a>  <i>modeltype_options</i>           Description
  -----------------------------------------------------------------------------
  Model
  <b>cf-ols</b>                      Control-function regression estimated by ordinary
                                  least squares
  <b>direct-2sls</b>                 IV regression estimated by direct two-stage least
                                  squares
  <b>probit-2sls</b>                 IV regression estimated by Probit and two-stage
                                  least squares
  <b>probit-ols</b>                  IV two-step regression estimated by Probit and
                                  ordinary least squares
  <b>heckit</b>                      Heckman two-step selection model
  -----------------------------------------------------------------------------
<p>
<p>
    <b>ivtreatreg</b> creates a number of variables:
<p>
        _ws_<i>varname_h</i> are the additional regressors used in model's
        regression when <b>hetero(</b><i>varlist_h</i><b>)</b> is specified. They are created in
        all models.
<p>
        _z_<i>varname_h</i> are the instrumental-variables used in model's
        regression when <b>hetero(</b><i>varlist_h</i><b>)</b> and <b>iv(</b><i>varlist_iv</i><b>)</b> are specified.
        They are created only in IV models.
<p>
        ATE(x) is an estimate of the idiosyncratic Average Treatment Effect.
<p>
        ATET(x) is an estimate of the idiosyncratic Average Treatment Effect
        on treated.
<p>
        ATENT(x) is an estimate of the idiosyncratic Average Treatment Effect
        on Non-Treated.
<p>
        G_fv is the predicted probability from the Probit regression,
        conditional on the observable used.
<p>
        _wL0, wL1 are the Heckman correction-terms.
<p>
<p>
    <b>ivtreatreg</b> returns the following scalars:
<p>
        r(N_tot) is the total number of (used) observations.
<p>
        r(N_treated) is the number of (used) treated units.
<p>
        r(N_untreated) is the number of (used) untreated units.
<p>
        r(ate) is the value of the Average Treatment Effect.
<p>
        r(atet) is the value of the Average Treatment Effect on Treated.
<p>
        r(atent) is the value of the Average Treatment Effect on Non-treated.
<p>
<p>
<p>
<b><u>Remarks</u></b> 
<p>
    The treatment has to be a 0/1 binary variable (1 = treated, 0 =
    untreated).
<p>
    The standard errors for ATET and ATENT may be obtained via bootstrapping.
<p>
    When option <b>hetero</b> is not specified, ATE(x), ATET(x) and ATENT(x) are one
    singleton number equal to ATE=ATET=ATENT.
<p>
    Since when <b>hetero</b> is not specified in model "heckit" <b>ivtreatreg</b> uses the
    in-built command <b>treatreg</b>, the following has to be taken into account:
    (i) option <b>beta</b> and option <b>head(noheader)</b> are not allowed; (ii) Option
    <b>vce</b> takes this sintax: <b>vce(</b><i>vcetype</i><b>)</b>, where <i>vcetype</i> may be "conventional",
    "bootstrap", or "jackknife".
<p>
    Please remember to use the <b>update query</b> command before running this
    program to make sure you have an up-to-date version of Stata installed.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>*** EXAMPLES WITHOUT IDIOSYNCRATIC AVERAGE EFFECT ***</b>
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv ,
   . model(cf-ols) head(noheader) const(noconstant)  vce(robust) beta 
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv ,
   . model(direct-2sls) iv(frsthalf) head(noheader) const(noconstant)  vce(robu
&gt; st) beta 
   . ;
   
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv ,
   . model(probit-2sls) iv(frsthalf) head(noheader) const(noconstant)  vce(robu
&gt; st) beta 
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv ,
   . model(probit-ols) head(noheader) const(noconstant) vce(robust) beta 
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv ,
   . model(heckit) iv(frsthalf) head(noheader) const(noconstant) conf(80) vce(v
&gt; ce(conventional))
   . ;
   
<p>
    <b>*** EXAMPLES WITH IDIOSYNCRATIC AVERAGE EFFECT ***</b>
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv , 
   . model(cf-ols) hetero(yearfm agefm) graphic 
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv , 
   . model(direct-2sls) hetero(yearfm agefm) iv(frsthalf)   graphic 
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv , 
   . model(probit-2sls) hetero(yearfm agefm) iv(frsthalf) graphic 
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv , 
   . model(probit-osls) hetero(yearfm agefm) graphic 
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . ;
<p>
   . #delimit ;
   . xi: ivtreatreg children  educ7  i.tv , 
   . hetero(yearfm agefm) iv(frsthalf) model(heckit) graphic 
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . * Test for checking the existence of the selection bias:
   . test _b[_wL1]=_b[_wL0]=0
   . ;
<p>
<p>
    <b>*** EXAMPLE ON HOW TO BOOTSTRAP STD. ERR. FOR "ATET" AND "ATENT" ***</b>
<p>
   . #delimit ;
   . xi: bootstrap atet=r(atet) atent=r(atent), rep(10):
   . ivtreatreg children  educ7  i.tv , hetero(yearfm agefm)  iv(frsthalf) mode
&gt; l(heckit)
   . head(noheader) const(noconstant) conf(90) beta vce(robust)
   . ;
<p>
   
<b><u>Reference</u></b>
<p>
    Cameron, A. C., and P. K. Trivedi. 2005. <i>Microeconometrics: Methods and</i>
        <i>Applications</i>.  Chapter 25. Cambridge University Press, New York.
<p>
    Cerulli, G. 2012. Ivtreatreg: a new STATA routine for estimating binary
        treatment models with heterogeneous response to treatment under
        observable and unobservable selection, <i>Working Paper Cnr-Ceris</i>, N°
        03/2012.
<p>
    Wooldridge, J. M. 2002.<i>  Econometric Analysis of Cross Section and Panel</i>
        <i>Data</i>.  Chapter 18. The MIT Press, Cambridge.
<p>
    Wooldridge, J. M. 2010.<i>  Econometric Analysis of Cross Section and Panel</i>
        <i>Data, 2nd Edition</i>.  Chapter 21. The MIT Press, Cambridge.
<p>
<p>
<b><u>Acknowledgment</u></b>
<p>
    I wish to thank all the participants to the "8th Italian Stata Users
    Group" meeting held in Venice (Italy) on November 17–18, 2011. A special
    thank to David Drukker for the useful discussions had with him in Venice
    and to the PhD students of the Doctoral School of Economics of the
    University of Rome "La Sapienza" who pushed me to write this routine in
    Stata 11.
<p>
<p>
<b><u>Author</u></b>
<p>
    Giovanni Cerulli
    Ceris-CNR
    Institute for Economic Research on Firms and Growth, National Research
        Council of Italy
    E-mail: g.cerulli@ceris.cnr.it
<p>
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  <b>treatreg</b>, <b>ivregress</b>, <b>pscore</b>, <b>psmatch2</b>, <b>nnmatch</b>
</pre>