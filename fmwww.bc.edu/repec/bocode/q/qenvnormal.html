<pre>
<b>help qenvnormal</b> 
-------------------------------------------------------------------------------
<p>
<b><u>Generate quantile envelopes for normal quantile-quantile plot</u></b>
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>qenvnormal</b> <i>varname</i> [<i>if</i>] [<i>in</i>] <b>,</b> <b><u>gen</u></b><b>erate(</b><i>newvar1 newvar2</i><b>)</b> [ <b>reps(</b><i>#</i><b>)</b>
                  <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <b><u>o</u></b><b>verall</b> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>qenvnormal</b> generates two numeric variables for later plotting on a
    quantile-quantile plot that define an envelope of low and high
    expectations for each quantile given repeated sampling from a normal
    distribution with the same number of values, mean and standard deviation
    as the data specified. The program is a helper program designed for use
    with qplot, which must be installed separately.  Type findit qplot to get
    references and code sources.
<p>
    When plotted, the envelopes are to be considered indicative, and not as
    implying a formal decision. In particular, the envelopes underline which
    quantiles are least reliable.  With some experience, they should guide
    later analysis.
<p>
<p>
<b><u>Remarks</u></b> 
<p>
    The precise recipe is as follows.
<p>
    1. Calculate number of values, mean and standard deviation.
<p>
    2. Take <b>reps</b> samples of the same size from a normal distribution with the
    same mean and standard deviation.
<p>
    3. Order each sample from smallest to largest.
<p>
    4. For each rank, calculate reference intervals containing <b>level</b>% of the
    sample quantiles. For example, with the default of 95%, the interval
    ranges from the 2.5% quantile to the 97.5% quantile, the quantiles being
    calculated using a procedure similar to that used for pctile.
<p>
    5. The generated variables contain values defining the reference
    intervals.
<p>
    In principle, the envelope variables could also be plotted in conjunction
    with qnorm, but that would require more work.
<p>
    This envelope approximates a separate test for each rank. The probability
    that in a variable an observation falls outside this envelope is much
    larger than 100 - <b>level</b>. When specifying the <b>overall</b> option an envelope
    will be computed such that the overall error rate will be approximately
    100 - <b>level</b> using an algorithm discussed by Davison and Hinkley (1997,
    Chapter 4).
<p>
    1. Set L to ceil((100 - <b>level</b>)/200 * <b>reps</b>).
<p>
    2. For each sample create an envelope using the remaining samples by
    storing for each rank the Lth and (<b>reps</b> - L)th smallest value, and
    determine whether the entire sample falls within this envelope. The
    proportion of samples for which this is not true is an estimate of the
    overall error rate of that envelope.
<p>
    3. Decrease L until the overall error rate is less than 100 - <b>level</b>. If
    the nominal level has not been reached when L = 1, then the entire range
    is returned and a warning is displayed reporting the approximate overall
    error rate for that envelope.
<p>
    4. Compute the envelope using all samples based on this L.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>generate()</b> specifies the names of two new variables to be generated.
        This is a required option.
<p>
    <b>reps()</b> specifies the number of samples to be taken. The default is 100.
        This is likely to be adequate for informal exploration.
<p>
    <b>level()</b> specifies the percent of sample values to be included within the
        envelope for each rank.  <b>level(100)</b> is allowed and interpreted as the
        entire range.
<p>
    <b>overall</b> specifies that an envelope with an approximate overall error rate
        of 100 - <b>level</b> is to be computed instead of a pointwise error rate of
        approximately 100 - <b>level</b>.
<p>
<p>
<b><u>Examples</u></b> 
<p>
    <b>. sysuse auto, clear</b>
    <b>. qenvnormal weight, gen(lower upper)</b>
    <b>. qplot weight lower upper, ms(oh none ..) c(. l l) lc(gs10 ..)</b>
        <b>legend(off) ytitle("Weight, lb")</b>
    <b>. su weight</b>
    <b>. scalar mean = r(mean)</b>
    <b>. scalar sd = r(sd)</b>
    <b>. qplot weight lower upper, ms(oh none ..) c(. l l) lc(gs10 ..)</b>
        <b>legend(off) ytitle("Weight, lb") trscale(`=mean' + `=sd' *</b>
        <b>invnormal(@)) xtitle(Normal quantiles)</b>
    <b>. qenvnormal weight, overall reps(2000) gen(lower2 upper2)</b>
    <b>. qplot weight lower2 upper2, ms(oh none ..) c(. l l) lc(gs10 ..)</b>
        <b>legend(off) ytitle("Weight, lb") trscale(`=mean' + `=sd' *</b>
        <b>invnormal(@)) xtitle(Normal quantiles)</b>
 
<p>
<p>
<b><u>Authors</u></b> 
<p>
    Nicholas J. Cox, Durham University
    n.j.cox@durham.ac.uk
<p>
    Maarten Buis, WZB
    maarten.buis@wzb.eu
<p>
 
<b><u>Reference</u></b>         
<p>
    Davison, A.C. and Hinkley, D.V. 1997.  <i>Bootstrap methods and their</i>
        <i>application.</i>  Cambridge: Cambridge University Press.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] diagnostic plots</b>
<p>
</pre>