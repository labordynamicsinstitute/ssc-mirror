<pre>
<b>help for xrigls</b>                                                 Patrick Royston
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Reference Interval Estimation by Generalized Least Squares</u></b>
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>xrigls</b> <i>yvar xvar</i> [<i>if</i>] [<i>in</i>] [<b>,</b> <i>major_options</i> <i>minor_options</i>]
<p>
<p>
    <i>options</i>                       Description
    -------------------------------------------------------------------------
    <i>major_options</i>
      <b><u>al</u></b><b>pha(</b><i>#</i><b>)</b>                    specifies significance level for testing
                                    between FP functions
      <b><u>ce</u></b><b>ntile(</b><i># </i>[<i># </i>...]<b>)</b>          defines the centiles of yvar|xvar
      <b>cv</b>                          models the S-curve as a coefficient of
                                    variation
      <b><u>det</u></b><b>ail</b>                      displays the final regression models
      <b>fp(</b>[<b>m:</b><i>term</i>] [<b>s:</b><i>term</i>]<b>)</b>       specifies fractional polynomial models
    <i>minor_options</i>
      <b><u>cova</u></b><b>rs(</b>[<b>m:</b><i>vars</i>] [<b>s:</b><i>vars</i>]<b>)</b>   includes variables as predictors of the
                                    mean and/or SD curve
      <b><u>cy</u></b><b>cles(</b><i>#</i><b>)</b>                   determines the number of fitting cycles
      <b><u>nogr</u></b><b>aph</b>                     suppresses the graph of the results
      <b><u>nolea</u></b><b>ve</b>                     prevents the creation of new variables
      <b><u>noti</u></b><b>dy</b>                      preserves fractional polynomial
                                    transformations
      <b><u>po</u></b><b>wers(</b><i>powlist</i><b>)</b>             defines powers for fractional polynomials
      <b><u>ro</u></b><b>pts(</b>[<b>m:</b><i>mopts</i>] [<b>s:</b><i>sopts</i>]<b>)</b>  determines regression options
      <b><u>sav</u></b><b>ing(</b><i>filename</i>[<b>, replace</b>]<b>)</b> saves the graph to a file
      <b>se</b>                          calculates standard errors of estimated
                                    centile curves
    -------------------------------------------------------------------------
<p>
    where <i>term</i> is of the form [<b>powers</b>] <i>#</i> [<i>#</i> ...]|<b>df</b> <i>#</i>.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>xrigls</b> calculates reference intervals for <i>yvar</i> based on the <i>xvar</i>- (e.g.
    age-) specific mean and standard deviation of <i>yvar</i>.  <i>yvar</i> is assumed to
    be Normally distributed, conditional on <i>xvar</i>.
<p>
<p>
<b><u>Options</u></b>
<p>
        +-------+
    ----+ Major +------------------------------------------------------------
<p>
    <b>alpha(</b><i>#</i><b>)</b> specifies the significance level for testing between degrees of
        FP for the mean and SD curves. Default : 0.05.
<p>
    <b>centile(</b><i># </i>[<i>#</i>...]<b>)</b> defines the required centiles of <i>yvar</i>|<i>xvar</i>.  Default is
        3 and 97 (i.e. a 94% reference interval).
<p>
    <b>cv</b> models the S-curve as a coefficient of variation.
<p>
    <b>detail</b> displays the final regression models for the mean and SD curves.
<p>
    <b>fp(</b>[<b>m:</b><i>term</i> [<b>, s:</b><i>term</i>]{cmd:) specifies fractional polynomial models in
        <i>xvar</i> for the mean and SD curves. <i>term</i> is of form [<b>powers</b>] <i>#</i> [<i>#</i>
        ...]|<b>df</b> <i>#</i>.  The phrase <b>powers</b> is optional.  The powers should be
        separated by spaces, for example <b>fp(m:powers 0 1, s:powers 2)</b>. If
        <b>powers</b> or <b>df</b> are not given for any curve, the default is cmd:fp(m:df
        4,s:df 2)}. <b>df</b> <i>#</i> specifies that the degrees of freedom for the
        best-fitting FP model are to be at most <i>#</i> for the curve in question.
        The powers are then determined from the data.
<p>
<p>
        +-------+
    ----+ Minor +------------------------------------------------------------
<p>
    <b>covars(</b>[<b>m:</b><i>vars</i> [<b>, s:</b><i>vars</i>]{cmd:) includes variables as predictors in the
        regression model for the mean and/or SD (S) curves.
<p>
    <b>cycles(</b><i>#</i><b>)</b> determines the number of fitting cycles (fit mean, calculate
        absolute residuals, fit absolute residuals, recalculate weights,
        etc.).  The default value of <i>#</i> is 2: an initial (unweighted) fit for
        the mean is followed by an unweighted fit of the absolute residuals;
        weights are calculated, and one weighted fit for the mean, one
        weighted fit for the absolute residuals and a final weighted fit for
        the mean are carried out.
<p>
    <b>nograph</b> suppresses a plot of <i>yvar</i> against <i>xvar</i> with fitted values and
        reference limits superimposed.  The default is to have the graph.
<p>
    <b>noleave</b> prevents the creation of new variables. The default (<b>leave</b>)
        causes new variables, appropriately labelled, containing the
        estimated mean, SD, Z- scores for <i>yvar</i> and also the centiles
        specified in <b>centile()</b>, to be created.
<p>
    <b>noselect</b> specifies that the degree of FP will be that specified in the
        <b>fp()</b> option. The default is to select a lower order FP if the
        likelihood ratio test has P-value <b>alpha()</b>.
<p>
    <b>notidy</b> preserves the variables created in the routine representing the
        fractional polynomials powers of the <i>xvar</i> used in the analysis.
<p>
    <b>powers(</b><i>powlist</i><b>)</b> specifies powers for FP models. Default <i>powlist</i> is -2,
        -1,-0.5, 0, 0.5, 1, 2, 3 (0 meaning log).
<p>
    <b>ropts(</b>[<b>m:</b><i>mopts</i>] [<b>,</b>] [<b>s:</b><i>sopts</i>]<b>)</b> determines the regression options for the
        mean and SD regression models.  Example: <b>ropt(m:nocons)</b> suppresses
        the constant for the mean curve.
<p>
    <b>saving(</b><i>filename</i>[<b>, replace</b>] saves the graph to a file (see <b>nograph</b>).
<p>
    <b>se</b> calculates the standard errors of the estimated centile curves.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <i>yvar</i> is assumed to have a normal (Gaussian) distribution.  If a constant
    SD is assumed, it is estimated by the residual mean square in the usual
    way.  Otherwise, the SD is estimated by regression of the absolute
    residuals on an FP in <i>xvar</i>.  The SD's are the predicted values from this
    regression, multiplied by the square root of pi/2 (i.e. 1.2533...).
    Since the correct regression for <i>yvar</i> should include weights proportional
    to the reciprocal of the squared SD, the regression for <i>yvar</i> is repeated
    using weights equal to the squared reciprocal of the fitted SDs. At each
    iteration, models of lower degree are also fitted. The FP with the lowest
    degree (k), for which the FP with degree k+1 is not a significantly
    better fit, is selected. The selection criteria between models may be
    specified.
<p>
    <b>xrigls</b> displays the deviance (-2 * ln likelihood) for the entire model
    (including weights derived from the fitted SD). In general, the lower the
    deviance, the better the fit of the model.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. sysuse auto</b>
<p>
    <b>. xrigls mpg weight, fp(m:1 3,s:2 2) centile(10 90) cycles(3)</b>
<p>
    The FP model with powers (1,3) is used for the mean, and the FP model
    with powers (2,2) for the SD.  Three cycles are performed. The results
    are saved in new variables. A graph of the resulting 10th, 50th and 90th
    centiles (or 80% reference interval) is given.
<p>
    <b>. xrigls mpg weight, fp(m:df 2,s:df 2) noselect powers(1 2 3) cv</b>
<p>
    The model for the mean of <b>mpg</b> is the best FP1 function of <b>weight</b>, and for
    the CV, the best degree-1 FP function of <b>weight</b>. The chosen powers will
    be a subset of {1,2,3}. A graph of the resulting 94% reference interval
    and new variables are also given.
<p>
    <b>. xrigls mpg weight, alpha(0.1) fp(m:df 2,s:df 2)</b>
<p>
    For both the mean and SD, a selection will be made between the best
    degree-1 FP function, linear and constant fits using a significance level
    of 10% in the the likelihood-ratio tests.
<p>
<p>
<b><u>Stored Results</u></b>
<p>
    <b>xrigls</b> is an R-class program and saves in the <b>r()</b> functions:
<p>
        <b>r(dev)</b>  deviance of final model
        <b>`r(mpow)'</b>       powers in final FP model for mean curve
        <b>`r(spow)'</b>       powers in final FP model for SD curve
<p>
<p>
<b><u>Authors</u></b>
<p>
    Patrick Royston, MRC Clinical Trials Unit, London.
    pr@ctu.mrc.ac.uk
<p>
    Eileen Wright, Macclesfield
<p>
<p>
<b><u>Also see</u></b>
<p>
</pre>