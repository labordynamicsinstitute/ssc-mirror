<pre>
-------------------------------------------------------------------------------
help for <b>xtivreg2</b>
-------------------------------------------------------------------------------
<p>
<b><u>Extended IV/2SLS, GMM and AC/HAC, LIML and k-class regression for panel data mo</u></b>
<b><u>&gt; dels</u></b>
<p>
    Full syntax, fixed effects and first differences models
<p>
        <b>xtivreg2</b> <i>depvar</i> [<i>varlist1</i>] <b>(</b><i>varlist2</i><b>=</b><i>varlist_iv</i><b>)</b> [<i>weight</i>] [<b>if</b> <i>exp</i>]
              [<b>in</b> <i>range</i>] <b>, {fe | fd}</b>  [<b><u>i</u></b><b>var(</b><i>varname</i><b>)</b> <b><u>t</u></b><b>var(</b><i>varname</i><b>)</b> <b>gmm</b> <b>bw(</b><i>#</i><b>)</b>
              <b>kernel(</b><i>string</i><b>)</b> <b>liml</b> <b>fuller(</b><i>#</i><b>)</b> <b>kclass(</b><i>#</i><b>)</b> <b>coviv</b> <b>cue</b> <b>cueinit(</b><i>matrix</i><b>)</b>
              <b><u>cueopt</u></b><b>ions(</b><i>string</i><b>)</b> <b><u>r</u></b><b>obust</b> <b><u>cl</u></b><b>uster(</b><i>varlist</i><b>)</b> <b>orthog(</b><i>varlist_ex</i><b>)</b>
              <b>endog(</b><i>varlist_en</i><b>)</b> <b><u>red</u></b><b>undant(</b><i>varlist_ex</i><b>)</b> <b>fwl(</b><i>varlist</i><b>)</b> <b><u>sm</u></b><b>all</b>
              <b><u>noc</u></b><b>onstant</b> <b>first</b> <b>ffirst</b> <b>savefirst</b> <b><u>savefp</u></b><b>refix(</b><i>prefix</i><b>)</b> <b>rf</b> <b>saverf</b>
              <b><u>saverfp</u></b><b>refix(</b><i>prefix</i><b>)</b> <b>nocollin</b> <b>noid</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <b><u>nohe</u></b><b>ader</b> <b><u>nofo</u></b><b>oter</b>
              <b><u>ef</u></b><b>orm(</b><i>string</i><b>)</b> <b><u>dep</u></b><b>name(</b><i>varname</i><b>)</b> <b>plus</b> ]
<p>
    Replay syntax
<p>
        <b>xtivreg2</b> [<b>,</b> <b>first</b> <b>ffirst</b> <b>rf</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <b><u>nohe</u></b><b>ader</b> <b><u>nofo</u></b><b>oter</b> <b><u>ef</u></b><b>orm(</b><i>string</i><b>)</b>
              <b><u>dep</u></b><b>name(</b><i>varname</i><b>)</b> <b>plus</b> ]}
<p>
    Version syntax
<p>
        <b>xtivreg2</b>, <b>version</b>
<p>
<p>
<b>xtivreg2</b> may be used with time-series or panel data, in which case the data can
be <b>tsset</b> before using <b>xtivreg2</b>; see help tsset.
<p>
All <i>varlists</i> may contain time-series operators; see help varlist.
<p>
<b>aweight</b>s, <b>fweight</b>s, <b>iweight</b>s and <b>pweight</b>s are allowed; see help weights.
<p>
The syntax of predict following <b>xtivreg2</b> is
<p>
        <b>predict</b> [<i>type</i>] <i>newvarname</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b> <i>statistic</i>]
<p>
For the fixed-effects estimator, <i>statistic</i> is
<p>
        <b>e</b>           v_it, the idiosyncratic component of the error term
<p>
and is available only for the estimation sample.
<p>
For the first-differences estimator, <i>statistic</i> is
<p>
        <b>e</b>           v_it - v_it-1, the first-differenced idiosyncratic
                       component
        <b>xb</b>          (X_it - X_it-1)*b_hat, the fitted values
<p>
and are available in and out of sample.  Use <b>e(sample)</b> if wanted only for the
estimation sample.
<p>
<p>
<b><u>Description</u></b>
<p>
<b>xtivreg2</b> implements IV/GMM estimation of the fixed-effects and
first-differences panel data models with possibly endogenous regressors.  It is
essentially a wrapper for <b>ivreg2</b>, which must be installed for <b>xtivreg2</b> to run
(version 2.1.11 or above of <b>ivreg2</b> is required for Stata 9; Stata 8.2 requires
<b>ivreg28</b>).  <b>xtivreg2</b> supports all the estimation and reporting options of
<b>ivreg2</b>; see help ivreg2 for full descriptions and examples.  In particular, all
the statistics available with <b>ivreg2</b> (heteroskedastic, cluster- and
autocorrelation-robust covariance matrix and standard errors,
overidentification and orthogonality tests, first-stage and
weak/underidentification statistics, etc.) are also supported by <b>xtivreg2</b> and
will be reported with any degrees-of-freedom adjustments required for a panel
data estimation.
<p>
The degrees-of-freedom adjustments depend on whether the estimation is
fixed-effects or first-differences, and whether it uses the <b>cluster</b> option.
<p>
For fixed-effects estimation without <b>cluster</b>, the covariance matrix and
regression statistics (identification and overidentification statistics,
first-stage regressions and tests, etc.) are adjusted for the number of fixed
effects N_g.  With large-sample statistics, the covariance matrix has the
adjustment (N-N_g); with small-sample statistics, the adjustment is (N-N_g-K),
where K is the number of regressors.
<p>
For fixed-effects estimation with <b>cluster</b>, <b>xtivreg2</b> makes <i>no</i> degrees-of-freedom
adjustment for the number of fixed effects.  This follows the formulation of a
cluster-robust covariance matrix for the fixed-effects model as originally
proposed by Arellano (1987); see, e.g., Wooldridge (2002), p. 275.  Stata's
official <b>xtivreg</b>, <b>xtreg</b> and <b>areg</b> (as of version 9.1, October 2005), by
contrast, use the (N-N_g-K) adjustment, which is somewhat conservative in this
context.  <i>However</i>, the approach used by <b>xtivreg2</b> requires that no panel
overlaps more than one cluster.  That is, either the panel variable is
identical to the cluster variable, or panels are uniquely assigned to clusters.
If any panel is contained in more than one cluster, the <b>xtivreg2</b> approach is
invalid, and it will exit with an error.
<p>
First-differences estimation makes no degrees-of-freedom adjustment,
irrespective of whether <b>cluster</b> is used.
<p>
Other features of <b>xtivreg2</b> and differences vs. official <b>xtivreg</b>:
<p>
   <b>xtivreg2</b> supports only the fixed effects and the first-differences panel
   models; the option <b>fe</b> or <b>fd</b> is required.  GLS random effects is not
   supported.
<p>
   <b>xtivreg2</b> does not estimate or report a constant with the fixed effects model
   <b>fe</b>.
<p>
   If <b>ivreg2</b> version 3.0 or later is installed, <b>xtivreg2</b> supports 2-way
   clustering; see help ivreg2 for details.
<p>
   First-differences estimation with <b>xtivreg2</b> yields estimates identical to
   <b>ivreg2</b> when the latter is supplied with all variables expressed in
   first-differences.
<p>
   <b>xtivreg2</b> allows use of time series operators.
<p>
   For fixed-effects estimation, the data must either be <b>tsset</b>, the panel id
   variable set with <b>iis</b>, or the panel id variable supplied to <b>xtivreg2</b> with
   the <b>ivar</b> option.  For first-differences estimation, the data must be <b>tsset</b>.
<p>
   <b>xtivreg2</b> supports all types of weights.
<p>
   The R-squared reported by <b>xtivreg2</b> for the fixed-effects estimation is the
   "within R-squared" obtained by estimating the equation in mean-deviation
   form.
<p>
   <b>xtivreg2</b> supports simple fixed effects and first-differences estimation with
   no endogeneous variables, i.e., <b>(</b><i>varlist2</i><b>=</b><i>varlist_iv</i><b>)</b> can be omitted.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . use http://fmwww.bc.edu/ec-p/data/macro/abdata.dta
        (Layard &amp; Nickell, Unemployment in Britain, Economica 53, 1986, from Ox
            dist)
<p>
        . tsset id year
<p>
(<b>xtivreg</b> vs. <b>xtivreg2</b>, fixed effects)
<p>
        . xtivreg2 ys k (n=l2.n l3.n), fe small
<p>
        . xtivreg ys k (n=l2.n l3.n), fe small
<p>
(<b>xtivreg2</b> vs. <b>ivreg2</b> vs. <b>xtivreg</b>, first-differences)
<p>
        . xtivreg2 ys k (n=l.n l2.n), fd small first
<p>
        . ivreg2 d.ys d.k (d.n=ld.n ld2.n), small first
<p>
        . xtivreg ys k (n=l.n l2.n), fd small
<p>
<p>
<b><u>Citation of xtivreg2</u></b>
<p>
<b>xtivreg2</b> is not an official Stata command. It is a free contribution to the
research community, like a paper. Please cite it as such:
<p>
    Schaffer, M.E., 2010.  xtivreg2: Stata module to perform extended
        IV/2SLS, GMM and AC/HAC, LIML and k-class regression for panel data
        models.  http://ideas.repec.org/c/boc/bocode/s456501.html
<p>
<p>
<b><u>References</u></b>
<p>
Arellano, M.  1987.  Computing Robust Standard Errors for Within-Groups
    Estimators.  Oxford Bulletin of Economics and Statistics, Vol. 49, pp.
    431-34.
<p>
Baum, C.F., Schaffer, M.E., and Stillman, S. 2003. Instrumental Variables and
    GMM:  Estimation and Testing.  The Stata Journal, Vol. 3, No. 1, pp. 1-31.
    Unpublished working paper version:  Boston College Department of Economics
    Working Paper No 545. http://fmwww.bc.edu/ec-p/WP545.pdf
<p>
Wooldridge, J.M. 2002. Econometric Analysis of Cross Section and Panel Data.
    Cambridge, MA: MIT Press.
<p>
<p>
<b><u>Author</u></b>
<p>
        Mark E Schaffer, Heriot-Watt University, UK
        m.e.schaffer@hw.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
On-line:  help for ivreg2, overid, ivendog, ivhettest, ivreset, xtoverid, 
                   condivreg (if installed)
</pre>