<pre>
-------------------------------------------------------------------------------
help for <b>xcontract</b>                                               (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Create dataset of variable combinations with frequencies and percents</u></b>
<p>
        <b>xcontract</b> <i>varlist</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b>
                 <b><u>li</u></b><b>st(</b> [<i>varlist</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [ , [<i>list_options</i>] ] <b>)</b>
                 <b><u>sa</u></b><b>ving(</b><i>filename</i>[<b>,replace</b>]<b>)</b> <b>no</b><b><u>re</u></b><b>store</b> <b>fast</b>
                 <b><u>fl</u></b><b>ist(</b><i>global_macro_name</i><b>)</b>
                 <b><u>f</u></b><b>req(</b><i>newvarname</i><b>)</b> <b><u>p</u></b><b>ercent(</b><i>newvarname</i><b>)</b> <b><u>cf</u></b><b>req(</b><i>newvarname</i><b>)</b>
                 <b><u>cp</u></b><b>ercent(</b><i>newvarname</i><b>)</b> <b><u>pty</u></b><b>pe(</b><i>storage_type</i><b>)</b> <b>by(</b><i>by_varlist</i><b>)</b>
                 <b><u>idn</u></b><b>um(</b><i>#</i><b>)</b> <b><u>nidn</u></b><b>um(</b><i>newvarname</i><b>)</b> <b><u>ids</u></b><b>tr(</b><i>string</i><b>)</b> <b><u>nids</u></b><b>tr(</b><i>newvarname</i><b>)</b>
                 <b><u>fo</u></b><b>rmat(</b><i>varlist_1 format_1 ... varlist_n format_n</i><b>)</b>
                 <b><u>z</u></b><b>ero</b> <b>nomiss</b> ]
<p>
    <b>fweight</b>s are allowed; see help for weights.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>xcontract</b> is an extended version of contract.  It creates an output data
    set with 1 observation per combination of values of the variables in
    <i>varlist</i> and data on the frequencies and percents of those combinations of
    values in the existing data set, and, optionally, the cumulative
    frequencies and percents of those combinations.  If the <b>by()</b> option is
    used, then the output data set has one observation per combination of
    values of the <i>varlist</i> variables per by-group, and percents are calculated
    within each by-group.  The output data set created by <b>xcontract</b> may be
    listed to the Stata log, or saved to a disk file, or written to the
    memory (overwriting any pre-existing data set).
<p>
<p>
<b><u>Options for use with </u></b><b><u>xcontract</u></b>
<p>
<b>xcontract</b> has a large number of options, which are listed in 3 groups:
<p>
<b>1.</b> Output-destination options.  (These specify where the output data set will
    be written.)
<p>
<b>2.</b> Output-variable options. (These specify the variables in the output data
    set.)
<p>
<b>3.</b> Other options. (These specify the observations in the output data set.)
<p>
<p>
<b><u>Output-destination options</u></b>
<p>
    <b>list(</b><i>varlist</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [, <i>list_options</i> ] <b>)</b> specifies a list of
        variables in the output data set, which will be listed to the Stata
        log by <b>xcontract</b>.  The <b>list()</b> option can be used with the <b>format()</b>
        option (see below) to produce a list of frequencies and/or percents
        with user-specified numbers of decimal places or significant figures.
        The user may optionally also specify if or in qualifiers to list
        subsets of combinations of variable values, or change the display
        style using a list of <i>list_options</i> allowed as options by the list
        command.  If <b>by(</b><i>by_varlist</i><b>)</b> is used, then the combinations are listed
        by the by-groups defined by <i>by_varlist</i>.
<p>
    <b>saving(</b><i>filename</i>[<b>,replace</b>]<b>)</b> saves the output data set to a disk file.  If
        <b>replace</b> is specified, and a file of that name already exists, then
        the old file is overwritten.
<p>
    <b>norestore</b> specifies that the output data set will be written to the
        memory, overwriting any pre-existing data set. This option is
        automatically set if <b>fast</b> is specified. Otherwise, if <b>norestore</b> is
        not specified, then the pre-existing data set is restored in the
        memory after the execution of <b>xcontract</b>.
<p>
    <b>fast</b> is a stronger version of <b>norestore</b>, intended for use by programmers.
        It specifies that the pre-existing data set in the memory will not be
        restored, even if the user presses Break during the execution of
        <b>xcontract</b>.  If <b>norestore</b> is specified and <b>fast</b> is absent, then
        <b>xcontract</b> will go to extra work so that it can restore the original
        data if the user presses Break.
<p>
    Note that the user must specify at least one of the four options <b>list()</b>,
        <b>saving()</b>, <b>norestore</b> and <b>fast</b>. These four options specify whether the
        output data set is listed to the Stata log, saved to a disk file, or
        written to the memory (overwriting any pre-existing data set). More
        than one of these options can be specified.
<p>
    <b>flist(</b><i>global_macro_name</i><b>)</b> specifies the name of a global macro, containing
        a filename list (possibly empty). If <b>saving()</b> is also specified, then
        <b>xcontract</b> will append the name of the data set specified in the
        <b>saving()</b> option to the value of the global macro specified in
        <b>flist()</b>. This enables the user to build a list of filenames in a
        global macro, containing the output of a sequence of output data
        sets.  These files may later be concatenated using append, or using 
        dsconcat (downloadable from SSC) if installed.
<p>
<p>
<b><u>Output-variable options</u></b>
<p>
    <b>freq(</b><i>newvarname</i><b>)</b> specifies a name for the frequency variable.  If not
        specified, <b>_freq</b> is used.
<p>
    <b>percent(</b><i>newvarname</i><b>)</b> specifies a name for the percent variable.  If not
        specified, <b>_percent</b> is used.  If the <b>by()</b> option is used, then the
        percent for each combination of values of the <i>varlist</i> variables in
        each by-group is calculated as a percent of the by-group.
<p>
    <b>cfreq(</b><i>newvarname</i><b>)</b> specifies a name for the cumulative frequency variable.
        If not specified, no cumulative frequency variable is created.  If
        the <b>by()</b> option is used, then the cumulative frequency for each
        combination of values of the <i>varlist</i> variables in each by-group is
        calculated as a cumulative frequency within the by-group.
<p>
    <b>cpercent(</b><i>newvarname</i><b>)</b> specifies a name for the cumulative percent
        variable.  If not specified, no cumulative percent variable is
        created.  If the <b>by()</b> option is used, then the cumulative percent for
        each combination of values of the <i>varlist</i> variables in each by-group
        is calculated as a cumulative percent of the by-group.
<p>
    <b>ptype(</b><i>storage_type</i><b>)</b> specifies a storage type for generating the percent
        variables specified by <b>percent()</b> and <b>cpercent()</b>.  If <b>type()</b> is not
        specified, then these variables will be generated as variables of
        type float. All generated variables are compressed to the smallest
        storage type possible without loss of precision. See help for 
        compress.
<p>
    <b>by(</b><i>by_varlist</i><b>)</b> specifies a list of by-variables. If <b>by()</b> is specified,
        then all percents will be calculated as percents of their by-groups.
        Note that, if the if expression or the weight expression contains the
        reserved names <b>_n</b> and <b>_N</b>, then these will be interpreted as the
        observation sequence number and the number of observations,
        respectively, within the whole data set, not within the by-group.
<p>
    <b>idnum(</b><i>#</i><b>)</b> specifies an ID number for the output data set.  It is used to
        create a numeric variable, with default name <b>idnum</b>, in the output
        data set, with that value for all observations.  This is useful if
        the output data set is concatenated with other <b>xcontract</b> output data
        sets using append, or using dsconcat if installed.
<p>
    <b>nidnum(</b><i>newvarname</i><b>)</b> specifies a name for the numeric ID variable evaluated
        by <b>idnum()</b>. If <b>idnum()</b> is present and <b>nidnum()</b> is absent, then the
        name of the numeric ID variable is set to <b>idnum</b>.
<p>
    <b>idstr(</b><i>string</i><b>)</b> specifies an ID string for the output data set.  It is used
        to create a string variable, with default name <b>idstr</b> in the output
        data set, with that value for all observations.  This is useful if
        the output data set is concatenated with other <b>xcontract</b> output data
        sets using append, or using dsconcat if installed.
<p>
    <b>nidstr(</b><i>newvarname</i><b>)</b> specifies a name for the string ID variable evaluated
        by <b>idstr()</b>. If <b>idstr()</b> is present and <b>nidstr()</b> is absent, then the
        name of the string ID variable is set to <b>idstr</b>.
<p>
    <b>format(</b><i>varlist_1 format_1 ... varlist_n format_n</i><b>)</b> specifies a list of
        pairs of variable lists and display formats.  The formats will be
        allocated to the variables in the output data set specified by the
        corresponding <i>varlist_i</i> lists.  If the <b>format()</b> option is absent,
        then the percent variables have the format <b>%8.2f</b>, the frequency
        variables have the format <b>%12.0g</b>, and the other variables have the
        same formats as the variables of the same names in the input data
        set.
<p>
<p>
<b><u>Other options</u></b>
<p>
    <b>zero</b> specifies that combinations of values of the variables in <i>varlist</i>
        with zero frequency in the input data set will be included in the
        output data set.
<p>
    <b>nomiss</b> specifies that observations with missing values for any of the
        variables in <i>varlist</i> will be excluded from the output data set.  If
        not specified, all observations are included, except if excluded by
        the if and in qualifiers or given zero weights.
<p>
<p>
<b><u>Examples</u></b>
<p>
The following examples use the <b>list()</b> option to list the output data set to the
Stata log.  After these examples are executed, there is no new data set either
in the memory or on disk.
<p>
    <b>. xcontract foreign rep78, list(,)</b>
<p>
    <b>. xcontract foreign rep78, zero list(,clean noobs)</b>
<p>
    <b>. xcontract foreign rep78, f(count) p(percent) cf(ccount) cp(cpercent)</b>
        <b>zero nomiss list(*,clean noobs)</b>
<p>
    <b>. xcontract rep78, by(foreign) fr(frequency) per(percentage) cf(cumfreq)</b>
        <b>cp(cumperc) pty(double) format(percentage cumperc %4.0f)</b>
        <b>list(rep78-cumperc,clean noobs abbrev(16))</b>
<p>
    <b>. xcontract _all, list(*,clean noobs)</b>
<p>
The following examples use the <b>norestore</b> option to create an output data set in
the memory, overwriting any pre-existing data set.
<p>
    <b>. xcontract foreign rep78, norestore</b>
<p>
    <b>. xcontract foreign rep78, zero norestore</b>
<p>
    <b>. xcontract foreign rep78, f(count) p(percent) cf(ccount) cp(cpercent)</b>
        <b>zero nomiss norestore</b>
<p>
    <b>. xcontract rep78, by(foreign) fr(frequency) per(percentage) cf(cumfreq)</b>
        <b>cp(cumperc) pty(double) format(percentage cumperc %4.0f) norestore</b>
<p>
    <b>. xcontract _all, norestore</b>
<p>
The following examples use the <b>saving()</b> option to create an output data set in
a disk file.
<p>
    <b>. xcontract foreign rep78, saving(myfreq1.dta)</b>
<p>
    <b>. xcontract foreign rep78, zero saving(myfreq2.dta,replace)</b>
<p>
    <b>. xcontract foreign rep78, f(count) p(percent) cf(ccount) cp(cpercent)</b>
        <b>zero nomiss saving(myfreq3.dta,replace)</b>
<p>
    <b>. xcontract rep78, by(foreign) fr(frequency) per(percentage) cf(cumfreq)</b>
        <b>cp(cumperc) pty(double) format(percentage cumperc %4.0f)</b>
        <b>saving(myfreq4.dta,replace)</b>
<p>
    <b>. xcontract _all, saving(myfreq5.dta,replace)</b>
<p>
<p>
<b><u>Acknowledgements</u></b>
<p>
I would like to thank Nicholas J. Cox of Durham University, UK for some very
helpful advice about writing efficient code, and also for writing the original
version of contract, from which I re-engineered some of the code for <b>xcontract</b>.
I would also like to thank StataCorp for writing fillin, from which I also
re-engineered some of the code for <b>xcontract</b>.
<p>
<p>
<b><u>Author</u></b>
<p>
Roger Newson, Imperial College London, UK.  Email: r.newson@imperial.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] contract</b>, <b>[R] collapse</b>, <b>[R] fillin</b>, <b>[R] compress</b>, <b>[R]</b>
             <b>format</b>, <b>[R] expand</b>, <b>[R] duplicates</b>
<p>
    Online:  help for contract, collapse, fillin, compress, format, expand, 
             duplicates
             help for xcollapse, dsconcat if installed
</pre>