<pre>
<b>help xriml</b>                                                      Patrick Royston
-------------------------------------------------------------------------------
<p>
<b><u>Reference Interval Estimation by Maximum Likelihood</u></b>
<p>
<p>
<b><u>Syntax</u></b>
<p>
<p>
        <b>xriml</b> <i>yvar</i> [<i>xvar</i>] [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <b><u>di</u></b><b>st(</b><i>distribution_code</i><b>)</b>
            [<i>major_options</i> <i>minor_options</i>]
<p>
<p>
    <i>options</i>                         Description
    -------------------------------------------------------------------------
    <i>major</i>
      <b><u>ce</u></b><b>ntile(</b><i>numlist</i><b>)</b>              defines the required centiles of
                                      <i>yvar</i>|<i>xvar</i>
      <b>fp(</b><i>terms</i><b>)</b>                     specifies the fractional polynomial
                                      power(s) in <i>xvar</i> for the M, S, G and D
                                      regression models
    <i>minor</i>
      <b><u>ce</u></b><b>ns(</b><i>censvar</i><b>)</b>                 defines a censoring variable
      <b><u>cova</u></b><b>rs(</b><i>covar_list</i><b>)</b>            includes variables as predictors in the
                                      regression models for the M, S, G and D
                                      curves
      <b>cv</b>                            parametrizes the S-curve to be a
                                      coefficient of variation
      <b><u>in</u></b><b>it(</b><i>terms</i><b>)</b>                   specifies initial values for the G and D
                                      curves
      <b><u>lt</u></b><b>olerance(</b><i>#</i><b>)</b>                 is a convergence criterion for the
                                      iterative fitting process
      <b><u>nod</u></b><b>etail</b>                      suppresses display of details of the
                                      iterative fitting algorithm
      <b><u>nogr</u></b><b>aph</b>                       suppresses the plot of the age-specific
                                      reference interval
      <b><u>noout</u></b><b>ofsample</b>                 restricts prediction of M, S, G and D
                                      curves and Z-scores to the estimation
                                      sample
      <b><u>off</u></b><b>set(</b><i>varname</i><b>)</b>               adds <i>varname</i> to the M-curve of the model
      <b>plot(</b><i>plot</i><b>)</b>                    provides a way to add other plots to the
                                      generated graph; see help plot option
      <b><u>scat</u></b><b>ter(</b><i>scatter_options</i><b>)</b>      are options of scatter
      <b>se</b>                            produces standard errors of the M, S, G
                                      and D curves, and reference intervals
      <i>line_options</i>                  options allowed with line
    -------------------------------------------------------------------------
<p>
    where <i>distribution_code</i> is one of <b>n</b>|<b>en</b>|<b>men</b>|<b>pn</b>|<b>mpn</b>|<b>sl</b>.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>xriml</b> calculates cross-sectional reference intervals for <i>yvar</i>, which is
    assumed to follow one of 6 possible distributions.  The parameters are
    estimated by maximum likelihood.
<p>
    If <i>xvar</i> is specified, reference intervals for <i>yvar</i> conditional on <i>xvar</i>
    are estimated. Typically, <i>xvar</i> is age. The parameters of the distribution
    are modelled as functions of <i>xvar</i> using fractional polynomials (see 
    fracpoly).
<p>
    <b>xriml</b> without variables or options displays the results of the most
    recent estimation.
<p>
    <b>NOTE</b>: the default prediction behaviour of <b>xriml</b> changed at version 6.0.0.
    The <b>all</b> option has been replaced with a <b>nooutofsample</b> option; please see
    the description of the latter under <i>Minor options</i> below.
<p>
<p>
<b><u>Options</u></b>
<p>
        +---------------+
    ----+ Major options +----------------------------------------------------
<p>
    <b>distribution(</b><i>distribution_code</i><b>)</b> is NOT optional.  Valid
        distribution_codes are Normal (<b>n</b>), exponential-Normal (<b>en</b>),
        modulus-exponential-Normal (<b>men</b>), power-Normal (or Box-Cox) (<b>pn</b>),
        modulus power-Normal (<b>mpn</b>) and shifted (or three-parameter) lognormal
        (<b>sl</b>).
<p>
    <b>centile(</b><i>numlist</i><b>)</b> defines the required centiles of <i>yvar</i>|<i>xvar</i>.  Default
        <i>numlist</i> is <b>3 97</b> (i.e. a 94% reference interval).
<p>
    <b>fp(</b>[<b>m:</b><i>term</i>] [<b>, s:</b><i>term</i>] [<b>, g:</b><i>term</i>] [<b>, d:</b><i>term</i>]<b>)</b> specifies the fractional
        polynomial power(s) in <i>xvar</i> for the M, S, G and (for the
        four-parameter distributions only) D regression models.
<p>
        <i>term</i> is of form [<i>powers</i>] <i>#</i> [<i>#</i> ...]|<b>fix</b> <i>#</i>.  The phrase <i>powers</i> is
        optional.  The powers should be separated by spaces, for example
        <b>fp(m:powers 0 1, s:powers 2)</b>, or equivalently <b>fp(m:0 1, s:2)</b>. If
        <i>powers</i> or <b>fix</b> are not specified for any curve, the curve is assumed
        to be a constant (<b>_cons</b>) estimated from the data.
<p>
        <b>fix</b> <i>#</i> implies that the corresponding curve is NOT to be estimated
        from the data, but is to be fixed at <i>#</i>. <b>fix</b> is valid only with <b>g:</b> and
        <b>d:</b>.
<p>
        Default: constants for each curve (M, S, G; D if applicable).
<p>
        +---------------+
    ----+ Minor options +----------------------------------------------------
<p>
    <b>cens(</b><i>censvar</i><b>)</b> defines <i>censvar</i> as the censoring variable for data in which
        some observations are left- (<i>censvar</i> = -1) or right- (<i>censvar</i> = 1)
        censored.  Uncensored observations have <i>censvar</i> = 0.
<p>
    <b>covars(</b>[<b>m:</b><i>mcovars</i>] [<b>, s:</b><i>scovars</i>] [<b>, g:</b><i>gcovars</i>] [<b>, d:</b><i>dcovars</i>]<b>)</b> includes
        <i>mcovars</i> (<i>scovars</i>, <i>gcovars</i>, <i>dcovars</i>) variables as predictors in the
        regression model for the M (S, G, D if applicable) curves.
<p>
    <b>cv</b> parametrizes the S-curve to be a coefficient of variation (CV,
        standard deviation divided by median), rather than a standard
        deviation.
<p>
    <b>init(</b>[<b>g:</b><i>#</i>] [<b>, d:</b><i>#</i>]<b>)</b> specifies initial values for the G (<b>g:</b>) and (where
        applicable) D (<b>d:</b>) parameter curves. Defaults are shown below.
<p>
        Distribution     Default # for G    Default # for D
        ---------------------------------------------------
        <b>n</b>                     N/A                N/A
        <b>en</b>                    0.01               N/A
        <b>men</b>                  -0.2                 1
        <b>pn</b>                    1                  N/A
        <b>mpn</b>                   1                   1
        <b>sl</b>                    0                  N/A
        ---------------------------------------------------
<p>
    <b>ltolerance(</b><i>#</i><b>)</b> is a convergence criterion for the iterative fitting
        process.  For convergence, the difference between the final two
        values of the log likelihood must be less than <i>#</i>.  Default <i>#</i> is
        0.001.
<p>
    <b>nodetail</b> suppresses display of the steps of the iterative fitting
        algorithm and of the estimated regression coefficients and confidence
        intervals.
<p>
    <b>nograph</b> suppresses the default plot of <i>yvar</i> against <i>xvar</i> with fitted
        median and reference limits.
<p>
    <b>nooutofsample</b> restricts prediction of M, S, G and D curves, standard
        errors (when specified) and Z-scores to the estimation sample. The
        default is to predict in-sample and out-of-sample for all available
        observations of <i>xvar</i> and <i>yvar</i>.
<p>
    <b>offset(</b><i>varname</i><b>)</b> offsets <i>varname</i>, that is, <i>varname</i> is added to the M-curve
        of the model.
<p>
    <b>plot(</b><i>plot</i><b>)</b> provides a way to add other plots to the generated graph; see
        help plot option.
<p>
    <b>saving(</b><i>filename</i> [<b>, replace</b>]<b>)</b> saves the graph to a file (see <b>nograph</b>).
<p>
    <b>scatter(</b><i>scatter_options</i><b>)</b> are options of scatter.  These should be
        specified to control the rendering of the original data points.
<p>
    <b>se</b> produces standard errors of the M, S, G (and if applicable, D) curves.
        Standard errors of the estimated reference limits are also
        calculated.  Warning: This option is computationally intensive when
        determining SEs of centiles, and may take considerable time on a slow
        computer and/or with a large dataset.
<p>
    <i>line_options</i> are any of the options allowed with line.  These should be
        specified to control the rendering of the smoothed lines or the
        overall graph.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    All the models fitted by <b>xriml</b> are defined by transformations of the
    original data towards a Normal distribution (the `identity
    transformation' in the case of the Normal model). The shape parameter(s)
    of the resulting distributions may either be estimated from the data or
    fixed by the user.
<p>
    Estimation is by maximum likelihood and is iterative. For the
    three-parameter models, the fit should converge within about 4-8
    iterations. For the four-parameter models, about 5-15 iterations are
    needed in most cases.
<p>
    The <b>pn</b> and <b>mpn</b> models may be used only with data which are positive in
    value.  The restriction does not apply to any of the other models.
<p>
    Each of the <b>en</b>, <b>pn</b> and <b>sl</b> distributions has 3 parameters known as M (mu,
    the median), S (sigma, the scale factor) and G (gamma, generic name for
    the shape parameter).  M is modelled as a fractional polynomial (FP)
    function of xvar.  S and G may also be modelled as FP functions of xvar,
    or may be treated as constants to be estimated from the data.
<p>
    The <b>mpn</b> (modulus power-Normal) and <b>men</b> (modulus exponential-Normal)
    distributions are governed by four parameters, M, S, G and D.  There are
    two shape parameters, G (gamma) and D (delta).  Delta = 1 gives the
    `parent' <b>pn</b> and <b>en</b> (power-Normal and exponential-Normal) distributions
    respectively.  If delta &lt; 1 the distribution has longer tails than the
    corresponding `parent' distribution, and vice versa for delta &gt; 1.  The
    distributions with gamma = 1 for the <b>mpn</b> and gamma = 0 for the <b>men</b> are
    symmetric.
<p>
    The <b>en</b> (<b>men</b>) and <b>pn</b> (<b>mpn</b>) models are essentially identical in that if Y
    has a <b>pn</b> (<b>mpn</b>) distribution, then log Y has an <b>en</b> (<b>men</b>) distribution.
    However, the parameter values from the two models will differ, since in
    the first case the M curve is the median of Y, whereas in the second it
    is the median of log Y.  The S curves from the <b>en</b> and <b>men</b> models for log
    Y have the character of a CV for Y.
<p>
    Note that fractional polynomial transformations of <i>xvar</i> are adjusted such
    that the transformed value is 0 at the mean of <i>xvar</i>.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. use foothemi.dta</b>
<p>
    <b>. generate y = log(foot)</b>
<p>
    <b>. xriml y gawks, fp(m:-2 -2, s:1) dist(en)</b>
<p>
    <b>. xriml y gawks, fp(m:-2 -2, s:1, g:fix 0) dist(men) se</b>
<p>
    <b>. xriml foot gawks, fp(m:powers 2 2, s:powers 2) dist(pn)</b>
<p>
    <b>. xriml foot gawks, fp(m:2 2) dist(pn) saving(g1, replace)</b>
<p>
    <b>. xriml foot gawks, fp(m:2 2) dist(pn) cv</b>
<p>
    <b>. xriml foot gawks, fp(m:1, s:-1, g:0) dist(en) nooutofsample</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Patrick Royston, MRC Clinical Trials Unit, London.
    patrick.royston@ctu.mrc.ac.uk
<p>
    Eileen Wright, Macclesfield
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] fracpoly</b>
<p>
    Online:  fracpoly, xrigls (when installed)
</pre>