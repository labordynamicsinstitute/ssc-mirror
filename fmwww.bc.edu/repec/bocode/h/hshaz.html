<pre>
-------------------------------------------------------------------------------
help for <b>hshaz</b>                               Stephen P. Jenkins (December 2005)
-------------------------------------------------------------------------------
<p>
<b><u>Discrete time (grouped data) proportional hazards models</u></b>
<p>
        <b>hshaz</b> <i>covariates</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b> <b><u>i</u></b><b>d(</b><i>idvar</i><b>)</b>
                 <b><u>d</u></b><b>ead(</b><i>deadvar</i><b>)</b> <b><u>s</u></b><b>eq(</b><i>seqvar</i><b>)</b> <b><u>n</u></b><b>mp(</b><i>#</i><b>)</b> <b>m2(</b><i>#</i><b>)</b> <b>p2(</b><i>#</i><b>)</b> <b>m3(</b><i>#</i><b>)</b> <b>p3(</b><i>#</i><b>)</b>
                 <b>m4(</b><i>#</i><b>)</b> <b>p4(</b><i>#</i><b>)</b> <b>m5(</b><i>#</i><b>)</b> <b>p5(</b><i>#</i><b>)</b> <b><u>ef</u></b><b>orm</b> <b>nocons</b> <b>nolog</b> <b><u>nob</u></b><b>eta0</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>
                 <i>maximize_options</i>]
<p>
    <b>by</b> <i>...</i> <b>:</b> may be used with <b>hshaz</b>; see help by.
<p>
    <b>fweight</b>s and <b>iweight</b>s are allowed; see help weights.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>hshaz</b> estimates, by ML, two discrete time (grouped data) proportional
    hazards regression models, one of which incorporates a discrete mixture
    distribution to summarize unobserved individual heterogeneity (or
    'frailty').  Covariates may include regressor variables summarizing
    observed differences between persons (either fixed or time-varying), and
    variables summarizing the duration dependence of the hazard rate.  With
    suitable definition of covariates, models with a fully non-parametric
    specification for duration dependence may be estimated; so too may
    parametric specifications.  <b>hshaz</b> thus provides a useful complement to
    <b>stcox</b> (for continuous survival time data), and related programs.  For
    further discussion of hazard regression models with unobserved
    heterogeneity, see e.g. 
    http://www.iser.essex.ac.uk/teaching/stephenj/ec968/index.php, espcially
    `Lesson 7'. The Lesson also shows how to derive predicted hazard and
    survivor functions from the estimates of the model.
<p>
    <b>hshaz</b> estimates two models by maximum likelihood:  (1) the
    Prentice-Gloeckler (1978) model; and (2) the Prentice-Gloeckler (1978)
    model incorporating a discrete mixture distribution to summarize
    unobserved individual heterogeneity, as proposed by Heckman and Singer
    (1984).  (To estimate a model incorporating Gamma distributed
    heterogeneity, use <b>pgmhaz8</b>.)
<p>
    Suppose there are individuals <i>i</i> = 1,...,<i>N</i>, who each enter a state (e.g.
    unemployment) at time <i>t</i> = 0 and are observed for <i>j</i> time periods, at which
    point each person either remains in the state (censored duration data) or
    leaves the state (complete duration data).
<p>
    In Model 1, the discrete hazard rate in period <i>t</i> is
<p>
                         <i>h_t</i> = 1-exp(-exp(<i>b0</i> + <i>X_it*b</i>))
<p>
    where <i>b0</i> is an intercept and the linear index function, <i>X_it*b</i>,
    incorporates the impact of covariates <i>X_it</i>. The contribution to the
    sample likelihood for a subject with a spell length of <i>j</i> periods is
<p>
                           <i>S</i>(<i>j</i>) * (<i>h_j</i>/(1 - <i>h_j</i>))^<i>c</i> 
<p>
    where <i>S</i>(<i>j</i>) is the probability of remaining in the state <i>j</i> periods, i.e.
    the survivor function, and <i>c</i> is a censoring indicator, equal to one for a
    completed spell and zero otherwise.
<p>
    Suppose now that each individual belongs to one of a number of different
    types, and membership of each class is unobserved. This is parameterized
    by allowing the intercept term in the hazard function to differ across
    types. Thus, for a model with types <i>z</i> = 1,...,<i>Z</i>, the hazard function for
    an individual belonging to type <i>z</i> is:
<p>
                     <i>hz_t</i> = 1-exp(-exp(<i>m_z</i> + <i>b0</i> + <i>X_it*b</i>))
<p>
    and the probability of belonging to type <i>z</i> is <i>p_z</i>. The <i>m_z</i> characterize
    the discrete points of support of a multinomial distribution (`mass
    points'), with <i>m_1</i> normalized to equal zero and <i>p_1</i> = 1 - SUM(<i>z</i>=2 to
    <i>z</i>=<i>Z</i>)[ <i>p_z</i> ]. The <i>z</i>th mass point equals <i>m_z + b0</i>.
<p>
    In <b>hshaz</b>, the default number of mass points is 2, but optionally may be
    set equal to 3, 4, or 5.
<p>
    The contribution to the sample likelihood of a subject with observed
    duration <i>j</i> is:
<p>
          <i>L</i> = SUM(<i>z</i>=1 to <i>z</i>=<i>Z</i>) [ <i>p_z</i> * <i>Sz</i>(<i>j</i>) * (<i>hz_j</i>/(1 - <i>hz_j</i>))^<i>c</i> ]  
<p>
    For suitably re-organised data, the log-likelihood function for Model 1
    is the same as the log-likelihood for a generalized linear model of the
    binomial family with complementary log-log link: see Allison (1982) or
    Jenkins (1995).  Model 1 is estimated using the glm command (cloglog
    produces the same estimates).
<p>
    Model 2 is estimated using <b>ml d0</b>. Heckman and Singer (1984) note
    potential problems with finding the global maxima rather multiple local
    maxima, and emphasize the benefits of estimating models with alternative
    sets of starting values to check convergence. Different starting values
    for the mass points and associated probabilities may be set optionally:
    see below. See also the discussion of <i>maximize_options</i> below.
<p>
<p>
<b><u>Important note about data organization and variables</u></b>
<p>
    The data set must be organised beforehand so that there is a data row
    corresponding to each time period at risk of the event for each subject.
    (This corresponds to `episode splitting' at each and every period.) 
    expand is useful for putting the data in this form.  Also see the `data
    step' discussion in Jenkins (1995).
<p>
<b><u>Options</u></b>
<p>
    The first three options are required:
<p>
    <b>id(</b><i>idvar</i><b>)</b> specifies the variable uniquely identifying each subject, <i>i</i>.
<p>
    <b>seq(</b><i>seqvar</i><b>)</b> is the variable uniquely identifying each time period at risk
        for each subject. For each <i>i</i> at risk <i>j</i> periods, the variable is the
        integer sequence 1, 2, ..., <i>j_i</i>.
<p>
    <b>dead(</b><i>deadvar</i><b>)</b> summarizes censoring status during each time period at
        risk.  If <i>c_i</i> = 0, deadvar = 0 for all <i>t</i> = 1, 2, ..., <i>j_i</i>; if <i>c_i</i> =
        1, <i>deadvar</i> = 0 for all <i>t</i> = 1,2,...,<i>(j_i)</i>-1, and <i>deadvar</i> = 1 for <i>t</i> =
        <i>j_i</i>.
<p>
    <b>nmp(</b><i>#</i><b>)</b> specifies the number of discrete points of support <i>Z</i>.  The default
        is two.
<p>
    <b>m2(</b><i>#</i><b>)</b>, <b>m3(</b><i>#</i><b>)</b>, <b>m4(</b><i>#</i><b>)</b>, <b>m5(</b><i>#</i><b>)</b>, specify starting values for <i>m_2</i>, <i>m_3</i>, <i>m_4</i>,
        <i>m_5</i>. The default values are 1, -1, 0.1, -0.1, respectively.
<p>
    <b>p2(</b><i>#</i><b>)</b>, <b>p3(</b><i>#</i><b>)</b>, <b>p4(</b><i>#</i><b>)</b>, <b>p5(</b><i>#</i><b>)</b>, specify starting values for the probabilities
        of belonging to types 2, 3, 4, and 5.  The default values are 0.3,
        0.3, 0.1, 0.1, respectively.
<p>
    <b>eform</b> reports the coefficients transformed to hazard ratio format, i.e.
        exp(b) rather than b. Standard errors and confidence intervals are
        similarly transformed. <b>eform</b> may be specified at estimation or when
        redisplaying results.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the significance level, in percent, for confidence
        intervals of the parameters; see help level.
<p>
    <b>nocons</b> specifies no intercept term, i.e. <i>b0</i> = 0.
<p>
    <b>nolog</b> suppresses the iteration logs.
<p>
    <b>nobeta0</b> suppresses reporting of the estimates from Model 1.
<p>
    <i>maximize_options</i> control the maximization process. The options available
        are those available for <b>ml d0</b> as shown by help maximize, with the
        exception of <b>from()</b>.  For difficult maximization problems, using the
        <b>difficult</b> or <b>technique</b> options may help convergence.  So too might
        different starting values for the frailty parameters.
<p>
<p>
<b><u>Saved results</u></b>
<p>
    In addition to the usual results saved after <b>ml</b>, <b>hshaz</b> also saves the
    following:
<p>
    <b>e(m2)</b> and <b>e(se_m2)</b>, <b>e(m3)</b> and <b>e(se_m3)</b>, <b>e(m4)</b> and <b>e(se_m4)</b>, <b>e(m5)</b> and
    <b>e(se_m5)</b>, are the estimated <i>m_z</i> and their corresponding standard errors.
    <b>e(m1)</b> = 0.
<p>
    <b>e(pr1)</b> and <b>e(se_pr1)</b>, <b>e(pr2)</b> and <b>e(se_pr2)</b>, <b>e(pr3)</b> and <b>e(se_pr3)</b>, <b>e(pr4)</b>
    and <b>e(se_pr4)</b>, <b>e(pr5)</b> and <b>e(se_pr5)</b>, are the estimated probabilities of
    each type and their corresponding standard errors. <b>e(pr1)</b> = 1 - SUM(<i>z</i>=2
    to <i>z</i>=<i>Z</i>)[<b>e(prz)</b>].
<p>
    <b>e(ll_nofr)</b> is the log-likelihood value from Model 1.
<p>
    <b>e(depvar)</b>, <b>e(deadvar)</b>, and <b>e(seqvar)</b> contain the names of <i>depvar</i>,
    <i>deadvar</i>, and <i>seqvar</i>.
<p>
    <b>e(N_spell)</b> is the number of spells in the data. (Cf. <b>e(N)</b>, the total
    number of `person-period' observations in the estimation data set.)
<p>
<p>
<b><u>Examples</u></b>
<p>
    . sysuse cancer, clear
<p>
    . ge id = _n
<p>
    . recode drug 1=0 2/3=1
<p>
    . expand studytime
<p>
    . bysort id: ge t = _n // 'survival time', t, is # periods at risk per
        subject
<p>
    . bysort id: ge dead = died &amp; _n==_N // event indicator
<p>
    . // duration dependence: log(time)
<p>
    . ge logt = ln(t)
<p>
    . // two mass points
<p>
    . hshaz drug age logt, id(id) seq(t) d(dead)
<p>
    . hshaz, eform
<p>
    . // equivalent model estimated using -gllamm-
<p>
    . gllamm dead age drug logt , i(id) ip(fn) nip(2) f(bin) l(cll) allc
        nocons
<p>
    . // three mass points
<p>
    . hshaz drug age logt, id(id) seq(t) d(dead) nmp(3) difficult tech(dfp)
<p>
<p>
<b><u>Author</u></b>
<p>
    Stephen P. Jenkins &lt;stephenj@essex.ac.uk&gt;, Institute for Social and
    Economic Research, University of Essex, Colchester CO4 3SQ, U.K.
<p>
<b><u>Acknowledgements</u></b>
<p>
    Adrienne tenCate found a bug in the handling of fweighted data, and Jeff
    Pitblado showed me how to fix it. Arne Uhlendorff and Peter Haan found a
    bug in the calculation of the SEs for the estimated probabilities of the
    various Types.
<p>
<b><u>References</u></b>
<p>
    Allison, P.D. (1982). Discrete-time methods for the analysis of event
        histories. In <i>Sociological Methodology 1982</i>, ed. S. Leinhardt, San
        Francisco: Jossey-Bass Publishers, 61-97.
<p>
    Heckman, J.J. and Singer, B. (1984). A Method for minimizing the impact
        of distributional assumptions in econometric models for duration
        data, <i>Econometrica</i>, 52 (2): 271-320.
<p>
    Jenkins, S.P. (1995). Easy estimation methods for discrete-time duration
        models. <i>Oxford Bulletin of Economics and Statistics</i> 57 (1): 129-138.
<p>
    Prentice, R. and Gloeckler L. (1978). Regression analysis of grouped
        survival data with application to breast cancer data.  <i>Biometrics</i> 34
        (1): 57-67.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Help for stcox, glm, cloglog, xtcloglog, expand, and, if installed, 
             pgmhaz, pgmhaz8.
<p>
</pre>