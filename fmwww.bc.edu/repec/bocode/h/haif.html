<pre>
-------------------------------------------------------------------------------
help for <b>haif</b> and <b>haifcomp</b>                                       (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Homoskedastic adjustment inflation factors for model selection</u></b>
<p>
        <b>haif</b> [ <i>corevarlist</i> ] [<i>if</i>] [<i>in</i>] [<i>weight</i>] , <b><u>a</u></b><b>ddvars(</b><i>varlist</i><b>)</b> [
                     <b><u>noc</u></b><b>onstant</b> ]
<p>
        <b>haifcomp</b> [ <i>corevarlist</i> ] [<i>if</i>] [<i>in</i>] [<i>weight</i>] , <b><u>da</u></b><b>ddvars(</b><i>varlist</i><b>)</b>
                     <b><u>na</u></b><b>ddvars(</b><i>varlist</i><b>)</b> [ <b><u>noc</u></b><b>onstant</b> ]
<p>
    where <i>corevarlist</i> is a <i>varlist</i> (possibly empty).
<p>
    <b>aweight</b>s, <b>fweight</b>s, and <b>iweight</b>s are allowed; see help for weight.
<p>
    <i>corevarlist</i> may contain factor variables; see fvvarlist.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>haif</b> calculates homoskedastic adjustment inflation factors (HAIFs) for
    core variables in the <i>corevarlist</i>, caused by adjustment by the additional
    variables specified by <b>addvars()</b>.  HAIFs are calculated for the variances
    and standard errors of estimated linear regression parameters
    corresponding to the core variables.  For each variance (or standard
    error), the HAIF is defined as the ratio between that variance (or
    standard error) of that parameter, in a model containing both the core
    variables and the additional variables, to the corresponding variance (or
    standard error) of the same parameter, in a model containing only the
    core variables, calculated assuming that the second model is true, and
    also assuming that the outcome variable is homoskedastic (meaning that it
    has equal variances in all subpopulations defined by the predictor
    variables).  <b>haifcomp</b> calculates the ratios between the HAIFs for the
    same core variables caused by adjustment for two alternative lists of
    additional variables, namely a numerator list and a denominator list.
    <b>haif</b> and <b>haifcomp</b> are intended for use in model selection, allowing the
    user to choose a model based on the joint distribution of the exposures
    and confounders, before estimating the parameters of the model from the
    data on the outcome variable.
<p>
<p>
<b><u>Options for </u></b><b><u>haif</u></b><b><u> and </u></b><b><u>haifcomp</u></b>
<p>
    <b>noconstant</b> specifies that the models being compared contain no constant
        term.  If <b>noconstant</b> is not specified, then it is assumed that the
        models being compared contain a constant term, labelled <b>_cons</b>, and
        HAIFs (or HAIF ratios) are calculated for the variance and standard
        error of that constant term.
<p>
<p>
<b><u>Options for </u></b><b><u>haif</u></b><b><u> only</u></b>
<p>
    <b>addvars(</b><i>varlist</i><b>)</b> specifies a list of additional variables, which must not
        contain any of the core variables.  The HAIFs will then be scale
        factors by which the variances and standard errors of the parameters
        of the core variables are scaled by including in the model the
        additional variables specified by <b>addvars()</b>, assuming that these
        additional variables do not really have any effect, and that the
        outcome variable is homoskedastic.  Note that the variable list
        specified by <b>addvars()</b> may contain factor variables.
<p>
<p>
<b><u>Options for </u></b><b><u>haifcomp</u></b><b><u> only</u></b>
<p>
    <b>daddvars(</b><i>varlist</i><b>)</b> specifies a list of additional variables, known as the
        denominator list, which must not contain any of the core variables.
        The HAIFs for the core variables, caused by adjustment for these
        additional variables, will then be defined as for the <b>addvars()</b>
        option of <b>haif</b>, and will be the denominators of the HAIF ratios.
        Note that the variable list specified by <b>daddvars()</b> may contain
        factor variables.
<p>
    <b>naddvars(</b><i>varlist</i><b>)</b> specifies a second list of additional variables, known
        as the numerator list, which also must not contain any of the core
        variables, although it may contain variables in common with the list
        specified by <b>daddvars()</b>.  The HAIFs for the core variables, caused by
        adjustment for this second list of additional variables, will then be
        defined as for the <b>addvars()</b> option of <b>haif</b>, and will be the
        numerators of the HAIF ratios.  Note that the variable list specified
        by <b>naddvars()</b> may contain factor variables.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    Homoskedastic adjustment inflation factors (or HAIFs) measure the loss of
    power to measure the effects of core predictors on an outcome, caused by
    the inclusion in the model of unnecessary additional predictors.  If
    these predictors are indeed unnecessary, and the true model is a
    homoskedastic (or equal-variance) linear regression model including only
    the core predictors, then it can be shown that the population variances
    and standard errors of the estimated core variable effects will be no
    smaller if the unneccessary variables are included than if they are not
    included.  (See Subsections 3.7 and 5.4 of Seber, 1977.) The variance
    HAIFs (and standard error HAIFs) are the scale factors by which these
    variances (and standard errors) are scaled up by the inclusion of the
    unnecessary additional variables.  The standard error HAIF is interpreted
    as the factor by which the confidence interval width for a core variable
    coefficient is scaled up by adjusting for the unnecessary additional
    variables.  The variance HAIF is interpreted as the factor by which the
    experimenter would have to scale up the size of the experiment, in order
    to counteract the effect on the confidence interval width of adjusting
    for the unnecessary additional variables.
<p>
    Note that, if the additional variables are not unnecessary, then
    including them in the model will not necessarily increase the variance of
    the coefficients of the core variables.  If the additional variables
    predict the outcome well, given each value of the core variables, then
    including the additional variables may even decrease the variance of the
    coefficients of the core variables.  The HAIFs therefore represent a
    "worst case" scenario, based on the values of the core and additional
    predictor variables, assuming that we have no knowledge of the
    distribution of the outcome variable.
<p>
<p>
<b><u>Methods and formulas</u></b>
<p>
    Let <i>X</i> denote the matrix whose columns are the core variables, let <i>A</i>
    denote the matrix whose columns are the additional variables specified by
    the <b>addvars()</b> option of <b>haif</b>, and let <i>D</i> denote the diagonal matrix of
    weights.  The variance HAIF of the <i>k</i>th variable in <i>X</i> is then a ratio,
    whose numerator is the <i>k</i>th diagonal entry in the matrix
<p>
    <i>inverse( (X,A)' * D * (X,A) )</i>
<p>
    and whose denominator is the <i>k</i>th diagonal entry in the matrix
<p>
    <i>inverse( X' * D * X )</i>
<p>
    The standard error (SE) HAIF is the square root of the corresponding
    variance HAIF.
<p>
    <b>haifcomp</b> inputs two alternative lists of additional variables.  Let <i>B</i>
    denote the matrix of additional variables specified by the <b>daddvars()</b>
    option, and let <i>C</i> denote the matrix of additional variables specified by
    the <b>naddvars()</b> option.  Then the variance HAIF ratio for the <i>k</i>th variable
    in <i>X</i> is then a ratio, whose numerator is the <i>k</i>th diagonal entry in the
    matrix
<p>
    <i>inverse( (X,C)' * D * (X,C) )</i>
<p>
    and whose denominator is the <i>k</i>th diagonal entry in the matrix
<p>
    <i>inverse( (X,B)' * D * (X,B) )</i>
<p>
    and the SE HAIF ratio is the square root of the corresponding variance
    HAIF ratio.  The HAIF ratios produced by <b>haifcomp</b> are especially useful
    if the columns of <i>B</i> are linearly dependent on the columns of <i>C</i>, implying
    that the model with design matrix <i>X,B</i> is a sub-model of the model with
    design matrix <i>X,C</i>.  For example, <i>X</i> might have a single column which is an
    interesting exposure variable whose effect we wish to know, <i>B</i> might have
    a single column whose entries are all 1, and <i>C</i> might have multiple
    columns, containing indicators of the membership of a row (or
    observation} in each of a set of multiple mutually exclusive strata.  The
    HAIFs will then measure the effect, on the variance and standard error of
    the slope for <i>X</i>, of fitting a multiple-intercept model (with a separate
    intercept for each stratum) instead of a single-intercept model (with one
    common intercept for all strata), assuming that the single-intercept
    model is true and that the outcome is homoskedastic.
<p>
    Note that the rows of the matrices correspond to observations with
    non-missing values for all variables in all <i>varlist</i>s input to <b>haif</b> or
    <b>haifcomp</b>.  Therefore, missing values are deleted listwise.
<p>
<p>
<b><u>Examples</u></b>
<p>
        <b>.sysuse auto, clear</b>
        <b>.haif weight, add(foreign length)</b>
        <b>.haif weight foreign, add(length headroom)</b>
        <b>.haif weight, add(foreign)</b>
<p>
    The following example demonstrates the use of <b>haifcomp</b> in measuring the
    effect of fitting an unnecessary 2-intercept model in <b>weight</b>, with
    separate intercepts for US car models and non-US car models, when a
    single-intercept model in <b>weight</b> is true, and the outcome variable is
    homoskedastic.  Note the use of factor variables in the <b>naddvars()</b>
    option.
<p>
        <b>.sysuse auto, clear</b>
        <b>.gene byte baseline=1</b>
        <b>.haifcomp weight, noc dadd(baseline) nadd(ibn.foreign)</b>
<p>
<p>
<b><u>Saved results</u></b>
<p>
    <b>haif</b> and <b>haifcomp</b> save the following in <b>r()</b>:
<p>
    Scalars        
      <b>r(N)</b>                number of observations
<p>
    Matrices       
      <b>r(haif)</b>             Variance and standard error HAIFs or HAIF ratios
<p>
    The matrix <b>r(haif)</b> has 1 row for each variable in the list of core
    variables, and also an additional row for the constant term, if
    <b>noconstant</b> is not specified.  It has 2 columns, the first containing
    variance HAIFs (or HAIF ratios), and the second containing standard eror
    (SE) HAIFs (or HAIF ratios).  This matrix is also listed to the Stata
    log, unless the user specifies the <b>quietly</b> prefix.
<p>
    <b>haif</b> also saves the following in <b>r()</b>:
<p>
    Macros         
      <b>r(addvars)</b>          <i>varlist</i> specified by <b>addvars()</b>
<p>
    <b>haifcomp</b> also saves the following in <b>r()</b>:
<p>
    Macros         
      <b>r(daddvars)</b>         <i>varlist</i> specified by <b>daddvars()</b>
      <b>r(naddvars)</b>         <i>varlist</i> specified by <b>naddvars()</b>
<p>
    Note that, if the variable lists specified by the <b>addvars()</b>, <b>daddvars()</b>
    and <b>naddvars()</b> are factor variable lists, then the saved variable lists
    <b>r(addvars)</b>, <b>r(daddvars)</b> and <b>r(naddvars)</b> will contain the corresponding
    expanded and specific factor variable lists.
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, National Heart and Lung Institute, Imperial College London,
    UK.
    Email: r.newson@imperial.ac.uk
<p>
<p>
<b><u>References</u></b>
<p>
    Seber, G. A. F. <i>Linear Regression Analysis.</i> New York, NY: John Wiley &amp;
        Sons; 1977.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] regress</b>; <b>[U] 11.4.3 Factor variables</b>; <b>[P] fvexpand</b>
<p>
      Help:  <b>[R] regress</b>, <b>[U] fvvarlist</b>, <b>[P] fvexpand</b>
</pre>