<pre>
<b>help hte</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>hte</b> -- Heterogeneous Treatment Effect Analysis
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>hte</b> <i>depvar1</i> [<i>depvar2</i> <i>...</i> <b>=</b>] <i>treatvar</i> <i>indepvars</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b>
               <i>options</i> ]
<p>
        <b>hte</b> <b><u>gr</u></b><b>aph</b> [<b>,</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <i>graph_options</i> ]
<p>
<p>
<a name="opt"></a>    <i>options</i>               Description
    -------------------------------------------------------------------------
    Main
      <b><u>al</u></b><b>pha(</b><i>#</i><b>)</b>            set significance level for balancing tests
      <i>pscore_options</i>      options as described in help <b>pscore</b> (except
                            <b>level()</b>)
      <b>join(</b><i>list</i><b>)</b>          merge specified strata
      <b><u>auto</u></b><b>join</b>[<b>(</b><i>#</i><b>)</b>]       merge small strata at low end or high end
      <b>by(</b><i>groupvar</i><b>)</b>        repeat analyses for groups defined by <i>groupvar</i>
      <b><u>sep</u></b><b>arate</b>            construct propensity score strata separately for
                            each by-group
      <b><u>con</u></b><b>trols(</b><i>clist</i><b>)</b>     control variables for within-strata models
      <b><u>est</u></b><b>com(</b><i>command</i><b>)</b>     set estimation command for within strata models;
                            default is <b>regress</b>
      <b><u>estop</u></b><b>ts(</b><i>options</i><b>)</b>    options to be applied to within-strata models
      <b><u>noi</u></b><b>sily</b>             display output from <b>pscore</b> and individual models
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>            set confidence level; default is <b>level(95)</b>
      <b><u>list</u></b><b>wise</b>            use listwise deletion to handle missing values
      <b><u>case</u></b><b>wise</b>            synonym for <b>listwise</b>
<p>
    Graph
      <b><u>nogr</u></b><b>aph</b>             suppress graph
      <b><u>o</u></b><b>utcomes(</b><i>numlist</i><b>)</b>   display results for specified outcomes
      <i>marker_options</i>      change look of markers
      <b><u>lineop</u></b><b>ts(</b><i>options</i><b>)</b>   change look of fitted lines
      <b><u>ciop</u></b><b>ts(</b><i>options</i><b>)</b>     change look of confidence intervals
      <b>noci</b>                suppress confidence intervals
      <b>addplot(</b><i>plot</i><b>)</b>       add other plots to the generated graph
      <i>twoway_options</i>      any options other than <b>by()</b> documented in
                            <b>[G] </b><i>twoway_options</i>
    -------------------------------------------------------------------------
    <b>fweight</b>s, <b>iweight</b>s, and <b>pweight</b>s are allowed; see help weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>hte</b> applies <b>pscore</b> (Becker and Ichino 2002) to construct balanced
    propensity score strata and, within each stratum, estimates the average
    treatment effect. <b>hte</b> then tests for linear trend in treatment effects
    using variance-weighted least squares. The stratum-specific treatment
    effects and the estimated linear trend are displayed in a twoway graph.
<p>
    See Brand and Xie (2010) for an application of this procedure.
<p>
    <b>hte</b> specified without arguments redisplays the results from a previous
    <b>hte</b> call (without graph).
<p>
    <b>hte graph</b> redraws the graph based on the results from a previous <b>hte</b>
    call.
<p>
<p>
<b><u>Dependencies</u></b>
<p>
    <b>hte</b> requires <b>pscore</b> by Becker and Ichino (2002) to be installed on the
    system. Type
<p>
        . net sj 5-3 st0026_2
<p>
    followed by
<p>
        . net install st0026_2
<p>
    to install the program.
<p>
<p>
<b><u>Options</u></b>
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>alpha(</b><i>#</i><b>)</b> sets the significance level for <b>pscore</b>'s tests of the balancing
        property. The default is <b>alpha(0.01)</b>.
<p>
    <i>pscore_options</i> are any options as described in help <b>pscore</b>, except
        <b>level()</b>.
<a name="join"></a><p>
    <b>join(</b><i>list</i><b>)</b> causes the specified strata to be merged together for the
        treatment effect analysis. The syntax for <i>list</i> is
<p>
            <i>numlist</i> [<b>,</b> <i>numlist</i> ...]
<p>
        where <i>numlist</i> is a list of consecutive integers that identify the
        strata to be merged. For example, type <b>join(1 2)</b> to merge the first
        and second stratum. Multiple (disjunctive) <i>numlist</i>s may be specified,
        separated by a comma, in which case multiple merges are applied.
        After merging, the strata will be renumbered.
<p>
    <b>autojoin</b>[<b>(</b><i>#</i><b>)</b>] causes small strata at the low and high end of the
        propensity score to be merged with subsequent or precedent strata,
        respectively, so that the number of observations is at least <i>#</i> for
        both the treated and the untreated (<i>#</i> defaults to <b>10</b>). Only one of
        <b>join()</b> and <b>autojoin()</b> may be specified.
<p>
    <b>by(</b><i>groupvar</i><b>)</b> specifies that the analysis be repeated for each group
        defined by the values of <i>groupvar</i>. The results are plotted in a
        single graph for all by-groups. Common propensity score strata are
        used for all groups unless the <b>separate</b> option is specified.
<p>
    <b>separate</b> causes the construction of propensity score strata to be
        repeated for each by-group. The default is to use common strata, that
        is, to construct the strata once, based on the whole sample including
        all groups. <b>separate</b> has an effect only if <b>by()</b> is specified.
<a name="controls"></a><p>
    <b>controls(</b><i>clist</i><b>)</b> specifies control variables to be included in the models
        used to estimate the within-strata treatment effects. <i>clist</i> may be a
        standard <i>varlist</i>, in which case the specified variables are included
        in each within-strata model. Alternatively, use the following syntax
        to specify strata-specific sets:
<p>
            [<i>varlist</i>] [<i>numlist1</i><b>:</b> <i>varlist1</i>] [<i>numlist2</i><b>:</b> <i>varlist2</i>] [<i>...</i>]
<p>
        <i>varlist</i> applies to all strata, <i>varlist1</i> applies to the strata
        specified in <i>numlist1</i>, etc.
<p>
    <b>estcom(</b><i>command</i><b>)</b> sets the command used to estimate the within strata
        treatment effects. The default is <b>regress</b>.
<p>
    <b>estopts(</b><i>options</i><b>)</b> are options to be applied to the models used to estimate
        the within-strata treatment effects. The options are as described in
        help <b>regress</b> (or as in help <i>command</i> where, <i>command</i> is the command
        specified via the <b>estcom()</b> option).
<p>
    <b>noisily</b> displays the output from <b>pscore</b> and the treatment effect models.
        <b>pscore</b>'s <b>detail</b> option implies <b>noisily</b>.
<p>
    <b>level(</b><i>#</i><b>)</b> sets the confidence level, as a percentage, for confidence
        intervals. The default is <b>level(95)</b> or as set by <b>set level</b>.
<p>
    <b>listwise</b> handles missing values through listwise deletion, meaning that
        an observation is excluded from all computations if any of the
        specified variables is missing for that observation. By default, <b>hte</b>
        uses all available observations to compute the propensity strata
        without regard to whether values for the outcome variables (the
        <i>depvars</i>) or the variables specified in <b>controls()</b> are missing.
<p>
    <b>casewise</b> is a synonym for <b>listwise</b>.
<p>
        +-------+
    ----+ Graph +------------------------------------------------------------
<p>
    <b>nograph</b> suppresses the graph.
<p>
    <b>outcomes(</b><i>numlist</i><b>)</b> causes results to be plotted for the specified outcomes
        only. Use this option to select results in case of multiple outcome
        variables or <b>by()</b>-groups. Use numbers 1, 2, 3, etc. to refer to the
        different outcomes. By-groups are ordered within variables if both
        multiple outcome variables and the <b>by()</b> option are specified. That
        is, number 1 refers to <i>depvar1</i> and the first by-group, number 2
        refers to <i>depvar1</i> and the second by-group, etc.
<p>
    <i>marker_options</i> affect the rendition of the plotted markers, including
        their shape, size, color, and outline; see <b>[G] </b><i>marker_options</i>. In
        case of multiple outcomes you can usually specify lists of elements
        to be applied to the different outcomes. For example, type <b>msymbol(D</b>
        <b>T)</b> to use diamonds for the first outcome and triangles for the second
        outcome.
<p>
    <b>lineopts(</b><i>cline_options</i><b>)</b> affects the rendition of the plotted lines; see 
        <b>[G] </b><i>cline_options</i>. In case of multiple outcomes you can usually
        specify lists of elements to be applied to the different outcomes.
        For example, type <b>lineopts(lcolor(blue red))</b> to use blue line color
        for the first outcome and red line color for the second outcome.
<p>
    <b>ciopts(</b><i>options</i><b>)</b> affects the rendition of the capped confidence spikes for
        the within strata treatment effects; see <b>[G] graph twoway rcap</b>.
<p>
    <b>noci</b> suppresses the confidence intervals for the within strata treatment
        effects. Confidence intervals are only displayed on plots containing
        a single outcome.
<p>
    <b>addplot(</b><i>plot</i><b>)</b> provides a way to add other plots to the generated graph;
        see <b>[G] </b><i>addplot_option</i>.
<p>
    <i>twoway_options</i> are any options other than <b>by()</b> documented in 
        <b>[G] </b><i>twoway_options</i>.
<p>
<p>
<b><u>Examples</u></b>
<p>
    Treatment effect of college on wages:
<p>
        . sysuse nlsw88
        . generate sq_exp = ttl_exp^2
        . hte wage collgrad ttl_exp sq_exp tenure south smsa
<p>
    Add control variables to within strata treatment effect estimation:
<p>
        . hte wage collgrad ttl_exp sq_exp tenure south smsa, control(ttl_exp s
&gt; q_exp)
<p>
    Separate results by <b>union</b>:
<p>
        . hte wage collgrad ttl_exp sq_exp tenure south smsa, by(union)
<p>
    Redraw graph for second group (<b>union</b>=1):
<p>
        . hte graph, outcome(2)
<p>
<p>
<b><u>Saved results</u></b>
<p>
    <b>hte</b> saves the following in <b>e()</b>:
<p>
    Scalars        
      <b>e(N)</b>                number of observations
      <b>e(neq)</b>              number of equations (outcomes)
<p>
    Macros         
      <b>e(cmd)</b>              <b>hte</b>
      <b>e(estcom)</b>           estimation command as specified by <b>estcom()</b>
      <b>e(depvar)</b>           name(s) of dependent variable(s)
      <b>e(treatvar)</b>         name of treatment variable
      <b>e(indepvars)</b>        name(s) of independent variables
      <b>e(controls)</b>         expanded controls option
      <b>e(trend)</b>            note about linear fit
      <b>e(byvar)</b>            name of <b>by()</b> variable
      <b>e(depvar#)</b>          outcome #: name of dependent variable
      <b>e(by#)</b>              outcome #: by-group
      <b>e(trend#)</b>           outcome #: note about linear fit
      <b>e(wtype)</b>            weight type
      <b>e(wexp)</b>             weight expression
      <b>e(properties)</b>       <b>b</b>
<p>
    Matrices       
      <b>e(b)</b>                results vector
      <b>e(se)</b>               standard errors
      <b>e(obs)</b>              number of observations per stratum
      <b>e(block)</b>            strata ranks
      <b>e(lfit)</b>             linear fit of treatment effect by strata rank
<p>
    Functions      
      <b>e(sample)</b>           estimation sample
<p>
<p>
<b><u>References</u></b>
<p>
    Becker, Sascha O., and Andrea Ichino. 2002. Estimation of average
        treatment effects based on propensity scores. The Stata Journal
        2:358–377.
<p>
    Brand, Jennie E. and Yu Xie. 2010. Who Benefits Most from College?
        Evidence for Negative Selection in Heterogeneous Economic Returns to
        Higher Education. American Sociological Review 75(2).
<p>
<p>
<b><u>Authors</u></b>
<p>
    Ben Jann, ETH Zurich, jannb@ethz.ch
<p>
    Jennie E. Brand, University of Calofornia - Los Angeles,
    brand@soc.ucla.edu
<p>
    Yu Xie, University of Michigan, yuxie@isr.umich.edu
<p>
    Thanks for citing this software as follows:
<p>
        Jann, B., J. E. Brand, Y. Xie. 2010. Stata module to perform
        heterogeneous treatment effect analysis. Available from
        http://ideas.repec.org/c/boc/bocode/s457129.html.
<p>
<p>
<b><u>Also see</u></b>
<p>
</pre>