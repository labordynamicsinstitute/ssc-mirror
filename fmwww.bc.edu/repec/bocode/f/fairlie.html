<pre>
<b>help fairlie</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>fairlie</b> --  Nonlinear decomposition of binary outcome differentials
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>fairlie</b> <i>depvar</i> <i>indepvars</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>]<b>,</b> <b>by(</b><i>groupvar</i><b>)</b> [ <i>options</i> ]
<p>
    where the syntax for <i>indepvars</i> is
<p>
        <i>term</i> [<i>term</i> <i>...</i>]
<p>
    with <i>term</i> as a variable name or, alternatively, a set of variables
    specified as
<p>
        <b>(</b>[<i>name</i><b>:</b>] <i>varlist</i><b>)</b>
<p>
    <i>name</i> is any valid Stata name and labels the set. If <i>name</i> is omitted, the
    name of the first variable is used to label the set.
<p>
<p>
    <i>options</i>             Description
    -------------------------------------------------------------------------
    <b>by(</b><i>groupvar</i><b>)</b>        specify the groups (required); <i>groupvar</i> must be 0/1
    <b><u>r</u></b><b>eps(</b><i>#</i><b>)</b>             number of decomposition replications; default is 100
    <b><u>nod</u></b><b>ots</b>              suppress the replication dots
    <b>ro</b>                  randomize ordering of variables in the detailed
                          decomposition
    <b><u>ref</u></b><b>erence(</b><i>#</i><b>)</b>        specify the reference model; <i>#</i> must be 0 (use group 0
                          model) or 1 (use group 1 model); default is 0
    <b><u>p</u></b><b>ooled</b>[<b>(</b><i>varlist</i><b>)</b>]   use a pooled model as reference; <i>varlist</i> is added to
                          the model if specified
    <b>probit</b>              use a <b>probit</b> model; default is to use a <b>logit</b> model
    <b><u>noe</u></b><b>st</b>               suppress model estimation output
    <b><u>save</u></b><b>est(</b><i>name</i><b>)</b>       store model estimation results under <i>name</i>
    <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>            set confidence level; default is <b>level(95)</b>
    <b><u>nole</u></b><b>gend</b>            suppress legend
    <i>estopts</i>             options passed through to the internal call of <b>logit</b>
                          or <b>probit</b>
    -------------------------------------------------------------------------
    <b>fweight</b>s, <b>pweight</b>s, and <b>iweight</b> are allowed; see weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>fairlie</b> computes the nonlinear decomposition of binary outcome
    differentials proposed by Fairlie (1999, 2003, 2005). That is, <b>fairlie</b>
    computes the difference in Pr(<i>depvar</i>!=0) between the two groups defined
    by <i>groupvar</i> and quantifies the contribution of group differences in the 
    <i>indepvars</i> to the outcome differential.  Furthermore, <b>fairlie</b> estimates
    the separate contributions of the individual independent variables (or
    groups of independent variables).  <b>fairlie</b> also reports standard errors
    for these separate contributions. Note that the covariances are set to
    zero. Therefore, do <i>not</i> use post-estimation commands such as <b>test</b> or
    <b>lincom</b> after <b>fairlie</b>.
<p>
    The implementation of the decomposition technique closely follows the
    suggestions provided by Fairlie (2003). The paper can be downloaded from 
    http://ssrn.com/abstract=497302. If weights are specified, a modified
    algorithm is used for the computation of the detailed decomposition (see
    below).
<p>
    The decomposition technique involves one-to-one matching of cases between
    the two groups. If the groups have different sizes, a sample is drawn
    from the larger group. Since the results depend on the specific sample,
    the process is repeated and mean results are reported. Use <b>reps()</b> to
    specify the number of desired replications. Set the random-number seed
    for replicable results; see help <b>generate</b>.
<p>
    The separate contributions from independent variables or groups of
    independent variables may be sensitive to the ordering of variables.  If
    results are sensitive to ordering then use the <b>ro</b> option described below
    to randomize the ordering of variables, thus approximating results over
    all possible orderings.
<p>
    Alternative decomposition approaches for binary response variables are
    provided, e.g., by Gomulka and Stern (1990) and Yun (2003).
<p>
    <i>Algorithm for weighted data</i>: The algorithm by Fairlie for the detailed
    decomposition is based on matching observations from the two groups,
    where the groups are balanced by drawing a random sample (without
    replacement) from the larger group. The goal of the matching is to
    generate a hypothetical sample in which the distributions of some of the
    variables stem from the first group and some from the second group. In
    the case of weighted data, the original algorithm cannot be used, since
    different weights would have to be applied to the different variables in
    the hypothetical sample. However, an appropriate hypothetical sample can
    be constructed by matching samples from both groups where the sampling
    probabilities are proportional to the weights. In the present
    implementation the sizes of the two sub-samples are set to half the total
    sample size over both groups and observations are drawn with replacement.
    The choice of the sub-sample size is arbitrary but that does not matter
    much since the precision of the results only depends on the "grand total"
    of sampled observations, which is a function of the sub-sample size and
    the number of decomposition replications as set by the <b>reps()</b> option.
    That is, a smaller (larger) sub-sample size can be counterbalanced by an
    increase (a decrease) in the number of replications. The results from the
    original algorithm and from the algorithm for weighted data are
    numerically different, but they have the same expectation if the weights
    are uninformative (i.e. if the weights are equal for all observations or
    if the weights are independent from the observations).
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>by(</b><i>groupvar</i><b>)</b> defines the groups between which the decomposition is to be
        performed. <i>groupvar</i> must be 0/1.
<p>
    <b>reps(</b><i>#</i><b>)</b> specifies the number of decomposition replications to be
        performed. The default is 100.
<p>
    <b>nodots</b> suppresses the display of replication dots.
<p>
    <b>ro</b> causes the ordering of variables to be randomized in the detailed
        decomposition. The default is to estimate the separate contributions
        of the individual independent variables (or groups of independent
        variables) one after another in the specified order. Note that
        results are sensitive to this ordering. Specifying the <b>ro</b> option will
        randomize the order of the variables in each replication and,
        therefore, approximate average results over all possible orderings.
        This is recommended if the results are sensitive to ordering of
        variables. It may also be useful to increase the number of
        replications when using this option.
<p>
    <b>reference(</b><i>#</i><b>)</b> specifies the reference estimates to be used with the
        decomposition. <b>reference(0)</b>, the default, indicates that the
        coefficients from the <i>groupvar</i>==0 model are used. <b>reference(1)</b>
        specifies that the coefficients from the <i>groupvar</i>==1 model are used.
<p>
    <b>pooled</b>[<b>(</b><i>varlist</i><b>)</b>] specifies that the coefficients from the pooled model
        over all cases be used for the decomposition. (Note that the cases
        used in the pooled model are not necessarily restricted to the
        non-missing cases of <i>groupvar</i>.  This is reasonable because it is
        sometimes desirable to include cases from other groups as well. Use
        <b>if</b> and <b>in</b> to restrict the sample of the pooled model.) Optionally, 
        <i>varlist</i> will be added as additional control variables to the pooled
        model. Often, <b>pooled(</b><i>groupvar</i><b>)</b> is a good choice. In any case, it is
        important that the reference group in the pooled model is the group
        for which <i>groupvar</i>==0.
<p>
    <b>probit</b> specifies that the <b>probit</b> command is used for model estimation.
        The default is to use <b>logit</b>.
<p>
    <b>noest</b> suppresses the display of the model estimates.
<p>
    <b>saveest(</b><i>name</i><b>)</b> stores the model estimation results under <i>name</i> using 
        <b>estimates store</b>.
<p>
    <b>level(</b><i>#</i><b>)</b>; see estimation options.
<p>
    <b>nolegend</b> suppresses the legend for the variable sets.
<p>
    <i>estopts</i> are options passed through to the internal call of <b>logit</b> or 
        <b>probit</b>.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . use http://fmwww.bc.edu/RePEc/bocode/h/homecomp.dta
<p>
        . fairlie homecomp female age (educ:hsgrad somecol college)
             (marstat:married prevmar) if white==1|black==1, by(black)
<p>
        . fairlie homecomp female age (educ:hsgrad somecol college)
             (marstat:married prevmar) if white==1|black==1, by(black)
             pooled(black)
<p>
        . generate black2 = black==1 if white==1|black==1
<p>
        . fairlie homecomp female age (educ:hsgrad somecol college)
             (marstat:married prevmar), by(black2)
             pooled(black latino asian natamer)
<p>
        . fairlie homecomp female age (educ:hsgrad somecol college)
             (marstat:married prevmar) if white==1|black==1 [pw=wgt],
             by(black)
<p>
<p>
<b><u>Saved Results</u></b>
<p>
    Scalars   
      <b>e(N)</b>           number of observations
      <b>e(N_0)</b>         number of obs for which <i>groupvar</i>==0
      <b>e(N_1)</b>         number of obs for which <i>groupvar</i>==1
      <b>e(N_match)</b>     sample size used for one-to-one matching
      <b>e(reps)</b>        number of decomposition replications
      <b>e(pr_0)</b>        outcome probability for <i>groupvar</i>==0
      <b>e(pr_1)</b>        outcome probability for <i>groupvar</i>==1
      <b>e(diff)</b>        differential <b>e(pr_0)</b>-<b>e(pr_1)</b>
      <b>e(expl)</b>        total contribution of group differences in regressors
<p>
<p>
    Macros    
      <b>e(cmd)</b>         <b>fairlie</b>
      <b>e(depvar)</b>      name of dependent variable
      <b>e(by)</b>          name group variable
      <b>e(_cmd)</b>        command used for model estimation (<b>logit</b> or <b>probit</b>)
      <b>e(wtype)</b>       weight type
      <b>e(wexp)</b>        weight expression
      <b>e(reference)</b>   reference estimates (<b>0</b>, <b>1</b>, or <b>pooled</b>)
      <b>e(legend)</b>      definitions of regressor sets
      <b>e(ro)</b>          <b>ro</b>, if the random order option was specified
      <b>e(properties)</b>  <b>b V</b>
<p>
    Matrices  
      <b>e(b)</b>           detailed decomposition results
      <b>e(V)</b>           variances for <b>e(b)</b> (covariances are set to zero)
      <b>e(_b)</b>          reference coefficients
      <b>e(_V)</b>          variance-covariance matrix of <b>e(_b)</b>
<p>
    Functions 
      <b>e(sample)</b>      marks estimation sample
<p>
<p>
<b><u>References</u></b>
<p>
    Fairlie, Robert W. (1999). The Absence of the African-American Owned
        Business: An Analysis of the Dynamics of Self-Employment. Journal of
        Labor Economics 17(1): 80-108.
    Fairlie, Robert W. (2003). An Extension of the Blinder-Oaxaca
        Decomposition Technique to Logit and Probit Models. Economic Growth
        Center, Yale University Discussion Paper No. 873.
    Fairlie, Robert W. (2005). An extension of the Blinder-Oaxaca
        decomposition technique to logit and probit models. Journal of
        Economic and Social Measurement 30: 305-316.
    Gomulka, Joanna, and Nicholas Stern (1990). The Employment of Married
        Women in the United Kingdom 1970-83. Economica 57: 171-199.
    Yun, Myeong-Su (2003). Decomposing Differences in the First Moment.  IZA
        Discussion Paper No. 877.
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jannb@ethz.ch
<p>
    Thanks for citing this software as follows:
<p>
        Jann, B. (2006). fairlie: Stata module to generate nonlinear
        decomposition of binary outcome differentials. Available from
        http://ideas.repec.org/c/boc/bocode/s456727.html.
<p>
<p>
<b><u>Acknowledgments</u></b>
<p>
    I thank Sonia Bhalotra, Rob Fairlie, Julia Horstschräer, George Leckie,
    and Steven Samuels for their comments and suggestions.
<p>
<p>
<b><u>Also see</u></b>
<p>
</pre>