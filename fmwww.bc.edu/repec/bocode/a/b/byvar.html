<pre>
-------------------------------------------------------------------------------
help for <b>byvar</b>                                                  Patrick Royston
-------------------------------------------------------------------------------
<p>
<b><u>Repeat command by variable(s)</u></b>
<p>
<p>
        <b>byvar</b> <i>varlist</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [ <b>,</b> <b>b(</b><i>coeflist</i><b>)</b> <b>e(</b><i>elist</i><b>)</b> <b><u>ge</u></b><b>nerate</b>
                 <b><u>m</u></b><b>issing</b> <b><u>nol</u></b><b>abel</b> <b><u>p</u></b><b>ause</b> <b>r(</b><i>rlist</i><b>)</b> <b><u>re</u></b><b>turn</b> <b>se(</b><i>selist</i><b>)</b> <b><u>t</u></b><b>abulate</b>
                 <b><u>u</u></b><b>nique</b> ] <b>: </b><i>stata_cmd</i>[@<i>stata_cmd</i> ...]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>byvar</b> repeats <i>stata_cmd</i> (and each additional <i>stata_cmd</i> following each <b>@</b>,
    if present) for each distinct combination of values in <i>varlist</i>.  The
    latter may contain string variables.
<p>
    For details of storage of results, see the <b>generate</b> and <b>return</b> options.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>b(</b><i>coeflist</i><b>)</b> stores the regression coefficients for variables named in
        <i>coeflist</i>. Individual items may be labelled as with the <b>e()</b> option.
<p>
    <b>e(</b><i>elist</i><b>)</b> saves the E-class estimates <b>e()</b> named in <i>elist</i> which arise from
        the final <i>stata_cmd</i> in <i>stata_cmd</i>[@<i>stata_cmd</i> ...]. The E-class
        estimates must evaluate to numbers; strings are not allowed. The
        estimate names must be separated by space(s). You may append a label,
        preceded by an <b>=</b> sign, to each estimate name; this will be used to
        label the corresponding column of output (if the <b>tabulate</b> option is
        used) or variable (if the <b>generate</b> option is used). The label will be
        truncated to 14 characters if it is longer than 14. If spaces are to
        be included, the label must be enclosed within quotes (<b>""</b>). Commas,
        colons or equals signs are not allowed anywhere within in the label.
        Example of <b>e()</b> option with such labelling: <b>e(rmse="RMS error" F="F</b>
        <b>statistic" N)</b>.
<p>
    <b>generate</b> creates new variable(s) corresponding to the quantities named in
        the <b>e()</b>, <b>r()</b>, <b>b()</b> and <b>se()</b> options. The names of the new variables
        begin with letter <b>E</b>, <b>R</b>, <b>B</b> and <b>S</b>, respectively, followed by up to six
        characters which represent the <b>e()</b>, <b>r()</b>, <b>b()</b> and <b>se()</b> quantity or
        variable name.  The final character is <b>_</b> (or sometimes, to avoid
        overwriting, a letter).  For example, <b>e(rmse N) generate</b> would create
        variables called <b>Ermse_</b> and <b>EN_</b>, containing the values of <b>e(rmse)</b> and
        <b>e(N)</b>, respectively, as left behind by each execution of the final
        <i>stata_cmd</i> in <i>stata_cmd</i>[@<i>stata_cmd</i> ...]. Results are stored according
        to the combinations of values of the by-variables in <i>varlist</i>.
<p>
    <b>missing</b> causes <i>stata_cmd</i>(s) to be executed even when a combination of
        values of any of the variables in <i>varlist</i> involves a missing value.
        The idea is the same as for the <b>missing</b> option in Stata's tabulate
        command.
<p>
    <b>nolabel</b> suppresses display of score labels for categoric variables for
        which score labels are defined. Numeric values are used instead.
<p>
    <b>pause</b> pauses output after each execution of <i>stata_cmd</i>. Useful for graphs.
<p>
    <b>r(</b><i>rlist</i><b>)</b> saves the R-class results <b>r()</b> named in <i>rlist</i> which arise from
        the final <i>stata_cmd</i> in <i>stata_cmd</i>[@<i>stata_cmd</i> ...]. The estimates must
        evaluate to numbers; strings are not allowed. Individual items may be
        labelled as with the <b>e()</b> option. Example: <b>r(W="W statistic"</b>
        <b>p=P-value)</b>.
<p>
    <b>return</b> returns the quantities named in the <b>e()</b>, <b>r()</b>, <b>b()</b> and <b>se()</b> options
        in functions of the form <b>r(E</b>|<b>R</b>|<b>B</b>|<b>S</b><i>#1</i><b>gp</b>#2<b>)</b>. Here, <i>#1</i> indexes the items
        in the <b>e()</b>, <b>r()</b>, <b>b()</b> and <b>se()</b> options; <b>gp</b><i>#2</i> indexes the subgroups
        defined by the combinations of values in <i>varlist</i>. For example, <b>e(rmse</b>
        <b>N) return</b> would return <b>r(E1gp1)</b>, <b>r(E1gp2)</b>, ... containing <b>e(rmse)</b> for
        subgroups 1, 2, ...  and <b>r(E2gp1)</b>, <b>r(E2gp2)</b>, ... containing <b>e(N)</b> for
        subgroups 1, 2, ... .
<p>
    <b>se(</b><i>selist</i><b>)</b> stores the standard errors of regression coefficients for
        variables named in <i>selist</i>.  Individual items may be labelled as with
        the <b>e()</b> option.
<p>
    <b>tabulate</b> displays the results in tabular form, suppressing the output (if
        any) from the final <i>stata_cmd</i>.
<p>
    <b>unique</b> is relevant only with <b>generate</b>. It specifies that results for each
        unique combination of values defined by varlist are stored only in
        the first position in the new variable(s). Values in other positions
        are set to missing. See also <b>store()</b>.
<p>
    <i>stata_cmd</i> is any Stata command and its options.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    Note that <b>byvar</b> acts conservatively when creating new variables with the
    <b>generate</b> option. It won't wipe out existing variables. You may therefore
    find your workspace becomes cluttered by variables beginning with the
    letters <b>E</b>, <b>R</b>, <b>B</b> or <b>S</b>. With caution, you can type, for example, <b>drop E* R*</b>
    to eliminate them in one action.
<p>
    Note that <b>byvar</b> now has <b>sortpreserve</b>, meaning that <b>byvar</b> will change the
    sort order of the data and that Stata is to restore the original sort
    order of the data upon the program's conclusion. See program.
<p>
<p>
<b><u>Examples</u></b>
<p>
    To produce a Normal Q-Q plot of <b>weight</b> for each non-missing value of
    <b>rep78</b>:
<p>
    <b>. sysuse auto</b>
    <b>. byvar rep78, pause: qnorm weight</b>
<p>
    To carry out Shapiro-Wilk tests on <b>mpg</b> for each of the 6 values of <b>rep78</b>
    including missing, store the W-statistics (<b>r(W)</b>) in functions
    <b>r(R1gp1)</b>,..., <b>r(R1gp6)</b> and their P-values (<b>r(p)</b>) in functions <b>r(R2gp1)</b>,
    ..., <b>r(R2gp6)</b>, and display the results in tabular form, with columns
    headed <b>W statistic</b> and <b>P-value</b>:
<p>
    <b>. byvar rep78, r(W="W statistic" p=P-value) return tabulate missing:</b>
        <b>swilk mpg</b>
<p>
    To create two new variables: <b>Ermse_</b> containing <b>e(rmse)</b>, i.e. the
    regression mean square error, for each of the two values of <b>foreign</b>, and
    <b>Bweight_</b> containing the estimated regression coefficients for regressing
    <b>mpg</b> on <b>weight</b>:
<p>
    <b>. byvar foreign, e(rmse) b(weight) generate: regress mpg weight</b>
<p>
    To run a logistic regression of <b>foreign</b> on <b>mpg</b> for levels 3, 4 and 5 of
    <b>rep78</b>, and calculate and report a Hosmer-Lemeshow chi-square statistic
    based on 5 groups:
<p>
    <b>. byar rep78 if rep78&gt;=3, tabulate r(chi2):</b>  <b>logit foreign mpg @ estat</b>
        <b>gof, groups(5)</b>
<p>
    To do the same, but save the chi-square values to a new variable called
    <b>Rchi2_</b>, storing only the unique result for each value of <b>rep78</b>:
<p>
    <b>. byar rep78 if rep78&gt;=3, generate r(chi2) unique:</b>  <b>logit foreign mpg @</b>
        <b>estat gof, groups(5)</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Patrick Royston, MRC Clinical Trials Unit, London.
    patrick.royston@ctu.mrc.ac.uk
<p>
<b><u>Also see</u></b>
<p>
</pre>