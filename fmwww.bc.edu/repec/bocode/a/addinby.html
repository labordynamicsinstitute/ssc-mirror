<pre>
-------------------------------------------------------------------------------
help for <b>addinby</b>                                                 (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Add in data from a disk dataset using a foreign key</u></b>
<p>
        <b>addinby</b> <i>keyvarlist</i> <b>using</b> <i>filename</i> [ , <b><u>m</u></b><b>issing</b> <b><u>un</u></b><b>matched(</b><i>action_spec</i><b>)</b>
                     <b><u>noc</u></b><b>omplete</b> <b>fast</b> <b>keep(</b><i>varlist</i><b>)</b> <b><u>gen</u></b><b>erate(</b><i>newvar</i><b>)</b> <b>sorted</b>
                     <b><u>nol</u></b><b>abel</b> <b><u>nonote</u></b><b>s</b> <b>update</b> <b>replace</b> ]
<p>
    where <i>keyvarlist</i> is a <i>varlist</i> specifying a list of key variables, and
    <i>action_spec</i> may be <b>drop</b>, <b>keep</b> or <b>fail</b>.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>addinby</b> is a "cleaner" alternative version of <b>merge m:1</b>, designed to
    reduce the lines of code in Stata do-files.  It adds variables and/or
    values to existing observations in the dataset currently in memory (the
    master dataset) from a Stata-format dataset stored in the file <i>filename</i>
    (the using dataset), using a foreign key of variables specified by the
    <i>keyvarlist</i> to identify observations in the using dataset.  These foreign
    key variables must identify observations in the using dataset uniquely.
    Unlike <b>merge m:1</b>, <b>addinby</b> always preserves the observations in the master
    dataset in their original sorting order, and never adds any additional
    observations, and only generates a matching information variable if
    requested to do so.  However, <b>addinby</b> may optionally check that there are
    no unmatched observations in the master dataset, and/or check that there
    are no missing values in the foreign key variables in the master dataset.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>missing</b> specifies that missing values are allowed in the variables in the
        <i>keyvarlist</i> in the master dataset.  If <b>missing</b> is not specified, then
        missing values in the variables in the <i>keyvarlist</i> cause <b>addinby</b> to
        fail.
<p>
    <b>unmatched(</b><i>action_spec</i><b>)</b> specifies the action to be taken with observations
        in the master dataset which are unmatched by the foreign key in the
        using dataset.  The possible values of <i>action_spec</i> are <b>drop</b>, <b>keep</b> and
        <b>fail</b>.  If <b>drop</b> is specified, then unmatched observations are dropped
        from the master dataset, and <b>addinby</b> completes execution without
        error.  If <b>keep</b> is specified, then unmatched observations are kept in
        the master dataset (with missing values in any variables added from
        the using dataset), and <b>addinby</b> completes execution without error.
        If <b>fail</b> is specified, then <b>addinby</b> fails with an error message if
        there are any unmatched observations in the master dataset.  If the
        <b>unmatched()</b> option is not specified, then <b>unmatched(fail)</b> is assumed.
<p>
    <b>nocomplete</b> is a shorthand for <b>unmatched(keep)</b>.  It is ignored if the
        <b>unmatched()</b> option is specified.
<p>
    <b>fast</b> is an option for programmers.  It specifies that <b>addinby</b> will take
        no action to restore the existing master dataset in memory in the
        event of failure.  If <b>fast</b> is not specified, then <b>addinby</b> will take
        this action, which uses an amount of time depending on the size of
        the dataset in memory.
<p>
    <b>keep(</b><i>varlist</i><b>)</b> specifies the variables to be kept from the using dataset.
        If <b>keep()</b> is not specified, then all variables are kept.
<p>
    <b>generate(</b><i>newvar</i><b>)</b> specifies the name of a new variable to be generated,
        containing match results information, and coded as the variable
        generated by the <b>generate()</b> option of <b>merge</b>.  If <b>generate()</b> is not
        specified, then no match results variable is generated.
<p>
    <b>sorted</b> specifies that the using dataset is already sorted by the
        <i>keyvarlist</i>.  If <b>sorted</b> is not specified, then <b>addinby</b> creates a
        temporary copy of the using dataset in the memory, and sorts it
        before merging it into the master dataset.  If the using dataset is
        very large, then this may possibly use a lot of time and/or space,
        which may possibly be saved by specifying <b>sorted</b>.
<p>
    <b>nolabel</b>, <b>nonotes</b>, <b>update</b> and <b>replace</b> function as the options of the same
        names for <b>merge</b>.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <b>addinby</b> was designed to be used with master datasets and using datasets
    keyed using the <b>keyby</b> package, which can be downloaded from SSC.  Both 
    <b>keyby</b> and <b>addinby</b> are designed to enforce the relational database model,
    in which a dataset is viewed as a mathematical function, whose domain is
    the set of existing value combinations of the primary key variables, and
    whose range is the set of all possible value combinations of the non-key
    variables.  A dataset therefore has one observation per <i>thing</i> (identified
    by the primary key variables), and data on <i>attributes_of_things</i>
    (specified by the non-key variables).  A foreign key is defined as a list
    of variables in a dataset (typically the master dataset) which is also
    the primary key of a second dataset (typically the using dataset).  <b>keyby</b>
    ensures that a dataset is sorted, and its observations uniquely
    identified, by a primary key.  <b>addinby</b> then adds variables and/or values
    to existing observations in a master dataset, using a foreign key
    specified by the <i>keyvarlist</i> to identify observations from the using
    dataset in which the values for the variables are to be found.
    Therefore, <b>keyby</b> is a "clean" version of <b>sort</b>, which ensures that the
    observations in a dataset are identified, as well as sorted, by the key
    variables.  And <b>addinby</b> is a "clean" version of <b>merge m:1</b>, which ensures
    that these observations stay identified, and sorted, after the additional
    data have been merged in.
<p>
<p>
<b><u>Examples</u></b>
<p>
        <b>.webuse autotech, clear</b>
        <b>.describe</b>
        <b>.describe using http://www.stata-press.com/data/r10/autocost</b>
        <b>.addinby make using http://www.stata-press.com/data/r10/autocost</b>
        <b>.describe</b>
<p>
        <b>.webuse dollars, clear</b>
        <b>.describe</b>
        <b>.list</b>
        <b>.webuse sforce, clear</b>
        <b>.describe</b>
        <b>.list</b>
        <b>.addinby region using http://www.stata-press.com/data/r10/dollars</b>
        <b>.describe</b>
        <b>.list</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, National Heart and Lung Institute, Imperial College London,
    UK.
    Email: r.newson@imperial.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[D] sort</b>, <b>[D] gsort</b>, <b>[D] merge</b>, <b>[D] order</b>, <b>[U] 12.2.1 Missing</b>
             <b>values</b>
<p>
      Help:  <b>[D] sort</b>, <b>[D] gsort</b>, <b>[D] merge</b>, <b>[D] order</b>, <b>[U] 12.2.1 Missing</b>
             <b>values</b>
             <b>keyby</b>, <b>keybygen</b> if installed
</pre>