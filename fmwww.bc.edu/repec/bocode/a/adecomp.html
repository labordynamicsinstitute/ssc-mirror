<pre>
-------------------------------------------------------------------------------
help for <b>adecomp</b>                                             Joao Pedro Azevedo
                                                               Minh Cong Nguyen
                                                              Viviane Sanfelice
-------------------------------------------------------------------------------
<p>
<b><u>adecomp</u></b><b><u> - Shapley Decomposition by Components of a Welfare Measure</u></b>
<p>
        <b>adecomp</b> <i>welfarevar</i> <i>components</i> [<b>weight</b>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>exp</i>], <b>by(</b><i>varname</i><b>)</b>
                 <b>equation(</b><i>c#[operator]c#[operator]c#[operator]...[operator]cN</i><b>)</b>
                 [ <b>indicator(</b><i>string</i><b>)</b> <b>varpl(</b><i>varname</i><b>)</b> <b>mpl(</b><i>numlist</i><b>)</b> <b>gic(</b><i>#</i><b>)</b>
                 <b>group(</b><i>varname</i><b>)</b> <b>id(</b><i>varname</i><b>)</b> <b>rank(</b><i>string</i><b>)</b> <b>strata(</b><i>varlist</i><b>)</b>
                 <b>percentile(</b><i>#</i><b>)</b> <b>oneway</b> <b>std</b> ]
<p>
    <b>fweights</b> and <b>aweights</b> are allowed; see help weights. See help weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>adecomp</b> implements the shapley decomposition of changes in a welfare
    indicator as proposed by Azevedo, Sanfelicce and Minh (2012). Following
    Barros et al (2006), this method takes advantage of the additivity
    property of a welfare aggregate to construct a counterfactual
    unconditional distribution of the welfare aggregate by changing each
    component at a time to calculate their contribution to the observed
    changes in poverty and inequality.
 
<p>
    Given that the distribution of a observable welfare measure (i.e. income
    or consumption) for period 0 and period 1 are known, we can construct
    counterfactual distributions for period 1 by substituting the observed
    level of the indicators <i>c</i> in period 0, one at a time. For each
    counterfactual distribution, we can compute the poverty or inequality
    measures, and interpret those counterfactuals as the poverty or
    inequality level that would have prevailed in the absence of a change in
    that indicator.
 
<p>
    As much of the micro-decomposition literature, approaches of this nature
    traditionally suffer from path-dependence (See Essama-Nssah (2012),
    Fortin et al (2011) and Ferreira (2010) for recent reviews of the
    literature), in other words, the order in which the cumulative effects
    are calculated matters . One of the major contributions of Azevedo,
    Sanfelicce and Minh (2012) is the implementation of the best known remedy
    for path-dependence which is to calculate the decomposition across all
    possible paths and then take the average between them. These averages are
    also known as the Shapley-Shorrocks estimates of each component, implying
    that we estimate every possible path to decompose these components and
    then take the average of these estimates (See Shapley (1953) and
    Shorrocks (1999)).
   
<p>
    There is one remaining caveat to this approach: the counterfactual income
    distributions on which these decompositions suffer from
    equilibrium-inconsistency. Since we are modifying only one element at a
    time, the counterfactuals are not the result of an economic equilibrium,
    but rather a statistical exercise in which we assume that we can in fact
    modify one factor at a time and keep everything else constant.
<p>
    For further examples of implementations of this approach please see
    Azevedo, Inchausete and Sanfelice (2012).
<p>
<p>
<b><u>Thanks for citing adecomp as follows</u></b>
<p>
    Azevedo, Joao Pedro, Viviane Sanfelice and Minh Cong Nguyen (2012)
    Shapley Decomposition by Components of a Welfare Measure. World Bank.
    (mimeo)
<p>
<b><u>Where</u></b>
<p>
    <i>welfarevar</i> is the welfare aggregate variable.
<p>
    <i>components</i> are the components used to construct the welfare variable, and
    which will be for the decomposition.
<p>
    <b>by</b> is the comparison indicator. It must take two categorical values and
    is usually defines two points in time or two geographic locations, which
    the difference of the indicator of choice is being decomposed.
<p>
    <b><u>eq</u></b><b>uation()</b> captures the relationship between <i>welfarevar</i> and <i>components</i>.
    The component variables in <i>varlist</i> must be denoted by c#, and must be
    separated by an arithmetic operator.
<p>
<b><u>Options</u></b>
<p>
    <b><u>in</u></b><b>dicator(</b><i>string</i><b>)</b> poverty and inequality indicators. fgt0, fgt1, fgt2,
    gini and theil are the currently supported options.
<p>
    <b>varpl(</b><i>varname</i><b>)</b> poverty line variable. It must be specified when fgt0,
    fgt1 and/or fgt2 indicators are used.
<p>
    <b>mpl(</b><i>numlist</i><b>)</b> allow to calculate the poverty indicators by multiple of the
    poverty line. It can be specified when fgt0, fgt1 and/or fgt2 indicators
    are used.
<p>
    <b>gic(</b><i>#</i><b>)</b> use as indicator the percentual change on the average of
    <i>welfarevar</i> in which one of its <i>#</i> percentile, i.e., decomposing the Growth
    Incidence Curve of <i>welfarevar</i>. You need to specify a number of bins
<p>
    <b>group(</b><i>varname</i><b>)</b> the indicators are calculated by each group of <i>groupvar</i>.
    Differ from the <b>if</b> option because do not restrict the database. <i>Groupvar</i>
    must be a numeric and discrete variable.
<p>
    <b>id(</b><i>varname</i><b>)</b> to specify the identificator variable in case of balanced
    panel data. The observed value of the unit of analysis is going to be
    used when changing the distribution.
<p>
    <b>strata(</b><i>varlist</i><b>)</b> allow the transposition of distributions be made within
    groups created using the variables listed in <i>varlist</i>.
<p>
    <b>rank(</b><i>string</i><b>)</b> specific the rank of which variable must be used when
    changing the distribution.  It can be a <i>varname</i> or typing <i>components</i> the
    rank of each <i>component</i> is going to be used. Default is <i>welfarevar</i> rank.
<p>
    <b><u>perc</u></b><b>entile(</b><i>#</i><b>)</b> used <i>#</i> percentile of <i>componentvar</i> to change the
    distribution. Default is to rescale the dataset in each period.
<p>
    <b>oneway</b> decomposition is made only one way from period 0 to period 1.
    Default is both ways.
<p>
    <b>std</b> Returns the standard deviation of the effect, besides the average.
<p>
<b><u>Saved Results</u></b>
<p>
<b>adecomp</b> returns results in <b>r()</b> format. 
By typing <b>return list</b>, the following results are reported:
<p>
    Scalars        
      <b>r(path)</b>             number of paths of the shapley decomposition
      <b>r(component)</b>        number of components of the decomposition
      <b>r(N)</b>                number of observations utilized on the calculation
<p>
    Matrices       
      <b>r(b)</b>                average effect of each components based on all
                            paths.
      <b>r(sd)</b>               standard deviation of the effects based on all
                            paths. If option <b>std</b> is specify.
      <b>r(gic)</b>              average effect of each components based on all
                            paths when the indicators are the changes on
                            <i>welfarevar()</i> by bin.
      <b>r(sd_gic)</b>           standard deviation of each components based on all
                            paths when the indicators are the changes on
                            <i>welfarevar()</i> by bin. If option <b>std</b> is specify.
<p>
    <b>Obs:</b> On the reported matrices
    <i>Index label</i>: 0 - FGT(0); 1 - FGT(1); 2 - FGT(2); 3 - Gini; 4 - Theil.
    <i>Effect label</i>: 1 represents the first <i>component</i> listed on the command, and
    so on. Total of components plus 1 represents the total change on the
    indicator and plus 2 denotes the residual, when this option is specified.
<p>
    <b>Important</b>: To guarantee precision, we recommend to use <i>double</i> when create
    variables.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . adecomp percapitainc laborinc nonlaborinc, by(year) equation(c1+c2)
            indicator(fgt0 fgt1 fgt2 gini theil) varpl(pline)
<p>
        . adecomp percapitainc laborinc nonlaborinc, by(year) equation(c1+c2)
            in(fgt0) varpl(pline) gic(100)
<p>
        . adecomp percapitainc laborinc nonlaborinc, by(year) equation(c1+c2)
            indicator(fgt0) varpl(pline) mpl(1 3.5)
<p>
        . adecomp percapitainc laborinc nonlaborinc, by(year) equation(c1+c2)
            indicator(fgt0 fgt1 fgt2 gini theil) varpl(pline) gic(100)
            strata(urban)
<p>
        . adecomp percapitainc laborinc nonlaborinc, by(year) equation(c1+c2)
            indicator(fgt0 fgt1 fgt2 gini theil) varpl(pline) gic(100)
            id(hh_id)
<p>
        . adecomp percapitainc laborinc nonlaborinc [w=weight], by(year)
            equation(c1+c2) indicator(fgt0 fgt1 fgt2) varpl(pline)
            group(region)
<p>
        . adecomp percapitainc laborinc nonlaborinc if (region == 1), by(year)
            equation(c1+c2) indicator(gini)
<p>
        . adecomp percapitainc padults laborinc capitalinc pensioninc
            transferinc othersinc, by(year) equation(c1*(c2+c3+c4+c5+c6))
            indicator(fgt0) varpl(pline)
<p>
<p>
      (click to run the example below)
<p>
        . use exdata_adecomp.dta, clear
        
        <b>. adecomp ipcf_ppp ila_ppp itran_ppp ijubi_ppp icap_ppp others</b> ///
        <b>. [w=pondera], by(ano) eq(c1+c2+c3+c4+c5) </b> ///
        <b>. varpl(lp_2usd_ppp) in(fgt0 fgt1 fgt2 gini theil) </b>
        
        . mat result = r(b)
        . mat colnames  result = indicator effect rate
        . drop _all
        . svmat double result, n(col)
        . label define indicator 0 "FGT0" 1 "FGT1" 2 "FGT2" 3 "Gini" 4 "Theil"
        . label values indicator indicator
        . label define effect ///
                1 "Labor" ///
                2 "Transfer" ///
                3 "Pension" ///
                4 "Capital" ///
                5 "Others" ///
                6 "Total change"
        . label values effect effect
        . local total 6
        . gen aux=rate if  effect==`total'  
        . egen total_effect=sum(aux) , by(indicator)
        . drop aux
        . gen share_effect= -100*rate/abs(total_effect)
<p>
        . keep if effect!=6
        . graph bar share_effect , over(effect, label(labsize(*0.6))) ///
            by(indicator)   blabel(bar, format(%16.1fc) size(*.98)) ///
            ytitle(Share of the component effect in the total change)
<p>
<b><u>References</u></b>
<p>
    Azevedo, Joao Pedro, Gabriela Inchauste, and Viviane Sanfelice.
    Forthcoming. Decomposing the Recent Inequality Decline in Latin America.
    World Bank (mimeo).
<p>
    Azevedo, Joao Pedro, Gabriela Inchauste, Sergio Olivieri, Jaime Saavedra,
    and Hernan Winkler. Forthcoming. “Is Labor Income Responsible for Poverty
    Reduction? A Decomposition Approach.” World Bank Policy Research Working
    Paper.
<p>
    Azevedo, Joao Pedro, Viviane Sanfelice and Minh Cong Nguyen (2012)
    Shapley Decomposition by Components of a Welfare Measure. World Bank.
    (mimeo)
<p>
    Barros, Ricardo Paes de. Carvalho, Mirela de. Franco, Samuel. Mendoça,
    Rosane (2006). "Uma Análise das Principais Causas da Queda Recente na
    Desigualdade de Renda Brasileira." In: Revista Econômica. Volume 8,
    número 1, p.117-147. Universidade Federal Fluminense. Rio de Janeiro.  
    (link to publication)
<p>
    Essama-Nssah, B. (2012). "Identification of Sources of Variation in
    Poverty Outcomes", World Bank Policy Research Working Papers, No. 5954.
<p>
    Ferreira Francisco H.G. (2010) "Distributions in Motion: Economic Growth,
    Inequality and Poverty Dynamics".  World Bank Policy Research Working
    Paper No. 5424.  The World Bank, Washington, D.C.
<p>
    Fortin Nicole, Lemieux Thomas and Firpo Sergio. (2011). "Decomposition
    Methods in Economics".  In: Ashenfelter Orley and Card David (eds)
    Handbook of Labor Economics, Vol. 4A , pp. 1-102. Northolland,
    Amsterdam..
<p>
    Inchauste, Gabriela , João Pedro Azevedo, Sergio Olivieri, Jaime
    Saavedra, and Hernan Winkler (2012) When Job Earnings Are behind Poverty
    Reduction. Economic Premise, November 2012, Number 97. World Bank:
    Washington DC.   (link to publication)
<p>
    Shapley, L. (1953). "A value for n-person games", in: H. W. Kuhn and A.
    W. Tucker (eds.), Contributions to the Theory of Games, Vol. 2
    (Princeton, N.J.: Princeton University Press).
<p>
    Shorrocks, Anthony (2012) Decomposition procedures for distributional
    analysis: a unified framework based on the Shapley value. Journal of
    Economic Inequality  (link to publication)
<p>
    World Bank (2012) The Effect Of Women'S Economic Power: in Latin America
    and the Caribbean. <b>LAC Poverty and Labor Brief</b>. World Bank: Washington
    DC.   (link to publication)
<p>
<b><u>Authors</u></b>
<p>
        
    Joao Pedro Azevedo, jazevedo@worldbank.org
        
    Minh Cong Nguyen, mnguyen3@worldbank.org
        
    Viviane Sanfelice, vsanfelice@worldbank.org
                
<b><u>Acknowledgements</u></b>
    
    The authors would like to thank Gabriela Inchauste, Samuel Freije, Andres
    Castaneda and Gabriel Facchini for their valuable suggestions. The code
    from Samuel Franco and Sergio Oliveri were used for inspiration in a few
    passages of this ado and should be greatfully acknowledged.
 
    
    All errors and ommissions are of exclusive responsability of the authors.
        
        
    This program was developed by the  LAC Team for Statistical Development
    (2012), in the Latin American and Caribbean Poverty Reduction and
    Economic Managment Group of the World Bank.
 
        
<p>
<b><u>Also see</u></b>
<p>
  Online:  help for apoverty; ainequal; wbopendata; mpovline; drdecomp; 
    skdecomp (if installed)
 
<p>
<p>
</pre>