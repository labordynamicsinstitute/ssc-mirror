<pre>
<b>help jnsn</b> and <b>help jnsni</b>                                 Version 1.2 2007-01-17
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Title</u></b>
<p>
    <b>jnsn</b> -- Fit Johnson's system of transformations by moment matching
    <b>jnsni</b>   
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>jnsn</b> <i>varname</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>jnsn-specific option</i>] [<i>common</i>
                 <i>options</i>]
<p>
        <b>jnsni</b> <b>,</b> <i>jnsni-specific options</i> [<i>common options</i>]
<p>
    <i>options</i>               Description
    -------------------------------------------------------------------------
    <b>jnsn</b>-specific Option
      <b><u>g</u></b><b>enerate(</b><i>newvar</i><b>)</b>    create variable named <i>newvar</i> that is the fitted
                            normal transformation of <i>varname</i>
<p>
    <b>jnsni</b>-specific Options
      <b>mean(</b><i>#</i><b>)</b>             mean of the variable to be transformed; this is
                            required
      <b>sd(</b><i>#</i><b>)</b>               standard deviation of the variable to be
                            transformed; this is required
      <b><u>skew</u></b><b>ness(</b><i>#</i><b>)</b>         coefficient of skewness of the variable to be
                            transformed
      <b>kurtosis(</b><i>#</i><b>)</b>         coefficient of kurtosis of the variable to be
                            transformed
<p>
    Common Options
      <b><u>tol</u></b><b>erance(</b><i>#</i><b>)</b>        tolerance differentiating distributions
      <b><u>sbiter</u></b><b>ate(</b><i>#</i><b>)</b>        iteration criterion for fitting bounded
                            distributions
      <b><u>moiter</u></b><b>ate(</b><i>#</i><b>)</b>        outer-loop iteration limit for estimating moments
                            (used in fitting bounded distributions)
      <b><u>motol</u></b><b>erance(</b><i>#</i><b>)</b>      outer-loop convergence criterion for estimating
                            moments (used in fitting bounded distributions)
      <b><u>miiter</u></b><b>ate(</b><i>#</i><b>)</b>        inner-loop iteration limit for estimating moments
                            (used in fitting bounded distributions)
      <b><u>mitol</u></b><b>erance(</b><i>#</i><b>)</b>      inner-loop convergence criterion for estimating
                            moments (used in fitting bounded distributions)
    -------------------------------------------------------------------------
    <b>by</b> may be used with <b>jnsn</b>; see <b>by</b>.
    <b>aweight</b>s and <b>fweight</b>s are allowed with <b>jnsn</b>; see weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>jnsn</b> fits the Johnson system of distributions (Johnson, 1949) for
    transforming <i>varname</i> to a standard normal deviate.  <b>jnsni</b> is the
    immediate form of the command, and allows the user to specify mean,
    standard deviation, and coefficients of skewness and kurtosis of a
    hypothetical variable or of one in a dataset that is not at-hand.  <b>jnsn</b>
    and <b>jnsni</b> implement what is known as <i>Algorithm AS 99</i> (Hill, Hill and
    Holder, 1976), which fits parameters of Johnson system functions by
    moment matching.
<p>
<p>
<b><u>Options</u></b>
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>generate</b> creates <i>newvar</i> containing values of the normal deviate as
        defined by the fitted transformation coefficients.
<p>
    <b>mean</b> and <b>sd</b> mean and standard deviation are used in all cases.
<p>
    <b>skewness</b> and <b>kurtosis</b> coefficients of skewness and kurtosis are those
        that would be returned by summarize.  If these are not supplied, then
        they default to zero and three.
<p>
    <b>tolerance</b> tolerance criterion used in discriminating distributions;
        defaults to 0.01.
<p>
    <b>sbiterate</b> maximum number of iterations in fitting bounded distributions;
        defaults to 50.
<p>
    <b>moiterate</b> maximum number of outer-loop iterations in higher moment
        estimation used for fitting bounded distributions; defaults to 50.
<p>
    <b>motolerance</b> criterion for convergence of the outer-loop interations in
        higher moment estimation used for fitting bounded distributions;
        defaults to 0.00001.
<p>
    <b>miiterate</b> maximum number of inner-loop iterations in higher moment
        estimation used for fitting bounded distributions; defaults to 50.
<p>
    <b>mitolerance</b> criterion for convergence of the inner-loop interations in
        higher moment estimation used for fitting bounded distributions;
        defaults to 0.00000001.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    Johnson's system comprises several functions intended to transform a
    variable into a standard normal deviate.  The choice of which of the
    functions to use in the transformation of a given variable is made on the
    basis of the distribution characteristics of the variable to be
    transformed.  Each of the functions has up to four parameters, which are
    usually named <i>gamma</i>, <i>delta</i>, <i>xi</i> and <i>lambda</i>.  Four of the functions are
    given below.  In each case, <i>z</i> is distributed <i>N</i>(0,1),and <i>y</i> is defined as
<p>
        <i>y</i> = (<i>x</i> - <i>xi</i>) / <i>lambda</i>
<p>
    where <i>x</i> is the variable to be transformed.
<p>
        SN (Normal distribution)
<p>
            <i>z</i> = <i>y</i>
<p>
        SL (log-normal distribution)
<p>
            <i>z</i> = <i>gamma</i> + <i>delta</i> * <i>ln</i>(<i>y</i>)
<p>
        SU (Unbounded distribution)
<p>
            <i>z</i> = <i>gamma</i> + <i>delta</i> * <i>asinh</i>(<i>y</i>)
<p>
        SB (Bounded distribution)
<p>
            <i>z</i> = <i>gamma</i> + <i>delta</i> * <i>ln</i>(<i>y</i> / (1 - <i>y</i>))
<p>
    The Johnson SN transformation is the trivial case where the variable to
    be transformed is already normally distributed.  Here, <i>xi</i> and <i>lambda</i> are
    the only two paramters involved, and represent the mean and standard
    deviation.  The Johnson SL case is tranformation of a variable that is
    bounded on one side.  For this distribution, <i>xi</i> is the bound, and <i>lambda</i>
    is either one (positive skew) or negative one (negative skew).  The
    Johnson SU case is transformation of an unbounded distribution.  A
    simplified version of this transformation is known as the Inverse
    Hyperbolic Sine (IHS) transformation.  The Johnson SB case is for
    variables whose distribution is bounded on both ends.  Here, <i>xi</i> lies just
    beneath the minimum of <i>x</i>'s distribution, and <i>lambda</i> is such that <i>lambda</i> -
    <i>xi</i> lies just above the maximum of <i>x</i>'s distribution.  Parameters for this
    case are the most difficult to fit.  In all cases in which it is
    involved, the parameter space for <i>delta</i> is strictly positive.
<p>
    Selection of the transformation function is made on the basis of the
    location of the variable's coefficients of skewness and kurtosis on the
    plane defined by their joint parameter space.  Two lines are defined in
    this plane for the purpose of selecting a transformation function.  One
    is the "log-normal" line emanating from (0,3).  (See the references for
    the parametric equations that define the log-normal line.) The other is
    the boundary line, defined as coefficient of kurtosis = squared
    coefficient of skewness + 1.  A skewness-kurtosis pair lying within
    <b>tolerance</b> of (0,3) will be fit as SN.  A pair within <b>tolerance</b> of the
    log-normal line will be fit as SL.  A pair lying above the log-normal
    line will be fit as SU.  A skew-kurtosis pair within <b>tolerance</b> of the
    boundary is fit as ST, which is not listed above.  A pair lying between
    the two lines is fit as SB.  ST is not a Johnson transformation, but
    rather a special case created by Hill, Hill and Holder (T stands for
    "two-ordinate").
<p>
    Once the transformation function has been chosen, the function's
    parameters are fitted.  Fitting for SN, SL and ST are noniterative and
    unproblematic.  Fitting for SU is iterative, but convergence is usually
    unproblematic.  Fitting of the SB case is more difficult.  Suboptimum fit
    and failure to fit are not unusual.  Although <b>jnsn</b> does not screen for
    adequacy of fit, it does detect failures to fit and then resorts to an
    alternative transformation (often SU or SL) chosen on the basis of the
    best match of sample skewness and kurtosis to those for a variable
    subject to the fall-back transformation.
<p>
    Johnson transformations involve only the first four moments of the
    distribution of the variable to be transformed.  Its transformation of a
    variable to the standard normal deviate is thus approximate.  If interest
    lies in the extremes or tails of the distribution, the approximation
    might not be adequate.
<p>
<b><u>Notes</u></b>
<p>
    <b>jnsn</b> and <b>jnsni</b> return the transformation function selected in the return
    macro r(johnson_type).  They return the fitted parameter estimates in
    return scalars r(gamma), r(delta), r(xi) and r(lambda), and convergence
    exceptions in the return macro r(fault).  Coefficients for parameters
    that are not used in a transformation, such as <i>gamma</i> and <i>delta</i> in type
    SN, are set to default values, typically, zero for <i>gamma</i> and one for
    <i>delta</i>.  For ST cases, <i>xi</i> and <i>lambda</i> are set to the ordinates on the
    skewness-kurtosis plane, <i>delta</i> is set to the proportion of values at
    <i>lambda</i>, and <i>gamma</i> is set to zero.
<p>
    Default values for tolerances and iteration maximums are those in the
    FORTRAN-66 source code accompanying the article by Hill, Hill and Holder
    (1976).
<p>
    <b>jsn</b> calls summarize to obtain mean, standard deviation, and skewness and
    kurtosis coefficients.  It then feeds them to <b>jnsni</b>.
<p>
<p>
<b><u>References</u></b>
<p>
    I. D. Hill, R. Hill and R. L. Holder, Fitting Johnson curves by moments.
    <i>Applied Statistics</i> <b>25</b>:180–89, 1976.
<p>
    N. L. Johnson, Systems of frequency curves generated by methods of
    translation. <i>Biometrika</i> <b>36</b>:149–76, 1949.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. jnsn mpg</b>
<p>
    <b>. jnsni , mean(0.5) sd(0)</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Joseph Coveney jcoveney@bigplanet.com
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] summarize</b>, <b>[R] boxcox</b>, <b>[R] lnskew0</b>, <b>[R] ladder</b>
<p>
</pre>