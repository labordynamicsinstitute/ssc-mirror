<pre>
-------------------------------------------------------------------------------
help for <b>jmpierce2</b>
-------------------------------------------------------------------------------
<p>
<b><u>Second-order Juhn-Murphy-Pierce decomposition</u></b>
<p>
        <b>jmpierce2</b> <i>est11</i> <i>est21</i> <i>est12</i> <i>est22</i> [ <b>,</b> <b><u>b</u></b><b>enchmark(1</b>|<b>2</b>|<i>est1bm</i> <i>est2bm</i><b>)</b>
               <b><u>r</u></b><b>eference(1</b>|<b>2</b>|<i>estref1</i> <i>estref2</i> [<i>estrefbm</i>]<b>)</b> <b><u>d</u></b><b>etail</b>[<b>(</b><i>dlist</i><b>)</b>]
               <b><u>par</u></b><b>ametric</b> <b><u>res</u></b><b>iduals(</b><i>newvar1 newvar2</i>|<i>prefix</i><b>)</b>
               <b><u>rank</u></b><b>s(</b><i>newvar1 newvar2</i>|<i>prefix</i><b>)</b> <b><u>non</u></b><b>otes</b> <b>nopreserve</b> ]
<p>
<p>
    where <i>dlist</i> is
<p>
               <i>name1</i> <b>=</b> <i>varlist1</i> [ <b>,</b> <i>name2</i> <b>=</b> <i>varlist2</i> [<b>,</b> <i>...</i> ] ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>jmpierce2</b> computes the decomposition of differences in mean outcome
    differentials proposed by Juhn, Murphy and Pierce (1991). An example is
    the decomposition of the change of the black-white or the male-female
    wage differential over time (Juhn, Murphy and Pierce 1991; Blau and Kahn
    1997) or the decomposition of differences in the male-female wage
    differential between countries (Blau and Kahn 1992, 1996; OECD 2002).
<p>
    <i>est11</i>, <i>est21</i>, <i>est12</i>, and <i>est22</i> specify the previously fitted and stored
    regression estimates to be used with the decomposition (see help 
    estimates store). The model estimated last may be indicated by a period
    (.), even if it has not yet been stored.  <i>est11</i> and <i>est21</i> specify the
    group 1 estimate (e.g. male, white) and the group 2 estimate (e.g.
    female, black) for the first sample (e.g.  time point 1, country A),
    <i>est12</i> and <i>est22</i> are the group estimates for the second sample (time point
    2, country B). Note that the estimation samples (<b>e(sample)</b>) of the
    specified models determine the relevant observations for the
    decomposition. Group 1 and group 2 must not overlap.
<p>
    See the smithwelch package (available from the SSC archive; type ssc
    describe smithwelch) for an alternative approach to decompose differences
    in differentials.
<p>
    <b>Warning:</b> <b>jmpierce2</b> is intended for use with models that have been
    estimated by the regress command. Use <b>jmpierce2</b> with other models at your
    own risk.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>benchmark(1</b>|<b>2</b>|<i>est1bm</i> <i>est2bm</i><b>)</b> specifies (the estimates for) the
        "benchmark" sample. <b>benchmark(1)</b> signifies that sample 1 is the
        benchmark sample and <i>est11</i> and <i>est21</i> are the benchmark estimates.
        Analogously, <i>est12</i> and <i>est22</i> are used as the benchmark, if you
        specify <b>benchmark(2)</b>. Alternatively, use <b>benchmark(</b><i>est1bm</i> <i>est2bm</i><b>)</b> to
        provide the estimates from another sample to be used as the benchmark
        (e.g. the pooled sample over all time points or countries). If
        <b>benchmark()</b> is omitted, an extended decomposition containing
        interaction terms for simultaneous changes in quantities and prices
        is computed. See the Methods and Formulas Section below.
<p>
    <b>reference(1</b>|<b>2</b>|<i>estref1</i> <i>estref2</i> [<i>estrefbm</i>]<b>)</b> determines the reference
        coefficients and reference residual distributions within the samples
        to be used with the decomposition. The default is <b>reference(1)</b>,
        meaning that the coefficients from the first group (i.e. <i>est11</i> and
        <i>est12</i>) are used; <b>reference(2)</b> uses the group 2 estimates (<i>est21</i> and
        <i>est22</i>). Alternatively, specify <b>reference(</b><i>estref1</i> <i>estref2</i> [<i>estrefbm</i>]<b>)</b>
        to provide other reference estimates (e.g. models based on the pooled
        samples over both groups). <i>estrefbm</i> is required only if
        <b>benchmark(</b><i>est1bm</i> <i>est2bm</i><b>)</b> is specified.
<p>
    <b>detail</b>[<b>(</b><i>dlist</i><b>)</b>] requests that detailed decomposition results for the
        individual regressors be reported (applies only to the decomposition
        of the change in the "predicted gap"; see the Methods and Formulas
        Section below). Use <i>dlist</i> to subsume the results for specific groups
        of regressors (variables not appearing in <i>dlist</i> are listed
        individually). The usual shorthand conventions apply to the <i>varlist</i>s
        specified in <i>dlist</i> (see help <i>varlist</i>). For example, specify
        <b>detail(exp=exp*)</b> if the models contain <b>exp</b> (experience) and <b>exp2</b>
        (experience squared).
<p>
    <b>parametric</b> causes <b>jmpierce2</b> to compute the decomposition using
        standardized residuals and residual standard deviations. The default
        is to apply a nonparametric approach based on the relative ranks of
        the residuals and the inverse residual distribution functions.
<p>
    <b>residuals(</b><i>newvar1 newvar2</i>|<i>prefix</i><b>)</b> saves the imputed hypothetical
        residuals as variables (<i>newvar1</i> or <i>prefix</i><b>1</b> for the first sample,
        <i>newvar2</i> or <i>prefix</i><b>2</b> for the second sample).
<p>
    <b>ranks(</b><i>newvar1 newvar2</i>|<i>prefix</i><b>)</b> saves the computed percentile ranks as
        variables (<i>newvar1</i> or <i>prefix</i><b>1</b> for the first sample, <i>newvar2</i> or
        <i>prefix</i><b>2</b> for the second sample).
<p>
    <b>nonotes</b> suppresses the display of the legend.
<p>
    <b>nopreserve</b> is a technical option. <b>jmpierce2</b> internally preserves the data
        (see help preserve) and then drops all unused observations to speed
        up the computations. However, if <b>nopreserve</b> is specified, <b>jmpierce2</b>
        skips preserving the data and keeps the unused observations in
        memory. <b>nopreserve</b> may make sense if there are only few unused
        observations or if <b>parametric</b> is specified.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . regress lnwage educ exp exp2 if sex==0 &amp; year==1
        . estimates store male1
        . regress lnwage educ exp exp2 if sex==1 &amp; year==1
        . estimates store female1
        . regress lnwage educ exp exp2 if sex==0 &amp; year==2
        . estimates store male2
        . regress lnwage educ exp exp2 if sex==1 &amp; year==2
        . estimates store female2
        . jmpierce2 male1 female1 male2 female2
        
<p>
        . jmpierce2 male1 female1 male2 female2, benchmark(1)
        
<p>
        . generate byte year2 = year==2
        . regress lnwage educ exp exp2 year2 if sex==0 &amp; (year==1 | year==2)
        . estimates store male12
        . regress lnwage educ exp exp2 year2 if sex==1 &amp; (year==1 | year==2)
        . estimates store female12
        . jmpierce2 male1 female1 male2 female2, benchmark(male12 female12)
        
<p>
        . regress lnwage educ exp exp2 if year==1
        . estimates store pooled1
        . regress lnwage educ exp exp2 if year==2
        . estimates store pooled2
        . jmpierce2 male1 female1 male2 female2, reference(pooled1 pooled2)
        
<p>
<p>
<b><u>Saved Results</u></b>
<p>
    Matrices:
<p>
    <b>r(D)</b>       Decomposition of differentials
    <b>r(DD)</b>      Decomposition of difference in differentials
    <b>r(E)</b>       Decomposition of difference in predicted gap
    <b>r(U)</b>       Decomposition of difference in residual gap
    <b>r(b1)</b>      Parameter vector for sample 1
    <b>r(b2)</b>      Parameter vector for sample 2
    <b>r(b3)</b>      Parameter vector for benchmark sample (if provided)
    <b>r(dX1)</b>     Vector of quantity differences for sample 1
    <b>r(dX2)</b>     Vector of quantity differences for sample 2
<p>
<p>
<b><u>Methods and Formulas</u></b>
<p>
    Consider the linear model
<p>
       y_t = x_t'b_t + e_t,  E(e_t) = 0
<p>
    where y_t is a vector of outcomes (e.g. log hourly wages) at time t, x_t
    is the data matrix (the values of the regressors), b_t is a coefficients
    vector, and e_t is the vector of residuals. The model can be reformulated
    as
<p>
       y_t = x_t'b_t + r_t*s_t
<p>
    where s_t represents the standard deviation of the residuals and r_t is
    the vector of standardized residuals. Thus, the equation now has a
    two-component residual, that is, the residuals are expressed as a
    function of the general residual inequality at time t and the positions
    of the residuals in the residual distribution.
<p>
    Given two groups (e.g. males and females), the mean outcome differential
    between the two groups can then be decomposed as follows:
<p>
        dy_t = dx_t'b_t + dr_t*s_t
<p>
    where dy is the difference in mean outcomes between the groups, dx is a
    vector of the group differences in means of regressors, and dr is the
    group difference in mean standardized residuals. The first term, E =
    dx_t'b_t, is the "predicted gap". It reflects the "explained" part of the
    differential due to differences in "observed quantities" (aka
    "endowments" aka regressors). The second term, U = dr_t*s_t, is the
    "residual gap" and reflects the "unexplained" part of the differential
    (due to differences in "unobserved quantities", their "unobserved
    prices", and discrimination).  It is easy to see that the "predicted gap"
    and the "residual gap" are equivalent to the explained part and the
    unexplained part in the standard Blinder-Oaxaca decomposition (see, e.g.,
    help oaxaca; available from the SSC Archive, type ssc describe oaxaca).
<p>
    Now, given two time points t=1 and t=2 (or, e.g., two countries), the
    <i>change</i> in the outcome differential can be written as
<p>
        dy_2-dy_1 = [dx_2'b_2 - dx_1'b_1] + [dr_2*s_2 - dr_1*s_1]
<p>
    where the first part on the right-hand side of the equation is the change
    in the "predicted gap" (dE) and the second part is the change in the
    "residual gap" (dU). The two terms can be further decomposed into
<p>
        dE = (dx_2-dx_1)'b_1 + dx_1'(b_2-b_1) + (dx_2-dx_1)'(b_2-b_1)
<p>
    and
<p>
        dU = (dr_2-dr_1)s_1 + dr_1(s_2-s_1) + (dr_2-dr_1)(s_2-s_1)
<p>
    The first term in the decomposition of dE reflects the portion of the
    change in the "predicted gap" that is explained by changes in the group
    differences in "observed quantities" (aka endowments) and the second term
    is the part that is due to changes in "observed prices" (aka
    coefficients). The third term is an adjustment term accounting for the
    interaction effect induced by the simultaneous change in quantities and
    prices. Similarly, the first term in the decomposition of dU, sometimes
    called the "gap effect", reflects the change that is due to changes in
    the group differences in residual positions (i.e. changes in the group
    differences in "unobserved quantities" and changes in discrimination) and
    the second term is the part due to changes in residual inequality (i.e.
    changes in "unobserved prices" for the "unobserved quantities"). The last
    term again adjusts for interaction.
<p>
    It is common practice to reduce the three terms in the decompositions
    above to two terms only by employing the coefficients vector and residual
    variation from a "benchmark" sample. Be b_B the benchmark coefficients
    vector and s_B the benchmark residual standard deviation. The
    decompositions may then be written as
<p>
        dE = (dx_2-dx_1)'b_B + [dx_2'(b_2-b_B) + dx_1'(b_B-b_1)]
<p>
    and
<p>
        dU = (dr_2-dr_1)s_B + [dr_2(s_2-s_B) + dr_1(s_B-s_1)]
<p>
    If one of the two time points is the benchmark, the formulas simplify to
    the parametrization applied by Juhn, Murphy and Pierce (1991), that is
<p>
        dE = (dx_2-dx_1)'b_1 + dx_2'(b_2-b_1)
        dU = (dr_2-dr_1)s_1 + dr_2(s_2-s_1)
<p>
    or the parametrization applied by, e.g., Blau and Kahn (1997), that is
<p>
        dE = (dx_2-dx_1)'b_2 + dx_1'(b_2-b_1)
        dU = (dr_2-dr_1)s_2 + dr_1(s_2-s_1)
<p>
    An alternative would be, for example, to use the pooled sample over all
    time points as the benchmark sample. Note that in this case it is
    reasonable to include year dummies in the models for the benchmark sample
    (see, e.g., OECD 2002:103).
<p>
<p>
    <i>Nonparametric implementation of the decomposition of dU</i>
<p>
    By definition, e_t = r_t*s_t. Therefore, dr_1*s_1 is simply the group
    difference in mean residuals at t=1 and dr_2*s_2 is the difference in
    mean residuals at t=2. But what about dr_1*s_2 or dr_2*s_1? One obvious
    solution would be to estimate the residual standard deviations and the
    standardized residuals for both time points and then multiply the
    standard deviation of one time point with the mean difference in
    standardized residuals of the other. This approach is applied by
    <b>jmpierce2</b> if specifying the <b>parametric</b> option. The disadvantage of the
    parametric approach is that differences in distributional shape (apart
    from the variance of the distribution) are neglected. Therefore, Juhn et
    al. (1991) proposed the following non-parametric procedure, which is the
    default procedure in <b>jmpierce2</b>. Let F_t() be the distribution function of
    the residuals at time t. Furthermore, let q_t represent the positions of
    the residuals in the residual distribution at time t (see help relrank;
    available from the SSC Archive, type ssc describe relrank), that is
<p>
        q_t = F_t(e_t)
<p>
    Furthermore
<p>
        e_t = F[-1]_t(q_t)
<p>
    where F[-1]_t() stands for the inverse of F_t() (see help invcdf;
    available from the SSC Archive, type ssc describe invcdf).  Applying the
    inverse distribution function of one time point to the residual ranks of
    the other, leads to a non-parametric version of the decomposition of dU.
    For example, dr_1*s_2 is obtained by assigning each individual at t=1 a
    percentile number corresponding to its position in the residual
    distribution of t=1, then using these relative ranks to derive
    hypothetical residuals for the t=1 individuals given the t=2 residual
    distribution function, and finally computing the group difference in the
    means of these hypothetical residuals.
<p>
<p>
    <i>Reference coefficients and reference residual distribution</i>
<p>
    For each time point, a reference model must be specified to determine the
    coefficients and residual distribution to be used in the decomposition.
    The default is to use <i>est11</i> and <i>est12</i> as the reference models (see the
    <b>reference()</b> option). From a technical point of view, two situations have
    to be distinguished. First, the reference model may be the group 1 model
    (<b>reference(1)</b>) or the group 2 model (<b>reference(2)</b>). In these cases, the
    coefficients of that model are used to compute the residuals for both
    groups, but only the observations in the reference group are used to
    determine the residual distribution function. Second, the reference model
    may be some other model (e.g. a pooled model over both groups). In this
    case, the coefficients from the reference model are again used to compute
    the residuals for both groups.  The residual distribution function,
    however, is not derived from these residuals. It is instead computed
    using the pooled residuals from the two group-specific models.
<p>
<p>
    Technical notes:
<p>
        - <b>jmpierce2</b> does not require all models to contain the exact same set
          of regressors. Coefficients not appearing in a model are simply
          assumed to be zero for that model. However, it is important that
          all regressors are defined (i.e. non-missing) for all observations
          used with the decomposition. Thus, even if a regressor does not
          appear in an individual model, the regressor must contain valid
          values for the observations in the estimation sample of that model.
<p>
        - <b>jmpierce2</b> computes residuals as the differences between the values
          of the model's dependent variable and the model's linear
          predictions (using matrix score). If the models have been estimated
          using weighted data, <b>jmpierce2</b> will take account of these weights
          in its computations.  In the <b>parametric</b> mode, <b>jmpierce2</b> will use
          the value of <b>e(rmse)</b> as the model's residual standard deviation. If
          multiple-equation models or models with ancillary parameters are
          used with <b>jmpierce2</b>, only the first equation in <b>e(b)</b> is taken into
          account.
<p>
<p>
<b><u>References</u></b>
<p>
    Juhn, Chinhui, Kevin M. Murphy, Brooks Pierce (1991). Accounting for the
        Slowdown in Black-White Wage Convergence. Pp. 107-143 in: Workers and
        Their Wages, ed. by Marvin Kosters, Washington, DC: AEI Press.
    Blau, Francine D., Lawrence M. Kahn (1992). The Gender Earnings Gap:
        Learning from International Comparisons. American Economic Review 82:
        533-538.
    Blau, Francine D., Lawrence M. Kahn (1996). Wage Structure and Gender
        Earnings Differentials: an International Comparison. Economica 63:
        S29-S62.
    Blau, Francine D., Lawrence M. Kahn (1997). Swimming Upstream: Trends in
        the Gender Wage Differential in the 1980s. Journal of Labor Economics
        15:  1-42.
    OECD (2002). Employment Outlook, Chapter 2. Paris.
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jann@soz.gess.ethz.ch
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  help for regress, estimates, cumul, smithwelch (if installed), 
             jmp (if installed), oaxaca (if installed), invcdf (if
</pre>