<pre>
-------------------------------------------------------------------------------
help for <b>perturb</b>                                                 John Hendrickx
-------------------------------------------------------------------------------
<p>
<b><u>perturb</u></b>
<p>
        <b>perturb</b> : <i>any_stata_command</i> , <b><u>popt</u></b><b>ions(</b><i>options</i><b>)</b> [<i>command_options</i>]
<p>
Where <b>poptions</b> can contain the following options:
<p>
        <b><u>pv</u></b><b>ars(</b><i>varlist</i><b>)</b> <b><u>pr</u></b><b>ange(</b><i>numlist</i><b>)</b> <b><u>u</u></b><b>niform</b> <b><u>pf</u></b><b>actors(</b><i>varlist</i><b>)</b>
                           <b><u>pc</u></b><b>nttabs(</b><i>string</i><b>)</b> <b><u>ad</u></b><b>just</b> <b><u>b</u></b><b>estmod</b> <b><u>q</u></b><b>list(</b><i>numlist</i><b>)</b>
                           <b><u>u</u></b><b>list(</b><i>numlist</i><b>)</b> <b><u>d</u></b><b>istlist(</b><i>numlist</i><b>)</b> <b><u>a</u></b><b>ssoc(</b><i>string</i><b>)</b>
                           <b><u>s</u></b><b>tatitics(</b><i>string</i><b>)</b> <b><u>f</u></b><b>ormat(</b><i>string</i><b>)</b> <b>save(</b><i>string</i><b>)</b>
                           <b><u>n</u></b><b>iter(</b>integer 100<b>)</b> <b><u>m</u></b><b>isclass(</b><i>numlist</i><b>)</b> <b><u>v</u></b><b>erbose</b>
<p>
<b><u>Description</u></b>
<p>
<b>perturb</b> is a tool for assessing ill-conditioning, i.e. the impact of small
random changes (perturbations) to variables on parameter estimates. It is an
alternative to collinearity diagnostics such as vif, collin, coldiag, coldiag2.
<b>perturb</b> works with any model, not just linear regression and is suitable for
models with categorical variables, interactions, or non-linear transformations
of the independent variables.
<p>
<b>perturb</b> works by adding a small random "perturbation" value to selected
independent variables, then re-estimating the model. This process is repeated
<i>niter</i> times, after which a summary of the means, standard deviation, minimum
and maximum of the parameter estimates is displayed. If collinearity is a
serious problem in the data, then the estimates will be unstable and vary
strongly.
<p>
<b>perturb</b> can be used with categorical variables. Categorical variables are
reclassified according to a table of reclassification probabilities. There
could for example be a 95% probability that each case is recoded to the same
category, otherwise it is assigned to one of the others. Reclassification
probabilities can be specified in the <b>pcnttabs</b> option. These are adjusted such
that the expected frequencies of the reclassified variable are the same as the
original and an <i>appropriate</i> pattern of association is imposed between the
original and the reclassified variable. See reclass for further details.
<p>
If a model contains interaction or nonlinear transformation then perturbations
are only added to the main effects/untransformed variables. <b>perturb</b> shows how
the perturbations indirectly affect estimates of the derived terms whereas
other collinearity diagnostics basicly treat interactions and transformations
as separate independent variables.
<p>
<b><u>Options</u></b>
<p>
<b>pvars</b> Contains a list of variables to be perturbed. Random values are added to
    the variable, after which the model is re-estimated.
<p>
<b>prange</b> Contains a list of values determining the magnitude of perturbations.
    There should be as many <i>prange</i> values as <i>pvars</i> variables.
<p>
<b>uniform</b> By default, the random perturbations are drawn from a normal
    distribution N(0,<i>x</i>), where <i>x</i> is the <i>prange</i> value corresponding with the
    <i>pvars</i> variable in question. If the option <b>uniform</b> is specified, then the
    random perturbations are drawn from a uniform distribution U(-<i>x</i>/2,<i>x</i>/2)
    instead.
<p>
<b>pfactors</b> Contains a list of categorical variables to be perturbed.
<p>
<b>pcnttabs</b> Contains a list of values corresponding with each entry in <b>pfactors</b>.
    List elements can be numbers, row or column matrices or square matrices. If
    matrices are specified, their dimensions should correspond with the number
    of categories of the <i>pfactor</i> in question.
<p>
    If a number is specified, its value should be between 0 and 100. The number
    should indicate the percentage of cases that will be reclassified to the
    same category. Note that this value is only used to derive initial
    reclassification probabilities and that the adjusted values will be
    somewhat different; see reclass for details.
<p>
    A row or column matrix can also be specified with different values for each
    category of the <i>pfactor</i> entry. These values must be between 0 and 100 and
    indicate the probability of reclassification to the same category for each
    category. See reclass for further details.
<p>
    If a square matrix is specified, it should specify initial reclassification
    probabilities with the original variable in the rows and the reclassified
    variable in the columns. Values need not add to 100 over the columns, this
    is handled by reclass. A square matrix is taken to indicate that the
    <i>pfactor</i> entry is an ordered variable.
<p>
<b>adjust</b> By default, the reclassification probabilities are adjusted such that
    the expected frequencies of the reclassified variable are the same as those
    of the original when the <b>pcnttabs</b> option is used. Use <b>noadjust</b> to suppress
    this and use the percentages specified in the <b>pcnttabs</b> option unmodified.
    <b>noadjust</b> implies <b>nobestmod</b>.
<p>
<b>bestmod</b> By default, an appropriate pattern of association is imposed between
    the original and the reclassified variable when the <b>pcnttab</b> option is used.
    Use <b>nobestmod</b> to avoid this. The reclassification probabilities will be
    adjusted to make the expected frequencies of the reclassified variable
    equal to those of the original but they will otherwise be close
    approximations of the values specified in the <b>pcnttab</b> option.
<p>
<b>qlist</b> Contains values for the multiplicative <b>q</b> parameter corresponding with
    each entry in <b>pfactors</b>. See reclass for further details.
<p>
<b>ulist</b> Contains values for multiplicative <b>u</b> corresponding with each entry in
    <b>pfactors</b>. See reclass for further details.
<p>
<b>distlist</b> Contains values for <b>dist</b> corresponding with each entry in <b>pfactors</b>.
    See reclass for further details.
<p>
<b>assoc</b> For users familiar with loglinear mobility models. Defines association
    patterns corresponding with each entry in <i>pfactors</i>.  Each entry should
    refer to a <b>program</b> in which the variable <b>paras</b> is defined in terms of the
    variables <b>orig</b> and <b>dest</b> to produce a loglinear pattern of associaton. If
    <b>assoc</b> is defined, <b>qlist</b> and <b>ulist</b> are ignored.
<p>
<b>statistics</b> Specify summary statistics to be produced by tabstat. See the
    corresponding option in <b>tabstat</b> for valid values. The default is <b>mean st</b>
    <b>min max</b>.
<p>
<b>format</b> A valid format for specifying results of tabstat and reclass. The
    default is %8.3f.
<p>
<b>save</b> Specify a valid filename to save the coefficients as a dataset for further
    analysis
<p>
<b>misclass</b> maintained for compatability with version 1.Translated by <b>reclass</b> into
    <b>pcnttab(100-</b><i>misclass</i><b>) noadjust</b>.
<p>
<b>niter</b> Indicates the number of times to re-estimate the model.  Default is 100.
<p>
<b>verbose</b> Used to print debugging information.
<p>
<b><u>Transformations</u></b>
<p>
Transformations are specified as global variables $ptrans1, $ptrans2, $ptrans<i>n</i>.
These global variables specify one variable as a function of others using a
syntax suitable for a replace statement. For example:
<p>
global ptrans1 "exp2=exp^2"
#delimit ;
perturb: reg ses fses*eyr educyr*eyr fses*exp educyr*exp exp2,
poptions(pvars(eyr exp) prange(5 5)) beta;
#delimit cr
<p>
<b><u>Categorical variables</u></b>
<p>
In a perturbation analysis, categorical variables are reclassified with a high
probability for each case to remain in the same category.  The easiest way to
do this is to specify an initial table of reclassification probabilities using
the <b>pcnttabs</b> option. These initial probabilities will be adjusted so that there
is an appropriate pattern of association between the original and the
reclassified variable and that the expected frequency distribution of the
reclassified variable is identical to that of the original. See reclass for
further details.
<p>
Dummy variables for the categorical variables can be created using the builtin 
xi command or with xi3 or desmat, available from the ssc archives. The <b>defcon</b>
and <b>desrep</b> options will be recognized if <b>desmat</b> is used. For example:
<p>
char eyr[pzat] dir  
#delimit ;  
mat p=(96, 4, 1, 0\  
        4,91, 4, 1\  
        1, 4,91, 4\  
        0, 1, 4,96);  
perturb: desmat: reg ses fegp6 expc eyr, defcon(dev) desrep(all)
   poptions(pvars(eyr) prange(2.5) pfac(expc fegp6) pcnt(p 96)
   save("tstdat") replace ) ;  
<p>
The same example using <b>xi3</b>:
<p>
perturb: xi3: reg ses e.fegp6 e.expc eyr,  
   poptions(pvars(eyr) prange(2.5) pfac(expc fegp6) pcnt(p 96));
<p>
In these examples, the matrix <b>p</b> contains initial reclassification probabilities
for the variable <b>expc</b>. For the variable <b>fegp6</b>, the initial probability of
reclassification to the same category is 96% for all categories.
<p>
<b><u>Remarks</u></b>
<p>
<b>perturb</b> saves the coefficients for each interation in a matrix.  On completion,
the matrix is transformed to data and summarized to show the mean, standard
deviation, minimum and maximum of the parameter estimates for the <i>perturbed</i>
variables. <b>perturb</b> restores the data to its original state before exiting but
the estimates for each iteration are saved in the result r(perturb). The
summary statistics are saved as r(StatTot). Optionally, the dataset of
coefficients can saved for subsequent analysis. Note that <b>perturb</b> modifies the
output of <b>tabstat</b> and prints variable labels instead of variable names.  The
results using the saved dataset will not have this feature
<p>
<b>perturb</b> can be used with estimation procedures other than regress. On the other
hand, collinearity is a result of extreme (multiple) correlation among
independent variables. Collinearity could therefore be diagnosed by running
<b>regress</b> with an arbitrary dependent variable to use <b>perturb</b>, vif and/or collin
to assess collinearity. This will certainly be a faster solution since maximum
likelihood procedures require iterative solutions whereas ols regression does
not. It is possible though that ML procedures are more sensitive to
collinearity, in which case <b>perturb</b> would be the preferred solution.
<p>
<b><u>Saved results</u></b>
<p>
<b>r(perturb)</b>
    A matrix of coefficients (columns) over the iterations (rows)
<p>
<b>r(StatTot)</b>
    A matrix of summary statistics produced by tabstat.
<p>
<b><u>References</u></b>
<p>
Belsley, D.A. (1991).  <i>Conditioning diagnostics, collinearity and weak data in</i>
    <i>regression</i>.  New York: John Wiley &amp; Sons.
<p>
http://www.xs4all.nl/~jhckx/perturb/
<p>
Direct comments to: John Hendrickx
<p>
<b>perturb</b> is available at SSC-IDEAS.  Use ssc <b>install perturb</b> to obtain the
latest version.
<p>
collin, coldiag, and coldiag2 are also available from SSC. Click on a name to
install or use <b>ssc install</b>
<p>
<b><u>Also see</u></b>
On-line: help for vif, collin, coldiag, coldiag2, reclass
<p>
</pre>