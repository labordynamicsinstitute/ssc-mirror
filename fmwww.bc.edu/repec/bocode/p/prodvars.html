<pre>
-------------------------------------------------------------------------------
help for <b>prodvars</b>                                                (Roger Newson)
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Create product variables for two lists of input variables</u></b>
<p>
        <b>prodvars</b> <i>lvarlist</i> [<i>if</i>] [<i>in</i>] <b>,</b> <b><u>rv</u></b><b>arlist(</b><i>rvarlist</i><b>)</b> [
               <b><u>g</u></b><b>enerate(</b><i>stub</i><b>)</b> <b><u>pr</u></b><b>efix(</b><i>string</i><b>)</b> <b><u>su</u></b><b>ffix(</b><i>string</i><b>)</b> <b><u>se</u></b><b>parator(</b><i>string</i><b>)</b>
               <b><u>lpr</u></b><b>efix(</b><i>string</i><b>)</b> <b><u>lsu</u></b><b>ffix(</b><i>string</i><b>)</b> <b><u>lse</u></b><b>parator(</b><i>string</i><b>)</b>
               <b><u>lln</u></b><b>ame</b> <b><u>lrn</u></b><b>ame</b> <b><u>nol</u></b><b>abel</b>
               <b><u>lch</u></b><b>arlist(</b><i>charlist</i><b>)</b> <b><u>rch</u></b><b>arlist(</b><i>charlist</i><b>)</b> <b><u>cch</u></b><b>arlist(</b><i>charlist</i><b>)</b>
               <b><u>ccpr</u></b><b>efix(</b><i>string</i><b>)</b> <b><u>ccsu</u></b><b>ffix(</b><i>string</i><b>)</b> <b><u>ccse</u></b><b>parator(</b><i>string</i><b>)</b>
               <b><u>noc</u></b><b>onstant</b> <b>float</b> <b>replace</b> <b>fast</b> ]
<p>
    where <i>lvarlist</i> and <i>rvarlist</i> are the left and right variable lists,
    respectively.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>prodvars</b> inputs 2 variable lists, known as the left variable list and the
    right variable list.  It produces as output a list of generated
    variables, one for each pair of variables from the left and right
    variable lists, each with a variable name derived either from a stub or
    from the names of the pair of input variables, and values equal to the
    products of the values of the two input variables.  Optionally, the
    generated variables may also have variable labels derived from the
    variable labels, or variable names, of the input variables.  <b>prodvars</b> is
    useful for calculating variables for the design matrix of a
    multiple-intercept model.  Such a multiple-intercept model is fitted to
    the data using an estimation command with the <b>noconstant</b> option.
    Typically, one of the two input variable lists is a list of indicator
    variables (or dummy variables), each indicating membership of one of
    several groups, forming a partition of the sample, and corresponding to
    group-specific intercepts in the fitted model.  Such a variable list may
    be produced using <b>tabulate</b> with the <b>generate()</b> option, or by <b>xi</b> with the
    <b>noomit</b> option.  The other variable list is typically a list of variables
    corresponding to slopes, differences, or ratios in the fitted model.
    These variables are usually either quantitative variables, or group
    identifier variables corresponding to a factor with an omitted group,
    possibly produced using <b>xi</b> without the <b>noomit</b> option.  The generated
    product variables will then be included in the design matrix, together
    with the variables in the first input list (corresponding to
    group-specific intercepts), and will correspond to group-specific slopes,
    differences, or ratios.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>rvarlist(</b><i>rvarlist</i><b>)</b> specifies the right variable list.  The generated
        variables will correspond to pairs of variables, the first variable
        from the left variable list <i>lvarlist</i>, and the second variable from
        the right variable list <i>rvarlist</i>.  Each generated variable will
        contain the product of the corresponding pair of input variables, at
        least in observations selected by the <b>if</b> and <b>in</b> qualifiers.
<p>
    <b>generate(</b><i>stub</i><b>)</b> specifies a stub from which the output variable names will
        be created.  If <b>generate()</b> is specified, then the output product
        variables will have names prefixed with the <i>stub</i>, and suffixed with
        serial numbers, ordered primarily by the order of the corresponding
        input variables in the <i>lvarlist</i> and secondarily by the order of the
        corresponding input variables specified by <b>rvarlist()</b>.  For instance,
        if there are 3 variables in the <i>lvarlist</i> and 2 variables in the
        variable list specified by <b>rvarlist()</b>, and the user specifies
        <b>generate(b_)</b>, then the output product variables will be named <b>b_1</b>,
        <b>b_2</b>, <b>b_3</b>, <b>b_4</b>, <b>b_5</b> and <b>b_6</b>.  If the user specifies a <b>generate()</b>
        option, then the <b>prefix()</b>, <b>suffix()</b> and <b>separator()</b> options will be
        ignored.
<p>
    <b>prefix(</b><i>string</i><b>)</b> specifies a prefix for generating the variable names of
        the generated product variables.  The name of a product variable,
        corresponding to a left variable from the left variable list and a
        right variable from the right variable list, is formed by combining
        the prefix specified by <b>prefix()</b>, the left variable name, the
        separator specified by <b>separator()</b>, the right variable name, and the
        suffix specified by <b>suffix()</b>.  The prefix and/or the separator and/or
        the suffix may be empty.
<p>
    <b>suffix(</b><i>string</i><b>)</b> specifies a suffix for generating the variable names of
        the generated product variables.
<p>
    <b>separator(</b><i>string</i><b>)</b> specifies a separator for generating the variable names
        of the generated product variables.
<p>
    <b>lprefix(</b><i>string</i><b>)</b> specifies a prefix for generating the variable labels of
        the generated product variables.  The variable label of a product
        variable, corresponding to a left variable from the left variable
        list and a right variable from the right variable list, is formed by
        combining the prefix specified by <b>lprefix()</b>, the left variable label
        (or name), the separator specified by <b>lseparator()</b>, the right
        variable label (or name), and the suffix specified by <b>lsuffix()</b>.  The
        prefix and/or the separator and/or the suffix may be empty.
<p>
    <b>lseparator(</b><i>string</i><b>)</b> specifies a separator for generating the variable
        labels of the generated product variables.
<p>
    <b>lsuffix(</b><i>string</i><b>)</b> specifies a suffix for generating the variable labels of
        the generated product variables.
<p>
    <b>llname</b> specifies that the variable labels of the generated product
        variables will be generated using the variable names of the left
        variables in the list <i>lvarlist</i>.  If <b>llname</b> is not specified, then the
        variable label of a generated product variable is generated using the
        variable label of the left variable, if this label is not empty, and
        using the variable name of the left variable otherwise.
<p>
    <b>lrname</b> specifies that the variable labels of the generated product
        variables will be generated using the variable names of the right
        variables in the list <i>rvarlist</i>.  If <b>lrname</b> is not specified, then the
        variable label of a generated product variable is generated using the
        variable label of the right variable, if this label is not empty, and
        using the variable name of the right variable otherwise.
<p>
    <b>nolabel</b> specifies that no variable labels will be generated for the
        generated product variables.  If <b>nolabel</b> is specified, then the
        options <b>lprefix()</b>, <b>lseparator()</b>, <b>lsuffix()</b>, <b>llname</b>, and <b>lrname</b> are
        ignored.
<p>
    <b>lcharlist(</b><i>charlist</i><b>)</b> specifies a list of names of variable characteristics
        for the generated product variables, to be inherited from the
        corresponding left input variables specified by the <i>lvarlist</i>.
<p>
    <b>rcharlist(</b><i>charlist</i><b>)</b> specifies a list of names of variable characteristics
        for the generated product variables, to be inherited from the
        corresponding right input variables specified by the <b>rvarlist()</b>
        option.
<p>
    <b>ccharlist(</b><i>charlist</i><b>)</b> specifies a list of names of variable characteristics
        for the generated product variables, to be evaluated by combining the
        characteristics of the same names from the corresponding left input
        variables specified by the <i>lvarlist</i> and from the corresponding right
        input variables specified by the <b>rvarlist()</b> option.
<p>
    <b>ccprefix(</b><i>string</i><b>)</b> specifies a prefix string, to be used when combining the
        variable characteristics specified by <b>ccharlist()</b> from the left and
        right input variables to form the characteristics of the same names
        for the generated product variables.
<p>
    <b>ccsuffix(</b><i>string</i><b>)</b> specifies a suffix string, to be used when combining the
        variable characteristics specified by <b>ccharlist()</b> from the left and
        right input variables to form the characteristics of the same names
        for the generated product variables.
<p>
    <b>ccseparator(</b><i>string</i><b>)</b> specifies a separator string, to be used when
        combining the variable characteristics specified by <b>ccharlist()</b> from
        the left and right input variables to form the characteristics of the
        same names for the generated product variables.
<p>
    <b>noconstant</b> specifies that generated product variables which are constant
        in the sample will be dropped.  This option can be useful if the
        generated product variables are used in a design matrix.
<p>
    <b>float</b> specifies that the highest precision storage type allowed for a
        generated product variable will be <b>float</b>.  If <b>float</b> is not specified,
        then the highest precision storage type allowed for a generated
        product variable will be <b>double</b>.  Note that, whether or not <b>float</b> is
        specified, all generated product variables are compressed to the
        lowest precision possible without losing information.
<p>
    <b>replace</b> specifies that, if any existing variables have the same names as
        those specified for the generated product variables, then these
        existing variables will be dropped.  If <b>replace</b> is not specified,
        then <b>prodvars</b> checks whether any such existing variables exist, and
        fails if any exist.
<p>
    <b>fast</b> is an option for programmers.  It specifies that <b>prodvars</b> will do no
        extra work to preserve the original data (without any generated
        product variables) if the user presses Break.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <b>prodvars</b> is intended to produce design matrices for regression models
    with multiple intercepts, estimated using estimation commands with the
    <b>noconstant</b> option.  This practice is in contrast to the more traditional
    practice of estimating regression parameters for models with a single
    intercept, which is identified in Stata by the parameter name <b>_cons</b>, if
    the <b>noconstant</b> option is not specified.
<p>
    The variable labels of the generated indicator variables can be made as
    informative as possible.  They are similar to those generated by <b>xi</b> and
    <b>tabulate</b>, but a lot more flexible.  In particular, the parameters, and
    the corresponding variable labels, can be output to output datasets (or
    resultssets) by the <b>parmest</b> package, and the categorical factors can be
    reconstructed in these resultssets, using the <b>descsave</b> and <b>factext</b>
    packages.  The packages <b>parmest</b>, <b>descsave</b> and <b>factext</b> can all be
    downloaded from SSC, using the <b>ssc</b> command in Stata.
<p>
<p>
<b><u>Examples</u></b>
<p>
    The following example works if the <b>descsave</b> and <b>parmest</b> packages are
    installed from SSC.  (This can be done in Stata using the <b>ssc</b> command.) 
    <b>xi</b> and <b>prodvars</b> are used together to create a design matrix, with
    variables prefixed by <b>_I</b>, corresponding to one intercept for each level
    of the variable <b>foreign</b>, and variables prefixed by <b>_H</b>, corresponding to
    one slope of fuel consumption with respect to weight for each level of
    <b>foreign</b>.  These parameters are estimated using <b>regress</b> and displayed
    using <b>parmest</b>.  Note that <b>descsave</b> and <b>parmest</b> display the variable
    labels of the product variables produced by <b>prodvars</b>.
<p>
                . sysuse auto, clear
                . gene gpm=1/mpg
                . lab var gpm "Fuel consumption (gallons/mile)"
                . xi i.foreign, noomit
                . prodvars _I*, rvar(weight) pre(_H) sep(X) lpre("(")
                    lsep(")*") lrname
                . descsave, list(, abbr(32) subvar noobs)
                . regress gpm _I* _H*, noconst
                . parmest, label list(, abbr(32))
<p>
    The following example works if the <b>descsave</b> and <b>parmest</b> packages are
    installed from SSC.  We create a categorical factor <b>mod3</b>, containing the
    sequence order (modulo 3) of the car model in the dataset, and having
    values 0, 1 and 2.  We then use <b>xi</b>, with the <b>noomit</b> option, to produce a
    lst of variables, prefixed by <b>_I</b>, indicating membership of groups defined
    by all values of the variable <b>foreign</b>.  We then use <b>xi</b>, without the
    <b>noomit</b> option, to produce a list of variables, prefixed by <b>J</b>, indicating
    membership of groups defined by all non-zero values of the variable <b>mod3</b>.
    We then use <b>prodvars</b> to produce product variables, prefixed by <b>_H</b>,
    corresponding to combinations of all values of <b>foreign</b> and non-zero
    values of <b>mod3</b>.  The final regression model contains an intercept for
    each value of <b>foreign</b>, defined as a mean weight for cars with that value
    of <b>foreign</b> and a baseline zero value of <b>mod3</b>, and a weight difference for
    each combined value of <b>foreign</b> and non-zero value of <b>mod3</b>, comparing mean
    car weights with the mean car weight for cars with the same value of
    <b>foreign</b> and a zero value of <b>mod3</b>.
<p>
                . sysuse auto, clear
                . gene mod3=mod(_n,3)
                . lab var mod3 "Model sequence (modulo 3)"
                . xi i.foreign, noomit
                . xi i.mod3, pref(_J)
                . prodvars _I*, rvar(_J*) pre(_H) lsep(" &amp; ")
                . descsave, list(, abbr(32) subvar noobs)
                . regress weight _I* _H*, noconst
                . parmest, label list(, abbr(32))
<p>
<p>
<b><u>Saved results</u></b>
<p>
    <b>prodvars</b> saves the following in <b>r()</b>:
<p>
    Macros         
      <b>r(prodvars)</b>         list of generated product variables
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, Imperial College London, UK.  Email:
    r.newson@imperial.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
     Manual: <b>[R] tabulate</b>, <b>[R] xi</b>
    On-line: help for <b>tabulate</b>, <b>xi</b>
             help for <b>parmest</b>, <b>descsave</b>, <b>factext</b> if installed
</pre>