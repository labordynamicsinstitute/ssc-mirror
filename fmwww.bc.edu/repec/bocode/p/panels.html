<pre>
<b>help panels</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>panels</b> -- Count panels (groups) / apply command to panel units
<p>
<p>
<b><u>Syntax</u></b>
<p>
<p>
    Syntax 1: count panels
<p>
        <b>panels</b> <i>varlist</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i> ]
<p>
<p>
    Syntax 2: apply <i>command</i> to panel units
<p>
        <b>panels</b> <i>varlist</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i> <i>prefix_options</i> ] <b>:</b>
               <i>command</i>
<p>
<p>
    <i>options</i>             description
    --------------------------------------------------------
    <b><u>g</u></b><b>enerate(</b><i>newvar</i><b>)</b>    store panel sizes in <i>newvar</i>
    <b><u>fill</u></b><b>in</b>              fill in <i>newvar</i> for all observations
    <b>id(</b><i>newvar</i><b>)</b>          create a new panel ID variable
    <b><u>r</u></b><b>eplace</b>             overwrite existing variables
    <b><u>isc</u></b><b>onstant(</b><i>varlist</i><b>)</b> verify that the specified variables
                          are constant within panels
    <b><u>n</u></b><b>oisily</b>             display panel info with syntax 2
    <b><u>now</u></b><b>arn</b>              suppress syntax 2 warning message
    --------------------------------------------------------
<p>
    <b>fweight</b>s, <b>aweight</b>s, <b>iweight</b>s, and <b>pweight</b>s are allowed; see help weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>panels</b> counts the panels defined by <i>varlist</i> and displays some basic
    information on panel sizes (syntax 1). A panel is a group of observations
    with identical values for the variables in <i>varlist</i>.
<p>
    If used as a prefix command (syntax 2), <b>panels</b> applies the specified
    command to the panel units defined by <i>varlist</i>. This is useful, for
    example, if you want to compute frequency distributions or summary
    statistics for panel characteristics. To be precise, <b>panels</b> picks one
    observation per panel and then applies the command to these observations.
    Variables referred to in <i>command</i> are assumed to be constant within
    panels. Use the <b>isconstant()</b> option to verify this assumption.
<p>
    <i>command</i> is required to follow standard Stata syntax and allow the if
    qualifier.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>generate(</b><i>newvar</i><b>)</b> stores in <i>newvar</i> the sizes of the panels (i.e. the
        number of observations per panel). The default is to use only one
        observation per panel to store this information (the remaining
        observation are set to missing). Specify the <b>fillin</b> option to store
        the panel sizes in all observations.
<p>
    <b>fillin</b> causes <i>newvar</i> stored by <b>generate()</b> to be filled in for all
        observations within the panels.
<p>
    <b>id(</b><i>newvar</i><b>)</b> stores in <i>newvar</i> unique identification numbers for the panels
        (using values 1, 2, ...).
<p>
    <b>replace</b> allows <b>panels</b> to overwrite existing variables.
<p>
    <b>isconstant(</b><i>varlist</i><b>)</b> verifies that the specified variables are constant
        within panels. <b>check()</b> is a synonym for <b>isconstant()</b>. Error is
        returned if any of the variables is not constant within panels.
<p>
    <b>noisily</b> can be used with syntax 2 to request that the information on the
        number of panels and the panel sizes be displayed. The default is to
        suppress this information in syntax 2.
<p>
<p>
<b><u>Examples</u></b>
<p>
    . webuse nlswork, clear
    (National Longitudinal Survey.  Young Women 14-26 years of age in 1968)
    
    . panels idcode
    
    Number of obs      =     28534
    Number of groups   =      4711
    
    Obs per group: min =         1
                   avg =  6.056888
                   max =        15
    
    . panels idcode if race==2
    
    Number of obs      =      8051
    Number of groups   =      1325
    
    Obs per group: min =         1
                   avg =  6.076226
                   max =        15
    
    . panels idcode: tabulate race
    
       1=white, |
       2=black, |
        3=other |      Freq.     Percent        Cum.
    ------------+-----------------------------------
              1 |      3,329       70.66       70.66
              2 |      1,325       28.13       98.79
              3 |         57        1.21      100.00
    ------------+-----------------------------------
          Total |      4,711      100.00
    
    (variables assumed constant within panels; use <b>isconstant()</b> to verify)
    
    . panels idcode: summarize birth_yr grade collgrad
    
        Variable |       Obs        Mean    Std. Dev.       Min        Max
    -------------+--------------------------------------------------------
        birth_yr |      4711    48.25387    3.051795         41         54
           grade |      4709    12.74347    2.566536          0         18
        collgrad |      4711    .2061134    .4045558          0          1
    
    (variables assumed constant within panels; use <b>isconstant()</b> to verify)
    
    . panels idcode, isconstant(age): summarize age
    23657 contradictions in 23823 observations
    assertion is false
    age not constant within panels
    r(9);
    
<p>
<b><u>Returned results</u></b>
<p>
    <b>panels</b> saves the following scalars:
<p>
        <b>r(N)</b>      Number of observations
        <b>r(N_g)</b>    Number of panels (groups)
        <b>r(g_min)</b>  Minimum panel size
        <b>r(g_avg)</b>  Average panel size
        <b>r(g_max)</b>  Maximum panel size
<p>
    If <b>panels</b> is used as a prefix command (syntax 2), the results may become
    overwritten by <i>command</i>.
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jannb@ethz.ch
<p>
    Thanks for citing this software as follows:
<p>
        Jann, B. (2009). panels: Stata module to count panels and apply a
        command to panel units. Available from 
        http://ideas.repec.org/c/boc/bocode/s457086.html.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Cox, N. J. (2007). Speaking Stata: Counting groups, especially panels.
        The Stata Journal 7(4):571-581.
<p>
</pre>