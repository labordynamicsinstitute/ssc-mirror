<pre>
-------------------------------------------------------------------------------
help for <b>pgmhaz8</b>                            Stephen P. Jenkins (September 2004)
-------------------------------------------------------------------------------
<p>
<b><u>Discrete time (grouped data) proportional hazards models</u></b>
<p>
        <b>pgmhaz8</b> <i>covariates</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b> <b><u>i</u></b><b>d(</b><i>idvar</i><b>)</b>
                 <b><u>d</u></b><b>ead(</b><i>deadvar</i><b>)</b> <b><u>s</u></b><b>eq(</b><i>seqvar</i><b>)</b> <b><u>lnv</u></b><b>ar0(</b><i>#</i><b>)</b> <b><u>ef</u></b><b>orm</b> <b>nocons</b> <b>nolog</b>
                 <b><u>nob</u></b><b>eta0</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <i>maximize_options</i>]
<p>
    <b>by</b> <i>...</i> <b>:</b> may be used with <b>pgmhaz8</b>; see help by.
<p>
    <b>fweight</b>s and <b>iweight</b>s are allowed; see help weights.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>pgmhaz8</b> estimates by ML two discrete time (grouped data) proportional
    hazards regression models, one of which incorporates a gamma mixture
    distribution to summarize unobserved individual heterogeneity (or
    'frailty').  Covariates may include regressor variables summarizing
    observed differences between persons (either fixed or time-varying), and
    variables summarizing the duration dependence of the hazard rate.  With
    suitable definition of covariates, models with a fully non-parametric
    specification for duration dependence may be estimated; so too may
    parametric specifications.  <b>pgmhaz8</b> thus provides a useful complement to
    <b>stcox</b> (for continuous survival time data), and related programs.  For
    further discussion of hazard regression models with unobserved
    heterogeneity, see e.g. 
    http://www.iser.essex.ac.uk/teaching/stephenj/ec968/index.php, espcially
    `Lesson 8'. The Lesson also shows how to derive predicted hazard and
    survivor functions from the estimates of the model.
<p>
<p>
    <b>pgmhaz8</b> estimates two models by maximum likelihood:  (1) the
    Prentice-Gloeckler (1978) model; and (2) the Prentice-Gloeckler (1978)
    model incorporating a gamma mixture distribution to summarize unobserved
    individual heterogeneity, as proposed by Meyer (1990).  Specifically, the
    Prentice-Gloeckler-Meyer models estimated are those described by Meyer
    (1990, equations 5 and 7).
<p>
    Suppose there are individuals <i>i</i> = 1,...,<i>N</i>, who each enter a state (e.g.
    unemployment) at time <i>t</i> = 0 and are observed for <i>k_i</i> time periods, at
    which point each person either remains in the state (censored duration
    data) or leaves the state (complete duration data).
<p>
    The log-likelihood function for Model (2) is:
<p>
            _                                                       _
     i=N   |   _   k_i-1       _             _    k_i        _       |
     ---   |  |     ---         |-v^-1      |     ---         |-v^-1 |
     \     |  |     \           |           |     \           |      |
     /  log|  |1+ v./  exp(I_it)|     - c_i.|1+ v./  exp(I_it)|      |
     ---   |  |     ---         |           |     ---         |      |
     i=1   |  |_    t=0        _|           |_    t=0        _|      |
           |_                                                       _|
<p>
<p>
    <i>c_i</i> is a censoring indicator (= 1 if event, 0 otherwise); <i>I_it</i> is an
    index function, <i>X_it*b</i>, incorporating the impact of covariates <i>X_it</i>; and
    <i>v</i> is the variance of the gamma mixing distribution (the mean of which is
    normalized to equal one).  Model 1 is the limiting case as <i>v</i> -&gt; 0.
<p>
    For suitably re-organised data, the log-likelihood function for Model (1)
    is the same as the log-likelihood for a generalized linear model of the
    binomial family with complementary log-log link: see Allison (1982) or
    Jenkins (1995).  Model (1) is estimated using the glm command (cloglog
    would have produced the same estimates).  To estimate the discrete time
    proportional hazards model with normally (rather than Gamma) distributed
    heterogeneity, use xtcloglog with the data organized as here.
<p>
    Model (2) is estimated using <b>ml d0</b>, with starting values for the
    coefficients <i>b</i> taken from Model (1)'s estimates. The program estimates
    the log of the Gamma variance, with default value equal to -1, i.e. a
    variance of c. 0.37). Different starting values for the log variance may
    be set optionally: see below.
<p>
<b><u>Important note about data organization and variables</u></b>
<p>
    The data set must be organised beforehand so that there is a data row
    corresponding to each time period at risk of the event for each subject.
    (This corresponds to `episode-splitting' at each each and every period.) 
    expand is useful for putting the data in this form.  Also see the `data
    step' discussion in Jenkins (1995).
<p>
<b><u>Options</u></b>
<p>
    The first three options are required:
<p>
    <b>id(</b><i>idvar</i><b>)</b> specifies the variable uniquely identifying each subject, <i>i</i>.
<p>
    <b>seq(</b><i>seqvar</i><b>)</b> is the variable uniquely identifying each time period at risk
        for each subject. For each <i>i</i>, the variable is the integer sequence 1,
        2, ..., <i>k_i</i>.
<p>
    <b>dead(</b><i>deadvar</i><b>)</b> summarizes censoring status during each time period at
        risk.  If <i>c_i</i> = 0, deadvar = 0 for all <i>t</i> = 1, 2, ..., <i>k_i</i>; if <i>c_i</i> =
        1, <i>deadvar</i> = 0 for all <i>t</i> = 1,2,...,<i>(k_i)</i>-1, and <i>deadvar</i> = 1 for <i>t</i> =
        <i>k_i</i>.
<p>
    <b>lnvar0(</b><i>#</i><b>)</b> specifies the value for the log of the Gamma variance that is
        used as the starting value in the maximization. The default is -1.
<p>
    <b>eform</b> reports the coefficients transformed to hazard ratio format, i.e.
        exp(b) rather than b. Standard errors and confidence intervals are
        similarly transformed. <b>eform</b> may be specified at estimation or when
        redisplaying results.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the significance level, in percent, for confidence
        intervals of the parameters; see help level.
<p>
    <b>nocons</b> specifies no intercept term in the index function, <i>X_it*b</i>.
<p>
    <b>nolog</b> suppresses the iteration logs.
<p>
    <b>nobeta0</b> suppresses reporting of the estimates from Model (1).
<p>
    <i>maximize_options</i> control the maximization process. The options available
        are those available for <b>ml d0</b> as shown by help maximize, with the
        exception of <b>from()</b>. For difficult maximization problems, using the
        <b>difficult</b> or <b>technique</b> options may help convergence.  So too might
        different starting values for the Gamma variance parameter.
<p>
<p>
<b><u>Saved results</u></b>
<p>
    In addition to the usual results saved after <b>ml</b>, <b>pgmhaz8</b> also saves the
    following:
<p>
    <b>e(gammav)</b> and <b>e(se_gammav)</b> are the estimated Gamma variance and its
    standard error.
<p>
    <b>e(ll_nofr)</b> is the log-likelihood value from Model (1).
<p>
    <b>e(lltest)</b> is the likelihood ratio test statistic for the test of Model
    (1) versus Model (2), i.e. for the hypothesis that the Gamma variance is
    equal to zero, and <b>e(lltest_p)</b> is the associated <i>p</i>-value.
<p>
    <b>e(depvar)</b>, <b>e(deadvar)</b>, and <b>e(seqvar)</b> contain the names of <i>depvar</i>,
    <i>deadvar</i>, and <i>seqvar</i>.
<p>
    <b>e(N_spell)</b> is the number of spells in the data. (Cf. <b>e(N)</b>, the total
    number of `person-period' observations in the estimation data set.)
<p>
<p>
<b><u>Examples</u></b>
<p>
    . sysuse cancer, clear
<p>
    . ge id = _n
<p>
    . recode drug 1=0 2/3=1
<p>
    . expand studytime
<p>
    . bysort id: ge t = _n // 'survival time', t, is # periods at risk per
        subject
<p>
    . bysort id: ge dead = died &amp; _n==_N // event indicator
<p>
    . // duration dependence: log(time)
<p>
    . ge logt = ln(t)
<p>
    . pgmhaz drug age logt, id(id) seq(t) d(dead) nolog
<p>
    . pgmhaz, eform
<p>
    . // duration dependence: piece-wise constant
<p>
    . ge byte dur1 = d1+d2+d3+d4+d5+d6
<p>
    . ge byte dur2 = d7+d8+d9+d10+d11+d12
<p>
    . ge byte dur3 = d13+d14+d15+d16+d17+d18
<p>
    . ge byte dur4 = d19+d20+d21+d22+d23+d24
<p>
    . ge byte dur5 = d25+d26+d27+d28+d29+d30
<p>
    . ge byte dur6 = d31+d32+d33+d34+d35+d36+d37+d38+d39
<p>
    . pgmhaz8 drug age dur1-dur6, i(id) s(t) d(dead) nocons
<p>
    . // duration dependence: non-parametric (period-specific)
<p>
    . ta t, ge(d) // Create period-specific dummy variables, d*
<p>
    . ta t dead // Check whether events in each period; only use periods with
        events
<p>
    . egen include = eqany(d1-d8 d10-d13 d15-d17 d22-d25 d28 d33), v(1)
<p>
    . pgmhaz8 drug age d1-d8 d10-d13 d15-d17 d22-d25 d28 d33 ///
<p>
            if include, i(id) s(t) d(dead) nocons
<p>
<p>
<b><u>Author</u></b>
<p>
    Stephen P. Jenkins &lt;stephenj@essex.ac.uk&gt;, Institute for Social and
    Economic Research, University of Essex, Colchester CO4 3SQ, U.K.
<p>
<b><u>Acknowledgements</u></b>
<p>
    Adrienne tenCate found a bug in the handling of fweighted data, and Jeff
    Pitblado showed me how to fix it.
<p>
<p>
<b><u>References</u></b>
<p>
    Allison, P.D. (1982). Discrete-time methods for the analysis of event
        histories. In <i>Sociological Methodology 1982</i>, ed. S. Leinhardt, San
        Francisco: Jossey-Bass Publishers, 61-97.
<p>
    Jenkins, S.P. (1995). Easy estimation methods for discrete-time duration
        models. <i>Oxford Bulletin of Economics and Statistics</i> 57 (1): 129-138.
<p>
    Meyer, B.D. (1990). Unemployment insurance and unemployment spells.
        <i>Econometrica</i> 58 (4): 757-782.
<p>
    Prentice, R. and Gloeckler L. (1978). Regression analysis of grouped
        survival data with application to breast cancer data.  <i>Biometrics</i> 34:
        57-67.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Help for stcox, glm, cloglog, xtcloglog, expand, and hshaz if installed.
             Users of Stata versions 5 to 8.1 may estimate Models (1) and (2)
             using <b>pgmhaz</b>, published in STB-39. Install it using <b>net stb 39</b>
             <b>sbe17</b>.
<p>
</pre>