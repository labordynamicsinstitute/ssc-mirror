<pre>
-------------------------------------------------------------------------------
help for <b>pstest</b>
-------------------------------------------------------------------------------
<p>
<b><u>Covariate imbalance testing and graphing</u></b>
<p>
        <b>pstest</b> <b>[</b><i>varlist</i><b>]</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>[,</b> <b><u>t</u></b><b>reated(</b><i>varname</i><b>)</b> <b>both</b> <b>raw</b>
                     <b><u>mw</u></b><b>eight(</b><i>varname</i><b>)</b> <b><u>sup</u></b><b>port(</b><i>varname</i><b>)</b> <b><u>not</u></b><b>able</b> <b><u>lab</u></b><b>el</b> <b><u>only</u></b><b>sig</b>
                     <b><u>nod</u></b><b>ist</b> <b><u>gr</u></b><b>aph</b> <b>hist</b> <i>graph_options</i> <b>]</b>
<p>
<b><u>Description</u></b>
<p>
    <b>pstest</b> calculates and optionally graphs several measures of the balancing
    of the variables in <i>varlist</i> between two groups (if <i>varlist</i> is not
    specified, <b>pstest</b> will look for the variables that were specified in the
    latest call of <b>psmatch2</b> or of <b>pstest</b>). In particular it can be used to
    gauge comparability in terms of <i>varlist</i> between:
<p>
    1. Two matched samples (the default).
<p>
       <b>pstest</b> can be called directly after <b>psmatch2</b>, or it can be fed
       matching weights via option <b>mweight</b> to assess the extent of balancing
       achieved on the two matched samples. A particularly useful way to use
       <b>pstest</b> is in search of a matching method and set of matching
       parameters that achieves good balancing; <b>psmatch2</b> can be called
       repeatedly prefixed by <b>quietly</b> and the extent of corresponding
       balancing can each time be displayed by calling <b>pstest</b>.
<p>
    2. Any two samples (option <b>raw</b>).
<p>
       <b>pstest</b> can be called to assess the comparability of <i>any</i> two groups.
       This may be before performing matching, or completely unrelated to
       matching purposes. (The groups are in any case referred to as Treated
       and Controls, but they could be males and females, employed and
       non-employed etc.).
<p>
    3. Two samples before and after having performed matching (option <b>both</b>).
<p>
       In this case <b>pstest</b> compares the extent of balancing between the two
       samples before and after having performed matching.
<p>
    For each variable in <i>varlist</i> it calculates:
<p>
        (a) t-tests for equality of means in the two samples (before and
        after matching if option <b>both</b> is specified). T-tests are based on a
        regression of the variable on a treatment indicator.  Before matching
        or on <b>raw</b> samples this is an unweighted regression on the whole
        sample, after matching the regression is weighted using the matching
        weight variable _weight or user-given weight variable in <b>mweight</b> and
        based on the on-support sample;
<p>
        (b) the standardised percentage bias. If option <b>both</b> is specified,
        the standardised percentage bias is shown before and after matching,
        together with the achieved percentage reduction in abs(bias).  The
        standardised % bias is the % difference of the sample means in the
        treated and non-treated (full or matched) sub-samples as a percentage
        of the square root of the average of the sample variances in the
        treated and non-treated groups (formulae from Rosenbaum and Rubin,
        1985).
<p>
    It also calculates overall measures of covariate imbalance:
<p>
        (a) Pseudo R2 from probit estimation of the conditional treatment
        probability (propensity score) on all the variables in <i>varlist</i> on <b>raw</b>
        samples, matched samples (default) or <b>both</b> before and after matching.
        Also displayed are the corresponding P-values of the likelihood-ratio
        test of the joint insignificance of all the regressors (before and
        after matching if option <b>both</b> is specified);
<p>
        (b) the mean and median bias as summary indicators of the
        distribution of the abs(bias) (before and after matching if option
        <b>both</b> is specified);
<p>
    Optionally <b>pstest</b> graphs the extent of covariate imbalance in terms of
    standardised percentage differences using dot charts (option <b>graph</b>) or
    histograms (option <b>hist</b>).
<p>
    One only need type <b>pstest[, both]</b> directly after <b>psmatch2</b> to inspect the
    extent of covariate balancing in matched samples if <b>psmatch2</b> has been
    called with a <i>varlist</i>.
<p>
    If option <b>both</b> is specified, <b>pstest</b> returns the following diagnostics of
    covariate balancing before and after matching: <i>r(meanbiasbef)</i> and
    <i>r(meanbiasaft)</i> the mean absolute standardised bias, <i>r(medbiasbef)</i> and
    <i>r(medbiasaft)</i> the median absolute standardised bias, <i>r(r2bef)</i> and
    <i>r(r2aft)</i> the pseudo R2 from probit estimation and <i>r(chiprobbef)</i> and
    <i>r(chiprobaft)</i> the P-value of the likelihood-ratio test. If the two groups
    are compared only once (matched samples as default or two unmatched
    samples if option <b>raw</b> is specified), <b>pstest</b> returns <i>r(meanbias)</i>,
    <i>r(medbias)</i>, <i>r(r2)</i> and <i>r(chiprob)</i>.  <b>pstest</b> always returns in <i>r(exog)</i> the
    names of the variables for which it has tested the extent of balancing.
<p>
<p>
<b><u>Important notes</u></b>
<p>
    <b>pstest</b> only considers balancing for the treated even if called after
    <b>psmatch2, ate</b>.
<p>
    Spline matching as in <b>psmatch2, spline</b> as well as the default (tricube)
    local linear regression matching as in <b>psmatch2, llr</b> first smooth the
    outcome and then perform nearest neighbor matching. <b>pstest</b> does not make
    sense in these cases since more non-treated are used to calculate the
    counterfactual outcome than the nearest neighbor only.
<p>
<p>
<b><u>Detailed Syntax</u></b>
<p>
    <b>Matched samples:</b>
<p>
        <b>pstest</b> <b>[</b><i>varlist</i><b>]</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>[,</b> <b><u>t</u></b><b>reated(</b><i>varname</i><b>)</b>
                     <b><u>mw</u></b><b>eight(</b><i>varname</i><b>)</b> <b><u>sup</u></b><b>port(</b><i>varname</i><b>)</b> <b><u>not</u></b><b>able</b> <b><u>nod</u></b><b>ist</b> <b><u>lab</u></b><b>el</b>
                     <b><u>only</u></b><b>sig</b> <b><u>gr</u></b><b>aph</b> <b>hist</b> <i>graph_options</i> <b>]</b>
<p>
<p>
    <b>Raw samples:</b>
<p>
        <b>pstest</b> <b>[</b><i>varlist</i><b>]</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>,</b> <b>raw</b> <b><u>t</u></b><b>reated(</b><i>varname</i><b>)</b> <b>[</b> <b><u>not</u></b><b>able</b>
                     <b><u>nod</u></b><b>ist</b> <b><u>lab</u></b><b>el</b> <b><u>only</u></b><b>sig</b> <b><u>gr</u></b><b>aph</b> <b>hist</b> <i>graph_options</i> <b>]</b>
<p>
    <b>Before and after matching:</b>
<p>
        <b>pstest</b> <b>[</b><i>varlist</i><b>]</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>,</b> <b>both</b> <b>[</b> <b><u>t</u></b><b>reated(</b><i>varname</i><b>)</b>
                     <b><u>mw</u></b><b>eight(</b><i>varname</i><b>)</b> <b><u>sup</u></b><b>port(</b><i>varname</i><b>)</b> <b><u>not</u></b><b>able</b> <b><u>nod</u></b><b>ist</b> <b><u>lab</u></b><b>el</b>
                     <b><u>gr</u></b><b>aph</b> <b>hist</b> <i>graph_options</i> <b>]</b>
<p>
        
<b><u>Options</u></b>
<p>
    <b><u>t</u></b><b>reated(</b><i>varname</i><b>)</b> Treatment (or group) indicator (0/1).  If option <b>raw</b> is
        not specified, default is _treated left behind from the latest
        <b>psmatch2</b> call.
<p>
    <b>both</b> Requires comparability to be assessed both before and after
        matching.  Default is only after matching.
<p>
    <b>raw</b> Requires comparability to be assessed between any two (unweighted)
        groups.  This can be before wishing to perform matching, but also
        unrelated to matching purposes, e.g.  to quickly assess how
        randomisation has worked.
<p>
    <b><u>mw</u></b><b>eight(</b><i>varname</i><b>)</b> Weight of matches.  If option <b>raw</b> is not specified,
        default is _weight left behind from the latest <b>psmatch2</b> call.
<p>
    <b><u>sup</u></b><b>port(</b><i>varname</i><b>)</b> Common support indicator (0/1).  If option <b>raw</b> is not
        specified, default is _support left behind from the latest <b>psmatch2</b>
        call.
<p>
    <b><u>not</u></b><b>able</b> Do not display the table with the individual covariate imbalance
        indicators (standardised percentage bias, t-tests, and if option <b>both</b>
        is specified achieved percentage reduction in absolute bias) for each
        variable in <i>varlist</i>.
<p>
    <b><u>lab</u></b><b>el</b> Display variable labels instead of variable names in the
        variable-by-variable table.
<p>
    <b><u>only</u></b><b>sig</b> In the variable-by-variable table only display those variables
        which are significantly unbalanced (p&lt;=0.10). This option is ignored
        if option <b>both</b> is specified.
<p>
    <b><u>nod</u></b><b>ist</b> Do not display the distribution summary of the absolute
        standardised percentage bias across all variables in <i>varlist</i>.
<p>
    <b><u>gr</u></b><b>aph</b> Display a graphical summary of covariate imbalance via a dot chart,
        showing the standardised percentage bias for each covariate. If
        option <b>both</b> is specified, information before and after matching is
        displayed in the same dot chart. If more than 30 covariates are
        specified, they are not labelled.
<p>
    <b>hist</b> Display a graphical summary of covariate imbalance via a histogram,
        showing the distribution of the standardised percentage bias across
        covariates. If option <b>both</b> is specified, imbalance before and after
        matching is displayed in two histograms. Recommended for a large
        number of covariates.
<p>
    <i>graph_options</i> Additional options can be specified for the relevant graph
        type (dot graph or histogram). Useful examples are
        <b>yscale(range(</b><i>numlist</i><b>))</b>, <b>ylabel(</b><i>numlist</i><b>))</b> or <b>legend(off)</b> for the
        former and <b>bin(</b>#<b>)</b> for the latter.
<p>
<p>
<b><u>Examples</u></b>
<p>
     . pstest age gender foreign exper, t(training) mw(_weight) onlysig graph
     . pstest age foreign exper if district==1, raw t(male) label hist
        
     . psmatch2 treated age gender foreign exper, outcome(wage)
     . pstest
     . pstest, both
<p>
<b><u>Also see</u></b>
<p>
    The commands psmatch2, psgraph.
<p>
<b><u>Background Reading</u></b>
<p>
Rosenbaum, P.R. and Rubin, D.B. (1985), "Constructing a Control Group Using
  Multivariate Matched Sampling Methods that Incorporate the Propensity Score",
  <i>The American Statistician 39(1)</i>, 33-38.
<p>
<b><u>Author</u></b>
<p>
    Edwin Leuven, University of Oslo. If you observe any problems 
    mailto:e.leuven@gmail.com.
<p>
</pre>