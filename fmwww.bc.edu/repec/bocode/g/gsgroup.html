<pre>
-------------------------------------------------------------------------------
help for <b>gsgroup</b>                                                 (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Create a group variable and optionally an output dataset for a </u></b><b><u>gsort</u></b><b><u> key</u></b>
<p>
        <b>gsgroup</b> <i>gsort_list</i> , <b><u>g</u></b><b>enerate(</b><i>varname</i><b>)</b> [ <b><u>sa</u></b><b>ving(</b><i>filename</i> [<b>, replace</b>]<b>)</b>
                     no<b><u>miss</u></b><b>ing</b> <b><u>m</u></b><b>first</b> ]
<p>
    where <i>gsort_list</i> is a list of one or more elements of the form
<p>
        [<b>+</b>|<b>-</b>]<i>varname</i>
<p>
    as used by the <b>gsort</b> command.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>gsgroup</b> inputs a <b>gsort</b> key (a list of elements of the form used by <b>gsort</b>,
    and generates as output a new variable, indicating the sequential order
    of the group to which each observation belongs, and (optionally) an
    output dataset (or resultsset), with 1 observation per group, and data on
    the values of the generated variable, and the variables of the <b>gsort</b> key
    corresponding to that group.  Unlike <b>gsort</b>, <b>gsgroup</b> does not change the
    sort order of the dataset in memory.  The output dataset can be merged
    into other datasets, using the official Stata command <b>merge</b> or the SSC
    package <b>addinby</b>.  <b>gsgroup</b> is typically used together with the SSC
    packages <b>parmest</b> and <b>xcontract</b>.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>generate(</b><i>varname</i><b>)</b> must be present.  It specifies the name of an output
        variable to be generated.  This output variable will contain, in each
        observation, the group to which that observation belongs, based on
        the values of the variables of the <b>gsort</b> key in that ovservation.  It
        will have 1 integer value per combination of values for the input
        variables in the <i>varlist</i>, in ascending order of these values,
        starting with 1.
<p>
    <b>saving(</b><i>filename</i> [<b>, replace</b>]<b>)</b> specifies a file containing an output
        dataset (or resultsset), with 1 observation per group specified by
        the <i>varlist</i>, and data on the corresponding value of the new variable
        specified by the <b>generate()</b> option, and also on the values of the
        input variables in the <b>gsort</b> key corresponding to that group.  The
        output dataset is sorted primarily by the grouping variable, and
        secondarily by the variables in the <b>gsort</b> key in order of appearance.
        If <b>replace</b> is specified, then any existing file named <i>filename</i> will
        be replaced.
<p>
    <b>nomissing</b> specifies that observations with missing values in the
        variables of the input <b>gsort</b> key will have missing values in the
        generated group variable, and that these missing values will not be
        included in the <b>saving()</b> dataset (if specified).  In default, groups
        with missing values will be included, both in the group variable and
        in the output dataset.
<p>
    <b>mfirst</b> functions as the option of the same name for <b>gsort</b>.
<p>
<b><u>Examples</u></b>
<p>
        <b>.sysuse auto, clear</b>
        <b>.gsgroup -foreign rep78, gene(frgroup)</b>
<p>
        <b>.sysuse auto, clear</b>
        <b>.gsgroup rep78 foreign, g(rfgroup) saving(rfgroup1.dta, replace)</b>
<p>
    The following advanced example requires Stata Version 11 or higher.  It
    uses <b>xgroup</b> with the packages <b>parmest</b>, <b>xcontract</b>, <b>keyby</b> and <b>addinby</b>,
    downloadable from SSC.  It defines a new binary variable <b>odd</b>, indicating
    that a car is odd-numbered in the sequence of the data.  It then uses
    <b>gsgroup</b> to create a new variable <b>fogroup</b>, grouping the data by the binary
    variables <b>foreign</b> and <b>odd</b>, and an output dataset with 1 option per group.
    It then fits a regression model predicting fuel efficiency in miles per
    gallon (mpg) from car weight in US pounds (lb) to the data in each group
    defined by <b>fogroup</b>, and uses <b>margins</b> to estimate the expected mileage per
    gallon, in that group, of a car weighing 3000 lb.  The estimated mileage
    for each group, with its confidence limits, is saved in an output dataset
    (or resultsset) in a temporary file, using <b>parmest</b>, with the <b>idstr()</b> and
    <b>rename()</b> options to create a numeric identifier variable, also with the
    name <b>fogroup</b>.  We then concatenate the <b>parmest</b> resultssets into the
    memory using <b>append</b>, and then use <b>addinby</b> to add in the values of the key
    variables from the <b>gsgroup</b> resultsset.  Finally, we use <b>keyby</b> to key the
    resultsset by the groups and by their defining variables, and <b>describe</b>
    and <b>list</b> the resultsset.  Note that this example uses the variable
    characteristic <b>fogroup[varlist]</b>, documented in <b>Saved results</b>, and
    containing a list of the variables defining the groups.
<p>
    Set-up:
<p>
        <b>.sysuse auto, clear</b>
        <b>.gene byte odd=mod(_n,2)</b>
        <b>.lab var odd "Odd-numbered car"</b>
<p>
    Calculations:
<p>
        <b>.gsgroup -foreign odd, gene(fogroup) saving(fogroup1, replace)</b>
        <b>.global tflist ""</b>
        <b>.levelsof fogroup, lo(fogroups)</b>
        <b>.foreach GP of num `fogroups' {</b>
        <b>.xcontract fogroup `fogroup[varlist]' if fogroup==`GP', list(,)</b>
        <b>.regress mpg weight if fogroup==`GP'</b>
        <b>.margins, at(weight=3000)</b>
        <b>.tempfile tfcur</b>
        <b>.parmest, bmat(r(b)) vmat(r(V)) idnum(`GP') rename(idnum fogroup)</b>
            <b>saving(`"`tfcur'"', replace) flis(tflist)</b>
        <b>.}</b>
        <b>.clear</b>
        <b>.append using $tflist</b>
        <b>.addinby fogroup using fogroup1</b>
        <b>.keyby fogroup `fogroup[varlist]'</b>
        <b>.describe</b>
        <b>.list</b>
<p>
<p>
<b><u>Saved results</u></b>
<p>
<b>gsgroup</b> assigns to the <b>generate()</b> variable a variable characteristic <b>varlist</b>,
containing a <i>varlist</i> of the variables appearing in the input <b>gsort</b> key,
in order of appearance in the key.
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, National Heart and Lung Institute, Imperial College London,
    UK.
    Email: r.newson@imperial.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
     Manual: <b>[D] gsort</b>, <b>[D] save</b>, <b>[D] sort</b>, <b>[D] merge</b>
    On-line: help for <b>gsort</b>, <b>save</b>, <b>sort</b>, <b>merge</b>
             help for <b>addinby</b>, <b>keyby</b>, <b>parmest</b>, <b>xcontract</b> if installed
</pre>