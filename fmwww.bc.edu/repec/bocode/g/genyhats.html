<pre>
<b>help genyhats</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    genyhats --    Generates <i>y_hat</i> affinity measures for PTV analysis
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>genyhats</b> yhatname1: <i>indepvars</i>_1 [ || yhatname2: <i>indepvars</i>_2 ... ] [<b>,</b>
                <i>options</i>]
        
                or
<p>
        <b>genyhats</b> <i>varlist</i> [<b>,</b> <i>options</i>]
<p>
    <i>options</i>                Description
    -------------------------------------------------------------------------
      <b><u>dep</u></b><b>var(</b><i>varname</i><b>)</b>      the dependent variable for which affinities are
                             being estimated
      <b><u>con</u></b><b>textvars(</b><i>varlist</i><b>)</b> the variables identifying different electoral
                             contexts
      <b><u>sta</u></b><b>ckid(</b><i>varname</i><b>)</b>     a variable identifying different "stacks", for
                             which y-hats will be separately generated if
                             <b>genyhats</b> is called after stacking
      <b><u>nos</u></b><b>tack</b>              override the default behavior that treats each
                             stack as a separate context (has no effect if
                             the command is used before the data have been
                             stacked.)
      <b><u>ypr</u></b><b>efix</b>              the prefix for new variable(s) generated from
                             those in <i>varlist</i> (default is to use a prefix of
                             "y_")
      <b><u>log</u></b><b>it</b>                use a logit model instead of linear regression
                             (the default)
      <b><u>adj</u></b><b>ust(</b><i>mean </i>|<i> constant </i>|<i> no </i><b>)</b>
                             adjust the y_hat by subtracting the mean
                             (default) or subtracting the constant term.
                             Alternatively, make no adjustment.
      <b><u>rep</u></b><b>lace</b>              drop all <i>indepvars</i> after the generation of y-hats
      <b><u>eff</u></b><b>ects(</b><i>window </i>|<i> rtf </i>|<i> csv </i>|<i> html</i><b>)</b>
                             display a summary table of stack-specific
                             effects from the regression used to generate a
                             y-hat
      <b><u>efm</u></b><b>t</b>                 change the coefficients reported by the effects()
                             option
      <b>output</b>               (not recommended) directly flush the results of
                             each stack-specific regression into the standard
                             output.
    -------------------------------------------------------------------------
<p>
<b><u>Description</u></b>
<p>
    <b>genyhats</b> generates (multiple) <i>y-hat</i> affinitie(s) for <i>depvar</i> based on each
    (set of) <i>indepvars</i>, saving them into the corresponding <i>yhatname</i>
    separately for each combination of <i>stackvars</i>. Multiple y-hat variables
    can be generated by specifying multiple models separated by <b>||</b>, but each
    of them has to involve affinities with the same depvar so, if issued
    before stacking, <b>genyhats</b> will have to be issued repeatedly (once for
    each of the item-specific depvars that will, after stacking, become a
    single generic depvar).
<p>
    Optionally, a variable list can be used instead of the "...: ...||"
    primary syntax. When a variable list is employed with <b>genyhats</b> each
    variable in the list is treated as a single independent variable in a set
    of separate predictions of <i>depvar</i>. With this syntax the y-hat affinity
    variable will be named by prefixing the independent variable with "y_" or
    such other prefix as may be established by the <b>yprefix()</b> option.
<p>
    The two syntaxes may be combined in that any appearance of || causes the
    previous variables to be treated as a variable list of which the first
    (unless it was followed by ":") will provide the suffix for the new
    variable name, being prefixed by "y_" or such other prefix as may be
    established by the <b>yprefix()</b> option.
<p>
    The <b>genyhats</b> command estimates the effect of each (set of) indep(s) on
    the depvar, separately for each stack if the data are stacked (unless
    <b>nostack</b> is optioned) and separately for each context if the <b>contextvars()</b>
    option was employed. It uses Stata's <b>predict</b> command to produce predicted
    values of the depvar for each case. These sets of so-called "y-hats" are
    each adjusted by subtracting the mean from the prediction equation
    (separately for each stack and context, if present) - unless some other
    adjustment is optioned by means of the <b>adjust</b> option - and saved under
    the appropriate variable name as described above. Estimation is by OLS
    unless <b>logit</b> is optioned.
    NOTE that, if the y_hat is not adjusted, the stack-specific mean will be
    included in the estimated y-hats, creating inconsistencies as between
    stacks and contexts that can cause large anomalies in subsequent analyses
    using these variables. As a result, in published work the choice of
    subtracting the mean has mostly been employed (and is the default option
    in <b>genyhats</b>). However, the option of subtracting the constant term is
    also available.
<p>
    The <b>genyhats</b> command can be issued before or after stacking. If issued
    after stacking, by default it treats each stack as a separate context to
    take into account along with any higher-level contexts.  This yields the
    same y-hat estimates as would have been created for separate unstacked
    depvars. However, the <b>nostack</b> option can be employed to force <b>genyhats</b> to
    ignore the stack-specific contexts.  In addition, <b>genyhats</b> can be
    employed with or without distinguishing between higher-level contexts, if
    any, (with or without the <b>contextvars()</b> option) depending on what makes
    methodological sense. If issued after stacking the command need only be
    issued once for the (generic) depvar instead of separately for each
    unstacked depvar. This makes <b>genyhats</b> simpler to use and saves creating a
    mass of temporary variables which hugely increase the size of the (often
    already very large) stacked file, but takes longer because estimation is
    performed with a much larger dataset, selecting a different stack on each
    pass.
<p>
    NOTE that when used in subsequent analyses (for instance in regression
    models) estimated coefficients for y-hat variables are not readily
    interpretable. In the absence of error variance and multicolinearity,
    each coefficient calculated for a y-hat independent variable predicting
    the ptv dependent variable would be +1.0. The actual values of these
    coefficients thus constitute a quasi-measure of covariance - like a
    partial correlation coefficient. However, standard errors (along with
    beta coefficients from OLS) retain their customary meanings.
<p>
<b><u>Options</u></b>
<p>
    <b>depvar(</b><i>varname</i><b>)</b> if specified, the variable for which affinities are
        estimated (default is <i>ptv</i>).
<p>
    <b>contextvars(</b><i>varlist</i><b>)</b> if specified, the variables whose combinations of
        values identify different electoral contexts (by default all cases
        are treated as part of a single context).
<p>
    <b>nostack</b> if present, overrides the default behavior of treating each stack
        as a separate context (has no effect if the <b>genyhats</b> command is
        issued before stacking).
<p>
    <b>stackid(</b><i>varname</i><b>)</b> if specified, a variable identifying different "stacks",
        for which y-hats will be separately generated. The default is to use
        the "genstacks_stack" variable if the <b>genyhats</b> command is issued
        after stacking.
<p>
    <b>yprefix</b> if specified, provides a prefix for y-hat affinities generated
        for each variable in a variable list (the default is "y_"). NOTE that
        the prefix, whether default or provided, can be overridden by
        explicitly specifying the y-hat variable name before a colon
        introducing the variable(s) to be used in estimating this y-hat.
<p>
    <b>logit</b> if specified, invokes a logit model instead of linear regression
        (the default).
<p>
    <b>adjust(</b><i> constant </i>|<i> mean </i>|<i> no </i><b>)</b> if specified, adjusts the y_hat by
        subtracting the constant term (default) or subtracting the mean.
        Alternatively, make no adjustment. Note that, when a logit model is
        optioned, the adjustment takes place on propensity values, and then
        mapped back to probability values.
<p>
    <b>replace</b> if specified, drops all <i>indepvars</i> for all specified models after
        the generation of y-hats.
<p>
    <b>effects(</b><i>window </i>|<i> rtf </i>|<i> csv </i>|<i> html</i><b>)</b> if specified, displays a table (in
        publication format) that summarizes the different effects of the same
        predictors in different stacks. The <b>window</b> option flushes the table
        to the standard output, while the other option saves the table in an
        external file, according to the chosen file format. By default,
        z-values are reported, along with significance stars.  The <b>efmt()</b>
        option can be used to change the coefficients reported in the table.
<p>
    <b>efmt</b> if specified, changes the coefficient reported in tables generated
        by <b>effects</b>.  {efmt()} accepts two types of values: either <b>beta</b> (in
        order to obtain beta coefficients) or any format string that is
        accepted by the <b>cells()</b> option of the <b>estout</b> command.  As an example,
        <b>efmt(b(fmt(3)star))</b> displays b coefficients with three decimal digits
        and significance stars.
<p>
    <b>output</b> if specified, the results of each stack-specific regression used
        to generate a y-hat are directly flushed into the standard output.
<p>
<p>
<b><u>Examples:</u></b>
<p>
    The following command generates two y-hat variables for <i>ptv</i> (the default
    dependent variable), based on working conditions and issues, with
    observations clustered by <i>t102</i>; and drops the original independent
    variables. In this example <b>stackid</b> is set to the variable <i>stack</i>, implying
    that the name "stack" was specified in the <b>stackid()</b> option of a previous
    <b>genstacks</b> command, or that the data were reshaped in some other fashion
    (eg using stata's <b>reshape</b> command with "stack" specified for the <b>j()</b>
    option.
<p>
        <b>. genyhats ywork: work_* || yissues: q56-q67, context(t102)</b>
            <b>stackid(stack) replace</b>
<p>
    The following command generates four y-hat variables for <i>chosen</i> (a binary
    dependent variable), one each for <i>age, income, union</i> and <i>educ</i>, with
    observations clustered by <i>t102</i>. Because the dependent variable is binary
    a logit model is used. The <b>yprefix</b> option ensures that the resulting
    y-hat variables will be named {it:yl_age, yl_income, yl_union} and
    <i>yl_educ</i>, possibly to distinguish them from similar variables created by
    OLS.  Because <b>replace</b> is not optioned, all variables will be retained.
    Because the <b>stackid</b> variable is not defined, either <b>genstacks</b> is
    operating on unstacked data or on stacked data whose stacks are
    identified by the default "genstacks_stack" variable created by
    <b>genstacks</b>.
<p>
        <b>. genyhats age income union educ, depvar(chosen) contextvars(t102)</b>
            <b>yprefix(yl_) logit</b>
<p>
<b><u>Generated variables</u></b>
<p>
    <b>genyhats</b> saves the following variables:
<p>
      <i>yhatname1 [yhatname2...]</i>    a set of y-hat (predicted) variables, each
                                   one either named before the colon
                                   introducing the corresponding (set of)
                                   indepvar(s) or (if no colon was employed)
                                   constructed from the corresponding indep
                                   by prefixing it with "y_" or whatever
                                   prefix may have been set using the <b>yprefix</b>
                                   option.
</pre>