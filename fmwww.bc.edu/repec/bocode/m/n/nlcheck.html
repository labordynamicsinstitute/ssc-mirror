<pre>
<b>help nlcheck</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>nlcheck</b> -- Check linearity assumption after model estimation
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>nlcheck</b> <i>varname</i> [<i>varlist</i>] [<b>,</b> <i>options</i> ]
<p>
<p>
<a name="opt"></a>    <i>options</i>                 Description
    -------------------------------------------------------------------------
    Main
      <b><u>b</u></b><b>ins(</b><i>#</i><b>)</b>               number of bins for the adaptive fit; default is
                              <b>bins(10)</b>
      <b><u>s</u></b><b>pline</b>                use linear spline instead of bins
      <b><u>k</u></b><b>nots(</b><i>#</i><b>)</b>              number of knots for the spline fit; default is
                              <b>knots(9)</b>
      <b><u>eq</u></b><b>freq</b>                use equal frequency bins
      <b><u>d</u></b><b>iscrete</b>              treat <i>varname</i> as a discrete variable
      <b><u>noi</u></b><b>sily</b>               display adaptive model estimation results
<p>
    Graph
      <b><u>g</u></b><b>raph</b>                 display graph containing linear predictions
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>              set confidence level; default is <b>level(95)</b>
      <b>step</b>                  use model without linear term to plot the
                              adaptive fit
      <b><u>eq</u></b><b>uation(</b><i>eqno</i><b>)</b>        plot predictions for <i>eqno</i> equation in a
                              multiple-equation system
      <i>cline_options</i>         affect rendition of the plotted predictions
      <b><u>ciopt</u></b><b>s(</b><i>area_options</i><b>)</b>  affect rendition of the plotted confidence
                              interval
      <i>twoway_options</i>        any options other than <b>by()</b> documented in
                              <b>[G] </b><i>twoway_options</i>
    -------------------------------------------------------------------------
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>nlcheck</b> is a simple diagnostic tool that can be used after fitting a
    model to quickly check the linearity assumption for predictor <i>varname</i>.
    <b>nlcheck</b> categorizes the predictor into bins, refits the model including
    dummy variables for the bins, and then performs a joint Wald test for the
    added parameters. A significant test result indicates that the linearity
    assumption is violated. Alternatively, if the <b>spline</b> option is specified,
    <b>nlcheck</b> uses linear splines for the adaptive model. Furthermore, support
    for discrete variables is provided (see the <b>discrete</b> option).
<p>
    Optionally, <b>nlcheck</b> also displays a graph of the adjusted linear
    predictions from the original model and the adaptive model (setting all
    other variables to the mean). Pointwise confidence intervals are plotted
    for the adaptive fit. Such a linear prediction plot can be useful to
    evaluate the functional form of a relationship.
<p>
    If a predictor enters the model repeatedly via different transformations
    (e.g. polynomials), then these additional terms should be taken into
    account when computing the adjusted linear predictions for the graph. Use
    <i>varlist</i> to specify such additional variables.
<p>
    <b>nlcheck</b> can be used with any estimation command as long as it supports 
    <b>test</b> (and, if <b>graph</b> is specified, <b>adjust</b>), follows the standard syntax
<p>
        <i>command</i> <i>varlist</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i> ]
<p>
    and stores the command as typed in <b>e(cmdline)</b>. Stata 10 is required.
<p>
<p>
<b><u>Options</u></b>
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>bins(</b><i>#</i><b>)</b> sets the number of bins used for the adaptive fit (resulting in
        #-1 additional parameters). The default is <b>bins(10)</b> or <b>knots()</b>+1 if
        <b>knots()</b> is specified.
<p>
    <b><u>s</u></b><b>pline</b> causes linear splines to be used for the adaptive fit instead of
        bins.
<p>
    <b>knots(</b><i>#</i><b>)</b> sets the number of knots for the spline fit. The default is
        <b>knots(9)</b> or <b>bins()</b>-1 if <b>bins()</b> is specified.
<p>
    <b>eqfreq</b> causes the bin boundaries to be chosen according to quantiles of
        the empirical distribution of the predictor (i.e. so that each bin
        contains approximately the same number of observations). The default
        is to determine the cut points based on quantiles of the distinct
        values of the predictor (i.e. so that each bin contains approximately
        the same number of distinct values). With <b>spline</b>, the knots are
        positioned at equally spaced quantiles (of the distinct values or of
        the empirical distribution, depending on the <b>eqfreq</b> option) with half
        a step before the first knot and after last.
<p>
    <b>discrete</b> causes <i>varname</i> to be treated as a discrete variable and includes
        one parameter for each distinct value of the predictor in the
        adaptive model. The <b>bins()</b>, <b>knots()</b>, and <b>spline</b> options are not
        allowed with <b>discrete</b>.
<p>
    <b>noisily</b> causes the estimation results from the adaptive model to be
        displayed.
<p>
        +-------+
    ----+ Graph +------------------------------------------------------------
<p>
    <b>graph</b> plots the linear predictions from the base model and the adaptive
        fit against the predictor with all other variables set to their mean
        and including pointwise confidence intervals for the adaptive fit.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, as a percentage, for the plotted
        confidence intervals. The default is <b>level(95)</b> or as set by <b>set</b>
        <b>level</b>.
<p>
    <b>equation(</b><i>eqno</i><b>)</b>, where <i>eqno</i> is <b>#</b><i>#</i> or <i>name</i> specifies the equation in a
        multiple-equation system for which the predictions be plotted. This
        option is allowed only after multiple-equation commands.
<p>
    <b>step</b> causes the plotted adaptive fit to be based on a model from which
        the original predictor is excluded. The adjusted predictions from
        such model appear as a step-function and may be easier to read. <b>step</b>
        has no effect with <b>spline</b> or <b>discrete</b>. <b>step</b> also has no effect on the
        performed nonlinearity test.
<p>
    <i>cline_options</i> affect the rendition of the plotted predictions. See help 
        <i>cline_options</i>.
<p>
    <b>ciopts(</b><i>area_options</i><b>)</b> specifies details about the rendition of the plotted
        confidence interval. See help <i>area_options</i>.
<p>
    <i>twoway_options</i> are any of the options documented in help <i>twoway_options</i>,
        excluding <b>by()</b>.
<p>
<p>
<b><u>Examples</u></b>
<p>
    Basic usage:
<p>
        . use http://www.stata-press.com/data/r10/nlswork4.dta
        . regress ln_wage ttl_exp msp
        . nlcheck ttl_exp
        . nlcheck ttl_exp, graph step
        . nlcheck ttl_exp, spline graph
<p>
    Nonlinear effect:
<p>
        . generate ttl_exp2 = ttl_exp^2
        . regress ln_wage ttl_exp ttl_exp2 msp
        . nlcheck ttl_exp ttl_exp2, graph step bin(20)
<p>
    Discrete predictor:
<p>
        . regress ln_wage ttl_exp msp year
        . nlcheck year, discrete graph
<p>
    Logit model:
<p>
        . sysuse auto
        . logit foreign price mpg
        . nlcheck price, spline knots(3) graph
<p>
    Multinomial logit:
<p>
        . mlogit rep78 mpg if rep78&gt;=3
        . nlcheck mpg, bin(4) graph equation(5)
<p>
<p>
<b><u>Returned results</u></b>
<p>
    Scalars
      <b>r(p)</b>             two-sided p-value
      <b>r(F)</b> or <b>r(chi2)</b>  F statistic or chi-squared
      <b>r(df)</b>            degrees of freedom
      <b>r(df_r)</b>          residual degrees of freedom (some models)
      <b>r(cut</b><i>#</i><b>)</b>          value of the <i>#</i>th cut point or spline knot
      <b>r(levels)</b>        list of distinct values of discrete predictor
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jannb@ethz.ch
<p>
    Thanks for citing this software as follows:
<p>
        Jann, B. (2008). nlcheck: Stata module to check linearity assumption
        after model estimation. Available from http://ideas.repec.org/.
<p>
<p>
<b><u>Also see</u></b>
<p>
</pre>