<pre>
<b>help mata mm_collapse()</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>mm_collapse() -- Make matrix of summary statistics by subgroups</b>
<p>
<p>
<b><u>Syntax</u></b>
<p>
           <i>real matrix</i> <b>mm_collapse(</b><i>X</i><b>,</b> <i>w</i><b>,</b> <i>id</i> [<b>,</b> <i>f</i><b>,</b> <i>...</i>]<b>)</b>
<p>
           <i>real matrix</i> <b>_mm_collapse(</b><i>X</i><b>,</b> <i>w</i><b>,</b> <i>id</i> [<b>,</b> <i>f</i><b>,</b> <i>...</i>]<b>)</b>
<p>
<p>
    where
<p>
            <i>X</i>:  <i>real matrix</i> containing data (rows are observations, columns
                  are variables)
            <i>w</i>:  <i>real colvector</i> containing weights or 1
           <i>id</i>:  <i>real colvector</i> containing subgroup ID variable
            <i>f</i>:  <i>pointer scalar</i> containing address of the function to be used,
                  i.e. <i>f</i> = <b>&amp;</b><i>functionname</i><b>()</b>; the default function is <b>mean()</b>
          <i>...</i>:  up to 10 optional arguments to pass through to <i>f</i>
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>mm_collapse()</b> returns a matrix of summary statistics by subgroups. It is
    similar to Stata's <b>collapse</b>.
<p>
    <i>X</i> provides the data. Rows are observations and columns are variables.
    Summary statistics are computed for each variable.
<p>
    <i>w</i> specifies weights associated with the observations (rows) in <i>X</i>. Specify
    <i>w</i> as 1 to obtain unweighted results.
<p>
    <i>id</i> specifies the subgroup identification numbers associated with the
    observations (rows) in <i>X</i>. Each distinct value in <i>id</i> defines a subgroup or
    panel for which to compute the summary statistics.
<p>
    The default is to compute arithmetic means using the <b>mean()</b> function.
    Alternatively, specify <i>f</i>, where <i>f</i> is a pointer to a function, i.e.
    <i>f</i> = <b>&amp;</b><i>functionname</i><b>()</b> (see <b>[M-2] ftof</b>). For example, specify <b>&amp;variance()</b> to
    compute variances. <i>f</i> is assumed to return a real scalar and take a data
    column vector as first argument and weights as second argument.
<p>
    <b>_mm_collapse()</b> is analogous to <b>mm_collapse()</b> but but assumes <i>X</i>, <i>w</i>, and <i>id</i>
    to be sorted by <i>id</i>. <b>_mm_collapse()</b> is faster and uses less memory than
    <b>mm_collapse()</b>.
<p>
    The matrix returned by <b>mm_collapse()</b> or <b>_mm_collapse()</b> contains the
    subgroup codes in the first column; the second and following columns, one
    for each variable in <i>X</i>, contain the computed statistics.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    Examples:
<p>
        . sysuse auto
        (1978 Automobile Data)
<p>
        . preserve
        
        . collapse (mean) price turn, by(rep78)
        
        . list
        
             +---------------------------+
             | rep78     price      turn |
             |---------------------------|
          1. |     1   4,564.5        41 |
          2. |     2   5,967.6    43.375 |
          3. |     3   6,429.2   41.0667 |
          4. |     4   6,071.5      38.5 |
          5. |     5     5,913   35.6364 |
             |---------------------------|
          6. |     .   6,430.4      37.6 |
             +---------------------------+
<p>
        . restore
        
        . mata: X  = st_data(., ("price", "turn"))
        
        . mata: ID = st_data(., "rep78")
        
        . mata: mm_collapse(X, 1, ID)
                         1             2             3
            +-------------------------------------------+
          1 |            1        4564.5            41  |
          2 |            2      5967.625        43.375  |
          3 |            3   6429.233333   41.06666667  |
          4 |            4        6071.5          38.5  |
          5 |            5          5913   35.63636364  |
          6 |            .        6430.4          37.6  |
            +-------------------------------------------+
<p>
        . mata: w = st_data(., "weight")
        
        . mata: mm_collapse(X, w, ID)
                         1             2             3
            +-------------------------------------------+
          1 |            1   4608.601613   41.11935484  |
          2 |            2   6230.200895   43.59932911  |
          3 |            3    7003.15439   41.80276852  |
          4 |            4    6240.01355   39.81842818  |
          5 |            5   6287.482192   35.74011742  |
          6 |            .   6736.482783   38.01827126  |
            +-------------------------------------------+
<p>
        . mata: mm_collapse(X, w, ID, &amp;mm_median())
                  1      2      3
            +----------------------+
          1 |     1   4934     42  |
          2 |     2   5104     44  |
          3 |     3   4816     42  |
          4 |     4   5798     42  |
          5 |     5   5719     36  |
          6 |     .   4453     38  |
            +----------------------+
<p>
        . mata: mm_collapse(X, w, ID, &amp;mm_quantile(), .25)
                  1      2      3
            +----------------------+
          1 |     1   4195     40  |
          2 |     2   4060     41  |
          3 |     3   4482     40  |
          4 |     4   4890     35  |
          5 |     5   4425     35  |
          6 |     .   4424     35  |
            +----------------------+
        
<p>
<b><u>Conformability</u></b>
<p>
     <b>mm_collapse(</b><i>X</i><b>,</b> <i>w</i><b>,</b> <i>id</i><b>,</b> <i>f</i><b>,</b> <i>...</i><b>)</b>,
    <b>_mm_collapse(</b><i>X</i><b>,</b> <i>w</i><b>,</b> <i>id</i><b>,</b> <i>f</i><b>,</b> <i>...</i><b>)</b>,
           <i>X</i>:  <i>n x k</i>
           <i>w</i>:  <i>n x</i> 1 or 1 <i>x</i> 1
          <i>id</i>:  <i>n x</i> 1
           <i>f</i>:  1 <i>x</i> 1
         <i>...</i>:  (depending on <i>f</i>)
      <i>result</i>:  <i>g x </i>(1 + <i>k</i>), where <i>g</i> is the number of subgroups
<p>
<p>
<b><u>Diagnostics</u></b>
<p>
    <b>mm_collapse()</b> and <b>_mm_collapse()</b> cannot be used with built-in functions
    (use wrappers).
<p>
    <b>mm_collapse()</b> and <b>_mm_collapse()</b> return <b>J(0, 1 + cols(</b><i>X</i><b>), .)</b> if <i>X</i> and <i>id</i>
    are void.
<p>
<p>
<b><u>Source code</u></b>
<p>
    mm_collapse.mata
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jannb@ethz.ch
<p>
<p>
<b><u>Also see</u></b>
<p>
</pre>