<pre>
-------------------------------------------------------------------------------
help for <b>makematrix</b>
-------------------------------------------------------------------------------
<p>
<b><u>Make a matrix of results from other commands</u></b>
<p>
    Outline syntax:
<p>
        <b>makematrix</b> [<i>matrix_name</i>]<b> ,</b>
                 <b>from(</b><i>results_list</i><b>)</b> [<i>production_options</i>] [<i>list_options</i>] <b>:</b>
                 [<b>"</b>]<i>command</i>[<b>"</b>] [<i>varlist</i>] ... [, <i>options</i> ]
<p>
    A matrix name <i>matrix_name</i> may be specified. If so, a matrix with that
    name will be produced and remain in memory.
<p>
    <i>command</i> must be specified together with whatever elements from [<i>varlist</i>]
    [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<i>weight</i>] [, <i>options</i> ] are appropriate.
<p>
    Strictly, <i>command</i> is the first token following the colon <b>:</b>.  Hence bind
    commands specified by two or more words in double quotes.  Thus if
    <i>command</i> were <b>run mydo.do</b>, specify it as <b>"run mydo.do"</b>.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>makematrix</b> runs <i>command</i> repeatedly for a specified variable list
    (optionally, two variable lists) to produce a matrix of results. As
    usual, a matrix could be a vector. The matrix will be listed using <b>matrix</b>
    <b>list</b>, unless the <b>list</b> option is specified, in which case it will be
    listed using the <b>list</b> command.
<p>
    There are various modes of operation, which are best appreciated by
    studying the detailed examples discussed in the next section.
<p>
<p>
<b><u>Remarks</u></b> 
<p>
    First, some terminology. We call a Stata (statistical) command
    essentially univariate if it requires only one variable; it may repeat
    itself if supplied with two or more variables.  <b>summarize</b> is an
    essentially univariate command; it does work for two or more variables,
    by repeating its operation for those variables. We call such a command
    essentially bivariate if it requires only two variables, and may repeat
    itself otherwise.  <b>correlate</b> is an essentially bivariate command; it does
    work for three or more variables, by repeating its operation for pairs of
    those variables.  <b>spearman</b> is also an essentially bivariate command,
    although it does not in fact accept more than two variables. Finally, we
    call such a command essentially multivariate if it produces just one set
    of results even if supplied with three or more variables.  <b>regress</b> is an
    essentially multivariate command. From now on the word "essentially" is
    not used, but should be understood.
<p>
    The output of <b>correlate</b> given a <i>varlist</i> of two or more variables is a
    matrix of correlations for every pair of variables in <i>varlist</i>. How could
    we produce an equivalent directly for spearman? We need to find out that
    <b>spearman</b> leaves a correlation behind in <b>r(rho)</b>:
<p>
    <b>. makematrix, from(r(rho)) : spearman head trunk length displacement</b>
        <b>weight</b>
<p>
    The result is displayed using <b>matrix list</b> and we will normally want to
    tidy up the presentation, say by
<p>
    <b>. makematrix, from(r(rho)) format(%4.3f) : spearman head trunk length</b>
        <b>displacement weight</b>
<p>
    However, let us leave these details of presentation on one side. In this
    case, given a bivariate command, and a <i>varlist</i>, and a single result from
    which to compile the matrix, <b>makematrix</b> takes each pair of variables from
    <i>varlist</i>, runs a bivariate command for that pair, and puts a single result
    in the cell defined by each pair of variables. So both rows and columns
    are specified by <i>varlist</i>.
<p>
    Alternatively, we might want different sets of variables on the rows and
    the columns, perhaps specifying a submatrix of the full matrix.  The
    option <b>cols()</b> can be used to specify variables to appear as columns. The
    variables in the <i>varlist</i> of <i>command</i> will then appear as rows.  Say we did
    a principal component analysis of five variables and followed with
    calculation of scores:
<p>
    <b>. pca head trunk length displacement weight</b>
    <b>. score score1-score5</b>
    <b>. makematrix, from(r(rho)) cols(score?) : correlate head trunk length</b>
        <b>displacement weight</b>
<p>
    Here the full correlation matrix of variables and scores, as would be
    produced by <b>correlate</b>, is 10 X 10, and the submatrix produced by
    <b>makematrix</b> is only 5 X 5.
<p>
    We can show two or more scalar results from each command run.  This is
    possible in various ways. A univariate command can be repeated, each time
    yielding two or more scalars:
<p>
    <b>. makematrix, from(r(mean) r(sd) r(skewness)) : su</b> <b>head trunk length</b>
        <b>displacement weight, detail</b>
<p>
    <b>makematrix</b> reasons in this way: The user wants three scalars, which I
    will show in three columns. So I must run the command specified in turn
    on each variable supplied, which I will show on the rows. So for each
    variable in <i>varlist</i>, <b>makematrix</b> runs a univariate command, and puts two
    or more scalars in the cells of each row.
<p>
    A bivariate command can be repeated, each time yielding two or more
    scalars:
<p>
    <b>. makematrix, from(r(rho) r(p)) lhs(rep78-foreign) : spearman mpg</b>
<p>
    <b>makematrix</b> reasons in this way: The user wants two scalars, which I will
    show in two columns. So I must run the command specified in turn on the
    variable supplied. The option <b>lhs()</b> is also specified, so that must be
    used to supply the other variable. Whenever <b>lhs()</b> is specified, it
    specifies the rows of the matrix.  That is, in this case, the rows show
    the results of <b>spearman rep78 mpg</b> ...  <b>spearman foreign mpg</b>. Notice how
    the variables specified in <b>lhs()</b> appear on the <b><u>l</u></b>eft-<b><u>h</u></b>and <b><u>s</u></b>ide of the
    <i>varlist</i> which <b>spearman</b> runs.  (<b>lhs()</b> also names the left-hand side of the
    matrix, but that is a happy accident.) This is also allowed:
<p>
    <b>. makematrix, from(r(rho) r(p)) rhs(rep78-foreign) : spearman mpg</b>
<p>
    In this case, the rows show the results of <b>spearman mpg rep78</b> ...
    <b>spearman mpg foreign</b>, and are exactly the same as in the previous
    example. Again, whenever <b>rhs()</b> is specified, it specifies the rows of the
    matrix.  Notice how the variables specified in <b>rhs()</b> appear on the
    <b><u>r</u></b>ight-<b><u>h</u></b>and <b><u>s</u></b>ide of the <i>varlist</i> which <b>spearman</b> runs.  (By a small stretch,
    you can also think of it as naming the right-hand side of the matrix,
    given that we could repeat the row names on that side.) In other cases,
    which is used may well matter:
<p>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b[mpg]) lhs(rep78-foreign) :</b>
        <b>regress mpg</b>
<p>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b) rhs(rep78-foreign) :</b>
        <b>regress mpg</b>
<p>
    The first series of regressions predicts <b>rep78</b> ... <b>foreign</b> in turn from
    <b>mpg</b>. The second series predicts <b>mpg</b> from <b>rep78</b> ...  <b>foreign</b> in turn. The
    r-square results will be the same, but not the root mean square errors,
    or the intercepts or slopes.  Note that <b>_b</b> by itself has the
    interpretation of <b>_b[</b><i>row_variable</i><b>]</b>.
<p>
    In fact <b>lhs()</b> and <b>rhs()</b> can be used to produce a series of multivariate
    results. Suppose we have <b>weightsq = weight^2</b>.
<p>
    <b>. makematrix, from(e(r2) e(rmse)) lhs(mpg-trunk length-foreign) :</b>
        <b>regress weight weightsq</b>
<p>
    This series predicts <b>mpg</b> ... <b>foreign</b> in turn from <b>weight</b> and <b>weightsq</b>.
    When either <b>lhs()</b> or <b>rhs()</b> is specified they define the varying rows,
    while the <i>varlist</i> supplied is fixed for each run of <i>command</i>.
<p>
    There is one more nuance to be explained. Say you want a table of sums
    for a set of variables. You might try
<p>
    <b>. makematrix, from(r(sum)): su head trunk length displacement weight,</b>
        <b>meanonly</b>
<p>
    However, <b>makematrix</b> cannot distinguish between this and a similar problem
    with a bivariate command, so it will attempt to run <b>summarize</b> on all
    distinct pairs of variables. This will succeed, except that what is left
    behind in <b>r(sum)</b> will be the sum of the second of each pair of variables.
    What you will prefer is a <b>vector</b>, and that is the option to specify:
<p>
    <b>. makematrix, from(r(sum)) vector: su head trunk length displacement</b>
        <b>weight, meanonly</b>
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>from(</b><i>results_list</i><b>)</b> is required. The <i>results_list</i> may in particular
    contain names of e-class results containing scalars (such as <b>e(rmse)</b>);
    names of r-class results containing scalars (such as <b>r(rho)</b>); estimates
    of intercepts, slopes or standard errors such as <b>_b[_cons]</b>, <b>_b[mpg]</b> or
    <b>_se[mpg]</b>; or names of globals (such as <b>S_1</b>).  Do not prefix global names
    with <b>$</b>. <b>_b</b> or <b>_se</b> by itself has the interpretation of <b>_b[</b><i>row_variable</i><b>]</b> or
    <b>_se[</b><i>row_variable</i><b>]</b>.  Expressions such as <b>r(rho)^2</b> or <b>log10(r(p))</b> are also
    allowed.  However, note that no spaces must occur within any individual
    expression and that the more complicated the expression you use, the more
    likely it is that it will not be acceptable as a matrix column name.
<p>
    <i>production_options</i> are
<p>
        <b>cols(</b><i>column_varlist</i><b>)</b> specifies a list of variables to appear on the
        columns of the matrix. (<i>varlist</i> then defines the rows only.}
<p>
        <b>lhs(</b><i>lhs_varlist</i><b>)</b> specifies a list of variables to appear on the
        left-hand side of the variable list supplied to <i>command</i>. These will
        appear on the rows of the matrix. (The list of results in <b>from()</b> then
        defines the columns of the matrix.)
<p>
        <b>rhs(</b><i>rhs_varlist</i><b>)</b> specifies a list of variables to appear on the
        right-hand side of the variable list supplied to <i>command</i>. These will
        appear on the rows of the matrix. (The list of results in <b>from()</b> then
        defines the columns of the matrix.)
<p>
        <b>vector</b> specifies that the results are to be compiled as a single
        vector. This option is necessary when, and only when, (1) there is a
        single result in <b>from()</b>; (2) there is no <b>cols()</b>, <b>lhs()</b> or <b>rhs()</b>; (3)
        <i>command</i> is a univariate command.  Without <b>vector</b>, <b>makematrix</b> would
        otherwise attempt to treat <i>command</i> as a bivariate command and carry
        out calculations for all pairs of variables.
<p>
        Only one of <b>cols()</b>, <b>lhs()</b>, <b>rhs()</b> and <b>vector</b> may be specified.
<p>
        <b>listwise</b> specifies that the results of <i>cmd</i> should be determined for
        as many observations as possible.  Note that as a consequence the
        number of observations used in each calculation may differ. By
        default casewise deletion is used to ensure consistency in
        observations selected.
<p>
    <i>list_options</i> control the presentation of the matrix.
<p>
        <b>list</b> specifies that the list command be used to present the matrix.
<p>
        <b><u>la</u></b><b>bel</b> specifies that an attempt be made to show variable labels
        wherever variables specify the rows of the matrix. Unless the <b>list</b>
        option is also specified, variable labels longer than 32 characters
        will not be shown and periods which <b>matrix list</b> does not construe as
        time series operators will be suppressed.
<p>
        <b><u>f</u></b><b>ormat(</b><i>format</i><b>)</b> specifies the format to be used for columns with <b>list</b>.
        As an extension of standard format options, multiple formats may be
        specified, one for each column.  For example, <b>format(%3.2f %4.3f</b>
        <b>%5.4f)</b> specifies that the columns of the matrix have the specified
        formats.
<p>
        <b>dp(</b><i>#</i> [ <i>#</i> [ ... ] ]<b>)</b> is an alternative to <b>format()</b> and specifies the
        number of decimal places to be shown with <b>list</b>. Note that, for
        example, <b>dp(2 3 4)</b> is equivalent to <b>format(%3.2f %4.3f %5.4f)</b>.
<p>
        <b><u>right</u></b><b>justify</b> specifies that row names are to be shown right-justified
        with <b>list</b>. The default is to present them left-justified.
<p>
        Other options may be specified that are options of <b>list</b> if the <b>list</b>
        option is specified or of <b>matrix list</b> otherwise.
<p>
<p>
<b><u>Examples</u></b> 
<p>
    <b>. sysuse auto, clear</b>
<p>
    <b>. makematrix, from(r(rho)) : spearman head trunk length displacement</b>
        <b>weight</b>
    <b>. makematrix, from(r(rho)) format(%4.3f) : spearman head trunk length</b>
        <b>displacement weight</b>
<p>
    <b>. pca head trunk length displacement weight</b>
    <b>. score score1-score5</b>
    <b>. makematrix, from(r(rho)) cols(score?) : correlate head trunk length</b>
        <b>displacement weight</b>
    <b>. makematrix R, from(r(rho)) cols(score?) : correlate head trunk length</b>
        <b>displacement weight</b>
    <b>. matrix colnames R = "score 1" "score 2" "score 3" "score 4" "score 5"</b>
    <b>. matrix li R, format(%4.3f)</b>
<p>
    <b>. makematrix , from(r(rho) r(p)) label cols(price) : spearman mpg-foreign</b>
    <b>. makematrix , from(r(rho) r(p)) list label format(%4.3f %6.5f) sep(0)</b>
        <b>cols(price) : spearman mpg-foreign</b>
<p>
    <b>. makematrix, from(r(mean) r(sd) r(skewness)) : su head trunk length</b>
        <b>displacement weight, detail</b>
    <b>. makematrix, from(r(mean) r(sd) r(skewness)) list format(%2.1f %2.1f</b>
        <b>%4.3f) sep(0) : su head trunk length displacement weight, detail</b>
<p>
    <b>. makematrix, from(r(rho) r(p)) lhs(rep78-foreign) : spearman mpg</b>
    <b>. makematrix, from(r(rho) r(p)) rhs(rep78-foreign) : spearman mpg</b>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b[mpg]) lhs(rep78-foreign) :</b>
        <b>regress mpg</b>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b[mpg]) lhs(rep78-foreign)</b>
        <b>list dp(3 2 2 3) abb(9) sep(0) divider : regress mpg</b>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b) rhs(rep78-foreign) :</b>
        <b>regress mpg</b>
    <b>. makematrix, from(e(r2) e(rmse) _b[_cons] _b) rhs(rep78-foreign) list</b>
        <b>dp(3 2 2 3) abb(9) sep(0) divider : regress mpg</b>
<p>
    <b>. gen weightsq = weight^2</b>
    <b>. makematrix, from(e(r2) e(rmse)) lhs(mpg-trunk length-foreign) : regress</b>
        <b>weight weightsq</b>
    <b>. makematrix, from(e(r2) e(rmse)) lhs(mpg-trunk length-foreign) list dp(3</b>
        <b>2) sep(0) divider : regress weight weightsq</b>
<p>
    <b>. makematrix, from(r(sum)) vector: su head trunk length displacement</b>
        <b>weight, meanonly</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Nicholas J. Cox, Durham University, U.K.
    n.j.cox@durham.ac.uk
<p>
<p>
<b><u>Acknowledgments</u></b>
<p>
    Ken Higbee made valuable comments on this help file.  Eric Uslaner
    pointed towards a bug. Hervé Stolowy pointed towards another bug, and
    Alan Riley explained it. Lisa Gilmore alerted me to a problem with
    handling double quotes.
<p>
<p>
<b><u>Also see</u></b>
<p>
    On-line:  help for list, matrix list; statsby, tabstat
<p>
</pre>