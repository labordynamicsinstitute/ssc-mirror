<pre>
<b>help mfpi</b>, <b>help mfpi_plot</b>
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Title</u></b>
<p>
    <b>mfpi</b> -- Modelling interactions between categorical and
              continuous/categorical covariates
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>mfpi</b> [, <i>mfpi_options</i>] <b>:</b>  <i>regression_cmd</i> [<i>yvar1</i> [<i>yvar2</i>]] <i>xvarlist</i> [<i>if</i>]
            [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>regression_cmd_options</i>]
<p>
<p>
        <b>mfpi_plot</b> <i>varname</i> [<i>if</i>] [<i>in</i>] [ <b>,</b> <i>mfpi_plot_options</i> ]
<p>
<p>
<p>
<a name="mfpi_options"></a>    <i>mfpi_options</i>              Description
    -------------------------------------------------------------------------
    <b><u>adju</u></b><b>st(</b><i>xvarlist2</i><b>)</b>         adjust linearly for <i>xvarlist2</i>
    <b>all</b>                       include out-of-sample observations in generated
                                variables
    <b><u>ce</u></b><b>nter(</b><i>center_list</i><b>)</b>       determine centering for FP-transformed
                                variables
    <b><u>det</u></b><b>ail</b>                    give additional details of fitted models
    <b>df(</b><i>df_list</i><b>)</b>               set up degrees of freedom for each predictor in
                                <i>xvarlist</i>
    <b><u>fl</u></b><b>ex(</b><i>#</i><b>)</b>                   define flexibility of main-effects and
                                interaction models
    <b>fp1(</b><i>fp1_zvarlist</i><b>)</b>         use fractional polynomials (FPs) of degree 1
                                for main effects and interactions with
                                <i>fp1_zvarlist</i>
    <b>fp2(</b><i>fp2_zvarlist</i><b>)</b>         use FPs of degree 2 for main effects and
                                interactions with <i>fp2_zvarlist</i>
    <b><u>gend</u></b><b>iff(</b><i>stubname</i><b>)</b>         generate new variable(s) that contains the
                                difference between the estimated functions
    <b>genf(</b><i>string</i><b>)</b>              generate new variables that contain fitted
                                functions
    <b><u>lin</u></b><b>ear(</b><i>linear_zvarlist</i><b>)</b>   define list of variables whose linear
                                interaction with <i>trt_var</i> is to be
                                investigated
    <b><u>mfp</u></b><b>opts(</b><i>mfp_options</i><b>)</b>      additional options for <b>mfp</b>
    <b><u>nosca</u></b><b>ling</b>                 suppress scaling of continuous variables in FP
                                transformations
    <b>noci</b>                      suppress standard errors and confidence
                                intervals for <b>gendiff()</b> and <b>genf()</b> options
    <b><u>sel</u></b><b>ect(</b><i>select_list</i><b>)</b>       set significance levels for variable selection
                                in <i>xvarlist</i>
    <b><u>show</u></b><b>model</b>                 show variables and FP transformations selected
                                from <i>xvarlist</i> by <b>mfp</b>
    <b><u>tr</u></b><b>eatment(</b><i>trt_var</i><b>)</b>        required - defines the categorical 'treatment'
                                variable
    <i>regression_cmd_options</i>    options for <i>regression_cmd</i>
    -------------------------------------------------------------------------
<p>
<a name="syntax"></a>    where
<p>
    <i>regression_cmd</i> may be <b>clogit</b>, <b>cnreg</b>, <b>glm</b>, <b>intreg</b>, <b>logistic</b>, <b>logit</b>, 
        <b>mlogit</b>, <b>nbreg</b>, <b>ologit</b>, <b>oprobit</b>, <b>poisson</b>, <b>probit</b>, <b>qreg</b>, <b>regress</b>, <b>rreg</b>,
        <b>stcox</b>, <b>stcrreg</b>, <b>stpm2</b> (if installed), <b>streg</b>, <b>xtgee</b>
<p>
    and
<p>
    <i>varname</i> for <b>mfpi_plot</b> must be an existing variable.  Typically, <i>varname</i>
        is a member of <i>linear_zvarlist</i>, <i>fp1_zvarlist</i> or <i>fp2_zvarlist</i>. See
        also the remark on <b>Working with composite variables</b> for details of
        plotting with composite predictors, such as spline basis functions or
        fractional polynomials, which can be done using a special feature of
        <i>linear_zvarlist</i>s.
<p>
<p>
<a name="mfpi_plot_options"></a>    <i>mfpi_plot_options</i>         Description
    -------------------------------------------------------------------------
    <b><u>stub</u></b><b>name(</b><i>stubname</i><b>)</b>        required if the <b>gendiff()</b> option of <b>mfpi</b> was
                                not specified
    <b>vn(</b><i>#</i><b>)</b>                     variable number in <b>linear()</b>, <b>fp1()</b>, and <b>fp2()</b>
    <b>level(</b><i>#</i><b>)</b>                  select level of <i>trt_var</i> to compare with base
                                level
    <b>plot(</b><i>plot</i><b>)</b>                add other plots to generated graph
    <i>graph_options</i>             options for <b>graph twoway</b>
    -------------------------------------------------------------------------
<p>
<p>
    All weight types supported by <i>regression_cmd</i> are allowed; see weight.
<p>
    <i>yvar</i> is not allowed for <b>streg</b>, <b>stcox</b> and <b>stpm2</b>; for these commands, you
        must first <b>stset</b> your data.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>mfpi</b> is designed to investigate the interaction of a categorical
    covariate (<i>trt_var</i>) with covariate(s) specified by any combination of the
    <b>fp1()</b>, <b>fp2()</b> and <b>linear()</b> options. Whether or not <i>trt_var</i> is specified as
    a factor variable, it is handled as one. Typically, <i>trt_var</i> is the
    treatment indicator variable in a randomized controlled trial of one or
    more treatments against a control arm, with the lowest value signifying
    the control arm.
<p>
    <b>mfpi</b> adjusts interactions with <i>trt_var</i> for variables in <i>xvarlist</i> (which
    may be subjected to FP transformation selected by <b>mfp</b>) and/or linearly
    for variables in <i>xvarlist2</i>.
<p>
    <b>mfpi_plot</b> produces a treatment-effect plot derived from variables saved
    with the <b>gendiff()</b> option of <b>mfpi</b>. A treatment-effect plot shows how the
    estimated treatment effect varies with a continuous covariate when an
    interaction between the two has been modelled.
<p>
<p>
<b><u>Options for </u></b><b><u>mfpi</u></b>
<p>
    <b>adjust(</b><i>xvarlist2</i><b>)</b> includes <i>xvarlist2</i> as covariates with a linear
        functional form in all the fitted models.
<p>
    <b>all</b> allows prediction (see the <b>gendiff()</b> and <b>genf()</b> options) for all
        available cases, irrespective of exclusion by <b>if</b>, <b>in</b>, or weights.
<p>
    <b>center(</b><i>center_list</i><b>)</b> determines the centering of FP-transformed variables.
        The most likely requirement is to suppress centering for all such
        variables, which is done with <b>center(no)</b>. The default behavior is
        centering on the mean of each continuous predictor. For further
        details, see the description of the <b>center()</b> option of <b>fracpoly</b>.
<p>
    <b>detail</b> gives additional details of the fitted models.
<p>
    <b>df(</b><i>df_list</i><b>)</b> sets up the degrees of freedom (df) for each predictor in
        <i>xvarlist</i>. The df (not counting the regression constant, <b>_cons</b>) are
        twice the degree of the FP, so, for example, a member of <i>xvarlist</i>
        fitted as a second-degree FP (FP2) has 4 df. The first item in
        <i>df_list</i> can be either <i>#</i> or <i>varlist</i><b>:</b><i>#</i>.  Subsequent items must be
        <i>varlist</i><b>:</b><i>#</i>. Items are separated by commas, and <i>varlist</i> is specified in
        the usual way for variables. With the first type of item, the df for
        all predictors are taken to be <i>#</i>. With the second type of item, all
        members of <i>varlist</i> (which must be a subset of <i>xvarlist</i>) have <i>#</i> df.
<p>
        The default df for a predictor of type <i>varlist</i> specified in <i>xvarlist</i>
        but not in <i>df_list</i> are assigned according to the number of distinct
        (unique) values of the predictor, as follows:
<p>
        ---------------------------------------------------------------
        No. of distinct values  Default df
        ---------------------------------------------------------------
                  1             (invalid -- covariate has variance 0)
                 2-3            1
                 4-5            min(2, <b>dfdefault(</b><i>#</i><b>)</b>)
                 &gt;=6            <b>dfdefault(</b><i>#</i><b>)</b>
        ---------------------------------------------------------------
        <b>dfdefault(</b><i>#</i><b>)</b> is an option of <b>mfp</b> (see the <b>mfpopts()</b> option and <b>mfp</b>);
        its default <i>#</i> is 4, meaning an FP2 function.
<p>
        Example:  <b>df(4)</b>
        All variables have 4 df.
<p>
        Example:  <b>df(2, weight displ:4)</b>
        <b>weight</b> and <b>displ</b> have 4 df, and all other variables have 2 df.
<p>
        Example:  <b>df(weight displ:4, mpg:2)</b>
        <b>weight</b> and <b>displ</b> have 4 df, <b>mpg</b> has 2 df, and all other variables
        have the default of 1 df.
<p>
        Example:  <b>df(weight displ:4, 2)</b>
        All variables have 2 df because the final 2 overrides the earlier 4.
<p>
    <b>flex(</b><i>#</i><b>)</b> defines the flexibility of the main-effects and interaction
        models; <i>#</i> = 1 is the least flexible and <i>#</i> = 4 is the most flexible.
        The default is <b>flex(1)</b>. See <b>Remarks</b> for further details.
<p>
    <b>fp1(</b><i>fp1_zvarlist</i><b>)</b> defines a list of continuous variables whose
        interactions with <i>trt_var</i> are to be investigated by fitting FP
        functions of degree 1 (i.e., FP1 functions) to each member of
        <i>fp1_zvarlist</i> in turn, at each level of <i>trt_var</i>. Also see <b>flex()</b>.
<p>
    <b>fp2(</b><i>fp2_zvarlist</i><b>)</b> defines a list of continuous variables whose
        interactions with <i>trt_var</i> are to be investigated by fitting FP
        functions of degree 2 (i.e., FP2 functions) to each member of
        <i>fp2_zvarlist</i> in turn, at each level of <i>trt_var</i>. Also see <b>flex()</b>.
<p>
    <b>gendiff(</b><i>stubname</i><b>)</b> generates a new variable(s) called <i>stubname#</i><b>_</b><i>j</i> that
        contains fj-f0, the difference between the estimated functions (at
        level j minus level 0 of <i>trt_var</i>), for the <i>#</i>th member of the list
        composed of <i>linear_zvarlist</i>, <i>fp1_zvarlist</i>, and <i>fp2_zvarlist</i>, in that
        order. The difference fj-f0 is an estimate of the covariate-specific
        effect of level j compared with level 0 (e.g., the covariate-specific
        treatment effect). <b>gendiff()</b> also creates new variables called
        <i>stubname#</i><b>s_</b><i>j</i>, which contains the standard error of fj-f0, and
        <i>stubname#</i><b>lb_</b><i>j</i> and <i>stubname#</i><b>ub_</b><i>j</i>, the lower and upper 95% confidence
        limits, thus providing all the quantities necessary for a
        treatment-effect plot.
<p>
    <b>genf(</b><i>stubname</i><b>)</b> generates new variables called <i>stubname#</i><b>_0</b>, <i>stubname#</i><b>_1</b>,
        etc., that contain the fitted functions at levels 0, 1, etc., of
        <i>trt_var</i>, respectively, for the <i>#</i>th member of the list composed of
        <i>linear_zvarlist</i>, <i>fp1_zvarlist</i>, and <i>fp2_zvarlist</i>, in that order. For
        variables in <i>fp1_zvarlist</i> and <i>fp2_zvarlist</i>, the same FP
        transformation is used at each level of <i>trt_var</i>.  The estimated
        function at level 0 of <i>trt_var</i> is adjusted to have mean 0.
<p>
    <b>linear(</b><i>linear_zvarlist</i><b>)</b> defines a list of variables whose linear
        interactions with <i>trt_var</i> are to be investigated. If a categorical
        variable in <i>linear_zvarlist</i> has more than 2 levels, the necessary
        dummy variables must be created and placed between parentheses to
        indicate that they should be tested together. More properly,
        <i>linear_zvarlist</i> is a list of variables of which some may be dummies
        for categorical variables.
<p>
        For example, <b>linear((who2 who3))</b> would bind <b>who2</b> and <b>who3</b> together to
        create a predictor with 2 df for its main effect.
<p>
        For further information, see the remarks in <i>Working with composite</i>
        <i>variables</i>.
<p>
<p>
    <b>mfpopts(</b><i>mfp_options</i><b>)</b> supplies <b>mfp</b> options to <b>mfpi</b> for the creation of the
        adjustment model from <i>xvarlist</i>.
<p>
    <b>noscaling</b> suppresses scaling of all the continuous variables that are
        subject to FP transformation. The default is automatic application of
        scale factors; the behavior can be turned off for all such variables
        by using <b>noscaling</b>. For further details, see the description of the
        same option in <b>fracpoly</b> and <b>fracgen</b>.
<p>
    <b>select(</b><i>select_list</i><b>)</b> sets the nominal P-values (significance levels) for
        variable selection among <i>xvarlist</i> by backward elimination. See the
        <b>select()</b> option of <b>mfp</b> for further details. A typical usage is
        <b>select(0.05)</b>, which selects all variables in <i>xvarlist</i> that are
        significant at the 5% level according to a backward stepwise
        algorithm.
<p>
        Example:  <b>select(0.05)</b>
        All variables have nominal p-value 5 percent.
<p>
        Example:  <b>select(0.05, weight:1)</b>
        All variables except <b>weight</b> have nominal p-value 5 percent; <b>weight</b> is
        forced into the model.
<p>
        Example:  <b>select(a (b c):0.05)</b>
        All variables except <b>a</b>, <b>b</b>, and <b>c</b> are forced into the model.  <b>b</b> and <b>c</b>
        are tested jointly with 2 df at the 5 percent level, and <b>a</b> is tested
        singly at the 5 percent level.
<p>
    <b>showmodel</b> shows the variables selected from <i>xvarlist</i> by <b>mfp</b>, together
        with their FP powers, where relevant. It also shows the interaction
        model fitted last. <b>showmodel</b> is a concise alternative to <b>detail</b>.
<p>
    <b>treatment(</b><i>trt_var</i><b>)</b> is required and defines the factor or categorical
        variable whose interactions with variables specified in <b>linear()</b>,
        <b>fp1()</b>, or <b>fp2()</b> are of interest. <i>trt_var</i> must have at least two
        distinct, nonmissing values, but the codes are arbitrary because they
        are mapped to 0, 1, 2, etc., internally. The category corresponding
        to the lowest value is taken as the reference category (level 0).
<p>
    <i>regression_cmd_options</i> are any options for <i>regression_cmd</i>.
<p>
<p>
<b><u>Options for </u></b><b><u>mfpi_plot</u></b>
<p>
    <b>stubname(</b><i>stubname</i><b>)</b> is required if the <b>gendiff()</b> option of <b>mfpi</b> was not
        specified. If the <b>gendiff()</b> option was specified, then <i>stubname</i> is
        identified automatically. The <b>stubname()</b> option allows you to produce
        a treatment-effect plot for a variable whose <i>stubname</i> was used in an
        earlier run of <b>mfpi</b>.
<p>
    <b>vn(</b><i>#</i><b>)</b> identifies the variable in <b>linear()</b>, <b>fp1()</b>, and <b>fp2()</b>, in that
        order, whose associated treatment effect is to be plotted. Only one
        variable can be plotted in a given call to <b>mfpi_plot</b>.  For example,
        if <b>linear(x1 x2)</b> <b>fp1(x1 x3)</b> <b>fp2(x3)</b> was specified, the list of
        variables is <b>x1 x2 x1 x3 x3</b>, and the total number of variables is 5
        (not 3). Thus <i>#</i> would be an integer between 1 and 5.  The default is
        <b>vn(1)</b>.
<p>
    <b>level(</b><i>#</i><b>)</b> defines the level of <i>trt_var</i> you wish to compare with the base
        level. Levels of <i>trt_var</i> are coded 0, 1, 2, etc., with the base
        (reference) level being 0. These coded levels may or may not coincide
        with the actual values of <i>trt_var</i> in the data. For example, <b>level(1)</b>
        denotes the second lowest value of <i>trt_var</i>, which could be any
        positive integer (not necessarily 1). The default <i>#</i> is 1, meaning
        compare the second level of <i>trt_var</i> with the first level. Specifying
        a non-existent level raises a "variable ... not found" type of error
        message.
<p>
    <b>plot(</b><i>plot</i><b>)</b> provides a way to add other plots to the generated graph; see 
        [G] <i>addplot option</i>.
<p>
    <i>graph_options</i> are any options of <b>graph twoway</b>, such as <b>xtitle()</b> and
        <b>ytitle()</b>.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <u>Methodology</u>
<p>
    The algorithm used in <b>mfpi</b> can be summarized as follows. To fix ideas, it
    is assumed that <i>trt_var</i> is a binary treatment indicator variable in a
    randomized controlled clinical trial with two parallel groups. <i>trt_var</i>
    therefore has two levels, arbitrarily labeled 0 and 1.
<p>
    We first describe the mfpi algorithm for the default flexibility setting,
    <b>flex(1)</b>, i.e., the least flexible case.
<p>
    Let Z be the continuous or binary covariate of immediate interest, and
    let T be the binary treatment variable with values of 0 and 1. Let X be a
    vector of potentially prognostic factors. In <b>mfpi</b>, Z is a member of
    <i>linear_zvarlist</i>, <i>fp1_zvarlist</i>, or <i>fp2_zvarlist</i>; T is <i>trt_var</i>; and X is
    <i>xvarlist</i>.  The basic idea is to model the relationship between the
    outcome and Z at each level of T, adjusting for selected members of X,
    the latter variables transformed by FP if appropriate.  A test for
    interaction is performed on regression coefficients at the final step.
    The procedure for a Z in <i>fp2_zvarlist</i> (see the <b>fp2()</b> option) is as
    follows:
<p>
        1.  Apply the MFP algorithm to X with a p-value threshold of a* for
            selecting variables and FP transformations. Let X* be the
            resulting covariate vector, which we will call the adjustment
            model. X* can include (transformed) variables in X selected by
            the MFP algorithm. If all variables in X are uninfluential, X*
            may even be null. No covariate adjustment is then performed.  In
            some cases, X* can be formulated from subject-matter knowledge,
            avoiding data-driven searching.
<p>
        2.  Find by maximum likelihood the best-fitting FP2 powers (p1,p2)
            for Z, adjusting for X*.
<p>
        3.  For groups j = 0, 1 and powers p_i (i = 1, 2), define new
            predictors Z_ji = Z^p_i if T = j, Z_ji = 0 otherwise.
<p>
        4.  The test of T x Z interaction is a likelihood-ratio test between
            the nested models T, Z_01, Z_02, Z_11, Z_12, X* and T, Z^p_1,
            Z^p_2, X*. The difference in deviance is compared with
            chi-squared on 2 df.
<p>
        5.  If an interaction is not found, Z is regarded as a potential
            prognostic factor only. To investigate if an FP2 function is
            still needed for Z, the final model is chosen by repeating step 1
            but including Z as a potential prognostic factor.
<p>
    The procedure for a Z in <i>fp1_zvarlist</i>, i.e., using FP1 rather than FP2
    functions of Z, is in principle identical.  The interaction is tested on
    1 df.
<p>
    If Z is binary or is modeled as linear (i.e., is a member of
    <i>linear_zvarlist</i>), the approach reduces to the usual procedure to estimate
    and to test for an interaction adjusted for covariates X*.
<p>
    Extension to cases where T has more than 2 levels follows immediately.
<p>
    For further details of the MFP algorithm used to construct X*, see
    Royston and Ambler (1999), Sauerbrei and Royston (1999), and <b>mfp</b>.
    Further information on the method and applications is given by Royston
    and Sauerbrei (2004).
<p>
<p>
    <u>Other flexibility values</u>
<p>
    The covariates X are treated in the same way for all values of <b>flex()</b>.
    Only the main effect of Z and its interaction with T are dealt with
    differently, as follows.
<p>
    With <b>flex(2)</b>, the best-fitting FP powers for Z are found within the
    context of interaction models. The powers are constrained to be the same
    for all levels of T. The FP powers for the main effect of Z are taken to
    be the same as for the Z x T interaction.
<p>
    <b>flex(3)</b> is the same as <b>flex(2)</b>, except that the FP powers for the main
    effect of Z are determined independently of the interaction, exactly as
    for <b>flex(1)</b>.
<p>
    <b>flex(4)</b>, the most flexible option, calls for FP powers to be estimated
    for the main effect of Z and also for all levels of T in the interaction
    context.
<p>
<p>
    <u>Hypothesis testing</u>
<p>
    The main-effects and interaction models for <b>flex(1)</b> are nested, so
    standard hypothesis testing may be used. Simulation studies (as yet
    unpublished) have confirmed that the significance level of <b>flex(1)</b> is
    close to its nominal value.
<p>
    <b>flex(2)</b> uses the same FP function for the interaction as for the main
    effect. At first glance, a standard hypothesis test appears appropriate.
    However, no allowance has been made for degrees of freedom used to
    estimate FP powers across the levels of the categorical variable in the
    interaction model, so the p-values from interaction tests should be
    regarded as indicative, not definitive.
<p>
    Similar comments apply to <b>flex(3)</b>, except that here the main-effects and
    interaction models are non-nested (because different FP models may be
    used for the main effects and interaction). P-values should again be
    taken as indicative rather than definitive.
<p>
    The extra flexibility provided by <b>flex(4)</b> is reflected in its additional
    degrees of freedom. Its significance level is currently under
    investigation in simulation studies.
<p>
<p>
    <u>Working with composite variables</u>
<p>
    A useful feature of <b>mfpi</b> is the ability to model, and if appropriate
    plot, functions of predictors represented by one or more individual but
    linked variables. For example, a restricted cubic regression spline with
    4 knots, 2 interior and 2 boundary, is represented by 3 basis functions.
    Regression is performed with these basis functions as predictors.  Such a
    set of predictors 'belongs' to just one original continuous predictor and
    must be handled appropriately. This is done by surrounding in parentheses
    (<b>()</b>) the linked variables in the <b>linear()</b> option.
<p>
    For example, suppose that <b>age_1 age_2 age_3</b> were restricted cubic spline
    basis variables derived from a predictor called <b>age</b>, e.g. using the Stata
    command <b>mkspline</b>. Analysis of interaction between treatment and the
    spline function for <b>age</b> is specified by the option <b>linear((age_ age_2</b>
    <b>age_3))</b>:
<p>
    <b>. mkspline age_ = age, cubic nknots(4)</b>
<p>
    <b>. mfpi, select(0.05) treatment(treat) linear((age_1 age_2 age_3)): stcox</b>
        <b>z1 z2 z3</b>
<p>
    When <b>treat</b> is binary, the interaction in the above example has 3 d.f.
<p>
    A nice feature of this approach is that the treatment-effect plot created
    by <b>mfpi_plot</b> works happily with the original variable. Continuing the <b>age</b>
    example above, we specify the <b>gendiff()</b> option of <b>mfpi</b> to create the
    variables necessary for the treatment-effect plot and then tell <b>mfi_plot</b>
    to plot the age-related treatment difference and its 95% pointwise
    confidence interval against <b>age</b> as follows:
<p>
    <b>. mfpi, select(0.05) treatment(treat) linear((age_1 age_2 age_3))</b>
        <b>gendiff(d): stcox z1 z2 z3</b>
<p>
    <b>. mfpi_plot age</b>
<p>
    The same approach works with categorical covariates with several levels,
    represented by dummy variables. Alternatively, such covariates can be
    defined as factor variables, for example, <b>linear(i.group)</b>. This avoids
    the need to create dummy variables. Factor variables are not allowed to
    be combined into groups using parentheses.
<p>
<p>
    <u>Note on the base level</u>
<p>
    <b>mfpi</b> assumes that the lowest value of <i>trt_var</i> represents the base level
    (reference value). If you want a different value to be the base level,
    you have to recode <i>trt_var</i> before running <b>mfpi</b>. For example
<p>
    <b>. recode trt (1=3) (3=1)</b>
<p>
    would reverse the ordering of the levels 1, 2, 3 of the variable <b>trt</b>.
    See <b>recode</b> for details.
<p>
<p>
    <u>Warning</u>
<p>
    Excitement engendered by the discovery of interactions should be tempered
    by proper caution. There is a significant problem of multiplicity and of
    potential instability of the FP functions found. See Royston and
    Sauerbrei (2004) for a more detailed discussion of this issue. It is
    prudent to check whether the functions in each treatment group suggest a
    cutpoint(s) that can reproduce a difference in response; whether the
    interaction is present in univariate as well as multivariable models; and
    whether it is robust to the choice of adjustment model.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. mfpi, select(0.05) showmodel treatment(i.treat) linear(c1 (c2 c3))</b>
        <b>fp2(x1 x2): stcox x1 x2 c1 c2 c3</b>
<p>
    <b>. mfpi, select(1) degree(1) dfdefault(2) treatment(i.treat) linear(c1 (c2</b>
        <b>c3)) fp1(x1 x2) fp2(x1 x2) genf(f) gendiff(d): logit y x1 x2 c1 c2 c3</b>
<p>
    <b>. mfpi, treatment(i.treat) linear(i.group x): regress y</b>
<p>
    <b>. mkspline age_ = age, cubic nknots(4)</b>
<p>
    <b>. mfpi, select(0.05) treatment(i.treat) linear((age_1 age_2 age_3))</b>
        <b>gendiff(d): stcox z1 z2 z3</b>
<p>
    <b>. mfpi_plot age</b>
<p>
<p>
<b><u>Saved results</u></b>
<p>
    In addition to what <i>regression_cmd</i> saves in <b>e()</b>, <b>mfpi</b> saves the some or
    all of the following in <b>r()</b>:
<p>
    Scalars   
      <b>r(nxvar)</b>       number of predictors in <i>xvarlist</i>
      <b>r(nxf)</b>         number of predictors in <i>xvarlist</i> selected by <b>mfp</b>
      <b>r(totdflin)</b>    total degrees of freedom for linear interaction model
      <b>r(totdffp1)</b>    total degrees of freedom for FP1 interaction model
      <b>r(totdffp2)</b>    total degrees of freedom for FP2 interaction model
      <b>r(devlin)</b>      deviance for linear interaction model
      <b>r(devfp1)</b>      deviance for FP1 interaction model
      <b>r(devfp2)</b>      deviance for FP2 interaction model
      <b>r(aiclin)</b>      AIC for linear interaction model
      <b>r(aicfp1)</b>      AIC for FP1 interaction model
      <b>r(aicfp2)</b>      AIC for FP2 interaction model
      <b>r(chi2lin)</b>     chi-squared value for testing linear interaction model
      <b>r(chi2fp1)</b>     chi-squared value for testing FP1 interaction model
      <b>r(chi2fp2)</b>     chi-squared value for testing FP2 interaction model
      <b>r(Plin)</b>        p-value for testing linear interaction model
      <b>r(Pfp1)</b>        p-value for testing FP1 interaction model
      <b>r(Pfp2)</b>        p-value for testing FP2 interaction model
<p>
    Macros    
      <b>r(varlist)</b>     <i>xvarlist</i>
      <b>r(adjust)</b>      <i>xvarlist2</i>
      <b>r(treatment)</b>   <i>trt_var</i>
      <b>r(Linear)</b>      list of variables in <b>linear()</b>
      <b>r(Fp1)</b>         list of variables in <b>fp1()</b>
      <b>r(Fp2)</b>         list of variables in <b>fp2()</b>
      <b>r(z)</b>           z, the final continuous variable processed
      <b>r(powmain)</b>     FP powers for z, main effect
      <b>r(powint0)</b>     FP powers for z at level 0 of <i>trt_var</i>
      <b>r(powint`j')</b>   FP powers for z at level `j' of <i>trt_var</i> (`j' &gt; 0)
<p>
<p>
<b><u>Author</u></b>
<p>
    Patrick Royston
    MRC Clinical Trials Unit
    London, UK
    pr@ctu.mrc.ac.uk
<p>
<p>
<b><u>References</u></b>
<p>
    Royston, P., and G. Ambler. 1999. sg112.1: Nonlinear regression models
        involving power or exponential functions of covariates: Update.  
        <i>Stata Technical Bulletin</i> 50: 26. Reprinted in <i>Stata Technical</i>
        <i>Bulletin Reprints</i>, vol. 9, p. 180. College Station, TX:  Stata Press.
<p>
    Royston, P., and W. Sauerbrei. 2004. A new approach to modelling
        interactions between treatment and continuous covariates in clinical
        trials by using fractional polynomials. <i>Statistics in Medicine</i> 23:
        2509-2525.
<p>
    Royston, P., and W. Sauerbrei. 2009. Two techniques for investigating
        interactions between treatment and continuous covariates in clinical
        trials.  <i>Stata Journal</i> 9 (2): 230-251.
<p>
    Sauerbrei, W., and P. Royston. 1999. Building multivariable prognostic
        and diagnostic models: Transformation of the predictors by using
        fractional polynomials. <i>Journal of the Royal Statistical Society,</i>
        <i>Series A</i> 162:  71-94.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Article: <i>Stata Journal</i>, volume 9, number 2: st0164
<p>
    Manual:  <b>[R] fracpoly</b>, <b>[R] mfp</b>
<p>
    Online:  <b>mfp</b>
</pre>