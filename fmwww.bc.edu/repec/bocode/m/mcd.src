** MCD(OPTION) START END* #<SUPPL. CARD>  (LIST OF VARIABLES TO BE EXAMINED FOR OUTLIERS)** OPTION:*  ITERATIONS=NUMBER OF SUBSAMPLES TO DRAW [3000]** GIVEN N JOINT OBSERVATIONS ON K CONTINUOUS VARIABLES,* MCD.SRC COMPUTES A ROBUST MEAN VECTOR AND A ROBUST COVARIANCE* MATRIX USING THE MINIMUM COVARIANCE DETERMINANT ALGORITHM* [P. J. ROUSSEEUW AND A. M. LEROY (1987), ROBUST REGRESSION* AND OUTLIER DETECTION, NEW YORK: WILEY]. OBSERVATIONS WHOSE* ROBUST MAHALANOBIS DISTANCES EXCEED THE 97.5% CHI-SQUARE* VALUE WITH K DEGREES OF FREEDOM ARE FLAGGED AS POTENTIAL* OUTLIERS. MCD.SRC USES A RESAMPLING METHOD, AND THE* NUMBER OF SUBSAMPLES (EACH HAVING K+1 DATA) IS THE* PROCEDURE'S ONLY OPTION (DEFAULT = 3000 SUBSAMPLES).* MCD.SRC READS THE DATA AS SERIES WHOSE FIRST OBSERVATION* IS START AND WHOSE LAST OBSERVATION IS END (I. E., N =* END - START + 1).*PROCEDURE MCD START END*TYPE INTEGER START ENDOPTION INTEGER ITERATIONS 3000LOCAL VECTOR[INTEGER] VARIDLOCAL INTEGER I J K1 L LITR N NHLOCAL VECTOR MED MAD MEAN SD MD BMEANLOCAL VECTOR CSLOCAL SYMM C DLOCAL SERIES XVAR R TEMPOLOCAL REAL CRITMIN CRIT*COMPUTE ITR = ITERATIONSENTER(VARYING) VARIDINQUIRE(MATRIX=VARID) KCOMPUTE N = END-START+1COMPUTE K1 = K+1COMPUTE NH = (N+K1)/2COMPUTE CRITMIN = 1.0E+13DIM VARID(K) MED(K) MAD(K) C(K,K) D(K,K)DIM MEAN(K) SD(K) MD(END) BMEAN(K)DIM CS(20)* PERFORM A ROBUST STANDARDIZATION (SUBTRACT THE MEDIAN* OF EACH SERIES AND DIVIDE BY THE MEDIAN ABSOLUTE* DEVIATION).COMPUTE L = 0DOFOR XVAR = VARIDCOMPUTE L = L+1STATISTICS(NOPRINT,NOMOMENTS,FRACTILES) XVAR START ENDCOMPUTE MED(L) = %MEDIANSET XVAR START END = XVAR - MED(L)SET R START END = ABS(XVAR)STATISTICS(NOPRINT,NOMOMENTS,FRACTILES) R START ENDCOMPUTE MAD(L) = %MEDIAN*1.4826SET XVAR START END = XVAR/MAD(L)END DOFOR* FILL A VECTOR WITH THE CHI-SQUARE DISTRIBUTION, 97.5%* SIGNIFICANCE LEVEL, FOR DEGREES OF FREEDOM FROM 1 TO* 20; THESE WILL BE USED AS A CUT-OFF CRITERION FOR* OUTLIERS.COMPUTE CS(1)=5.0 ; COMPUTE CS(2)=7.4 ; COMPUTE CS(3)=9.4COMPUTE CS(4)=11.1 ; COMPUTE CS(5)=12.8 ; COMPUTE CS(6)=14.4COMPUTE CS(7)=16.0 ; COMPUTE CS(8)=17.5 ; COMPUTE CS(9)=19.0COMPUTE CS(10)=20.5 ; COMPUTE CS(11)=21.9 ; COMPUTE CS(12)=23.3COMPUTE CS(13)=24.7 ; COMPUTE CS(14)=26.1 ; COMPUTE CS(15)=27.5COMPUTE CS(16)=28.8 ; COMPUTE CS(17)=30.2 ; COMPUTE CS(18)=31.5COMPUTE CS(19)=32.9 ; COMPUTE CS(20)=34.2* START ITERATIONS ON SUBSAMPLESDO LITR = 1,ITRIF %FRAC(LITR/50.0) .EQ. 0.0BEGINDISPLAY(UNIT=SCREEN) LITR ' ITERATIONS COMPLETE OUT OF ' ITRENDSET TEMPO START END = T* AT EACH ITERATION, DRAW A RANDOM SUBSAMPLE OF K+1 OBSERVATIONS.:10 BOOT M  1 K1 START ENDSET R START END = 0.0DO I = 1,K1COMPUTE R(M(I)) = 1.0DO J = 1,K1IF I .EQ. JBEGINBRANCH 20ENDIF M(I) .EQ. M(J)BEGINBRANCH 10END:20 END DO JEND DO I* SKIP ANY SUBSAMPLE THAT IS SINGULAR OR NEARLY SO. THIS REQUIRES* AN EXAMINATION OF THE EIGENVALUES OF THE CORRELATION MATRIX IN* EACH SUBSAMPLE.CMOM(NOPRINT,CORR,SMPL=R)# VARIDEIGEN %CMOM CVECCOMPUTE CR = CVEC(1)/CVEC(K)COMPUTE CR = SQRT(CR)IF CR .GT. 25.0BEGINBRANCH 10END* USE THE SUBSAMPLE TO COMPUTE A MEAN VECTOR AND A COVARIANCE* MATRIX. INVERT THE MATRIX. THEN COMPUTE THE ROBUST* MAHALANOBIS DISTANCES OVER THE ENTIRE DATA SET.CMOM(NOPRINT,CENTER,SMPL=R)# VARIDCOMPUTE %CMOM = (1.0/K)*(%CMOM)COMPUTE C = INV(%CMOM)COMPUTE L=0DOFOR XVAR = VARIDCOMPUTE L=L+1STATISTICS(NOPRINT,SMPL=R) XVARCOMPUTE MEAN(L) = %MEANEND DOFORDO T = START,ENDMAKE B T T# VARIDCOMPUTE B = B -TR(MEAN)COMPUTE MD(T) = %QFORM(C,B)END DO TSET R START END = MD(T)ORDER R START END TEMPOSET R START END = TEMPO .LE. NHCMOM(NOPRINT,CENTER,SMPL=R)# VARIDCOMPUTE %CMOM = (1.0/NH)*%CMOMCOMPUTE CRIT = %DET(%CMOM)COMPUTE L=0DOFOR XVAR = VARIDCOMPUTE L=L+1STATISTICS(NOPRINT,SMPL=R) XVARCOMPUTE MEAN(L) = %MEANEND DOFOR* IS THE DETERMINANT IN THIS SUBSAMPLE THE SMALLEST* SO FAR ? IF SO, SAVE THE MEAN VECTOR AND THE* COVARIANCE MATRIX. THEN DRAW ANOTHER SUBSAMPLE.IF CRIT .LT. CRITMINBEGINCOMPUTE CRITMIN = CRITCOMPUTE D = %CMOMCOMPUTE BMEAN = MEANENDEND DO LITR* HAVING TRIED ITR SUBSAMPLES, APPLY A SMALL-SAMPLE CORRECTION* TO THE MCD COVARIANCE MATRIX AND RECOMPUTE THE ROBUST* MAHALANOBIS DISTANCES. IDENTIFY AS GOOD OBSERVATIONS THOSE* WHOSE ROBUST DISTANCES ARE LESS THAN CHI-SQUARE(0.975) WITH* K DEGREES OF FREEDOM.COMPUTE CORFAC = 1.0 + 15.0/(N-K)COMPUTE D = CORFAC*DCOMPUTE C = INV(D)DO T = START,ENDMAKE B T T# VARIDCOMPUTE B = B -TR(BMEAN)COMPUTE MD(T) = %QFORM(C,B)END DO TSET R START END = MD(T) .LE. CS(K)* RESTORE THE VARIABLES TO THEIR ORIGINAL UNITS, MULTIPLYING* EACH BY ITS MEDIAN ABSOLUTE DEVIATION AND ADDING BACK THE* MEDIAN. COMPUTE ROBUST MEANS, STANDARD DEVIATIONS, AND* CORRELATIONS BASED ON THE GOOD OBSERVATIONS.COMPUTE L=0DOFOR XVAR = VARIDCOMPUTE L=L+1SET XVAR START END = XVAR*MAD(L)SET XVAR START END = XVAR+MED(L)STATISTICS(NOPRINT,SMPL=R) XVARCOMPUTE MEAN(L) = %MEANCOMPUTE SD(L) = SQRT(%VARIANCE)END DOFOR* WRITE THE ROBUST MEANSDISPLAY 'ROBUST MEANS'WRITE MEAN* WRITE THE ROBUST STANDARD DEVIATIONSDISPLAY 'ROBUST STANDARD DEVIATIONS'WRITE SD* WRITE THE ROBUST CORRELATIONSDISPLAY 'ROBUST CORRELATION MATRIX'CMOM(PRINT,CORR,SMPL=R)# VARID* COMPUTE AND WRITE THE ROBUST COVARIANCE MATRIXDO I = 1,KDO J = 1,KCOMPUTE C(I,J) = ( %CMOM(I,J) )*SD(I)*SD(J)END DO JEND DO IDISPLAY 'ROBUST COVARIANCE MATRIX'WRITE C* COMPUTE THE CLASSICAL MEANS, COVARIANCES AND CORRELATIONSCOMPUTE L = 0DOFOR XVAR = VARIDCOMPUTE L=L+1STATISTICS(NOPRINT) XVAR  START ENDCOMPUTE MEAN(L) = %MEANCOMPUTE SD(L) = SQRT(%VARIANCE)END DOFOR* WRITE THE CLASSICAL MEANSDISPLAY 'CLASSICAL MEANS'WRITE MEAN* WRITE THE CLASSICAL STANDARD DEVIATIONSDISPLAY 'CLASSICAL STANDARD DEVIATIONS'WRITE SD* WRITE THE CLASSICAL CORRELATION MATRIXDISPLAY 'CLASSICAL CORRELATION MATRIX'CMOM(PRINT,CORR) START END# VARID* COMPUTE AND WRITE THE CLASSICAL COVARIANCE MATRIXDO I = 1,KDO J = 1,KCOMPUTE C(I,J) = ( %CMOM(I,J) )*SD(I)*SD(J)END DO JEND DO IDISPLAY 'CLASSICAL COVARIANCE MATRIX'WRITE C* COMPUTE THE CLASSICAL MAHALANOBIS DISTANCESSET R START END = MD(T)COMPUTE D = INV(C)DO T = START,ENDMAKE B T T# VARIDCOMPUTE B = B -TR(MEAN)COMPUTE MD(T) = %QFORM(D,B)END DO TSET XVAR START END = MD(T)* IDENTIFY PROBABLE OUTLIERS BASED ON THE ROBUST* MAHALANOBIS DISTANCEDO T = START,ENDIF T .EQ. 1BEGINDISPLAY 'LARGE ROBUST MAHALANOBIS DISTANCES INDICATE PROBABLE'DISPLAY 'OUTLIERS. THE TABLE BELOW LISTS OBSERVATIONS WHOSE 'DISPLAY 'ROBUST DISTANCES EXCEED ' CS(K) ' WHICH IS THE 97.5%'DISPLAY 'VALUE OF THE CHI-SQUARE DISTRIBUTION WITH ' KDISPLAY 'DEGREES OF FREEDOM.'DISPLAY '  'DISPLAY 'OBS.     MAHALANOBIS DISTANCES'DISPLAY 'NO.       ROBUST    CLASSICAL 'ENDIF R(T) .GT. CS(K)BEGINDISPLAY T R(T) XVAR(T)ENDEND DO T* GRAPH THE ROBUST AND CLASSICAL MAHALANOBIS DISTANCES* (THEIR SQUARE ROOTS)DISPLAY(STORE=HEADER) 'SQUARE ROOTS OF MAHALANOBIS DISTANCES'DISPLAY(STORE=HLABEL) 'OBSERVATION'DISPLAY(STORE=VLABEL) 'ROBUST AND CLASSICAL DISTANCES'SET ROBUSTDIST START END = SQRT(R)SET CLASSICDIST START END = SQRT(XVAR)SET TEMPO START END = TSCATTER(STYLE=SYMBOL,PATTERNS,KEY=BELOW,HEADER=HEADER, $  HLABEL=HLABEL,VLABEL=VLABEL) 2# TEMPO ROBUSTDIST START END# TEMPO CLASSICDIST START ENDEND MCD