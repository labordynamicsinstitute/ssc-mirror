<pre>
-------------------------------------------------------------------------------
help for <b>mlowess</b>
-------------------------------------------------------------------------------
<p>
<b><u>Lowess smoothing with multiple predictors</u></b>
<p>
        <b>mlowess</b> <i>yvar xvarlist</i> [<i>if</i>] [<i>in</i>] [<b>,</b> <b>combine(</b><i>combine_options</i><b>)</b> <b><u>cyc</u></b><b>les(</b><i>#</i><b>)</b>
            <b><u>dr</u></b><b>aw(</b><i>numlist</i><b>)</b> <b><u>gen</u></b><b>erate(</b><i>stub</i><b>)</b> <b>nograph</b> <b>log</b> <b>lowess(</b><i>lowess_options</i><b>)</b>
            <b><u>om</u></b><b>it(</b><i>numlist</i><b>)</b> <b><u>p</u></b><b>redict(</b><i>newvar</i><b>)</b> <b><u>nopt</u></b><b>s</b> <b>replace</b>
            <b><u>sc</u></b><b>atter(</b><i>scatter_options</i><b>)</b> <i>line_options</i>]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>mlowess</b> computes lowess smooths of <i>yvar</i> on all predictors in <i>xvarlist</i>
    simultaneously; that is, each smooth is adjusted for the others.  Fitted
    values may be saved in new variables with names beginning with <i>stub</i>, as
    specified in the <b>generate()</b> option.
<p>
    By default, for each <i>xvar</i> in <i>xvarlist</i> adjusted values of <i>yvar</i> and the
    lowess smooth for <i>xvar</i> are plotted against <i>xvar</i>.  See <b>Remarks</b> for more
    details.
<p>
    If you have just one predictor, use <b>lowess</b> directly.
<p>
<p>
<b><u>Options</u></b> 
<p>
    <b>combine(</b><i>combine_options</i><b>)</b> specifies any of the options allowed by the 
        <b>graph combine</b> command.  Useful examples are <b>combine(ycommon)</b> and
        <b>combine(saving(</b><i>graphname</i><b>))</b>.
<p>
    <b>cycles(</b><i>#</i><b>)</b> sets the number of cycles. The default is <b>cycles(3)</b>.
<p>
    <b>draw(</b><i>numlist</i><b>)</b> specifies that smooths for a subset of the variables in
        <i>xvarlist</i> be plotted. The elements of <i>numlist</i> are indexes determined
        by the order of the variables in <i>xvarlist</i>.  For example, <b>mlowess y x1</b>
        <b>x2 x3, draw(2 3)</b> would plot smooths only for <b>x2</b> and <b>x3</b>. By default
        results for all variables in <i>varlist</i> are plotted. <b>draw()</b> takes
        precedence over <b>omit()</b> in the sense that results for variables
        included (by index) in <i>numlist</i> are plotted, even if they are excluded
        by <b>omit()</b>. See also <b>omit()</b>.
<p>
    <b>generate(</b><i>stub</i><b>)</b> specifies that fitted values for each member of <i>xvarlist</i>
        be saved in new variables with names beginning with <i>stub</i>.
<p>
    <b>nograph</b> suppresses the graph.
<p>
    <b>log</b> displays the squared correlation coefficient between the overall
        fitted values and <i>yvar</i> at each cycle for monitoring convergence.
        This option is provided mainly for pedagogic interest.
<p>
    <b>lowess(</b><i>lowess_options</i><b>)</b> control the operation of <b>lowess</b> in generating
        smooths. Key are
<p>
        <b><u>m</u></b><b>ean</b> specifies running-mean smoothing; the default is running-line
        least-squares smoothing.
<p>
        <b><u>now</u></b><b>eight</b> prevents the use of Cleveland's tricube weighting function;
        the default is to use the weighting function.
<p>
        <b><u>bw</u></b><b>idth(</b><i>#</i><b>)</b> specifies the bandwidth.  Centred subsets of <b>bwidth()</b> * n
        observations are used for calculating smoothed values for each point
        in the data except for end points, where smaller, uncentred subsets
        are used.  The greater the <b>bwidth()</b>, the greater the smoothing.  The
        default is 0.8.
<p>
        Note that each choice applies to all predictors. There is no
        provision for treating predictors differently.
<p>
    <b>omit(</b><i>numlist</i><b>)</b> specifies that smooths for a subset of the variables in
        <i>xvarlist</i> not be plotted. The elements of <i>numlist</i> are indexes
        determined by the order of the variables in <i>varlist</i>. For example,
        <b>mlowess y x1 x2 x3, omit(3)</b> would plot smooths only for <b>x1</b> and <b>x2</b>. By
        default results for no variables in <i>varlist</i> are omitted.  <b>draw()</b>
        takes precedence over <b>omit()</b>.  See also <b>draw()</b>.
<p>
    <b>predict(</b><i>newvar</i><b>)</b> specifies that the predicted values be saved in new
        variable <i>newvar</i>.
<p>
    <b>nopts</b> suppresses the points in the plots. Only the lines representing the
        smooths are drawn.
<p>
    <b>replace</b> allows variables specified by any of the <b>generate()</b> and <b>predict()</b>
        options to be replaced if they already exist.
<p>
    <b>scatter(</b><i>scatter_options</i><b>)</b> specifies any of the options allowed by the 
        <b>scatter</b> command.  These should be specified to control the rendering
        of the data points.  The default includes <b>msymbol(oh)</b>, or <b>msymbol(p)</b>
        with over 299 observations.
<p>
    <i>line_options</i> are any of the options allowed with <b>line</b>.  These should be
        specified to control the rendering of the smoothed lines or the
        overall graph.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    The approach of <b>mlowess</b> is based on methodology for generalised additive
    models (Hastie and Tibshirani 1990). <b>mlowess</b> is primarily intended for
    exploratory graphics, rather than model fitting with inferential
    apparatus.
<p>
    An R-square (squared correlation coefficient) is provided as a goodness
    of fit indicator. However, this R-square can typically be increased
    simply by just smoothing less, which is often likely to be unhelpful. As
    the resulting predictions come closer to interpolating the data, R-square
    will approach 1, but scientific usefulness and the possibility of insight
    will usually diminish.
<p>
    Suppose that there are p &gt;= 1 predictors.  <b>mlowess</b> estimates the smooths
    f_1,...,f_p by using a backfitting algorithm and a lowess smoother
    S[y|x_j] for each predictor, as follows:
<p>
    1.  Initialize: alpha = mean(<i>yvar</i>), f_1,...,f_p estimated by multiple
        linear regression.
<p>
    2.  Cycle: j = 1,...,p, 1,...,p, ...
<p>
        f_j = S[y - alpha - sum_{i != j} f_i|x_j]
<p>
    3.  Continue for <b>cycles()</b> rounds.
<p>
    No convergence criterion is applied. In practice, three cycles are
    usually more than sufficient to get results adequate for exploratory
    work.
<p>
    The smooths are adjusted so that the mean of each equals the mean of
    <i>yvar</i>.
<p>
    The points in the plots provided by <b>mlowess</b> depict y - sum_{i != j}
    f_i|x_j, i.e., the partial residuals plus alpha.
<p>
<p>
<b><u>Examples</u></b> 
<p>
    <b>. mlowess mpg weight displ length</b>
<p>
    <b>. mlowess mpg weight displ length, lowess(mean)</b>
<p>
    <b>. mlowess mpg weight displ length, generate(S) nograph</b>
<p>
    <b>. mlowess mpg weight displ length, omit(2) combine(saving(graph1))</b>
<p>
    For comparison, bivariate smooths may be compared like this:
<p>
    <b>. foreach v in weight displ length {</b>
    <b>.         lowess mpg `v', combine(saving(lwss_`v'))</b>
    <b>. }</b>
    <b>. graph combine "lwss_weight" "lwss_displ" "lwss_length"</b>
<p>
<p>
<b><u>Author</u></b> 
<p>
    Nicholas J. Cox
    Durham University
    n.j.cox@durham.ac.uk
<p>
<p>
<b><u>Acknowledgements</u></b> 
<p>
    The main features of the implementation here depend on the work of
    Patrick Royston, as reported by Royston and Cox (2005).
<p>
<p>
<b><u>References</u></b>
<p>
    Hastie, T. and Tibshirani, R. 1990.  <i>Generalized additive models.</i>
        London: Chapman and Hall.
<p>
    Royston, P. and Cox, N.J. 2005.  A multivariable scatterplot smoother.
        <i>Stata Journal</i> 5(3): 405-412.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  <b>lowess</b>
<p>
</pre>