<pre>
<p>
-------------------------------------------------------------------------------
help for <b>mahascores</b>
-------------------------------------------------------------------------------
<p>
<b><u>Generate a set of Mahalanobis distance measures</u></b>
<p>
        <b>mahascores</b> <i>varlist</i> [<i>weight</i>] <b>,</b> [ <b>idvar(</b><i>idvar</i><b>)</b> <b>varprefix(</b><i>varprefix</i><b>)</b>
                 <b>genmat(</b><i>genmat</i><b>)</b> <b>genfile(</b><i>filename</i><b>)</b> <b>name1(</b><i>name1</i><b>)</b> <b>name2(</b><i>name2</i><b>)</b>
                 <b>scorevar(</b><i>scorevar</i><b>)</b> <b>replace</b> <b>treated(</b><i>treatedvar</i><b>)</b>
                 <b><u>invcov</u></b><b>armat(</b><i>invcovarmat</i><b>)</b> <b><u>compute</u></b><b>_invcovarmat</b>
                 <b><u>disp</u></b><b>lay(</b><i>display_options</i><b>) full all</b> <b><u>unsq</u></b><b>uared</b> <b><u>eucl</u></b><b>idean</b>
                 <b><u>verb</u></b><b>ose</b> <b>float</b> <b><u>trans</u></b><b>pose</b> <b><u>nocovtrlim</u></b><b>itation</b> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>mahascores</b> generates a Mahalanobis distance measure between every pair of
    observations, or possibly between selected pairs of observations (under
    the <b>treated()</b> option).  By default, the result is actually the square of
    the proper Mahalanobis measure. You can use the unsquared option to give
    you the unsquared value, but note that in most cases, the resulting
    values are used in comparisons or sortings; the proportional magnitude is
    not significant, so the squared values are just as good.
<p>
    <i>varlist</i> (the "covariates") is a list of numeric variables on which to
    build the distance measure.  These variables should be of numeric
    significance, not categorical; any categorical variables should be
    replaced by a set of indicator variables.
<p>
    See mahascore for an explanation of the Mahalanobis measure.
<p>
    Weights are allowed, but apply only under the <b>compute_invcovarmat</b> option.
<p>
    There are three means of getting the output:
        - a set of generated variables, using the <b>varprefix()</b> option;
        - a matrix, using the <b>genmat()</b> option;
        - a separate file, using the <b>genfile()</b> option.
<p>
<b><u>Options</u></b>
<p>
    In what follows, let <i>p</i> denote the number of variables in <i>varlist</i>.
<p>
    <b>idvar(</b><i>idvar</i><b>)</b> is an identifying variable which is used to mark the
    components of the output:
        - with the <b>varprefix()</b> option, its values become part of the new
          variable names;
        - with the <b>genmat()</b> option, its values are used as matrix row and
          column names;
        - with the <b>genfile()</b> option, its values go into the primary and
          secondary identifying variables.
<p>
    <i>idvar</i> can be of any type, but it must be a single variable. If the
    existing identifying scheme consists of multiple variables, you should
    devise a way to combine them uniquely into a single variable. Numbers are
    acceptable, but they should be integers.
<p>
    It is desirable and often essential (depending on the output options)
    that <i>idvar</i> uniquely identify observations.  Under the the <b>varprefix()</b>
    option, it is essential that the contents of <i>idvar</i> be acceptable as
    suffixes on variable names; avoid embedded spaces and characters that are
    not acceptable in variable names.
<p>
           --------------------------------------------------------------------
            <b>technical notes:</b>
<p>
            With the <b>varprefix()</b> option, illegal characters,
            embedded spaces, or non-unique values may result in a
            fatal error.
<p>
            With the <b>genmat()</b> option, embedded spaces may cause the
            row or column names to "slip over" to the wrong row or
            column. Non-unique values do not cause an immediate
            error, but may cause confusing labelling of the columns
            and rows and may cause errors in later use of the
            matrix.
<p>
            With the <b>genfile()</b> option, the form of the values in
            <i>idvar</i> is not critical, but if they don't uniquely
            identify observations, then it will be difficult to use
            the resulting file.
           --------------------------------------------------------------------
<p>
    <b>idvar()</b> is optional. If it is omitted then the following values are used:
        - with the <b>varprefix()</b> option, 1, 2, etc., that is, the variable
          names are <i>varprefix</i>1, <i>varprefix</i>2, etc;
        - with the <b>genmat()</b> option, obs1, obs2, etc. as row and column names;
        - with the <b>genfile()</b> option, 1, 2, etc.
    But note that these numbers refer to the observations in the present
    order and become meaningless after a sort. Thus, the <b>idvar()</b> provides a
    more secure way of identifying the results.
<p>
    The <b>varprefix()</b>, <b>genmat()</b>, and <b>genfile()</b> options are nonexclusive
    alternatives for obtaining the output; at least one of them must be used.
<p>
    <b>varprefix(</b><i>varprefix</i><b>)</b> specifies that the results will be placed in a set
    of new variables, one for each observation.  These variables will be
    named with a common prefix <i>varprefix</i>, and the remainder of the names are
    the values in <i>idvar</i>, or the observation numbers if <b>idvar()</b> is omitted.
    See the notes regarding acceptable content for <i>idvar</i>, above.  Note that
    this option can generate a potentially very large set of variables - as
    many as there are observations (thus, constituting a square array of
    values), though that may set be reduced under the <b>treated()</b> option.  (See
    remarks under treated() for more on that matter.) The default type for
    these variables is double.
<p>
    <b>genmat(</b><i>genmat</i><b>)</b> specifies that the results will be placed in a matrix
    named <i>genmat</i>. The row and column names will be taken from the values in
    <i>idvar</i>, or will be obs1, obs2, etc., if <b>idvar()</b> is omitted.  See the notes
    regarding acceptable content for <i>idvar</i>, above.  If <i>genmat</i> already exists
    as a matrix, it will be overwritten. See additional remarks under
    <b>treated()</b> regarding which rows and columns will be included.
<p>
    <b>genmat()</b> potentially creates a very large matrix. You may need to set
    matsize to a large value to enable this matrix to be created.
<p>
    <b>genfile(</b><i>filename</i><b>)</b> specifies that the results will be placed in a separate
    dataset in long form. See reshape for an explanation of long form.
<p>
      Under the <b>genfile()</b> option, the resulting file is a Stata dataset with
      these variables:
<p>
          A primary and secondary id variable which refer to observations in
            the dataset from which the measures were derived.
<p>
          A variable to hold the distance measure, measured between the
            observations identified in the primary and secondary id
            variables. The default name is _score, and its default type is
            double.
<p>
      The types, content, and default names of the primary and secondary id
      variables depend on whether <b>idvar()</b> is specified:
<p>
          If <b>idvar()</b> is specified, then these variables are of the same type
          as <i>idvar</i>, and contain values from <i>idvar</i> corresponding to the
          pertinant observations.  Their default names are _refid and <i>idvar</i>.
<p>
          If <b>idvar()</b> is omitted, then they are integer types, and contain the
          corresponding observation numbers.  Their default names are _refobs
          and _obs.
<p>
    Note that each of the three output options has two distinct entities that
    locate a distance measure value. We will identify one as primary and the
    other as secondary. The primary entities are...
<p>
      for <b>varprefix()</b>, the variables generated;
      for <b>genmat()</b>, the rows of the matrix;
      for <b>genfile()</b>, the primary id variable.
<p>
    The secondary entities are...
<p>
      for <b>varprefix()</b>, the observations of the dataset (with values placed in
      the generated variables);
      for <b>genmat()</b>, the columns of the matrix;
      for <b>genfile()</b>, the secondary id variable.
<p>
    Thus, the distance measure represents a difference measured from from the
    observation identified by the primary entity to the observation
    identified by the secondary entity; the distance in the other direction
    is the same.  Consequently, the distinction between the primary and
    secondary entities often becomes immaterial, due to the symmetry of the
    situation.  However, there is a situation where we choose to make a
    distinction, and the resulting set of values is asymmetric. In
    particular, this occurs under the <b>treated()</b> option, which will be
    described below.
<p>
<p>
<b><u>Options for use with </u></b><b><u>genfile</u></b>
<p>
    <b>name1(</b><i>name1</i><b>)</b> allows you to specify the name for the primary id variable.
    The default name depends on whether <b>idvar()</b> is specified, as explained
    above.
<p>
    <b>name2(</b><i>name2</i><b>)</b> allows you to specify the name for the secondary id
    variable. The default name depends on whether <b>idvar()</b> is specified, as
    explained above.
<p>
    <b>scorevar(</b><i>scorevar</i><b>)</b> allows you to specify the name of the distance measure
    variable. The default name is _score.
<p>
    <b>replace</b> specifies that if the file already exists, it will be replaced.
<p>
<p>
<b><u>More Options</u></b>
<p>
    <b>invcovarmat(</b><i>invcovarmat</i><b>)</b> specifies the name of a matrix to be used in the
    computation of the distance measure. It is presumably the inverse
    covariance matrix of <i>varlist</i>, but the only requirement is that it be a
    square <i>p</i>-by-<i>p</i> matrix, and both the row and column names must equal the
    names in <i>varlist</i> in the same order as in <i>varlist</i>.
<p>
    <b>invcovarmat(</b><i>invcovarmat</i><b>)</b> is expected to be rarely used; it is provided in
    case the user wishes to supply an existing inverse covariance matrix, or
    one computed in some special way not provided for by the available
    options.  Additionally, it might enable some efficiency advantage if
    repeated calls are made requiring the same inverse covariance matrix. For
    most usages, however, you probably want the <b>compute_invcovarmat</b> option
<p>
    <b>compute_invcovarmat</b> specifies that you want the inverse covariance matrix
    to be computed, rather than passed in (via <b>invcovarmat()</b>).  This
    computation is subject to weighting, as well as limitation by <i>treatedvar</i>
    if the <b>treated()</b> option is specified.  (But see <b>nocovtrlimitation</b>.) Note
    that this will call covariancemat, which computes covariances limited to
    observations with all variables of <i>varlist</i> nonmissing.  (I.e., it is
    potentially different from the pairwise computation of covariances.)
<p>
    <b>invcovarmat()</b> and <b>compute_invcovarmat</b> are alternatives; one of them must
    be specified. If both are specified, then <b>compute_invcovarmat</b> takes
    precedence.
<p>
<p>
    <b>treated(</b><i>treatedvar</i><b>)</b> specifies a numeric variable that distinguishes the
    "treated" observations, with values of 0 and non-zero signifying
    non-treated and treated, respectively. See mahapick for an explanation of
    the concept of the treated set.  This option affects the action of the
    <b>compute_invcovarmat</b> in that the computation is limited to the set of
    observations for which <i>treatedvar</i> is non-zero, if <b>treated()</b> is specified.
    See <b>nocovtrlimitation</b> for how to control that limitation.
<p>
    <b>treated()</b> also potentially limits the set of values that are output.  In
    generic terms, the default action is that primary entities are associated
    with (limited to) the treated observations, and the secondary entities
    are associated with (limited to) the non-treated observations. (One
    exception: the secondary entities of the <b>varprefix()</b> option - the placing
    of values in the generated variables - are never limited in this way.)
    More specifically,
<p>
      With <b>varprefix()</b>, only the variables corresponding to the treated
      observations will be generated.
<p>
      With <b>genmat()</b>, only the rows corresponding to treated cases are
      generated; only the columns corresponding to non-treated cases are
      generated.
<p>
      With <b>genfile</b>, only observations with primary id corresponding to
      treated cases, and with secondary id corresponding to non-treated cases
      are generated.
<p>
    The rationale is that, with <b>treated()</b>, you would only be interested in
    distance measurments from a treated observation to a non-treated. (And
    these limitations save space as well.)
<p>
    The <b>all</b> option lifts these limitations entirely; both the primary and
    secondary entities will range over all observations, yielding a square
    symmetric result.
<p>
    The <b>full</b> option lifts the restriction on the secondary entities; all
    possible secondary id values or matrix columns are generated.  (It has no
    effect on the <b>varprefix()</b> results, as the secondary entities for
    <b>varprefix()</b> are never limited by <b>treated()</b>.)
<p>
    In other words,
          the variables generated, the rows of the matrix, or the primary id
          variable, correspond to...
              the treated observations, if <b>treated()</b> is specified without
              <b>all</b>;
              all observations, otherwise.
          the colums of the matrix, or the secondary id variable correspond
          to...
              the non-treated observations, if <b>treated()</b> is specified without
              <b>all</b> or <b>full</b>;
              all observations, otherwise.
<p>
    Note that <b>all</b> implies <b>full</b>; there is no provision for generating all
    primary id values (or matrix rows) without also getting all secondary id
    values (or matrix columns).
<p>
    <b>unsquared</b> modifies the results to be the unsquared values, that is, the
    square roots of the default values.
<p>
    <b>euclidean</b> takes effect only if <b>compute_invcovarmat</b> is also specified.
    This specifies that the normalized Euclidean measure is to be used,
    rather than the true Mahalanobis measure - meaning that the off-diagonal
    elements of the covariance matrix are replaced with zeroes prior to
    inverting. The result is a measure that accounts for the scale of
    measurement in each variable of <i>varlist</i>, but ignores correlation between
    the variables. This is probably not desirable, given the advantages of
    the true Mahalanobis measure, but is provided as an alternative and for
    comparison to (or emulation of) earlier releases of mahascore and 
    mahapick. See mahascore for more details on this matter.
<p>
    <b>float</b> specifies that the type for the variables generated by <b>varprefix()</b>
    or for the distance measure (or <i>scorevar</i>) generated by <b>genfile()</b> will be
    float, rather than double. This has no effect on <b>genmat()</b>, as matrices
    always contain doubles.
<p>
    <b>display(</b><i>display_options</i><b>)</b> turns on the display of certain data structures
    used in the computation. If <i>display_options</i> contains <b>covar</b>, then the
    covariance matrix is listed; if it contains <b>invcov</b>, then the inverse
    covariance matrix is listed.  Any other content is ignored.
<p>
    <b>verbose</b> takes effect only if <b>compute_invcovarmat</b> is also specified.  This
    causes each call to mahascore to be reported, along with information
    about what options were specified.
<p>
    <b>transpose</b> specifies that the matrix (under <b>genmat()</b>) is to be transposed.
<p>
    <b>nocovtrlimitation</b> specifies that the covariance computation (for
    <b>compute_invcovarmat</b>) not be limited to treated observations.
<p>
<b><u>Remarks</u></b>
<p>
    If the inverse covariance matrix is computed on a very small set of
    observations, it may not be valid and may yield strange results. It might
    fail to be positive semi-definite, and can yield negative measures.  (It
    may also cause the <b>unsquared</b> option to have a real effect on comparisons
    and sortings of the results.)
<p>
    Please see mahascore for more information on the computation of the
    Mahalanobis measure.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. mahascores income age numkids edlevel, idvar(persno) varprefix(d1_)</b>
        <b>treated(assisted) compute_invcov</b>
<p>
    <b>. mahascores income age numkids edlevel, idvar(persno) genmat(m1)</b>
        <b>treated(assisted) compute_invcov</b>
<p>
    <b>. mahascores income age numkids edlevel, idvar(persno) genfile(dist1)</b>
        <b>compute_invcov scorevar(d1)</b>
<p>
<p>
<b><u>Acknowledgement</u></b>
    The author wishes to thank Heiko Giebler of Wissenschaftszentrum Berlin
    fur Sozialforschung GmbH, for suggestion leading to the development of
    this program.
<p>
<p>
<b><u>Author</u></b>
    David Kantor.  Email kantor.d@att.net if you observe any problems.
<p>
<p>
<b><u>Also See</u></b>
    mahascore, mahascore2, mahapick, covariancemat, variancemat, 
</pre>