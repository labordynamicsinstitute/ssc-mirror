<pre>
-------------------------------------------------------------------------------
help for <b>corrtable</b> 
-------------------------------------------------------------------------------
<p>
<b><u>Correlation matrix as graphical table</u></b>
<p>
        <b>corrtable</b> <i>varlist</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [, <b><u>ha</u></b><b>lf</b> <b><u>list</u></b><b>wise</b> <b>n</b> <b><u>p</u></b><b>val</b>
                 <b>rformat(</b><i>format</i><b>)</b> <b>pformat(</b><i>format</i><b>)</b> <i>scatteri_options</i> <b>flag1()</b>
                 <b>howflag1()</b> ... <b>flag7()</b> <b>howflag7()</b> <b>rsize(</b><i>rule</i><b>)</b>
                 <b><u>diag</u></b><b>onal(</b><i>scatteri_options</i><b>)</b> <b><u>comb</u></b><b>ine(</b><i>combine_options</i><b>)</b> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>corrtable</b> displays a correlation matrix (and optionally corresponding
    sample sizes and/or P-values) as a table using graph. There is scope for
    varying the format(s) of correlations and P-values; for emphasising
    selected correlations with (for example) larger font sizes or different
    plotregion colours; and for specifying a rule relating font size to the
    magnitude of each correlation.  correlate is used for the basic
    calculations.
<p>
    In each off-diagonal cell the correlation is displayed. If requested, the
    corresponding sample size is displayed immediately below. If requested,
    the P-value is displayed below other results. The diagonal cells show
    variable labels, or if they do not exist variable names.
<p>
<p>
<b><u>Remarks</u></b> 
<p>
    Understanding of certain options pivots on knowing that immediately after
    each <b>correlate</b> command the correlation is available as <b>r(rho)</b>.
<p>
    <b>corrtable</b> is intended as indicative, not definitive.  The code may help
    others who wish to produce similar displays. Special effects for
    particular problems are sometimes better implemented by adding customised
    code, rather than by attempting a much more general program with large
    numbers of options.  Users of Stata 10 up may also use the Graph Editor
    to revise an initial graph.
<p>
    Some limitations should be flagged.
<p>
        <b>corrtable</b> can not avoid the problems of displaying large tables
        legibly, especially if you want to show several results and/or your
        variable labels are long or complicated.
<p>
        <b>corrtable</b> does not support the display of stars, which is deprecated
        by the program author. Persons wanting stars should wonder why and,
        if the desire persists, write their own code or persuade others to do
        so.
<p>
        <b>corrtable</b> can be slow. Under the hood it is producing several
        individual graphs and then using <b>graph combine</b>. With even modest
        correlation matrices that entails handling of several graphs.  Hence
        the use of <b>corrtable</b> may be better restricted to producing
        presentation material.
<p>
<p>
<b><u>Options</u></b> 
<p>
    <b>half</b> specifies display of the lower half of the correlation matrix,
        together with a diagonal display of variable labels or names.
        Although not the default, this option is commended as quicker and
        simpler.
<p>
    <b>listwise</b> specifies that the results for each pair of variables should be
        determined for as many observations as possible.  Note that as a
        consequence the number of observations used in each calculation may
        differ. By default casewise deletion is used to ensure consistency in
        observations selected.
<p>
    <b>n</b> specifies display of the sample size in addition to other results. This
        is usually advisable only in conjunction with <b>listwise</b>, as otherwise
        the same sample size will be displayed in each off-diagonal cell of
        the table.
<p>
    <b>pval</b> specifies display of the P-value in addition to other results. Given
        sample size n and sample correlation r, the P-value is calculated as
        2 * ttail(n - 2, abs(r) * sqrt(n - 2) / sqrt(1 - r^2)).  There is no
        check of the underlying assumptions.
<p>
    <b>rformat(</b><i>format</i><b>)</b> and <b>pformat(</b><i>format</i><b>)</b> specify formats for correlations and
        P-values respectively. The default is %5.3f for correlations and
        %4.3f for P-values.
<p>
    <i>scatteri_options</i> control the display of each off-diagonal cell.  The
        defaults include <b>mlabsize(*4) mlabpos(0)</b>.
<p>
    <b>flag1()</b> and <b>howflag1()</b> to <b>flag7()</b> and <b>howflag7()</b> are paired options
        selecting certain correlations for specific attention.  For example,
        <b>flag1()</b> selects correlations and <b>howflag1()</b> indicates how to show
        them.  In essence, <b>flag</b>?  options specify conditions using Stata
        syntax involving the returned correlation <b>r(rho)</b> that must be true
        for the correlations to be emphasised, while <b>howflag</b>? specify options
        of twoway scatteri that control display of emphasised results.  Any
        <b>flag</b><i>k</i><b>()</b> option overwrites any <b>flag</b><i>j</i><b>()</b> option if <i>k</i> &gt; <i>j</i>.  The limit of
        7 pairs of such options is arbitrary: programmers may easily clone
        the program and change the code to raise the limit.  Note that there
        is no wired-in link to any legend option.
<p>
    <b>rsize()</b> suggests <b>mlabsize()</b> for a given correlation by specifying a rule
        for size in terms of the returned <b>r(rho)</b> using Stata syntax. Usually,
        but not necessarily, it will be desired to show larger correlations
        with larger fonts.  A rule of <b>1 + 5 * abs(r(rho))</b> will show
        correlations of +1 or -1 at <b>mlabsize(6)</b> and correlations of 0 at
        <b>mlabsize(1)</b>. Rules using functions such as <b>sqrt(abs(r(rho)))</b> or
        <b>(abs(r(rho))^4)</b> would make smaller correlations more readable.
        Precisely what fonts you see is a little dependent on your machine
        set-up and what graph file format you use. Representation on your
        monitor may well be coarser than what can be printed (e.g. if you
        save graph files as <b>.eps</b> first). <b>rsize()</b> overrides any other
        specification of <b>mlabsize()</b> for off-diagonal cells.
<p>
    <b>diagonal()</b> specifies options of twoway scatteri that tune the appearance
        of the diagonal plots that show variable labels (or failing those,
        variable names). The defaults include <b>mlabsize(*3) mlabpos(0)</b>
        <b>ysc(off) xsc(off)</b>. It may often be advisable to clone the variables
        and revise the variable labels to obtain more concise but still
        informative text. For example, while it is usually good practice to
        specify units of measurement, they are typically immaterial for
        correlations.
<p>
    <b>combine()</b> specifies options of graph combine() that tune the combination
        of the graphs. <b>combine(imargin(zero))</b> is often a good choice.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. set scheme s1color</b>
<p>
    <b>. corrtable price-foreign, flag1(abs(r(rho)) &gt; 0.8)</b>
        <b>howflag1(mlabsize(*7)) flag2(inrange(abs(r(rho)), 0.6, 0.8))</b>
        <b>howflag2(mlabsize(*6)) half</b>
<p>
    <b>. foreach v of var price-gear {</b>
    <b>.         clonevar `v'2 = `v'</b>
    <b>.         local label : var label `v'2</b>
    <b>.         if strpos("`label'", "(") local label = substr("`label'", 1,</b>
        <b>strpos("`label'", "(") - 2)</b>
    <b>.         label var `v'2 "`label'"</b>
    <b>. }</b>
    <b>. corrtable mpg2 gear_ratio2 rep782 price2 headroom2-displacement2,</b>
        <b>flag1(r(rho) &gt; 0) howflag1(plotregion(color(blue * 0.1)))</b>
        <b>flag2(r(rho) &lt; 0) howflag2(plotregion(color(pink*0.1))) half rsize(2</b>
        <b>+ 6 * abs(r(rho)))</b>
<p>
    <b>. corrtable log*, rsize(5 * sqrt(abs(r(rho)))) half</b>
        <b>combine(imargin(zero))</b>
<p>
<p>
<b><u>Acknowledgments</u></b> 
<p>
    Rob Dunford sparked the development of this program. Vince Wiggins made
    helpful comments.
<p>
<p>
<b><u>Author</u></b>
<p>
    Nicholas J. Cox, Durham University, U.K.
    n.j.cox@durham.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  help for correlate; help for pwcorr; help for corrmat (if
             installed); help for matcorr (if installed); help for makematrix
             (if installed)
<p>
</pre>