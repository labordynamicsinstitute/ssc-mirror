<pre>
-------------------------------------------------------------------------------
help for <b>expgen</b>                                                  (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Duplicate observations sorted in original order with generated variables</u></b>
<p>
        <b>expgen</b> <i>newvarname1</i> <b>=</b> <i>ncexp</i> [<i>if</i>] [<i>in</i>] [ <b>,</b> <b><u>o</u></b><b>ldseq(</b><i>newvarname2</i><b>)</b>
                     <b><u>c</u></b><b>opyseq(</b><i>newvarname3</i><b>)</b> <b><u>m</u></b><b>issing</b> <b><u>z</u></b><b>ero</b> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>expgen</b> is an extended version of <b>expand</b>.  It replaces each observation in
    the current dataset with <i>nc</i> copies of the observation, sorted in the
    original order, where <i>nc</i> is equal to the integer part <b>int(</b><i>ncexp</i><b>)</b> of the
    required expression <i>ncexp</i>.  <b>expgen</b> may also add new variables.  These are
    <i>newvarname1</i> (containing the value of the expression <i>ncexp</i>), <i>newvarname2</i>
    (containing the sequential order of the original observation in the old
    dataset), and <i>newvarname3</i> (containing the sequential order of each copy
    in the set of copies generated from its original observation).  If
    <b>missing</b> and/or <b>zero</b> is specified, then observations in the old dataset
    with missing and/or non-positive values for <b>int(</b><i>ncexp</i><b>)</b> are each replaced
    by one observation in the new dataset.
<p>
<p>
<b><u>Options for use with </u></b><b><u>expgen</u></b>
<p>
    <b>oldseq(</b><i>newvarname2</i><b>)</b> specifies a new variable to be generated, containing
        the sequential order of the observation in the old dataset from which
        the current observation was copied, as defined in the old dataset.
        This old sequential order is defined after the exclusion from the old
        dataset of observations not satisfying the <b>if</b> and <b>in</b> requirements,
        and after the exclusion of observations with missing values of <i>ncexp</i>
        (if <b>missing</b> was not specified) and of observations with non-positive
        values of <b>int(</b><i>ncexp</i><b>)</b> (if <b>zero</b> was not specified).  (See <b>missing</b> and
        <b>zero</b> below.)
<p>
    <b>copyseq(</b><i>newvarname3</i><b>)</b> specifies a new variable to be generated, containing
        the sequential order of the copied observation in the new dataset, in
        the set of observations copied from the same original observation in
        the old dataset.  If an observation in the old dataset has a value
        <b>int(</b><i>ncexp</i><b>)</b> equal to <i>k</i>, then the <i>k</i> duplicates of that observation in
        the new dataset have values of the <b>copyseq()</b> variable in ascending
        order from 1 to <i>k</i>.
<p>
    <b>missing</b> specifies that observations in the old dataset with missing
        values of <i>ncexp</i> are each to be replaced in the new dataset with a
        single observation.  If <b>missing</b> is absent, then such old observations
        are deleted from the new dataset.
<p>
    <b>zero</b> specifies that observations in the old dataset with non-positive
        values of <b>int(</b><i>ncexp</i><b>)</b> are each to be replaced in the new dataset with
        a single observation.  If <b>zero</b> is absent, then such old observations
        are deleted from the new dataset.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <b>expgen</b> is designed as an improved version of <b>expand</b>.  Unlike <b>expand</b>, it
    returns duplicate observations sorted in the original order of the
    corresponding observations in the old dataset, from which they were
    copied.  There is also the option of adding new variables to the
    duplicate observations.  <b>expgen</b> was designed for use, in a medical
    setting, in the case when the original dataset is from a spreadsheet with
    one row per patient, and with multiple columns containing multiple
    repeated measurements on the same patient at different times and/or on
    different parts of the same patient's body.  We might want to expand this
    dataset to a new dataset with 1 observation per repeated measurement, and
    then perform a repeated measures analysis.  The <b>copyseq()</b> variable can be
    used to generate a new variable in this new dataset, containing the
    repeated measures.  The new variable might have values each copied from
    one of a list of variables in the original dataset, depending on the
    value of the <b>copyseq()</b> variable.  (See Examples.  In SAS, this kind of
    duplication is done using a SAS data step containing a SAS <b>OUTPUT</b>
    statement inside a SAS <b>DO</b>-loop, iterating over a list of variables
    defined as a SAS array.)
<p>
<p>
<b><u>Examples</u></b>
<p>
        <b>. expgen nreps=rep78, old(modseq) copy(repseq) miss zero</b>
<p>
    The following example uses the census dataset, and expands it from a
    dataset of US states to a dataset of combinations of US state and age
    group:
<p>
        <b>. sysuse census, clear</b>
        <b>. expgen =4, copy(agegp)</b>
        <b>. lab def agegp 1 "0-4" 2 "5-17" 3 "18-64" 4 "65+"</b>
        <b>. lab val agegp agegp</b>
        <b>. gene popul = (agegp==1)*poplt5 + (agegp==2)*pop5_17 +</b>
            <b>(agegp==3)*(pop18p-pop65p) + (agegp==4)*pop65p</b>
        <b>. drop pop poplt5 pop5_17 pop18p pop65p</b>
        <b>. desc</b>
        <b>. list state agegp popul</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, National Heart and Lung Institute, Imperial College London,
    UK.
    Email: r.newson@imperial.ac.uk
<p>
<p>
<b><u>Also see</u></b>
<p>
     Manual: <b>[D] expand</b>, <b>[D] expandcl</b>, <b>[D] joinby</b>, <b>[D] contract</b>, <b>[D]</b>
             <b>collapse</b>, <b>[D] reshape</b>
    On-line: help for <b>expand</b>, <b>expandcl</b>, <b>joinby</b>, <b>contract</b>, <b>collapse</b>, <b>reshape</b>,
             help for <b>expandby</b> if installed
</pre>