<pre>
-------------------------------------------------------------------------------
help for <b>rsource</b>                                                 (Roger Newson)
-------------------------------------------------------------------------------
<p>
<b><u>Run R from inside Stata using an R source file</u></b>
<p>
        <b>rsource</b> <b>using</b> <i>R_source_filename</i> [ <b>,</b> <b>no</b><b><u>lo</u></b><b>utput</b> <b><u>ls</u></b><b>ource</b>
                     <b><u>rp</u></b><b>ath(</b><i>R_pathname</i><b>)</b> <b><u>ro</u></b><b>ptions(</b><i>R_options</i><b>)</b> ]
<p>
    where <i>R_source_filename</i> is the name of a file containing R source code,
    <i>R_pathname</i> is the name of the path of the R command to be used under the
    user's system, and <i>R_options</i> is a set of options for the R command.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>rsource</b> runs an R source file in batch mode from within Stata, optionally
    listing the R output and/or the R source file to the Stata Results window
    and/or the Stata log file.  This allows the user to call R at a point in
    the execution of a Stata program to input data files previously created
    by Stata and/or to create output data files for later input by Stata.
    The R software system must be installed on the user's system if the
    <b>rsource</b> package is to work.
<p>
<p>
<b><u>Options for use with </u></b><b><u>rsource</u></b>
<p>
    <b>noloutput</b> specifies that the output from the R command is not listed to
        the Stata Results window and/or the Stata log file.  If <b>noloutput</b> is
        not specified, then the output from the R command is listed.
<p>
    <b>lsource</b> specifies that the R source file specified by the <b>using</b> modifier
        is listed to the Stata Results window and/or the Stata log file.  If
        <b>lsource()</b> is specified and <b>noloutput</b> is not specified, then the R
        source file is listed before the output from the R command.
<p>
    <b>rpath(</b><i>R_pathname</i><b>)</b> specifies a path name for invoking the R command.  If
        <b>rpath()</b> is not specified, then it is set to the value of the global
        macro <b>Rterm_path</b>, if that macro has been specified, and to
        <b>"Rterm.exe"</b> otherwise.  (See Technical note below.)
<p>
    <b>roptions(</b><i>R_options</i><b>)</b> specifies a set of options for the R command.  If
        <b>roptions()</b> is not specified, then it is set to the value of the
        global macro <b>Rterm_options</b>, if that macro has been specified, and to
        the empty string <b>""</b> otherwise.  (See Technical note below.)
<p>
<p>
<b><u>Remarks</u></b>
<p>
    The R statistical software system can be downloaded from the R Project
    Website.  It is complementary to Stata in its capabilities, as it
    contains implementations of many methods unavailable in Stata, but does
    not have as many easy-to-use data management tools as Stata.  It may
    therefore be useful to be able to call R in batch mode from within a
    Stata do-file.  R can read Stata dataset files using the <b>read.dta</b> and
    <b>write.dta</b> modules of the <b>foreign</b> package.  Alternatively, it is possible
    to translate between Stata and R datasets using Version 9 of
    Stat/Transfer, which can be accessed from within Stata using the <b>stcmd</b>
    package, downloadable from SSC.  For more about import and export of data
    to and from R, refer to <i>R Data Import/Export</i> (see References)
<p>
<p>
<a name="rsource_technote"></a><b><u>Technical note</u></b>
<p>
    <b>rsource</b> works by running the <b>Rterm.exe</b> program of R.  The assumed R
    program path is displayed by <b>rsource</b> before any other output, and is the
    assumed name and address of the R program run by <b>rsource</b>.  If the user
    does not specify the <b>rpath()</b> and <b>roptions()</b> options, then <b>rsource</b> sets
    defaults.  In the case of <b>rpath()</b>, the default is the value of the global
    macro <b>Rterm_path</b>, if that macro has been specified, and otherwise is
    <b>"Rterm.exe"</b> if the operating system is Windows and <b>"/usr/bin/r"</b>
    otherwise.  In the case of <b>roptions()</b>, the default is the value of the
    global macro <b>Rterm_options</b>, if that macro has been specified, and is the
    empty string <b>""</b> otherwise.  Therefore, the user should either set the
    system default file search path to include the directory containing the
    current version of R, or set the global macros <b>Rterm_path</b> and
    <b>Rterm_options</b> to sensible default values before using <b>rsource</b>.
<p>
    The setting of default values for <b>Rterm_path</b> and <b>Rterm_options</b> is
    probably done most easily by inserting two lines into the user's Stata
    profile do-file to initialize these global macros every time the user
    starts Stata.  For instance, under Windows, if the user's profile do-file
    contains the lines
<p>
        <b>. global Rterm_path `"c:\r\R-2.5.0\bin\Rterm.exe"'</b>
        <b>. global Rterm_options `"--vanilla"'</b>
<p>
    and the <b>Rterm.exe</b> program of R, in the user's system, has path
    <b>c:\r\R-2.5.0\bin\Rterm.exe</b>, then the user does not need to specify the
    <b>rpath()</b> and <b>roptions()</b> options of <b>rsource</b>, because the R path is then set
    to its correct value, and the R options are set to the sensible default
    value <b>--vanilla</b>.  Other possible R options, which can be set using
    <b>roptions()</b>, are listed in Appendix B of <i>An Introduction to R</i> (see
    References).
<p>
    Note that, when the user downloads a new version of R, the installation
    process creates a new directory, containing the new version of <b>Rterm.exe</b>.
    Therefore, when R is upgraded, the user should either change the system
    default file search path, or change the line of code in the profile
    do-file setting the global macro <b>Rterm_path</b>.
<p>
<p>
<b><u>Examples</u></b>
<p>
        <b>. rsource using nitz2.R</b>
<p>
        <b>. rsource using nitz2.R, lsource</b>
<p>
        <b>. rsource using nitz2.R, noloutput roptions(--slave)</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, National Heart and Lung Institute, Imperial College London,
    UK.
    Email: r.newson@imperial.ac.uk
<p>
<p>
<a name="rsource_references"></a><b><u>References</u></b>
<p>
    Venables W. N., D. M. Smith, and the R Development Core Team.  <i>An</i>
        <i>Introduction to R</i>.  Downloadable from the R Project Website.
<p>
    The R Development Core Team.  <i>R Data Import/Export</i>.  Downloadable from
        the R Project Website.
<p>
<p>
<b><u>Also see</u></b>
<p>
     Manual: <b>[GSW] C.3 Executing commands every time Stata is started</b>, <b>[GSM]</b>
             <b>C.1 Executing commands every time Stata is started</b>, <b>[GSU] C.1</b>
             <b>Executing commands every time Stata is started</b>
    On-line: help for profile, profilew, profilem, profileu
             help for <b>stcmd</b> if installed
</pre>