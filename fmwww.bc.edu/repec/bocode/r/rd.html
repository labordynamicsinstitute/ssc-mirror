<pre>
-------------------------------------------------------------------------------
help for <b>rd</b>
-------------------------------------------------------------------------------
<p>
<b><u>Regression discontinuity (RD) estimator</u></b>
<p>
<b><u>Syntax</u></b>
<p>
      <b>rd</b> [<i>varlist</i>] [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i>]
<p>
      where <b>varlist</b> has the form <i>outcomevar</i> [<i>treatmentvar</i>] <i>assignmentvar</i>
<p>
<a name="weights"></a>        +---------+
    ----+ Weights +----------------------------------------------------------
<p>
    <b>aweight</b>s, <b>fweight</b>s, and <b>pweight</b>s are allowed; see help weights.  Under
    Stata versions 9.2 or before (using locpoly to construct local regression
    estimates) <b>aweight</b>s and <b>pweight</b>s will be converted to <b>fweight</b>s
    automatically and the data expanded. If this would exceed system memory
    limits, error r(901) will be issued; in this case, the user is advised to
    round weights.  In any case, the validity of bootstrapped standard errors
    will depend on the expanded data correctly representing sampling
    variability, which may require rounding or replacing weight variables.
    Under Stata versions 10 or later (using lpoly to construct local
    regression estimates), all weights will be treated as <b>aweight</b>s.
<p>
      <b>bs</b> [, <i>options</i>]: <b>rd</b> <i>varlist</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i>]
<p>
<a name="contents"></a>        +----------------------------+
    ----+  Table of Further Contents +---------------------------------------
<p>
  General description of estimator
  Examples
  Detailed syntax
  Description of options
  Remarks and saved results
  References
  Acknowledgements
  Citation of <b>rd</b>
  Author information
<p>
<a name="description"></a>        +-------------+
    ----+ Description +------------------------------------------------------
<p>
<b>rd</b> implements a set of regression-discontinuity estimation methods that are
thought to have very good internal validity, for estimating the causal effect
of some explanatory variable (called the treatment variable) for a particular
subpopulation, under some often plausible assumptions.  In this sense, it is
much like an experimental design, except that levels of the treatment variable
are not assigned randomly by the researcher.  Instead, there is a jump in the
conditional mean of the treatment variable at a known cutoff in another
variable, called the assignment variable, which is perfectly observed, and this
allows us to estimate the effect of treatment <i>as if</i> it were randomly assigned
in the neighborhood of the known cutoff.
<p>
<b>rd</b> is an alternative to various regression techniques that purport to allow
causal inference (e.g. panel methods such as xtreg), instrumental variables
(IV) and other IV-type methods (see the ivreg2 help file and references
therein), and matching estimators (see the psmatch2 and nnmatch help files and
references therein).  The <b>rd</b> approach is in fact an IV model with one exogenous
variable excluded from the regression (<i>excluded instrument</i>), an indicator for
the assignment variable above the cutoff, and one endogenous regressor (the
treatment variable).
<p>
<b>rd</b> estimates local linear or kernel regression models on both sides of the
cutoff, using a triangle kernel.  Estimates are sensitive to the choice of
bandwidth, so by default several estimates are constructed using different
bandwidths. In practice, <b>rd</b> uses kernel-weighted suest (or ivreg if suest
fails) to estimate the local linear regressions and reports analytic SE based
on the regressions.
<p>
Further discussion of <b>rd</b> appears in Nichols (2007).
<p>
<a name="examples"></a>        +----------+
    ----+ Examples +---------------------------------------------------------
<p>
In the simplest case, assignment to treatment depends on a variable Z being
above a cutoff Z0.  Frequently, Z is defined so that Z0=0. In this case,
treatment is 1 for Z&gt;=0 and 0 for Z&lt;0, and we estimate local linear regressions
on both sides of the cutoff to obtain estimates of the outcome at Z=0.  The
difference between the two estimates (for the samples where Z&gt;=0 and where Z&lt;0)
is the estimated effect of treatment.
<p>
For example, having a Democratic representative in the US Congress may be
considered a treatment applied to a Congressional district, and the assignment
variable Z is the vote share garnered by the Democratic candidate.  At Z=50%,
the probability of treatment=1 jumps from zero to one. Suppose we are
interested in the effect a Democratic representative has on the federal
spending within a Congressional district.  <b>rd</b> estimates local linear
regressions on both sides of the cutoff like so:
<p>
         ssc inst rd, replace
         net get rd
         use votex
         rd lne d, gr mbw(100)
         rd lne d, gr mbw(100) line(`"xla(-.2 "Repub" 0 .3 "Democ", noticks)"')
         rd lne d, gr ddens
         rd lne d, mbw(25(25)300) bdep ox
         rd lne d, x(pop-vet)
<p>
In a fuzzy RD design, the conditional mean of treatment jumps at the cutoff,
and that jump forms the denominator of a Local Wald Estimator. The numerator is
the jump in the outcome, and both are reported along with their ratio. The
sharp RD design is a special case of the fuzzy RD design, since the denominator
in the sharp case is just one.
<p>
         g byte ranwin=cond(uniform()&lt;.1,1-win,win)
         rd lne ranwin d, mbw(100)
<p>
The default bandwidth from Imbens and Kalyanaraman (2009) is designed to
minimize MSE, or squared bias plus variance, in a sharp RD design. Note that a
smaller bandwidth tends to produce lower bias and higher variance. The optimal
bandwidth will tend to be larger for a fuzzy design due to the additional
variance arising from the estimation of the jump in the conditional mean of
treatment.  Unfortunately, a larger bandwidth also leads to additional bias,
which will be greater if the curvature of the response function is greater
(meaning that a linear regression over a larger range is a poorer
approximation).  The increase in squared bias due to dividing by the estimated
jump in the conditional mean of treatment (using observations away from the
discontinuity) can easily dominate the increase in variance and lead to the
optimal bandwidth in a fuzzy design to be smaller than in the sharp design.  No
clear guidance is offered; conducting simulations using plausible generating
functions for your specific application are highly recommended.  The <b>rd</b> option
<b>bdep</b> facilitates visualizing the dependence of the estimate on bandwidth.
<p>
         rd lne ranwin d, mbw(25(25)300) bdep ox
<p>
<a name="options"></a>        +-----------------------------+
    ----+ Detailed Syntax and Options +--------------------------------------
<p>
There should be two or three variables specified after the <b>rd</b> command; if two
are specified, a sharp RD design is assumed, where the treatment variable jumps
from zero to one at the cutoff.  If no variables are specified after the <b>rd</b>
command, the estimates table is displayed.
<p>
      <b>rd</b> <i>outcomevar</i> [<i>treatmentvar</i>] <i>assignmentvar</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b>
                <i>options</i>]
<p>
<p>
        +-----------------+
    ----+ Options summary +--------------------------------------------------
<p>
<b>mbw(</b>numlist<b>)</b> specifies a list of multiples for bandwidths, in percentage terms.
    The default is "100 50 200" (i.e. half and twice the requested bandwidth)
    and 100 is always included in the list, regardless of whether it is
    specified.
<p>
<b>z0(</b><i>real</i><b>)</b> specifies the cutoff Z0 in <i>assignmentvar</i> Z.
<p>
<b><u>str</u></b><b>ineq</b> specifies that mean treatment differs at Z0 from all Z&gt;Z0 (e.g.
    treatment is 1 for Z&gt;0 and 0 for Z&lt;=0); the default assumption is that mean
    treatment differs at Z0 from all Z&lt;Z0 (e.g. treatment is 1 for Z&gt;=0 and 0
    for Z&lt;0).
<p>
<b>x(</b><i>varlist</i><b>)</b> requests estimates of jumps in control variables <i>varlist</i>.
<p>
<b><u>dd</u></b><b>ens</b> requests a computation of a discontinuity in the density of Z.  This is
    computed in a relatively ad hoc way, and should be redone using McCrary's
    test described at http://www.econ.berkeley.edu/~jmccrary/DCdensity/.
<p>
<b>s(</b><i>stubname</i><b>)</b> requests that estimates be saved as new variables beginning with
    <i>stubname</i>.
<p>
<b><u>gr</u></b><b>aph</b> requests that local linear regression graphs for each bandwidth be
    produced.
<p>
<b><u>nosc</u></b><b>atter</b> suppresses the scatterplot on those graphs.
<p>
<b><u>sco</u></b><b>pt(</b><i>string</i><b>)</b> supplies an option list to the scatter plot.
<p>
<b><u>line</u></b><b>opt(</b><i>string</i><b>)</b> supplies an option list to the overlaid line plots.
<p>
<b>n(</b><i>real</i><b>)</b> specifies the number of points at which to calculate local linear
    regressions.  The default is to calculate the regressions at 50 points
    above the cutoff, with equal steps in the grid, and to use equal steps
    below the cutoff, with the number of points determined by the step size.
<p>
<b><u>bw</u></b><b>idth(</b><i>real</i><b>)</b> allows specification of a bandwidth for local linear regressions.
    The default is to use the estimated optimal bandwidth for a "sharp" design
    as given by Imbens and Kalyanaraman (2009).  The optimal bandwidth
    minimizes MSE, or squared bias plus variance, where a smaller bandwidth
    tends to produce lower bias and higher variance. Note that the optimal
    bandwidth will often tend to be larger for a fuzzy design, due to the
    additional variance that arises from the estimation of the jump in the
    conditional mean of treatment.
<p>
<b><u>bd</u></b><b>ep</b> requests a graph of estimates versus bendwidths.
<p>
<b><u>ox</u></b><b>line</b> adds a vertical line at the default bandwidth.
<p>
<b><u>k</u></b><b>ernel(</b><b><u>rec</u></b><b>tangle)</b> requests the use of a rectangle (uniform) kernel. The default
    is a triangle (edge) kernel.
<p>
<b><u>cov</u></b><b>ar(</b><i>varlist</i><b>)</b> adds covariates to Local Wald Estimation, which is generally a
    Very Bad Idea.  It is possible that covariates could reduce residual
    variance and improve efficiency, but estimation error in their coefficients
    could also reduce efficiency, and any violations of the assumptions that
    such covariates are exogenous and have a linear impact on mean treatment
    and outcomes could greatly increase bias.
<p>
<p>
<a name="macros"></a>        +---------------------------+
    ----+ Remarks and saved results +----------------------------------------
<p>
<p>
To facilitate bootstrapping, <b>rd</b> saves the following results in <b>e()</b>:
<p>
Scalars
   <b>e(N)</b>          Number of observations used in estimation
   <b>e(w)</b>          Bandwidth in base model; other bandwidths are reported in
                  e.g. e(w50) for the 50% multiple.
<p>
Macros
   <b>e(cmd)</b>        <b>rd</b>
   <b>e(rdversion)</b>  Version number of <b>rd</b>
   <b>e(depvar)</b>     Name of dependent variable
<p>
Matrices
   <b>e(b)</b>          Coefficient vector of estimated jumps in variables at
                  different percentage bandwidth multiples
<p>
Functions
   <b>e(sample)</b>     Marks estimation sample
<p>
<p>
<a name="refs"></a><b><u>References</u></b>
<p>
Many references appear in
<p>
    Nichols, Austin. 2007.  Causal Inference with Observational Data. Stata
        Journal 7(4): 507-541.
<p>
but the interested reader is directed also to
<p>
    Imbens, Guido and Thomas Lemieux. 2007. "Regression Discontinuity
        Designs: A Guide to Practice." NBER Working Paper 13039.
<p>
    McCrary, Justin. 2007. "Manipulation of the Running Variable in the
        Regression Discontinuity Design:  A Density Test." NBER Technical
        Working Paper 334.
<p>
    Shadish, William R., Thomas D. Cook, and Donald T. Campbell. 2002.
        <i>Experimental and Quasi-Experimental Designs for Generalized Causal</i>
        <i>Inference</i>.  Boston: Houghton Mifflin.
<p>
    Fuji, Daisuke, Guido Imbens, and Karthik Kalyanaraman. 2009. "Notes for
        Matlab and Stata Regression Discontinuity Software."
        http://www.economics.harvard.edu/faculty/imbens/software_imbens
<p>
    Imbens, Guido, and Karthik Kalyanaraman. 2009. "Optimal Bandwidth Choice
        for the Regression Discontinuity Estimator." NBER WP 14726.
<p>
<a name="acknow"></a><b><u>Acknowledgements</u></b>
<p>
I would like to thank Justin McCrary for helpful discussions.  Any errors are
my own.
<p>
The optimal bandwidth calculations are from Fuji, Imbens, and Kalyanaraman
(2009), available at
http://www.economics.harvard.edu/faculty/imbens/software_imbens.
<p>
<a name="citation"></a><b><u>Citation of </u></b><b><u>rd</u></b>
<p>
<b>rd</b> is not an official Stata command. It is a free contribution to the research
community, like a paper. Please cite it as such:
<p>
    Nichols, Austin. 2011.  rd 2.0: Revised Stata module for regression
        discontinuity estimation.
        http://ideas.repec.org/c/boc/bocode/s456888.html
<p>
<b><u>Author</u></b>
<p>
    Austin Nichols
    Urban Institute
    Washington, DC, USA
    austinnichols@gmail.com
<p>
<b><u>Also see</u></b>
<p>
 Manual:  <b>[U] 23 </b> Estimation<b> and </b> post-estimation<b> commands</b>
          <b>[R] bootstrap</b>
          <b>[R] lpoly</b> in Stata 10, else locpoly (findit locpoly to install)
          <b>[R] ivregress</b> in Stata 10, else <b>[R] ivreg</b>
          <b>[R] regress</b>
          <b>[XT] xtreg</b>
<p>
 On-line: help for (if installed) rd_obs (prior version of <b>rd</b>), ivreg2, overid,
          ivendog, ivhettest, ivreset, xtivreg2, xtoverid, ranktest, condivreg;
          psmatch2, nnmatch.
</pre>