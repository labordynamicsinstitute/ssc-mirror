**  RQ(option) DEPVAR NBEG NEND QUANT*  #<suppl. card>   (list of explanatory variables;*                    if a constant is included, it should*                    be the LAST item on the suppl. card)**  DEPVAR IS THE DEPENDENT VARIABLE.*  NBEG IS THE NUMBER OF THE FIRST OBSERVATION.*  NEND IS THE NUMBER OF THE LAST OBSERVATION.*  QUANT IS THE DESIRED QUANTILE (SEE BELOW).**  Option:*   ITERATIONS=number of subsamples to draw [3000]**  RQ.SRC COMPUTES A REGRESSION QUANTILE [R. KOENKER AND*  G. BASSETT (1978) "REGRESSION QUANTILES" IN ECONOMETRICA,*  46, 33-50]. JUST AS LEAST-SQUARES ESTIMATES THE AVERAGE*  VALUE OF THE DEPENDENT VARIABLE FOR SPECIFIED VALUES*  OF THE INDEPENDENT VARIABLES, THE 0.5 QUANTILE (THE FIFTIETH*  PERCENTILE) ESTIMATES THE MEDIAN OF THE DEPENDENT VARIABLE FOR*  SPECIFIED VALUES OF THE INDEPENDENT VARIABLES. IN GENERAL,*  THE USER CHOOSES "QUANT" (0 < QUANT < 1) TO ESTIMATE ANY*  DESIRED QUANTILE OF THE DEPENDENT VARIABLE. THE PROCEDURE*  IS DESIGNED FOR LINEAR MODELS; IT CANNOT HANDLE MODELS WHICH*  ARE INTRINSICALLY NONLINEAR IN THE UNKNOWN PARAMETERS.**  RQ.SRC USES THE RATS FUNCTION "FIND MINIMUM" TO APPROXIMATE*  A REGRESSION QUANTILE. TO OBTAIN GOOD INITIAL VALUES*  FOR THIS FUNCTION, RQ.SRC FIRST DOES A SEARCH OVER MANY*  "ELEMENTAL SUBSETS" OF THE SAMPLE; EACH SUBSET CONTAINS*  AS MANY OBSERVATIONS AS THERE ARE UNKNOWN PARAMETERS.*  THE OPTION "ITERATIONS" SPECIFIES HOW MANY SUBSETS ARE TO*  BE EXAMINED. THE DEFAULT, 3000 SUBSETS, SHOULD BE ADEQUATE*  FOR MOST REGRESSION MODELS.**  THE USER MUST INSERT CERTAIN COMMANDS IN THE PROGRAM THAT*  CALLS RQ.SRC. OTHER COMMANDS MUST BE INSERTED IN RQ.SRC*  ITSELF. FOR ILLUSTRATION, CONSIDER A REGRESSION OF SERIES Y*  ON SERIES X AND Z TO ESTIMATE THE TENTH PERCENTILE OF Y.*  SUPPOSE THE SAMPLE CONTAINS "NOBS" OBSERVATIONS (I. E.,*  NOBS = NEND - NBEG + 1). THEN THE CALLING PROGRAM MUST*  CONTAIN THESE STATEMENTS:**  NONLIN B1 B2 B0*  FRML RHS = B1*X + B2*Z + B0*  SOURCE RQ.SRC*  @RQ(ITERATIONS=3000) Y 1 NOBS 0.1*  # X Z CONSTANT**  WHEN THE ELEMENTAL-SUBSET SEARCH IS COMPLETE, THE INITIAL*  REGRESSION COEFFICIENTS ARE STORED IN A VECTOR BRQ. THE*  USER MUST SUPPLY "COMPUTE" COMMANDS TO MAKE THESE INITIAL*  VALUES AVAILABLE TO THE "FIND MINIMUM" FUNCTION. FOR*  EXAMPLE:** COMPUTE B1 = BRQ(1)* COMPUTE B2 = BRQ(2)* COMPUTE B0 = BRQ(3)** PLEASE PUT THESE COMPUTE COMMANDS DIRECTLY INTO RQ.SRC AT* THE PLACE INDICATED BELOW.*PROCEDURE RQ DEPVAR NBEG NEND QUANT*TYPE INTEGER           NBEG NENDTYPE REAL              QUANTTYPE SERIES            DEPVAROPTION INTEGER         ITERATIONS  3000LOCAL VECTOR[INTEGER]  IVLOCAL VECTOR           BRQLOCAL INTEGER          I J K L N ITRLOCAL REAL             CR CRIT CRITMIN LCT REGQUANTLOCAL SERIES           R ROLS*COMPUTE ITR = ITERATIONSENTER(VARYING) IVINQUIRE(MATRIX=IV) KCOMPUTE N = NEND-NBEG+1DIM IV(K) BRQ(K)COMPUTE CRITMIN = 1000000.0DO L = 1,ITRCOMPUTE LCT = FLOAT(L) IF %FRAC(LCT/50.0) .EQ. 0.0 {  DISPLAY(UNIT=SCREEN) L ' Iterations Complete Out Of ' ITR }* AT EACH ITERATION L, DRAW A RANDOM SUBSAMPLE OF K OBSERVATIONS.:10 BOOT M 1 K 1 NSET R 1 N = 0.0DO I = 1,KCOMPUTE R(M(I)) = 1.0DO J = 1,KIF I .EQ. JBEGINBRANCH 20ENDIF M(I) .EQ. M(J)BEGINBRANCH 10END:20 END DO JEND DO I* SKIP ANY SUBSAMPLE THAT IS SINGULAR OR NEARLY SO. TO DO SO,* INSPECT THE EIGENVALUES OF THE CORRELATION MATRIX  OF THE* INDEPENDENT VARIABLES.CMOM(SMPL=R,CORR)# IVEIGEN %CMOM CVECCOMPUTE CR = CVEC(1)/CVEC(K-1)COMPUTE CR = SQRT(CR)IF CR .GT. 25.0BEGINBRANCH 10END* USE THE SUBSAMPLE TO COMPUTE A SET OF REGRESSION COEFFICIENTS.* THEN COMPUTE THE ABSOLUTE VALUES OF THE RESIDUALS AND THEIR* SUM.LINREG(NOPRINT,SMPL=R) DEPVAR# IV CONSTANTPRJ ROLS 1 NSET R 1 N = DEPVAR-ROLSDO T = 1,NIF R(T) .GT. 0.0BEGINCOMPUTE R(T) = QUANT*R(T)BRANCH 30ENDCOMPUTE R(T) = (1.0-QUANT)*R(T):30 END DO TSET ROLS 1 N = ABS(R)STATISTICS(NOPRINT) ROLS 1 NCOMPUTE CRIT = %MEAN*N* IS THE SUM OF ABSOLUTE RESIDUALS IN THIS SUBSAMPLE THE SMALLEST* SO FAR ? IF SO, SAVE THE COEFFICIENTS. THEN DRAW ANOTHER* SUBSAMPLE.IF CRIT .LT. CRITMINBEGINCOMPUTE CRITMIN = CRITCOMPUTE BRQ = %BETAENDEND DO L* THE USER MUST TYPE IN THE FOLLOWING STATEMENTS TO* INITIALIZE PARAMETER ESTIMATES FOR THE RATS FUNCTION* "FIND MINIMUM." IF A CONSTANT IS INCLUDED, IT IS THE* LAST ELEMENT IN BRQ.COMPUTE B1 = BRQ(1)COMPUTE B2 = BRQ(2)COMPUTE B0 = BRQ(3)DISPLAY 'COEFFICIENT ESTIMATES FOR'DISPLAY 'REGRESSION QUANTILE ' QUANTFIND MINIMUM REGQUANT{SET R 1 N = DEPVAR-RHSDO T = 1,NIF R(T) .GT. 0.0BEGINCOMPUTE R(T) = QUANT*R(T)BRANCH 40ENDCOMPUTE R(T) = (1.0-QUANT)*R(T):40 END DO TSET ROLS 1 N = ABS(R)STATISTICS(NOPRINT) ROLS 1 NCOMPUTE REGQUANT = %MEAN*N}END RQ