<pre>
<b>help skilmack</b>
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Title</u></b>
<p>
<p>
    <b>skilmack</b> -- Skillings-Mack test
<p>
<p>
<p>
<b><u>Syntax</u></b>
<p>
<p>
        <b>skilmack</b> <i>varname</i> [<i>if</i>] [<i>in</i>]<b>,</b> <b><u>i</u></b><b>d(</b><i>varname</i><b>)</b> <b>repeated(</b><i>varname</i><b>)</b> [<i>options</i>]
<p>
<p>
    <i>options</i>                         Description
    -------------------------------------------------------------------------
    <b><u>c</u></b><b>ovariance</b>                      use estimated covariance matrix in place
                                      of no-ties covariance matrix
    <b><u>f</u></b><b>orcesims(on</b>|<b>off)</b>               if and only if there are ties will
                                      simulations be run, unless overridden
                                      by this option
    <b>reps(</b><i>#</i><b>)</b>                         number of simulations; default is
                                      <b>reps(1000)</b>
    <b><u>s</u></b><b>eed(</b><i>#</i><b>)</b>                         specify initial value of random-number
                                      seed
    <b><u>n</u></b><b>otable(noties</b>|<b>tiescov</b>|<b>both)</b>    suppress output table produced in no-ties
                                      section or in case of ties when
                                      <b>covariance</b> option is used (or both)
    -------------------------------------------------------------------------
<p>
<p>
<p>
<b><u>Description</u></b>
<p>
<p>
    <b>skilmack</b> implements the Skillings-Mack (SM) test, which is a
    generalization of the Friedman test. It is particularly useful for an
    unbalanced/incomplete block design or in the presence of missing data.
    Missing data can be missing by design or missing completely at random.
<p>
<p>
    N.B. The SM test is equivalent to the Friedman test when there are no
    missing data and is useful when there are many ties or equal ranks.
<p>
<p>
    Unlike with the <b>friedman</b> command, the data are required to be in the more
    usual long format, i.e., one column for the outcome measure, one for the
    block identifier or ID, and one for the treatment or within-block
    repeated variable.
<p>
<p>
<p>
<b><u>Options</u></b>
<p>
<p>
    <b>id(</b><i>varname</i><b>)</b> is required and specifies the factor variable containing the
        block identifiers.
<p>
<p>
    <b>repeated(</b><i>varname</i><b>)</b> is required and specifies the factor variable
        containing the treatment identifiers.
<p>
<p>
    <b>covariance</b> specifies that the estimated covariance matrix is used in
        place of the no-ties covariance matrix. The estimated covariance
        matrix is the sample covariance matrix of the weighted sum of
        centered ranks from the simulations.
<p>
<p>
    <b>forcesims(on</b>|<b>off)</b> forces whether simulations are used.  Simulations will
        be run if and only if there are ties, unless overridden by this
        option.
<p>
<p>
    <b>reps(</b><i>#</i><b>)</b> sets the number of simulations. The default is <b>reps(1000)</b>.
<p>
<p>
    <b>seed(</b><i>#</i><b>)</b> specifies the random-number seed; time is used as the default
        seed.  This option allows an exact replication of the Monte Carlo
        simulations.
<p>
<p>
    <b>notable(noties</b>|<b>tiescov</b>|<b>both)</b> suppresses the output table produced in the
        no-ties section or in the case of ties when the <b>covariance</b> option is
        used (or both).
<p>
<p>
<p>
<b><u>Remarks</u></b>
<p>
<p>
    The following data are taken from Brady (1969):
<p>
<p>
    Dysfluencies under each condition
      +-----------------+
      | id   R   A    N |
      |-----------------|
      |  1   3   5   15 |
      |  2   1   3   18 |
      |  3   5   4   21 |
      |  4   2   .    6 |
      |  5   0   2   17 |
      |  6   0   2   10 |
      |  7   0   3    8 |
      |  8   0   2   13 |
      +-----------------+
  
    Use <b>reshape</b> to reshape the data into the long format; this is, after
    prefixing each condition with "score" by using <b>rename</b>, type
<p>
<p>
      . <b>reshape long score, i(id) j(cond) string</b>
        
      +--------------------+
      | id    cond   score |
      |--------------------|
      |  1       A       5 |
      |  1       N      15 |
      |  1       R       3 |
      |--------------------| 
      |  2       A       3 |
      |  2       N      18 |
      |  2       R       1 |
      |--------------------|
      |  3       A       4 |
      |  3       N      21 |
      |  3       R       5 |
      |--------------------|
      |  4       A       . |
      |  4       N       6 |
      |  4       R       2 |
      |--------------------|
      |  5       A       2 |
      |  5       N      17 |
      |  5       R       0 |
      |--------------------|
      |  6       A       2 |
      |  6       N      10 |
      |  6       R       0 |
      |--------------------|
      |  7       A       3 |
      |  7       N       8 |
      |  7       R       0 |
      |--------------------|
      |  8       A       2 |
      |  8       N      13 |
      |  8       R       0 |
      +--------------------+
<p>
<p>
    The SM results from the above data are
<p>
<p>
        . <b>skilmack score, id(id) repeated(cond)</b>  
<p>
<p>
        Weighted Sum of Centered Ranks
<p>
<p>
         cond  |     N  WSumCRank        SE   WSum/SE  
        -------+-------------------------------------
         A     |     7      -1.73      3.74     -0.46  
         N     |     8      13.12      3.87      3.39  
         R     |     8     -11.39      3.87     -2.94  
        ---------------------------------------------
         Total               0 
<p>
<p>
        Skillings Mack    =  13.281
        P-value (No ties) =   0.0013
             N.B. As P-value &lt;0.02, it is likely to be conservative (unless n l
&gt; arge).
             Consider obtaining a p-value from a simulated null distribution of
&gt;  SM -
             see options.
<p>
<p>
<p>
    N.B. A large negative <b>WSumCRank</b> (or <b>WSum/SE</b>) means a low ranking (e.g.,
    1) because of typically low scores. This was the case for condition <b>R</b>,
    which had the fewest dysfluencies.
<p>
<p>
<b> Simulations and ties</b>
<p>
<p>
    Simulations are preferable for obtaining more accurate small p-values if
    the sample size is not large, because the p-value from the chi-squared
    approximation is likely to be conservative here (Skillings and Mack
    1981).
<p>
<p>
    If there are ties (equal ranks), average ranks are assigned, e.g., 1.5,
    1.5, 3. Assigning average ranks is perhaps the most common way of dealing
    with ties. However, one may prefer to force ranks to be randomly assigned
    when they are tied. (This can effectively be done by adding a small
    random amount to each score.)
<p>
<p>
    The SM statistic can be calculated when there are ties; however, the
    p-value calculated from the assumed chi-squared null distribution becomes
    more and more conservative the more ties there are.  To provide a more
    accurate p-value, simulations are used to approximate the distribution of
    SM values under the null hypothesis, and conditional on the particular
    missing-data structure and tied rankings.
<p>
<p>
    A dataset is simulated by sorting on random numbers, for each individual,
    to randomly shuffle which data point belongs to which repeat.  The
    sorting on random numbers is not applied where there are missing data to
    preserve the missing-data structure.
<p>
<p>
    With the <b>covariance</b> option, the SM statistic can be redefined by
    estimating the covariance matrix of the weighted sums of centered ranks
    and using this in place of the covariance matrix (which is accurate when
    there are no ties, but not when there are many ties).  A new table is
    produced with different standard errors, and a new SM statistic and
    p-value are calculated.  The tables can be suppressed by using the
    <b>notable</b> option.
<p>
<p>
<b> Definition of SM statistic</b>
<p>
<p>
    SM = A' (sigma0^-1) A , where A is a column vector of all but one of the
    weighted [by sqrt(12/ si+1), where si is the number of measures for
    person i] sums of centered ranks, and (sigma0^-1) is any generalized
    inverse of the covariance matrix.
<p>
<p>
<p>
<b><u>References</u></b> 
<p>
<p>
    Brady, J. P. 1969. Studies on the metronome effect on stuttering.
        <i>Behaviour Research and Therapy</i> 7: 197-204.
<p>
<p>
    Skillings, J. H., and G. A. Mack. 1981. On the use of a Friedman-type
        statistic in balanced and unbalanced block designs. <i>Technometrics</i> 23:
        171-177.
<p>
<p>
<p>
<b><u>Authors</u></b>
<p>
<p>
    Mark Chatfield
    Medical Research Council
    Human Nutrition Research
    Cambridge, UK
    mdc_england@hotmail.com
<p>
<p>
    Adrian Mander
    Medical Research Council
    Human Nutrition Research
    Cambridge, UK
<p>
<p>
<p>
<b><u>Also see</u></b>
<p>
<p>
    Online:  <b>friedman</b> (if installed)
</pre>