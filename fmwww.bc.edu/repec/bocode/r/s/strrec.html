<pre>
<p>
<b>help strrec</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
     <b>strrec</b> -- Recode string variables, modify value labels or recode variables
               referring to value labels
<p>
<b><u>Syntax</u></b>
<p>
        <b>strrec</b> <i>varlist</i> <b>(</b><i>rule</i><b>)</b> [<b>(</b><i>rule</i><b>)</b> <i>...</i>] [<i>if</i>] [<i>in</i>] [<b>,</b> <i>options</i>]
<p>
     where <i>rule</i> is one of
<p>
                       <b>"</b><i>str</i><b>"</b> [<b>"</b><i>str</i><b>"</b> <i>...</i>] <b>=</b> <i>#</i> [<b>"</b><i>lbl</i><b>"</b>]
<p>
                       <b>"</b><i>str</i><b>"</b> [<b>"</b><i>str</i><b>"</b> <i>...</i>] <b>=</b> <b>"</b><i>newstr</i><b>"</b>
<p>
     <i>str</i> is a string. Double quotes may be omitted if <i>str</i> does not contain
        embedded spaces.
<p>
     <i>#</i> is a number. Non-integers are allowed.
<p>
     <i>lbl</i> is a value label. Double quotes may be omitted if <i>lbl</i> does not contain
        embedded spaces. Make sure to insert a blank between <i>#</i> and <i>lbl</i> if not
        using double quotes. This part of <i>rule</i> is optional.
<p>
     <i>newstr</i> is a single string. Double quotes may be omitted if <i>newstr</i> does not
        contain embedded spaces.
<p>
     Parentheses around <i>rules</i> must be used.
<p>
<p>
    <i>options</i>                Description
    -------------------------------------------------------------------------
    <i>main options</i>
      <b><u>pre</u></b><b>fix(</b><i>name</i><b>)</b>         use <i>name</i> as prefix for transformed variables
      <b><u>g</u></b><b>enerate(</b><i>namelist</i><b>)</b>   create variables <i>name1, ..., namek</i> containing
                             transformed variables
      <b>replace</b>              replace <i>var</i> with transformed values
      <b>sub</b>                  recode if <i>str</i> is a substring in <i>var</i>
      <b><u>case</u></b><b>sensitive</b>        case-sensitive recode
      <b><u>str</u></b><b>ing</b>               force new variables to be string variables
    <i>numeric options</i>
      <b><u>def</u></b><b>ine(</b><i>name</i><b>)</b>         specify name for defined value label
      <b><u>nol</u></b><b>abel</b>              do not define value label/s
    <i>string options</i>
      <b>elsemiss</b>             set strings that do not meet the conditions of
                             <i>rules</i> to missing
      <b><u>copy</u></b><b>rest</b>             copy strings that are excluded by the <i>if</i> and <i>in</i>
                             qualifiers from <i>var</i>
    <i>extended options</i>
      <b><u>vall</u></b><b>ab</b>               apply <i>rules</i> to value labels (numeric variables)
      <b><u>nodel</u></b><b>ete</b>             do not delete value labels that are changed
    -------------------------------------------------------------------------
<p>
<b><u>Description</u></b>
<p>
    <b>strrec</b> recodes string variables according to <i>rules</i>. Variables may either
    be recoded into numeric variables or into string variables. Any string in
    <i>var</i> that does not meet the conditions of <i>rules</i> is set to missing in
    created numeric variables and copied from <i>var</i> in created string
    variables. Value labels will be defined for numeric variables, assigning
    <i>str</i> (or, if specified <i>lbl</i>) to corresponding numeric values.
<p>
    <b>Remarks:</b> <b>strrec</b> may also be used to recode numeric variables referring to
    their value labels. See option vallab.
<p>
<b><u>Options</u></b>
<p>
        +---------+
    ----+ Options +----------------------------------------------------------
<p>
    <b>prefix(</b><i>name</i><b>)</b> uses <i>name</i> as prefix for recoded variables. If not specified
        <b>r_</b> is default. May also be used with <b>generate()</b>.
<p>
    <b>generate(</b><i>namelist</i><b>)</b> creates new variables <i>name1, ..., namek</i> containing
        recoded variables. The number of names specified must equal the
        number of variables in <i>varlist</i>.
<p>
    <b>replace</b> replaces <i>var</i> with transformed variable.
<p>
    <b>sub</b> recodes <i>var</i> if <i>str</i> is a substring of <i>var</i>. In <i>str</i>, <b>"?"</b> means any
        single character, <b>"*"</b> means zero or more characters. The synonym
        <b><u>wild</u></b><b>cards</b> may be used.
<p>
    <b>casesensitive</b> specifies that <i>str</i> (as well as <i>var</i>) is treated "as is",
        meaning case-sensitive <b>and</b> with leading- trailing- and consecutive
        internal blanks. If specified, <i>var</i> will only be recoded if it
        perfectly matches <i>str</i>.
<p>
    <b>string</b> forces new variable/s to be string variables. <b>strrec</b> sets the new
        variables' type (numeric or string) according to the first rule
        specified. If <i>newstr</i> is a single number in the first rule and you
        want to create string variables, specify <b>string</b>.
<p>
    <b>define(</b><i>name</i><b>)</b> specifies a name for the created value label. If not
        specified, the new variables' names are used as value label name.
<p>
    <b>nolabel</b> specifies that no value labels will be defined.
<p>
    <b>elsemiss</b> specifies that strings that do not meet the conditions of <i>rules</i>
        are set to missing (<b>""</b>). Default is to copy those strings from <i>var</i>.
<p>
    <b>copyrest</b> specifies that strings are copied from <i>var</i>, even if they are
        excluded by the <i>if</i> and <i>in</i> qualifier. Default is to set those strings
        to missing (<b>""</b>).
<p>
<a name="vl"></a><p>
    <b>vallab</b> applies <i>rules</i> to the value labels of (numeric) variables in
        <i>varlist</i>.  In case <i>"str"</i> = <i>"newstr"</i> is used as <i>rule/s</i>, only the text
        in the variables' value labels will be changed. Using <i>"str"</i> = # <i>"lbl"</i>
        as <i>rule/s</i> will change the value labels (text and integer) <b>and</b> the
        values of <b>all</b> variables using the respective value label. The <i>if</i> and
        <i>in</i> qualifiers are ignored and only options <b>sub</b>, <b>casesensitive</b> and
        <b>nodelete</b> may be used. <b><u>vl</u></b><b>ab</b> or <b>labrec</b> are synonyms for <b>vallab</b>. See
        example.
<p>
    <b>nodelete</b> does not delete (old) value labels that are changed by <i>rules</i>.
        This option should be specified if <i>rules</i> refer to the same text as
        <i>str</i> and <i>lbl</i>.
<p>
<b><u>Examples</u></b>
<p>
        . sysuse auto ,clear
        (1978 Automobile Data)
<p>
        . tabulate make
<p>
            Make and Model |      Freq.     Percent        Cum.
        -------------------+-----------------------------------
               AMC Concord |          1        1.35        1.35
                 AMC Pacer |          1        1.35        2.70
                AMC Spirit |          1        1.35        4.05
                 Audi 5000 |          1        1.35        5.41
                  Audi Fox |          1        1.35        6.76
        [...]
                 VW Dasher |          1        1.35       94.59
                 VW Diesel |          1        1.35       95.95
                 VW Rabbit |          1        1.35       97.30
               VW Scirocco |          1        1.35       98.65
                 Volvo 260 |          1        1.35      100.00
        -------------------+-----------------------------------
                     Total |         74      100.00
<p>
        <b>. strrec make ("AMC*" = 1 "AMC")("Audi*" = 2 "Audi") ///</b>
        <b>&gt; [...] ("VW*" = 22 "VW")("Volvo*" = 23 "Volvo") ,sub generate(make_onl</b>
<b>&gt; y)</b>
        make_only
        (3 real changes made)
        (2 real changes made)
        (1 real change made)
        (7 real changes made)
        (3 real changes made)
        (6 real changes made)
        (4 real changes made)
        (4 real changes made)
        (1 real change made)
        (2 real changes made)
        (2 real changes made)
        (3 real changes made)
        (1 real change made)
        (6 real changes made)
        (7 real changes made)
        (1 real change made)
        (5 real changes made)
        (6 real changes made)
        (1 real change made)
        (1 real change made)
        (3 real changes made)
        (4 real changes made)
        (1 real change made)
<p>
        . tabulate make_only
<p>
          make_only |      Freq.     Percent        Cum.
        ------------+-----------------------------------
                AMC |          3        4.05        4.05
               Audi |          2        2.70        6.76
        [...]
                 VW |          4        5.41       98.65
              Volvo |          1        1.35      100.00
        ------------+-----------------------------------
              Total |         74      100.00
<p>
<a name="vlex"></a><p>
    <b><u>vallab</u></b><u> option</u>
<p>
    Consider the following value labels in a dataset
<p>
        . label list
        agelbl:
                 888 Don't know
                 999 Refusal
        pollbl:
                  -9 REFUSAL
                  -8 DON'T KNOW
                   1 very interested
                   2 quite interested
                   3 hardly interested
                   4 not at all interested
        marlbl:
                   0 not married
                   1 married
                   9 Refusal
        tvlbl:
                   1 no time at all
                   2 less than 30 min
                   3 30 to 60 min
                   4 60 to 90 min
                   5 90 to 180 min
                   6 more than 180 min
                   8 don't know
                   9 refused
<p>
    Note that missing value codes, as well as the spelling of the labels'
    text "don't know" and "refused" vary across variables.
<p>
        <b>. strrec _all ("don't know" = .a)(ref* = .b "refused") ,vallab sub</b>
        [...]
        
        . label list
        marlbl:
                   0 not married
                   1 married
                  .b refused
        agelbl:
                  .a don't know
                  .b refused
        pollbl:
                   1 very interested
                   2 quite interested
                   3 hardly interested
                   4 not at all interested
                  .a don't know
                  .b refused
        tvlbl:
                   1 no time at all
                   2 less than 30 min
                   3 30 to 60 min
                   4 60 to 90 min
                   5 90 to 180 min
                   6 more than 180 min
                  .a don't know
                  .b refused 
<p>
    All variables will be recoded accordingly. Note that old value labels
    (e.g. 888 Don't know) are deleted. To prevent <b>strrec</b> from doing so, add
    option <b>nodelete</b>. The option should be added if <i>rules</i> are used to swap
    value labels as in
<p>
        . <b>strrec anyvar ("one" = 5 "five") ("five" = 1 "one")</b>
        
<b><u>Further Remarks</u></b>
<p>
    Make sure to always use the typewriter apostrophe (<b>'</b>), even if left
    single quotes (<b>`</b>) are used as apostrophe in the labels. <b>strrec</b> will
    change those left single quotes to typewriter apostrophes.
<p>
<p>
<b><u>Author</u></b>
<p>
    Daniel Klein, University of Bamberg, klein.daniel.81@gmail.com
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>encode</b>, <b>recode</b>, label
<p>
    if installed: labrec (old)
</pre>