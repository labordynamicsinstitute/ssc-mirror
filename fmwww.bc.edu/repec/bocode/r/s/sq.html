<pre>
<b>help sq</b>                                                         (SJ6-4: st0111)
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>sq</b> -- Sequence analysis
<p>
<p>
<b><u>Description</u></b>
<p>
    The term sq refers to sequence data and to the commands for analyzing
    these data. Sequences are entities built by a limited number of elements
    that are ordered in a specific way. A typical example is human DNA, where
    the elements adenine, cytosine, guanine, and thymine (the organic bases)
    are ordered into a sequence. Other sequences are songs that are built by
    tones that appear in a specific order, or careers of employers that are
    built by specific job positions and ordered along time.
<p>
    Sequence data are data that contain one variable holding the elements,
    one variable that contains the position of each element within this
    sequence, and one variable that identifies the sequences itself. Hence,
    sequence data require data that are set up in what Stata usually calls
    the "long form" and which is explained in some detail below.
<p>
    The SQ-Ados are a bundle of commands to describe, analyze, and group the
    sequences of a sequence dataset. The following sq commands are available:
<p>
        <b>sqset</b>             Declare data to be sequence data
        <b>sqdes</b>             Describe sequence concentration
        <b>sqtab</b>             Tabulate sequences
        <b>sqegen</b>            Generate variables reflecting entire sequences
        <b>sqstat</b>            Describe, summarize, and tabulate sq-egenerated
                            variables' sequences
        <b>sqindexplot</b>       Graph sequences as sequence index plot
        <b>sqparcoord</b>        Graph sequences with parallel coordinates
        <b>sqom</b>              Optimal matching of sequences
        <b>sqclusterdat</b>      Prepare a dataset to perform cluster analyses on
                            the results of <b>sqom</b>
        <b>sqclustermat</b>      Perform one cluster analysis on the results of <b>sqom</b>
<p>
    You begin an analysis by <b>sqset</b>ting your data, which tells Stata the key
    sequence data variables; see <b>sqset</b>.  Once you have <b>sqset</b> your data, you
    can use the other sq commands.  If you <b>save</b> your data after <b>sqset</b>ting it,
    you will not have to <b>sqset</b> it again in the future; Stata will remember
    it.
<p>
    Please refer to sqdemo for a quick demonstration of the sq commands.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    Remarks are presented under the following headings:
<p>
        Sequences and how they are stored
        Typical research questions
        Gaps, missings, etc.
        Limitations
<p>
<p>
<a name="1"></a><b><u>Sequences and how they are stored</u></b>
<p>
    An example for a sequence is the following chain of letters:
<p>
                              A-G-C-T-T-T-T-G-C-A
<p>
    In this example, the letters might stand for something else, such as the
    four organic bases adenine, guanine, cytosine, and thymine of DNA. The
    chain of letters might, however, also denote the tones of a song (using
    the letter "T" for a break), the employment states in a job career, party
    preferences during a lifetime, etc.
<p>
    In what follows, we will use the term "sequence" for the entire chain,
    "element" for the states of the chain, and "position" for the position on
    which a specific element is found. Hence, in the sequence above, the
    element A is at positions 1 and 10, G is at position 2 and 8, etc.
<p>
    In Stata, sequences can be stored in two formats. The first format is the
    wide form. Sequence data in wide form store sequences underneath each
    other with one variable for each position. Here is an example:
<p>
                                 (wide form)           
<p>
                         <b>id  bas1   bas2   bas3   bas4</b>
                        -------------------------------
                         1      A      G     C     T  
                         2      G      C     T     A  
                         3      C      G     T     A  
<p>
<p>
    The second format has one variable that indicates the sequence, one
    variable that stores the position and another one that stores the
    elements. This is called the long form. In long form, the above example
    looks as follows:
<p>
                                  (long form)      
<p>
                               <b>id   pos   bas  </b>
                            -----------------------
                                 1     1    A 
                                 1     2    G 
                                 1     3    C 
                                 1     4    T 
                                 2     1    G 
                                 2     2    C 
                                 2     3    T 
                                 2     4    A 
                                 3     1    C 
                                 3     2    T 
                                 3     3    G 
                                 3     4    A 
<p>
    The sq-commands expect sequence data in long form. Toggling between wide
    and long form is easy with <b>reshape</b>.
<p>
<p>
<a name="2"></a><b><u>Typical research questions</u></b>
<p>
    The first aim of sequence analysis is to describe the sequences. With a
    few short sequences, it is easy to describe the sequences by simply
    listing them, but in practice, there are usually many sequences that tend
    to be rather long. It is therefore necessary to have some specific tools
    that allow describing many long sequences effectively. Among the
    sq-commands <b>sqgen</b>, <b>sqstat</b>, <b>sqtab</b>, <b>sqparcoord</b>, and <b>sqindexplot</b> might be
    useful for this task.
<p>
    The second aim of sequence analysis is to find certain similarities of
    sequences. The similarity of sequences has to be defined a little
    further, however. Look, for example, at the following sequences,
    presented in wide form:
<p>
                         <b>id  bas1   bas2   bas3   bas4</b>
                        -------------------------------
                         1      A      G     C     T  
                         2      G      C     T        
                         3      A      G              
<p>
    First, the three sequences have different length.  In terms of length,
    sequence 1 is more similar to sequence 2 than to sequence 3.  If one,
    however, compares the elements at each position, sequences 1 and 3 have
    the same elements at the first two positions, and they differ only in
    that sequence 1 is longer than sequence 3. Sequence 2 has different
    elements at each position from those of the two other sequences.  Hence,
    sequences 1 and 3 are more similar than 1 and 2 in this respect.
    Finally, in a third respect, sequences 1 and 2 are quite similar.  They
    differ only in that sequence 1 starts with "A". If we delete the first
    position from sequence 1, or insert "A" at the beginning of the second
    sequence, both sequences would be identical. All tools to describe the
    sequences can be also used to find similarities between the sequences in
    one respect or another.  However, one of the sq-commands, <b>sqom</b>, is
    specially aimed to find similarities in the third respect.
<p>
    Finally, if one has been able to depict certain typical sequences, one
    might be interested in using sequence types as independent variables in
    statistical models. Biostatisticians might be interested in whether
    specific types of DNA sequences affect behavior or appearance of species,
    and social scientists might be interested in whether certain types of
    educational careers cause dangerous job situations. The sq-commands
    therefore allow building variables for grouping similar sequences
    together.
<p>
<p>
<a name="3"></a><b><u>Gaps, missings, etc.</u></b>
<p>
    If an element at a certain position is unknown, we call this a gap. Gaps
    theortically can appear at the beginning, and/or in the middle of a
    sequence, and we treat them differently.
<p>
    For sequence analysis, gaps create several problems -- not so much in
    terms of technical problems but in terms of content. The way one deals
    with gaps influences the substantial outcomes of sequence analysis, and
    it depends on the research questions, which way of dealing with gaps is
    the most appropriate. The SQ-Ados are generally designed such that
    sequences that contain a gap in the middle are not used in the analysis;
    however, they can be included in some of the programs by using the option
    <b>gapinclude</b>.
<p>
    Unknown elements at the beginning or the end of a sequence are generally
    not counted as a "gap". We do, however, recommend erasing them with the
    options <b>ltrim</b>, <b>rtrim</b>, or <b>trim</b> of the command <b>sqset</b>.
<p>
    Taking care of gaps is mainly up to the user.  To guide the user through
    his decisions, <b>sqset</b> will control for gaps and propose ways to deal with
    them.  In this section, we will explain the various ways to deal with
    gaps in more detail.
<p>
    In sequence data, gaps can appear two ways. Presented in long form, the
    first way is shown here:
<p>
                               <b>id   pos   bas  </b>
                            -----------------------
                                 1     1    A 
                                 1     2      
                                 1     3    C 
                                 1     4    T 
<p>
    There is no entry (or a missing), at position 2. In other words, one does
    not know the element at position 2. The other way to represent gaps is to
    erase an observation from the data:
<p>
                               <b>id   pos   bas  </b>
                            -----------------------
                                 1     1    A 
                                 1     3    C 
                                 1     4    T 
<p>
    Although both ways seem to represent the same information, we let you 
    <b>sqset</b> the data only if gaps are represented in the first way. With <b>sqset</b>,
    an error message will appear if gaps appear in the second form. To
    proceed, you need to restructure your data such that gaps either appear
    the first way or do not appear at all. Hence, you might go on with
<p>
    <b>. fillin id pos</b>
<p>
    which will bring you to the first way (as long as there is at least one
    sequence without a gap at the second position), or you restructure the
    variable holding the positions of the elements by stating something like
<p>
    <b>. bysort id: replace pos = _n</b>
<p>
    After having decided how to deal with the "forbidden" gaps, one can <b>sqset</b>
    the data. However, if there are still gaps of the first variety in the
    data, <b>sqset</b> will display a note accordingly. You then have several
    choices. The first choice always is to simply ignore the note and to let
    the sq-commands deal with gaps however they like. The second choice is to
    encode missings to a meaningful value. Hence, you define the missing to
    be just another element:
<p>
    <b>. replace base = "M" if base == ""</b>
<p>
    The third choice is to keep only the longest available section of each
    sequence that is not interrupted by gaps. This can be achieved with the
    option <b>keeplongest</b> of <b>sqset</b>.
<p>
<p>
<a name="4"></a><b><u>Limitations</u></b>
<p>
    For the SQ-Ados, sequence data are expected to be in long format, which
    imposes no restrictions with respect to sequence length. Much of the
    programming within the SQ-Ados is, however, done in wide format, so that
    the maximum sequence length is somewhat less than the number of variables
    allowed in the respective flavor of Stata (32,000 in Stata/SE and 2,047
    in Intercooled Stata).
<p>
    The command <b>sqom</b> with option <b>full</b> stores its results by pushing a Mata
    matrix into a Stata matrix. The maximum dimension of the Stata matrix is
    11,000 x 11,000. The flavor of Stata and the matsize plays no role for
    this restriction.
<p>
    Given the limits and speed problems, optimal matching as it is
    implemented in <b>sqom</b> seems capable of working with a moderate number of
    relatively short sequences. It has been tested for around 2,000 sequences
    of length up to 100 positions.
<p>
<p>
<b><u>Authors</u></b>
<p>
    Ulrich Kohler, WZB, kohler@wz-berlin.de
    Magdalena Luniak, WZB, luniak@wz-berlin.de
    Christian Brzinsky-Fay, WZB, brzinsky-fay@wz-berlin.de
<p>
    Bug reports go to Ulrich Kohler. Questions on applications of sequence
    analysis are handled by Christian Brzinsky-Fay.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[D] reshape</b>
<p>
    Online: <b>sq</b>, <b>sqdemo</b>, <b>sqset</b>, <b>sqdes</b>, <b>sqegen</b>, <b>sqstat</b>, <b>sqindexplot</b>, 
             <b>sqparcoord</b>, <b>sqom</b>, <b>sqclusterdat</b>, <b>sqclustermat</b>
</pre>