<pre>
<p>
-------------------------------------------------------------------------------
<b>help for spwmatrix</b> 
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
  <b>spwmatrix --- Generates, imports, and exports spatial weights</b>
<p>
<a name="contents"></a>        +--------------------+
    ----+  Table of Contents +-----------------------------------------------
<p>
  Syntax
  General description
  Description of the options
  Examples
  References
  Author information
  Citation
<p>
-------------------------------------------------------------------------------
<p>
<a name="syntax"></a><b><u>Syntax</u></b>
<p>
Import first order contiguity spatial weights (GAL files) from GeoDa
<p>
    <b>spwmatrix</b> <i>gal</i> <b>using</b> <i>gal_filename</i><b>,</b> <b><u>wn</u></b><b>ame(</b><i>wght_name</i><b>)</b> [Other_options]
<p>
<p>
Create geographic and economic distance-based spatial weights using latitude an
&gt; d longitude
<p>
    <b>spwmatrix</b> <i>gecon</i> <i>varlist</i> [if] [in]<b>,</b> <b><u>wn</u></b><b>ame(</b><i>wght_name</i><b>)</b>
        [<b><u>wt</u></b><b>ype(</b><i>bin</i>|<i>inv</i>|<i>econ</i>|<i>invecon</i><b>)</b> <b>cart</b> <b>r(</b><i>#</i><b>)</b> <b><u>db</u></b><b>and(</b><i>numlist</i><b>)</b> <b>alpha(</b><i>#</i><b>)</b> <b>knn(</b><i>#</i><b>)</b>
        <b>econvar(</b><i>varname1</i><b>)</b> <b>beta(</b><i>#</i><b>)</b> <b>gwt(</b><i>gwt_filename</i><b>)</b> <b><u>con</u></b><b>nect</b> Other_options]
<p>
<p>
Create social network and socio-economic spatial weights
<p>
    <b>spwmatrix</b> <i>socio</i> <i>varname2</i> [if] [in]<b>,</b> <b><u>wn</u></b><b>ame(</b><i>wght_name</i><b>)</b>
        <b><u>wt</u></b><b>ype(</b><i>socnet</i>|<i>socecon</i><b>)</b> [<b>idvar(</b><i>varname3</i><b>)</b> <b>gwt(</b><i>gwt_filename</i><b>)</b> <b><u>con</u></b><b>nect</b>
        Other_options]
<p>
<p>
    where <i>gal, gecon, and socio</i> are sub-commands.
<p>
<p>
<p>
    <i>options</i>                           Description
<a name="options"></a><p>
    -------------------------------------------------------------------------
    Main Options
        
      <b><u>wn</u></b><b>ame(</b><i>wght_name</i><b>)</b>                indicate a name for the spatial weights
                                        matrix
<p>
      <b><u>wt</u></b><b>ype(</b><i>bin</i>|<i>inv</i>|<i>econ</i>|<i>invecon</i>|<i>socnet</i>|<i>socecon</i><b>)</b>
                                        request binary, distance decay,
                                        economic distance, inverse economic
                                        distance, social network, or
                                        socio-economic spatial weights
<p>
      <b>alpha(</b><i>#</i><b>)</b>                        indicate the value of the dampening
                                        parameter; default is <b>alpha(</b><i>1</i><b>)</b>
<p>
      <b><u>db</u></b><b>and(</b><i>numlist</i><b>)</b>                  indicate a distance band or cut-off
<p>
      <b>cart</b>                            use Cartesian coordinates (projected
                                        latitudes and longitudes)
<p>
      <b>r(</b><i>#</i><b>)</b>                            indicate the earth radius value to be
                                        used in case of spherical
                                        coordinates; default is r(6371.009),
                                        i.e 6371.009 km
<p>
      <b>knn(</b><i>#</i><b>)</b>                          request nearest neighbor spatial
                                        weights
<p>
      <b>econvar(</b><i>varname1</i><b>)</b>               request economic or inverse economic
                                        distance spatial weights
<p>
      <b>beta(</b><i>#</i><b>)</b>                         specify the coefficient beta for the
                                        exponential function
<p>
      <b>idvar(</b><i>varname3</i><b>)</b>                 specify the identifier variable
<p>
      <b>gwt(</b><i>gwt_filename</i><b>)</b>               save the spatial weights in sparse form
                                        to a text file
<p>
      <b><u>con</u></b><b>nect</b>                         display connectivity information about
                                        the spatial weights
<p>
<p>
<a name="other_options"></a><p>
    -------------------------------------------------------------------------
    Other Options
   
      <b><u>m</u></b><b>ataf</b>                           save the spatial weights and the
                                        eigenvalues to Mata files
<p>
      <b><u>eignv</u></b><b>al(</b><i>eignv_name</i><b>)</b>             specify a column vector name to hold
                                        the eigenvalues
<p>
      <b>eignvar(</b><i>newvar</i><b>)</b>                 specify a variable name to hold the
                                        eigenvalues
<p>
      <b><u>row</u></b><b>stand</b>                        row-standardize the spatial weights
<p>
      <b>matlab(</b><i>dat_filename</i><b>)</b>            export the spatial weights to a .dat
                                        (text) file for use in <b>Matlab</b>
<p>
      <b>replace</b>                          overwrite existing <i>newvar</i>,
                                        <i>gwt_filename</i>, and <i>dat_filename</i> as
                                        well as <i>wght_name</i> and <i>eignv_name</i> if
                                        <b>mataf</b> is specified
<p>
      <b>favor(</b><i>speed</i>|<i>space</i><b>)</b>              favor speed or space
<p>
    -------------------------------------------------------------------------
<p>
<a name="description"></a>        +-------------+
    ----+ Description +------------------------------------------------------
<p>
    <b>spwmatrix</b> creates distance based spatial weights and imports first-order
    contiguity spatial weights (.gal files saved in sparse form) created
    using the GeoDa software (see http://geodacenter.asu.edu). <b>spwmatrix</b> also
    generates economic distance spatial weights based on an economic variable
    (see Fingleton and Le Gallo, 2008) and social network and socio-economic
    spatial weights based on a socio-economic variable (See Anselin and Bera,
    1998). Optionally, created and imported spatial weights are exported to a
    .dat file for use in Matlab. Created spatial weights may also be exported
    to a .gwt file for use in GeoDa. Ultimately, the requested spatial
    weights are delivered as a Stata matrix loaded in memory or as a
    permanent Mata file. When creating distance-related spatial weights,
    <b>spwmatrix</b> uses either the straight-line (crow-fly) Euclidean distance or
    the Great Circle distance depending on whether the latitudes and
    longitudes supplied in <i>varlist</i> are projected or not.
<p>
    Spatial weights matrices created or imported by <b>spwmatrix</b> may be used by
    other user-written commands requiring a spatial weights matrix.
<p>
<p>
<a name="main_options"></a>        +--------------+
    ----+ Main Options +-----------------------------------------------------
<p>
    <b>wname(</b><i>wght_name</i><b>)</b> specifies a name for the spatial weights matrix to be
        created. This option is required.
<p>
    <b>wtype(</b><i>bin</i>|<i>inv</i>|<i>econ</i>|<i>invecon</i>|<i>socnet</i>|<i>socecon</i><b>)</b> indicates whether binary,
        distance decay, economic distance, inverse economic distance, social
        network, or socio-economic spatial weights should be created.
<p>
        Refer to the literature cited below for a background on these spatial
        weights, except for inverse economic distance spatial weights which
        are defined as:
<p>
            <b>W_ij = [1/|econvar_i - econvar_j|] * exp(-beta*D_ij)</b>, where D_ij
            is the distance between i and j
<p>
    <b>alpha(</b><i>#</i><b>)</b> specifies a value to be used for the dampening parameter when
        requesting inverse distance spatial weights.  If <b>wtype(</b><i>inv</i><b>)</b> is
        specified, the default will be <b>alph(</b><i>1</i><b>)</b>. Specifying <b>alpha(</b><i>2</i><b>)</b> requests
        inverse distance squared spatial weights.
<p>
    <b>dband(</b><i>numlist</i><b>)</b> indicates a distance cut-off to be used beyond which no
        spatial autocorrelation is assumed. This option is required when
        option <b>wtype(</b><i>bin</i><b>)</b> is specified. Following the literature (see Boarnet
        et al., 2006) , option <b>dband(</b><i>numlist</i><b>)</b> is not required when an inverse
        distance weights matrix is requested. When <b>dband(</b><i>numlist</i><b>)</b> is
        specified, by default, the distance unit is assumed to be kilometers,
        but that can be overriden with <b>cart</b> or <b>r(</b><i>#</i><b>)</b>.
<p>
    <b>cart</b> indicates that the latitudes and longitudes supplied in <i>varlist</i> are
        projected and that, in generating the spatial weights, Euclidean or
        crow-fly distance should be calculated. By default, the Great Circle
        distance is calculated. For more details, see the help file for 
        <b>nearstat</b>.
<p>
    <b>r(</b><i>#</i><b>)</b> indicates the value to be used for the Earth radius or mean radius
        in case of spherical coordinates.  The Earth radius usually refers to
        various fixed distances and to various mean radii since only a sphere
        has a true radius.  Fortunately, the numerical differences among
        different radii vary by far less than one percent, making the choice
        of <b>#</b> less of a concern.
<p>
        <b>N.B.:</b> As indicated above, by default, the distance unit for <b>dband(</b>
        <i>numlist</i><b>)</b> is assumed to be kilometers. If you want the unit to be
        miles, then you must specfiy <b>r(</b><i>3958</i>.<i>761</i><b>)</b>.
<p>
        Options <b>r(</b><i>#</i><b>)</b> and <b>cart</b> may not be combined.
<p>
    <b>knn(</b><i>#</i><b>)</b> requests nearest neighbor spatial weights and indicates the number
        of nearest neighbors to be used.  Option <b>knn(</b><i>#</i><b>)</b> may not be combined
        with either <b>wtype()</b> or <b>dband()</b>.
<p>
    <b>econvar(</b><i>varname1</i><b>)</b> specifies the name of the economic variable to be used
        in creating economic or inverse economic distance spatial weights.
<p>
    <b>beta(</b><i>#</i><b>)</b> specifies a value to be used for the beta coefficient. The
        default is <b>beta(</b><i>100</i><b>)</b>. You might want to choose # so that the spatial
        weights matrix does not contain any rows with elements summing up to
        zero.
<p>
    <b>idvar(</b><i>varname3</i><b>)</b> specifies the identifier variable (with values varying
        from 1 to N) to be used when creating social network spatial weights.
        The variable holding the groups or the networks should be supplied
        with <i>varname2</i>. <b>idvar()</b> is required when <b>wtype(</b><i>socnet</i><b>)</b> is specified to
        request social network spatial weights. For instance, you can
        generate spatial weights based on the idea that two or more
        households are considered neighbors if they belong to the same
        village. In this case, <i>varname3</i> would contain the household
        indentification numbers and <i>varname2</i> would take on the village names
        or identification numbers.
<p>
    <b>gwt(</b><i>gwt_filename</i><b>)</b> requests that the generated spatial weights be written
        in sparse form to the text file <i>gwt_filename.gwt</i> for use in GeoDa.
        Prior to using the .gwt file in GeoDa, a header line containing 0,
        the number of observations, name of a shapefile, and the key variable
        should be inserted. This can be done in Notepad.
<p>
    <b>connect</b> requests that connectivity information such as sparseness,
        average number of neighbors, etc... for the created spatial weights
        be displayed.
<p>
<p>
<a name="oth_options"></a>        +---------------+
    ----+ Other Options +----------------------------------------------------
<p>
<a name="mataf"></a>    <b>mataf</b> requests that the spatial weights (and the eigenvalues if <b>eignval()</b>
        is specified) be saved to permanent Mata files. By default, the
        spatial weights matrix and its eigenvalues are created as Stata
        matrices temporarily loaded in memory. However, if size of the
        spatial weights matrix to be created or imported exceeds the matsize
        limit of your Stata flavor and option <b>mataf</b> is not specified, the
        spatial weights matrix and its eigenvalues will automatically be
        saved to Mata files. In such a case, the names suppplied with options
        <b>wname()</b> and <b>eignval()</b> will be suffixed with "_n" to avoid replacing
        existing files. For example, if you specify <b>wname(</b><i>mywght</i><b>)</b>, then the
        Mata file <i>mywght_n</i> will be created.
<p>
        <b>N.B.:</b> Unless your goal is to generate a spatial weights matrix to be
        used with <b>spatreg</b>, in which a case you should also specify <b>eignval()</b>,
        I recommend specifying option <b>mataf</b> always.
<p>
    <b>eignval(</b><i>eign_name</i><b>)</b> specifies that the spatial weights matrix eigenvalues
        be written to the <i>N x 1</i> vector or file <i>eign_name</i>.
<p>
<a name="eigv"></a>    <b>eignvar(</b><i>newvar</i><b>)</b> specifies a variable name to hold the eigenvalues.
<p>
<a name="rowst"></a>    <b>rowstand</b> requests that the spatial weights matrix be row-standardized.
        <b>spwmatrix</b> will deny this request if elements of at least one row sum
        up to zero. When this is the case, the indexes of such rows will be
        listed.
<p>
    <b>matlab(</b><i>dat_filename</i><b>)</b> specifies that the spatial weights matrix (generated
        or imported) be written to the text file <i>dat_filename.dat</i> for use in
        Matlab. To use the file in Matlab, you code:
<p>
        <b>load dat_filename.dat;</b>
<p>
        <b>W=dat_filename(:,:);</b>
<p>
    <b>replace</b> overwrites existing <i>newvar</i>, <i>dat_filename</i>, and <i>gwt_filename</i> and
        existing <i>wght_name</i> and <i>eign_name</i> if <b>mataf</b> is specified.
<p>
    <b>favor(</b><i>speed</i>|<i>space</i><b>)</b> instructs <b>spwmatrix</b> to favor speed or space when
        performing all calculations.  <b>favor(</b><i>speed</i><b>)</b> is the default. This
        option provides a tradeoff between speed and memory use. See [M-3]
        mata set.
<p>
<p>
<p>
<a name="examples"></a>        +----------+
    ----+ Examples +---------------------------------------------------------
<p>
    1) Create a row-standardized binary spatial weights matrix assuming
        spherical coordinates and a distance cut-off of 10 miles
<p>
        <b>. spwmatrix gecon latitude longitude, wn(wbin) dist(bin) db(0 10) ///</b>
          <b>r(3958.761) row</b> 
<p>
  -----------------------------------------------------------------------------
<p>
    2) Generate a spatial weights matrix under the assumptions above and save
        both the weights matrix and its eigenvalues to Mata files<i> wbin</i> and
        <i>eignwbin</i>, and export the weights matrix to the text file <i>wghtotxt.dat</i>
<p>
        <b>. spwmatrix gecon latitude longitude, wn(wbin) dist(bin) dband(0 10)</b>
        <b>///</b>
          <b>r(3958.761) rowstand eignval(eignwbin) mataf matlab(wghtotxt)</b>
<p>
  -----------------------------------------------------------------------------
<p>
    3) Generate an inverse distance squared spatial weights matrix using
        projected latitudes and longitudes
<p>
        <b>. spwmatrix gecon latitude longitude, wname(winvsq) wtype(inv) ///</b>
          <b>alpha(2) dband(0 100) cart </b>
<p>
    Here the distance cut-off unit is assumed to be the same as that of the
        projected latitudes and longitudes.
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    4) Generate an economic distance spatial weights matrix using employment
        as the economic variable
<p>
        <b>. spwmatrix gecon latitude longitude, wn(wecon) wtype(econ) ///</b>
          <b>econvar(employment) rowstand</b>
<p>
  -----------------------------------------------------------------------------
 
<p>
    5) Generate an inverse economic distance spatial weights matrix using
        income as the economic variable
<p>
        <b>. spwmatrix gecon latitude longitude, wn(winvecon) wtype(invecon)</b>
        <b>econvar(income) rowstand</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    6) Import a first order contiguity spatial weights matrix created in
        GeoDa to be used in <b>Stata</b>
<p>
        <b>. spwmatrix gal using C:\data\wcontig.gal, wname(wcontig) rowstand</b>
<p>
    Note that the gal extension is required for <b>spwmatrix</b> to locate the file.
        Also, the identifier variable supplied to GeoDa when creating the
        spatial weights should take on values ranging from 1 to N, where N is
        the number of observations.  But, the header line in the GeoDa .gal
        file needs not be removed.
<p>
  -----------------------------------------------------------------------------
<p>
    7) Import a first order contiguity spatial weights matrix created in
        GeoDa and save it to a .dat file to be used in Matlab
<p>
        <b>. spwmatrix gal using C:\data\wcontig.gal, wname(wcontig)</b>
        <b>matlab(wcontig)</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    8) Generate a row-standardized 5-nearest neighbor spatial weights matrix
<p>
        <b>. spwmatrix gecon latitude longitude, wname(wknn5) knn(5) rowstand</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    9) Generate a socio-economic spatial weights matrix
<p>
        <b>. spwmatrix socio village_id, wname(socecon_wght) row wtype(socecon)</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    10) Generate a social network spatial weights matrix (e.g., households
        are considered neighbors if they belong to the same village)
<p>
        <b>. spwmatrix socio village_id, wname(socnet_wght) wtype(socnet)</b>
        <b>idvar(hhid)</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
<a name="refs"></a><b><u>References</u></b>
<p>
<b>Anselin, L, and A. Bera</b>. 1998. "Spatial Dependence in Linear Regression Models 
&gt; with an Introduction to Spatial Econometrics." 
In A. Ullah and D.E. Giles (Eds), <i>Handbook of Applied Economic Statistics</i>. New 
&gt; York: Marcel Dekker, pp.237-89.
<p>
<b>Boarnet MG, Chalermpong S, Geho E</b>. 2006 "Specification Issues in Models of Popu
&gt; lation and Employment Growth.
<i>Papers in Regional Science</i> 84: 21–46.
<p>
<b>Fingleton. B. and J. Le Gallo</b>. 2008. "Estimating Spatial Models with Endogenous
&gt;  Variables, a Spatial Lag and Spatially
Dependent Disturbances: Finite Sample Properties ", <i>Papers in Regional Science</i> 
&gt; 87(3): 319-339. 
<p>
<b>Wikipedia</b>. 2008. <i>Earth Radius</i>. http://en.wikipedia.org/wiki/Earth_radius#Mean_r
&gt; adii.
<p>
<b>--------</b> <i>Great-Circle Distance</i>. http://en.wikipedia.org/wiki/Great-circle_dista
&gt; nce
<p>
<p>
<a name="author"></a><b><u>Author</u></b>
<p>
    <b>P. Wilner Jeanty</b>, Dept. of Agricultural, Environmental, and Development
    Economics, The Ohio State University
<p>
    Email to jeanty.1@osu.edu for any comments or suggestions.
<p>
<p>
<a name="citat"></a><b><u>Citation</u></b>
<p>
Users please cite this software as follows:
<p>
<b>Jeanty, P.W.</b>, 2010. <b>spwmatrix</b>: Stata module to create, import, and export spati
&gt; al weights. Available from http://ideas.repec.org/c/boc/bocode/s457111.html.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>nearstat</b>, <b>spwmatfill</b>, <b>splagvar</b>, <b>anketest</b>, and <b>spatwmat</b> (if
             installed)
<p>
<p>
</pre>