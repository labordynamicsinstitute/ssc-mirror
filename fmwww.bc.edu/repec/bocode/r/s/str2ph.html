<pre>
-------------------------------------------------------------------------------
help for <b>str2ph</b>, <b>str2d</b>                                          Patrick Royston
-------------------------------------------------------------------------------
<p>
<b><u>Explained variation in survival analysis</u></b>
<p>
<p>
        <b>str2ph</b> <i>survival_cmd</i> [<i>varlist</i>] [<b>if</b>] [<b>in</b>] [<b>,</b> <b><u>adj</u></b><b>ust</b> <b><u>bo</u></b><b>otreps(</b><i>#</i><b>)</b>
            <b><u>cal</u></b><b>ibrate</b> <b><u>den</u></b><b>ominator</b> <b><u>nodot</u></b><b>s</b> <b><u>off</u></b><b>set(</b><i>varname</i><b>)</b> <b><u>rand</u></b><b>omness</b>
            <b><u>val</u></b><b>idate(</b><i>varname</i><b>)</b> <i>survival_cmd_options</i> ]
<p>
        <b>str2d</b> <i>survival_cmd</i> <i>varlist</i> [<b>if</b>] [<b>in</b>] [<b>,</b> <b><u>adj</u></b><b>ust</b> <b><u>bo</u></b><b>otreps(</b><i>#</i><b>)</b> <b><u>rand</u></b><b>omness</b>
            <b><u>val</u></b><b>idate(</b><i>varname</i><b>)</b> <i>survival_cmd_options</i> ]
<p>
<p>
    where <i>survival_cmd</i> may be stcox, streg, or stpm (if installed).
<p>
    You must have <b>stset</b> your data before using <b>str2ph</b> or <b>str2d</b>.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>str2ph</b> computes Royston (2006)'s modification of O'Quigley, Xu &amp; Stare's
    (2005) modification of Nagelkerke's (1991) R-squared (R≤) statistic
    (a.k.a. coefficient of determination, proportion of explained variation)
    for proportional hazards (PH) models for censored survival data.  <b>str2ph</b>
    will also give sensible results in non-PH survival models supported by
    <b>streg</b> and <b>stpm</b>; see Royston (2006) for further information.
<p>
    <b>str2d</b> computes Royston &amp; Sauerbrei (2004)'s R≤ statistic based on their
    index of discrimination (D) for proportional hazards, proportional odds
    and probit models for censored survival data. The D measure is available
    for all <i>survival_cmd</i>s except <b>streg, distribution(gamma)</b>.
<p>
    The model is defined by
<p>
        <b>.</b> <i>survival_cmd</i> <i>varlist</i> [ <b>,</b> <i>survival_cmd_options</i> ]
<p>
<p>
    See the <b>validate()</b> option for comments on out-of-sample prediction and
    assessment of R≤ in a "validation" or test sample.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>adjust</b> computes adjusted R≤, taking into account the dimension (i.e.
        number of covariates) of the model. This may be helpful when R≤ is
        low and/or the model is very complex, since the expected value of
        R≤ under the null hypothesis (that the outcome is unrelated to the
        covariates) is greater than zero and depends on the model dimension.
        Adjustment attempts to eliminate this bias in R≤ under the null
        hypothesis.  Since R≤ calculated by out-of-sample prediction in a
        "validation" sample does not require adjustment, the <b>validate()</b>
        option is not permitted with <b>adjust</b>.
<p>
    <b>bootreps(</b><i>#</i><b>)</b> with <i>#</i> &gt; 0 computes a bootstrap confidence interval for R≤,
        using <i>#</i> bootstrap replications. A minimum reasonable value of <i>#</i> is
        1000, but a better number is 5000. Note that with <i>#</i> = 5000, the
        computation may take quite some time. The default value of <i>#</i> is 0,
        meaning no bootstrap CI is computed.  With <i>#</i> = 0 in <b>str2d</b>, an
        analytic estimate of the SE of R≤ is displayed, derived by the
        delta method from the SE of D (see Royston &amp; Sauerbrei (2004) for
        details of the SE of D).
<p>
    <b>calibrate</b> (for use only with <b>str2ph</b> ... <b>, validate()</b>) forces the survival
        regression to be re-estimated in the test sample on the index
        predicted from <i>varlist</i> in the training sample.  The default is to
        offset the predicted index and calculate R≤ via the likelihood of
        that model. Regression on the index amounts to calibration of the
        model in the test sample and may noticeably increase the R≤ value.
        See also the <b>validate()</b> option.
<p>
    <b>denominator</b> changes the denominator for the model chisquare statistic
        from k (the number of events) to n*(k/n)^alpha, where n is the sample
        size and alpha is approximately 5/6. A better value of alpha is
        required; this is work in progress. The effect of this option is to
        reduce the variation explained, particularly when the number of
        events is small.
<p>
    <b>nodots</b> suppresses display of the replication dots with bootstrap
        confidence interval estimation. By default, a single dot character is
        displayed after each 100 replications.
<p>
    <b>offset(</b><i>varname</i><b>)</b> offsets <i>varname</i> from the linear predictor. Note that
        <b>offset(</b><i>varname</i><b>)</b> without a main <i>varlist</i> is permitted. This allows the
        evaluation of a predictor 'from outside'.
<p>
    <b>randomness</b> prevents conversion of the modified Nagelkerke index of
        determination from explained randomness to explained variation. The
        reported R≤ is then interpretable, at least in PH models, as
        explained randomness.
<p>
    <b>validate(</b><i>varname</i><b>)</b> estimates the model in the subsample defined by the low
        value of <i>varname</i> and computes R≤ in the subsample defined by the
        high value of <i>varname</i>.  These subsamples may be thought of as a
        training and a test set.  <i>varname</i> must have exactly two distinct
        values in the estimation sample defined by <i>varlist</i> and <b>if</b> and <b>in</b>.
        These two values are arbitrary. <i>varname</i> may be a string variable, in
        which case lexicographic ordering is assumed. R≤ is computed
        according to the index (<b>xb</b>) predicted from the training sample (low
        value of <i>varname</i>) into the test sample (high value of <i>varname</i>). With
        <b>str2ph</b>, there is a choice between refitting the index in the test
        sample, or offsetting the index there (see the <b>calibrate</b> option).
        With <b>str2d</b>, the index predicted on the test sample is transformed to
        scaled normal scores and regression on the scores is performed. The
        slope of this regression is Royston &amp; Sauerbrei (2004)'s D statistic.
        This step is required to compute D and hence R≤. The <b>calibrate</b>
        option is not relevant to the D method, hence is not available with
        <b>str2d</b>.
<p>
    <i>survival_cmd_options</i> are options of <i>survival_cmd</i>.  Examples include
        <b>distribution(weibull)</b> for <b>streg</b>, <b>df(2) scale(hazard)</b> for <b>stpm</b>, and
        <b>strata(x1 x2)</b> for <b>stcox</b>.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. str2ph stcox x1 x2 x3</b>
    <b>. str2ph stcox x1-x20, adjust bootreps(1000)</b>
    <b>. str2ph stcox x1-x20, validate(tt) bootreps(1000)</b>
    <b>. str2ph stcox x1-x20, validate(tt) calibrate bootreps(1000)</b>
    <b>. str2ph streg x1 x2 x3, distribution(weibull)</b>
    <b>. str2ph stpm x1 x2 x3, scale(hazard) df(2)</b>
    <b>. str2ph stcox, offset(index)</b>
<p>
    <b>. str2d stcox x1 x2 x3</b>
    <b>. str2d stcox x1 x2 x3, validate(tt)</b>
    <b>. str2d streg x1 x2 x3, distribution(llogistic)</b>
    <b>. str2d stpm x1 x2 x3 if a==1, scale(odds) df(2) validate(tt)</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Patrick Royston, MRC Clinical Trials Unit, London.
    patrick.royston@ctu.mrc.ac.uk
<p>
<p>
<b><u>References</u></b>
<p>
    N. J. D. Nagelkerke. 1991. A note on a general definition of the
        coefficient of determination. Biometrika 78: 691-692.
<p>
    J. O'Quigley, R. Xu and J. Stare. 2005.  Explained randomness in
        proportional hazards models.  Statistics in Medicine 24: 479-489.
<p>
    P. Royston. 2006. Explained variation for survival models.  Stata
        Journal.
<p>
    P. Royston and W. Sauerbrei. 2004. A new measure of prognostic separation
        in survival data. Statistics in Medicine 23: 723-748.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  help for stcox, streg; stpm if installed.
</pre>