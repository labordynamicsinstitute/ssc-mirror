<pre>
-------------------------------------------------------------------------------
<b>help survsim</b>                                                                   
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>survsim</b> -- Simulate complex survival data
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>survsim</b> <i>newvarname1</i> [<i>newvarname2</i>] [<b>,</b> <i>options</i>]
<p>
<p>
    <i>options</i>                               Description
    -------------------------------------------------------------------------
      <b><u>l</u></b><b>ambdas(</b><i>numlist</i><b>)</b>                    scale parameters
      <b><u>g</u></b><b>ammas(</b><i>numlist</i><b>)</b>                     shape parameters
      <b><u>d</u></b><b>istribution(</b><b><u>e</u></b><b>xponential)</b>           exponential survival distribution
      <b><u>d</u></b><b>istribution(</b><b><u>gom</u></b><b>pertz)</b>              Gompertz survival distribution
      <b><u>d</u></b><b>istribution(</b><b><u>w</u></b><b>eibull)</b>               Weibull survival distribution
                                            (default)
      <b><u>maxt</u></b><b>ime(</b><i>#</i><b>)</b>                          administrative censoring time
      <b><u>cov</u></b><b>ariates(</b><i>vn # </i>[<i># </i>...]<i> </i>...<b>)</b>        baseline covariates
      <b>tde(</b><i>vn # </i>[<i># </i>...]<i> </i>...<b>)</b>               time-dependent effects
      <b>centol(</b><i>real</i><b>)</b>                        set the tolerance for the root
                                            finding scheme, default is 1E-08
<p>
    2-component mixture
      <b><u>mix</u></b><b>ture</b>                             simulate survival times from a
                                            2-component mixture model
      <b><u>pm</u></b><b>ix(</b><i>real</i><b>)</b>                          mixture parameter, default is 0.5
<p>
    Competing risks
      <b>cr</b>                                  simulate survival times from the
                                            all-cause distribution of
                                            cause-specific hazards
      <b>ncr(</b><i>int</i><b>)</b>                            specifies the number of competing
                                            risks
      <b><u>show</u></b><b>diff</b>                            display the maximum difference in
                                            estimates between iterations
                                            under the Newton-Raphson scheme
<p>
    User-defined [log] [cumulative] hazard function
      <b><u>logh</u></b><b>azard(</b><i>string</i><b>)</b>                   user-defined log baseline hazard
                                            function, see details
      <b><u>h</u></b><b>azard(</b><i>string</i><b>)</b>                      user-defined baseline hazard
                                            function, see details
      <b><u>logcumh</u></b><b>azard(</b><i>string</i><b>)</b>                user-defined log cumulative
                                            baseline hazard function, see
                                            details
      <b><u>cumh</u></b><b>azard(</b><i>string</i><b>)</b>                   user-defined baseline cumulative
                                            hazard function, see details
      <b>nodes(</b><i>#</i><b>)</b>                            number of Gauss-Legendre quadrature
                                            nodes, default 30
      <b><u>tdefunc</u></b><b>tion(</b><i>string</i><b>)</b>                 function of time to interact with
                                            covariates specified in <b>tde(),</b>
                                            <b>see details</b>
      <b><u>it</u></b><b>erations(</b><i>#</i><b>)</b>                       maximum number of iterations to
                                            pass to Mata function <b>mm_root()</b>
      <b><u>mint</u></b><b>ime(</b><i>#</i><b>)</b>                          minimum time for use in root
                                            finding, default 1E-08
    -------------------------------------------------------------------------
    Abbreviation: <i>vn = varname</i>
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>survsim</b> simulates survival times from parametric distributions and
    user-defined hazard functions. Distributions include the exponential,
    Gompertz and Weibull. Newton-Raphson iterations are used to generate
    survival times under cause-specific hazard models for competing risks,
    using standard parametric distributions. Non-proportional hazards can be
    included with all models; under an exponential or Weibull model
    covariates are interacted with log time, under a Gompertz model
    covariates are interacted with time. Baseline covariates can be included.
    <i>newvarname1</i> specifies the new variable name to contain the generated
    survival times. <i>newvarname2</i> is required when generating competing risks
    data to create the status indicator or when the maxtime() option is
    specified which defines the time of administrative censoring. Finally, a
    user-defined [log] [cumulative] baseline hazard function can be
    specified, in Mata code using colon operators, with survival times
    generated using a combination of Gaussian quadrature and root finding
    techniques. Complex time-dependent effects can also be specified.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>lambdas(</b><i>numlist</i><b>)</b> defines the scale parameters in the Weibull/Gompertz
        distribution(s). The number of values required depends on the model
        choice.  Default is a single number corresponding to a standard
        parametric distribution. Under a <b>mixture</b> model 2 values are required.
        Under a competing risks model, <b>cr</b>, the number of values are defined
        by <b>ncr()</b>.
<p>
    <b>gammas(</b><i>numlist</i><b>)</b> defines the shape parameters of the parametric
        distribution(s). Number of entries must be equal to that of <b>lambdas</b>.
<p>
    <b>distribution</b>(<i>string</i>) specifies the parametric survival distrubution to
        use. <b>exponential</b>, <b>gompertz</b> or <b>weibull</b> can be used, with <b>weibull</b> the
        default.
<p>
    <b>maxtime(</b><i>#</i><b>)</b> specifies an administrative censoring time. Two new varnames
        syntax must be specified, the second to contain the event indicator.
<p>
    <b>covariates(</b><i>varname # </i>[<i># </i>...]<i> </i>...<b>)</b> defines baseline covariates to be
        included in the linear predictor of the survival model, along with
        the value of the corresponding coefficient. For example a treatent
        variable coded 0/1 can be included, with a log hazard ratio of 0.5,
        by <b>covariates</b>(treat 0.5).  Variable treat must be in the dataset
        before <b>survsim</b> is run. If <b>cr</b> is used with <b>ncr(4)</b>, then a value for
        each coefficient must be inputted for each competing risk, e.g.
        <b>covariates</b>(treat 0.5 -0.2 0.1 0.25). If <b>cumhazard()</b> or <b>logcumhazard()</b>
        are used, then <b>covariates()</b> effects are additive on the log
        cumulative hazard scale.
<p>
    <b>tde(</b><i>varname # </i>[<i># </i>...]<i> </i>...<b>)</b> creates non-proportional hazards by
        interacting covariates with either log time or time under a Weibull
        or Gompertz model, respectively.  Under a user-defined [log]
        [cumulative] hazard function, covariates are interacted with
        <b>tdefunction()</b>. Values should be entered as <b>tde</b>(trt 0.5), for example.
        If <b>cumhazard()</b> or <b>logcumhazard()</b> are used, then <b>tde()</b> effects are
        additive on the log cumulative hazard scale.
<p>
        +---------------+
    ----+ Mixture model +----------------------------------------------------
<p>
    <b>mixture</b> specifies that survival times are simulated from a 2-component
        mixture model, with mixture component distributions defined by
        <b>distribution()</b>. <b>lambdas()</b> and <b>gammas()</b> must be of length 2.
<p>
    <b>pmix(</b><i>#</i><b>)</b> defines the mixture parameter. Default is 0.5.
<p>
        +-----------------+
    ----+ Competing risks +--------------------------------------------------
<p>
    <b>cr</b> specifies that survival times are simulated from the all-cause
        distribution from <b>ncr()</b> cause-specific hazards, with distributions
        defined by <b>distribution()</b>. In this case, Newton-Raphson iterations
        are used to simulate the survival times.
<p>
    <b>ncr(</b><i>#</i><b>)</b> defines the number of competing risks. <b>lambdas()</b> and <b>gammas()</b> must
        be of length <b>ncr()</b>.
<p>
        +--------------------+
    ----+ Convergence scheme +-----------------------------------------------
<p>
    <b>centol(</b><i>real</i><b>)</b> specifies the tolerance of Brent's univariate root finder or
        the Newton-Raphson scheme. Default is 1E-08.
<p>
    <b>showdiff</b> display the maximum difference in estimates between iterations
        when using the Newton-Raphson scheme. This can be used to monitor
        convergence.
<p>
        +----------------------------------------------------------+
    ----+ User defined [log] [cumulative] baseline hazard function +---------
<p>
    <b>loghazard(</b><i>string</i><b>)</b> is the user-defined log baseline hazard function. This
        must be written in Mata code using colon operators.  Time must be
        entered as #t. See examples below.
<p>
    <b>hazard(</b><i>string</i><b>)</b> is the user-defined baseline hazard function. This must be
        written in Mata code using colon operators.  Time must be entered as
        #t. See examples below.
<p>
    <b>logcumhazard(</b><i>string</i><b>)</b> is the user-defined log cumulative baseline hazard
        function. This must be written in Mata code using colon operators.
        Time must be entered as #t.
<p>
    <b>cumhazard(</b><i>string</i><b>)</b> is the user-defined baseline cumulative hazard
        function. This must be written in Mata code using colon operators.
        Time must be entered as #t.
<p>
    <b>nodes(</b><i>#</i><b>)</b> defines the number of Gauss-Legendre quadrature points used to
        evaluate the cumulative hazard function when <b>loghazard()</b> or <b>hazard()</b>.
        Default is 30. This should be increased to assess the stability of
        the simulation process.
<p>
    <b>tdefunction(</b><i>string</i><b>)</b> defines the function of time to which covariates
        specified in <b>tde()</b> are interacted with to create time-dependent
        effects. The default is #t, i.e. linear time. This must be written in
        Mata code with #t used to represent time, for example #t:^2.
<p>
    <b>iterations(</b><i>#</i><b>)</b> defines the maximum number of iterations passed to
        <b>mm_root()</b>. Default is 1000. See <b>moremata</b> for more details.
<p>
    <b>mintime(</b><i>#</i><b>)</b> defines the minimum possible simulated survival time passed to
        <b>mm_root()</b>. Default is 1E-08. See <b>moremata</b> for more details.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    When simulating from a user-defined <b>loghazard()</b> or <b>hazard()</b> function,
    numerical quadrature is used to evaluate the cumulative hazard function,
    within iterations of Brent's univariate root finder. As with all model
    frameworks which use numerical integration, it is important to assess the
    stability of the simulated survival times with an increasing number of
    quadrature nodes.
<p>
<p>
<b><u>Examples</u></b>
<p>
    Generate times from a Weibull model including a binary treatment
    variable, with log(hazard ratio) = -0.5, and censoring after 5 years:
    . set obs 1000
    . gen trt = rbinomial(1,0.5)
    . survsim stime1 died, lambdas(0.1) gammas(1.5) cov(trt -0.5) maxt(5)
    . stset stime1, f(died = 1)
    . streg trt, dist(weibull) nohr
<p>
    Generate times from a Gompertz model:
    . survsim stime2, lambdas(0.1) gammas(0.05) dist(gompertz)
<p>
    Generate times from a 2-component mixture Weibull model:
    . survsim stime3, mixture lambdas(0.1 0.05) gammas(1 1.5) pmix(0.5)
        maxtime(5)
<p>
    Generate times from a competing risks model with 4 cause-specific Weibull
    hazards and 4 cause-specific treatment effects:
    . survsim stime4 status, cr ncr(4) lambdas(0.1 0.05 0.1 0.05) gammas(0.5
        1.5 1 1.2) cov(trt 0.2 0.1 -0.1 0.4)
<p>
    Generate times from a Weibull model with diminishing treatment effect:
    . survsim stime5, lambdas(0.1) gammas(1.5) cov(trt -0.5) tde(trt 0.05)
<p>
    Generate times from user-defined log baseline hazard function:
    . survsim stime6, loghazard(-1 :+ 0.02:*#t :- 0.03:*#t:^2 :+
        0.005:*#t:^3) maxt(1.5)
<p>
    Generate times from user-defined log baseline hazard function with
    diminishing treatment effect:
    . survsim stime7 died2, loghazard(-1 :+ 0.02:*#t :- 0.03:*#t:^2 :+
        0.005:*#t:^3) cov(trt -0.5) tde(trt 0.03) maxt(1.5)
<p>
<p>
<b><u>Author</u></b>
<p>
    Michael J. Crowther
    Department of Health Sciences
    University of Leicester
    E-mail: michael.crowther@le.ac.uk
<p>
    Please report any errors you may find.
<p>
<p>
<b><u>References</u></b>
<p>
    Bender R, Augustin T and Blettner M. Generating survival times to
        simulate Cox proportional hazards models. <i>Statistics in Medicine</i>
        2005;24:1713-1723.
<p>
    Beyersmann J, Latouche A, Buchholz A and Schumacher M. Simulating
        competing risks data in survival analysis. <i>Statistics in Medicine</i>
        2009;28:956-971.
<p>
    Crowther MJ and Lambert PC (2013). Simulating biologically plausible
        complex survival data. (Under revision).
<p>
    Crowther MJ and Lambert PC. Simulating complex survival data.<i> The Stata</i>
        <i>Journal</i> 2012;12(4):674-687.
<p>
    Jann, B. 2005. moremata: Stata module (Mata) to provide various
        functions. Available from
        http://ideas.repec.org/c/boc/bocode/s455001.html.
<p>
</pre>