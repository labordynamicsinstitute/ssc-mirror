<pre>
-------------------------------------------------------------------------------
<b>help for spmlreg</b> 
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
  <b>spmlreg --- Estimates the spatial lag, the spatial error, the spatial</b>
        <b>durbin, and the general spatial models by maximum likelihood</b>
<p>
<a name="contents"></a>        +--------------------+
    ----+  Table of Contents +-----------------------------------------------
<p>
  Syntax
  General description
  Description of the options
  Saved Results
  Examples
  Acknowledgments
  Author information
  Citation
<p>
-------------------------------------------------------------------------------
<p>
<a name="syntax"></a><b><u>Syntax</u></b>
<p>
    <b>spmlreg</b> varlist<b>,</b> <b><u>w</u></b><b>eights(</b><i>weights_name</i><b>)</b> <b><u>wf</u></b><b>rom(</b><i>Stata</i>|<i>Mata</i><b>)</b> <b><u>e</u></b><b>ignvar(</b><i>varname</i><b>)</b>
        <b><u>m</u></b><b>odel(</b><i>lag</i>|<i>error</i>|<i>durbin</i>|<i>sac</i><b>)</b> [Other_options]
<p>
<p>
<p>
    <i>options</i>                       Description
    -------------------------------------------------------------------------
    Options
 
      <b><u>w</u></b><b>eights(</b><i>weights_name</i><b>)</b>       indicate the name of the spatial weights
                                    matrix to be used
<p>
      <b><u>wf</u></b><b>rom(</b><i>Stata</i>|<i>Mata</i><b>)</b>           indicate the source of the spatial weights
                                    matrix
  
      <b><u>e</u></b><b>ignvar(</b><i>varname</i><b>)</b>            indicate the name of the variable holding
                                    the eigenvalues of the weights matrix
                                    supplied with <b>weigths()</b>
<p>
      <b><u>m</u></b><b>odel(</b><i>lag</i>|<i>error</i>|<i>durbin</i>|<i>sac</i><b>)</b> indicate the model to be estimated
<p>
      <b><u>no</u></b><b>log</b>                       suppress the iteration log
<p>
      <b><u>r</u></b><b>obust</b>                      request Huber-White standard errors for the
                                    spatial lag or the spatial durbin model
<p>
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>                    specify the confidence level
<p>
      <b>favor(</b><i>speed</i>|<i>space</i><b>)</b>          favor speed or space
<p>
      <b>wrho(</b><i>name</i><b>)</b>                  indicate the name of the weights matrix to
                                    be used to generate the spatially lagged
                                    dependent variable in the <b>sac</b> model
<p>
      <b><u>eigw</u></b><b>rho(</b><i>varname</i><b>)</b>            specify the variable holding the
                                    eigenvalues of the weights matrix
                                    supplied with <b>wrho(</b><i>name</i><b>)</b>
<p>
      <b><u>initr</u></b><b>ho(</b><i>#</i><b>)</b>                  provide initial value for rho
<p>
      <b><u>initl</u></b><b>ambda(</b><i>#</i><b>)</b>               provide initial value for lambda
<p>
      <b>sr2</b>                         display goodness of fit measures for the
                                    spatial lag, the spatial durbin, and the
                                    general spatial models
<p>
      Other maximization_options  specify other maximization options
<p>
<p>
    -------------------------------------------------------------------------
<p>
<a name="description"></a>        +-------------+
    ----+ Description +------------------------------------------------------
<p>
    <b>spmlreg</b> estimates the spatial lag, the spatial error, the spatial durbin,
    and the general spatial (or spatial mixed) models by maximum likelihood.
    Optionally, at the end of the estimation process, predicted values of the
    dependent variable from the spatial lag, the spatial durbin, and the
    general spatial models are generated based on the expression for the
    conditional expectation of the reduced form since the spatially lagged
    dependent variable is endogenous.
<p>
    <b>Limitations:</b> While the sample size that can be used is not subject to the
    matsize limit of your Stata flavor, unless you are running <b>Small Stata</b>,
    model estimation using huge datasets may be hampered by memory limitation
    since sparse matrix operations are not yet allowed in Mata. However, as
    long as you can generate a spatial weights matrix and a variable holding
    the eigenvalues using spwmatrix, <b>spmlreg</b> will dutifully estimate a model
    for you.
<p>
    <b>Dependency:</b> <b>spmlreg</b> relies heavily on splagvar which must be installed.
<p>
<p>
<a name="options"></a>        +------------------+
    ----+ Required options +-------------------------------------------------
<p>
    <b>weights(</b><i>weights_name</i><b>)</b> specifies the name of the spatial weights matrix to
        be used in the estimation.
<p>
    <b>wfrom(</b>Stata | Mata<b>)</b> indicates whether the spatial weights matrix is from
        Stata or Mata. If the spatial weights matrix is from Mata, the file
        should be located in the working directory.  A spatial weights matrix
        created using spwmatrix should exist as a Stata matrix loaded in
        memory or as a Mata file.
<p>
    <b>eignvar(</b><i>varname</i><b>)</b> indicates the name of the variable holding the
        eigenvalues of the weights matrix supplied with <b>weigths()</b>.  This
        variable must have been generated using the eignvar() option of the
        <b>spwmatrix</b> command. Make sure the spatial weights matrix is
        row-standardized.
<p>
    <b>model(</b><i>lag</i>|<i>error</i>|<i>durbin</i>|<i>sac</i><b>)</b> indicates the type of spatial model to be
        estimated. <b>model(</b><i>lag</i><b>)</b> estimates the spatial lag model, <b>model(</b><i>error</i><b>)</b>
        estimates the spatial error model, <b>model(</b><i>durbin</i><b>)</b> estimates the
        spatial durbin model, and <b>model(</b><i>sac</i><b>)</b> estimates the general spatial
        (or spatial mixed) model allowing for both lag and error
        autocorrelation.
<p>
<p>
<a name="other_options"></a>        +------------------+
    ----+ Optional options +-------------------------------------------------
<p>
    <b>log</b> and <b>nolog</b> specify whether an iteration log showing the progress of
        the log likelihood is to be displayed.  The log is displayed by
        default, and nolog suppresses it.
<p>
    <b>robust</b> requests Huber-White standard errors for the spatial lag and the
        spatial durbin models.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, in percent, for confidence
        intervals. The default is level(95) or as set by set <b>level()</b>.
<p>
    <b>favor(</b><i>speed</i>|<i>space</i><b>)</b> instructs <b>spmlreg</b> to favor speed or space when
        calculating several underlying spatially lagged variables.
        <b>favor(</b><i>speed</i><b>)</b> is the default. This option provides a tradeoff between
        speed and memory use. See [M-3] mata set.
<p>
    <b>wrho(</b><i>name</i><b>)</b> indicates the name of the spatial weights matrix to be used
        when generating the spatially lagged dependent variable in the <b>sac</b>
        model.  By default, the spatial weights matrix supplied with <b>wname()</b>
        is used for both the spatially lagged dependent variable and the
        spatially lagged disturbances, although there may be identification
        problems. The two spatial weights must be of the same source, as
        indicated with <b>wfrom()</b>.
<p>
    <b>eigwrho(</b><i>varname</i><b>)</b> specifies the variable holding the eigenvalues of the
        weights matrix supplies with <b>wrho()</b>.
<p>
        <b>Note 1:</b> Options <b>wrho()</b> and <b>eigwhro()</b> are necessary when you want to
        estimate the general spatial model with different spatial weights for
        the autoregressive lag and the autoregressive error terms. When these
        two options are not specified, <b>spmlreg</b> uses the same spatial weights
        matrix for both the autoregressive lag and the autoregressive error
        terms (see examples below).
<p>
    <b>initrho(</b><i>#</i><b>)</b> provides initial value for rho. The default is <b>initrho(</b><i>0</i><b>)</b>.
<p>
    <b>initlambda(</b><i>#</i><b>)</b> provides initial value for lambda. The default is
        <b>initlambda(</b><i>0</i><b>)</b>.
<p>
        <b>Note 2:</b> You should rarely have to specify <b>initrho(</b><i>#</i><b>)</b> and
        <b>initlambda(</b><i>#</i><b>)</b>
<p>
    <b>sr2</b> requests that goodness of fit measures for the spatial lag, the
        spatial durbin, and the general spatial models be displayed.  When
        this option is specified, two goodness of fit measures are reported.
        The first one is computed as the squared correlation between the
        predicted and observed values of the dependent variable. The other
        one is calculated as the ratio of the variance of the predicted
        values to the variance of the observed values of the dependent
        variable. As stressed above, for the spatial lag, the spatial durbin,
        and the general spatial models, <b>spmlreg</b> generates the predicted
        values from the expression for the conditional expectation of the
        reduced form:
<p>
            <b>y_hat = E(y|x) = (I-rho_hat*W)^-1 * X*beta_hat</b>
<p>
<p>
        By default, goodness of fit measures are calculated when you specify
        <b>model(</b><i>error</i><b>)</b>. Note also that predicted values for the dependent
        variable in the spatial error model can be obtained using the predict
        command after estimation:
 
            <b>. predict y_hat</b>
<p>
    Other maximization_options allows the user to specify other maximization
        options (e.g., difficult, trace, iterate(#), constraint(#), etc.).
        However, you should rarely have to specify them, though they may be
        helpful if parameters approach boundary values.
<p>
<a name="results"></a>        +---------------+
    ----+ Saved Results +----------------------------------------------------
<p>
Depending on the model estimated, <b>spmlreg</b> saves the following results in <b>e()</b>:
<p>
Scalars        
   <b>e(N)</b>              number of observations
   <b>e(k)</b>              number of parameters
   <b>e(k_eq)</b>           number of equations 
   <b>e(k_eq_model)</b>     number of equations to include in a model Wald test 
   <b>e(k_dv)</b>           number of dependent variables 
   <b>e(df_m)</b>           model degrees of freedom
   <b>e(ll)</b>             log likelihood for the current model
   <b>e(ll_0)</b>           log likelihood for OLS
   <b>e(chi2)</b>           chi-squared 
   <b>e(p)</b>              significance of model of test 
   <b>e(ic)</b>             number of iterations 
   <b>e(rank)</b>           rank of e(V)
   <b>e(rank0)</b>          rank of e(V) for OLS
   <b>e(rc)</b>             return code 
   <b>e(converged)</b>      1 if converged, 0 otherwise 
   <b>e(varRatio)</b>       variance ratio of predicted to observed values of the depe
&gt; ndent variable
   <b>e(sqCorr)</b>         squared correlation between predicted and observed values 
&gt; of the dependent variable
   <b>e(wald_durbin)</b>    Wald test for the coefficients on the lags of X's
   <b>e(p_durbin)</b>       p-value for the Wald test on the coefficients on lags of X
&gt; 's
   <b>e(Wald)</b>           Wald test for rho or lambda equal to zero
   <b>e(maxEigen)</b>       Maximum eigenvalue
   <b>e(minEigen)</b>       minimum eigenvalue
<p>
Macros         
   <b>e(cmd)</b>            name of the command
   <b>e(cmdline)</b>        command as typed
   <b>e(depvar)</b>         name of the dependent variable
   <b>e(pred_y)</b>         predicted values of dependent variable from the lag, durbi
&gt; n, and sac models
   <b>e(title)</b>          title in estimation output
   <b>e(chi2type)</b>       Wald or LR; type of model chi-squared test
   <b>e(vce)</b>            vcetype specified in vce()
   <b>e(vcetype)</b>        title used to label Std. Err.
   <b>e(opt)</b>            type of optimization
   <b>e(ml_method)</b>      type of ml method by commands using ml
   <b>e(user)</b>           name of likelihood-evaluator program
   <b>e(technique)</b>      from technique() option
   <b>e(crittype)</b>       optimization criterion
   <b>e(properties)</b>     estimator properties
   <b>e(wname)</b>          name of the spatial weights matrix
   <b>e(wfrom)</b>          source of the main spatial weights matrix: Mata or Stata
<p>
Matrices       
   <b>e(b)</b>              coefficient vector
   <b>e(V)</b>              variance-covariance matrix of the estimators
   <b>e(gradient)</b>       gradient vector 
   <b>e(ilog)</b>           iteration log (up to 20 iterations); 
<p>
Functions      
   <b>e(sample)</b>         marks estimation sample
<p>
<p>
<a name="examples"></a>        +----------+
    ----+ Examples +---------------------------------------------------------
<p>
    Load the Columbus crime dataset
<p>
        . use http://fmwww.bc.edu/repec/bocode/c/columbus_dataset, clear
<p>
    Import the first order contiguity spatial weights matrix, columbus.gal,
        created in GeoDa
<p>
        . spwmatrix gal using
        http://fmwww.bc.edu/repec/bocode/c/columbus.gal, wn(W)
        eignvar(eigvarW) row mataf
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    1) Estimate the spatial lag model
<p>
        . spmlreg crime inc hoval, weights(W) wfrom(Mata) eignvar(eigvarW)
        model(lag) sr2
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    2) Estimate the spatial error model
<p>
        . spmlreg crime inc hoval, weights(W) wfrom(Mata) eignvar(eigvarW)
        model(error)
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    3) Estimate the spatial durbin model
<p>
        . spmlreg crime inc hoval, weights(W) wfrom(Mata) eignvar(eigvarW)
        model(durbin) sr2
<p>
  -----------------------------------------------------------------------------
<p>
    4) Estimate the general spatial model: <b>y = rho*W*y + X*b + u, where u =</b>
        <b>lambda*W*u + e</b>
<p>
        . spmlreg crime inc hoval, weights(W) wfrom(Mata) eignvar(eigvarW)
        model(sac) sr2
<p>
  -----------------------------------------------------------------------------
<p>
<p>
    Create an inverse distance squared spatial weights matrix with a cutoff
        distance of 5 to be used for the lag autocorrelation
<p>
        . spwmatrix gecon y x, wn(W1) cart rowstand wtype(inv) alpha(2)
        dband(0 5) eignvar(eigvarW1) mataf
<p>
<p>
    5) Estimate the general spatial model: <b>y = rho*W1*y + X*b + u, where u =</b>
        <b>lambda*W*u + e</b>
<p>
        . spmlreg crime inc hoval, weights(W) wfrom(Mata) eignvar(eignvarW)
        model(sac) wrho(W1) eigwrho(eigvarW1) sr2
<p>
  -----------------------------------------------------------------------------
<p>
    <b>Note 3</b>: For the Columbus crime dataset, <b>spwmatrix</b> can generate the
        weights matrix and the eigenvalues vector needed in order to use
        <b>spatreg</b>. You need to specify option <b>eignval()</b> and remove option
        <b>mataf</b>.
<p>
<p>
<a name="acknow"></a><b><u>Acknowledgments</u></b>
<p>
Thanks to Maurizio Pisati for writing <b>spatreg</b>. Thanks to Mark E. Schaffer for s
&gt; uggesting that I write <b>spmlreg</b> and for commenting on the first version.
<p>
<p>
<a name="author"></a><b><u>Author</u></b>
<p>
    <b>P. Wilner Jeanty</b>, Dept. of Agricultural, Environmental, and Development
    Economics, The Ohio State University
<p>
    Email to jeanty.1@osu.edu for any comments or suggestions.
<p>
<p>
<a name="cit"></a><b><u>Citation</u></b>
<p>
Users should please cite <b>spmlreg</b> as follows:
<p>
Jeanty, P.W., 2010. <b>spmlreg</b>: Stata module to estimate the spatial lag, the spat
&gt; ial error, the spatial durbin, and the general spatial models.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>spatreg</b>, <b>sarml</b>, <b>spreg</b> (if installed)
<p>
<p>
</pre>