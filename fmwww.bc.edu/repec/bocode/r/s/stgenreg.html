<pre>
-------------------------------------------------------------------------------
<b>help stgenreg</b>                                 also see: <b>stgenreg postestimation</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>stgenreg</b> -- General parametric survival models
<p>
<b><u>Syntax</u></b>
<p>
        <b>stgenreg</b> [<i>if</i>] [<i>in</i>] [<b>,</b> <i>options</i>]
<p>
<p>
<a name="options"></a>    <i>options</i>                        Description
    -------------------------------------------------------------------------
    Model
      <b><u>loghaz</u></b><b>ard(</b><i>string</i><b>)</b>            user-defined log baseline hazard function
      <b><u>haz</u></b><b>ard(</b><i>string</i><b>)</b>               user-defined baseline hazard function
      <b><u>bhaz</u></b><b>ard(</b><i>varname</i><b>)</b>             invokes relative survival models, defining
                                     the expected hazard rate at the time of
                                     event
      <b>eq_name(</b><i>string</i><b>)</b>              specify the components to include in the
                                     linear predictor of each parameter
<p>
    Reporting
      <b><u>showcomp</u></b><b>onent</b>                display each parsed component specified in
                                     <b>cov#</b>
      <b><u>matalogh</u></b><b>azard</b>                display the log hazard function passed to
                                     Mata
      <b><u>matak</u></b><b>eep</b>                     do not drop data from Mata after fitting a
                                     model
      <b>eform</b>                        exponentiate coefficients of first <b>ml</b>
                                     equation}
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>                     set confidence level; default is <b>level(95)</b>
<p>
    Maximization options
      <b>nodes(</b><i>#</i><b>)</b>                     number of quadrature nodes
      <b>search(</b><i>string</i><b>)</b>               search option to pass to <b>ml</b>
      <b>initmat(</b><i>matrix_name</i><b>)</b>         matrix of initial values to pass to <b>ml</b>
      <b>copy</b>                         parameters in the initial values matrix
                                     are entered by position
      <b>skip</b>                         any parameters found in initial values
                                     matrix but not in model are skipped
      <b>nolog</b>                        suppress display of log-likelihood
                                     iteration log
      <i>maximize_options</i>             control the maximization process; seldom
                                     used
    -------------------------------------------------------------------------
    You must <b>stset</b> your data before using <b>stgenreg</b>; see <b>[ST] stset</b>.
    <b>fweights</b>, <b>iweights</b>, and <b>pweights</b> may be specified using stset; <b>[ST]</b>
      <b>stset</b>.
    Factor variables are not currently supported.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>stgenreg</b> fits parametric survival models using any user-defined [log]
    baseline hazard fuction. Gaussian quadrature is used to evaluate the
    cumulative hazard function and consequently the survival function
    allowing the estimation of a parametric survival model with almost any
    form. The [log] hazard function must be written in Mata code using colon
    operators. Each parameter defined in a [log] hazard function can include
    components, whereby each component can contain variables, user-defined
    functions of time, restricted cubic spline functions and/or fractional
    polynomial functions. Time-dependent effects can be included in any
    component. Relative survival models can also be fitted.
<p>
<p>
<b><u>Options</u></b>
<p>
        +-------+
    ----+ Model +------------------------------------------------------------
<p>
    <b>loghazard(</b><i>string</i><b>)</b> is the user-defined log baseline hazard function. This
        must be written in Mata code using colon operators.  Each parameter
        must be identified in square brackets, for example [xb]. Time must be
        entered as #t.
<p>
    <b>hazard(</b><i>string</i><b>)</b> is the user-defined baseline hazard function. This must be
        written in Mata code using colon operators.  Each parameter must be
        identified in square brackets, for example [xb]. Time must be entered
        as #t.
<p>
    <b>bhazard(</b><i>varname</i><b>)</b> defines the expected hazard rate at the time of event,
        used in relative survival or cure models. The timescale units used to
        generate this variable must be the same as the units of <b>_t</b>.
<p>
    <b>eq_name(</b><i>string</i><b>)</b> specifies the components to be included in the linear
        predictor of each parameter. Components must be split by <b>|</b>, for
        example, <b>eq_name(</b><i>comp1</i><b> | </b><i>comp2</i><b> | </b><i>comp3</i><b>)</b>. Each component can be one of
        the following:
<p>
            <i>varlist</i> [,<b>nocons</b>]: the user may specify a standard variable list
                within a component section, with an optional <b>nocons</b> option
<p>
            g(#t): where g() is any user defined function of #t written in
                Mata code, for example #t:^2
<p>
            #rcs(<i>options</i>): which creates restricted cubic splines of either
                log time or time. <i>options</i> include <b>df(#)</b>, the number of
                degrees of freedom, <b>noorthog</b> which turns off the default
                orthogonalisation, <b>time</b>, which creates splines using time
                rather than log time, the default, and <b>offset(varname)</b>, which
                includes an offset variable. See rcsgen for more details.
<p>
            #fp(<i>numlist</i> [,<b>offset(</b><i>varname</i><b>)</b>]): which creates fractional
                polynomials of time. If 0 is specified, log time is
                generated. If <b>offset()</b> is specified an offset variable is
                added to <b>_t</b> before generating the fractional polynomials.
<p>
            <i>varname</i>:*f(#t): to include time-dependent effects, where f(#t) is
                one of #rcs(), #fp() or g().
<p>
        +-----------+
    ----+ Reporting +--------------------------------------------------------
<p>
    <b>showcomponent</b> display each parsed component specified in the <b>eq_name</b>
        options. This is useful to check that <b>stgenreg</b> has correctly parsed
        the options.
<p>
    <b>mataloghazard</b> display the log hazard function passed to Mata. This is
        useful to check that <b>stgenreg</b> has correctly parsed the log hazard
        function.
<p>
    <b>matakeep</b> do not drop the data from Mata following a model fit. By
        default, all data passed to Mata is dropped.
<p>
    <b>eform</b> exponentiate the coefficients of the first <b>ml</b> equation.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, as a percentage, for confidence
        intervals.  The default is <b>level(95)</b> or as set by <b>set level</b>.
<p>
        +--------------+
    ----+ Maximization +-----------------------------------------------------
<p>
    <b>nodes(</b><i>#</i><b>)</b> defines the number of Gauss-Legendre quadrature points used to
        evaluate the cumulative hazard function in the maximisation process.
        Must be an integer &gt; 2, with default 15.
<p>
    <b>search(</b><i>string</i><b>)</b> search option to pass to <b>ml</b>.
<p>
    <b>initmat(</b><i>matrix_name</i><b>)</b> passes a matrix of initial values.
<p>
    <b>copy</b> pass initial values by position rather than name.
<p>
    <b>skip</b> any parameters found in the initial values matrix but not in model
        are skipped.
<p>
<a name="maximize_options"></a>    <i>maximize_options</i>; <b><u>dif</u></b><b>ficult</b>, <b><u>tech</u></b><b>nique(</b><i>algorithm_spec</i><b>)</b>, <b><u>iter</u></b><b>ate(</b><i>#</i><b>)</b>,
        [<b>no</b>]<b><u>lo</u></b><b>g</b>, <b><u>tr</u></b><b>ace</b>, <b><u>grad</u></b><b>ient</b>, <b>showstep</b>, <b><u>hess</u></b><b>ian</b>, <b><u>shownr</u></b><b>tolerance</b>,
        <b><u>tol</u></b><b>erance(</b><i>#</i><b>)</b>, <b><u>ltol</u></b><b>erance(</b><i>#</i><b>)</b> <b><u>gtol</u></b><b>erance(</b><i>#</i><b>)</b>, <b><u>nrtol</u></b><b>erance(</b><i>#</i><b>)</b>,
        <b><u>nonrtol</u></b><b>erance</b>, <b>from(</b><i>init_specs</i><b>)</b>; see <b>[R] maximize</b>.  These options are
        seldom used, but the <b>difficult</b> option may be useful if there are
        convergence problems.
<p>
<p>
<b><u>Remark</u></b>
<p>
    Note: As with all models which use numerical integration, the stability
    of maximum likelihood estimates should be established by using an
    increasing number of quadrature nodes.
<p>
<p>
<b><u>Example</u></b>
<p>
    Setup
        webuse brcancer
        stset rectime, failure(censrec = 1) scale(365.25)
<p>
    Weibull proportional hazards model
        stgenreg, loghazard([ln_lambda] :+ [ln_gamma] :+
            (exp([ln_gamma])-1):*log(#t)) ln_lambda(hormon)
<p>
    Restricted cubic splines on the log hazard scale
        stgenreg, loghazard([xb]) xb(hormon | #rcs(df(5)))
<p>
    FP3 model
        stgenreg, loghazard([xb]) xb(hormon | #fp(0 1 2))
<p>
    Restricted cubic splines on the log hazard scale, with time-dependent
    effect
        stgenreg, loghazard([xb]) xb(hormon | #rcs(df(5)) |
            hormon:*#rcs(df(3)))
<p>
<b><u>Authors</u></b>
<p>
    Michael J. Crowther
    Department of Health Sciences
    University of Leicester
    E-mail: michael.crowther@le.ac.uk
<p>
    Paul C. Lambert
    Department of Health Sciences
    University of Leicester
    E-mail: paul.lambert@le.ac.uk
<p>
    Please report any errors you may find.
<p>
<p>
<b><u>References</u></b>
<p>
    Crowther MJ and Lambert PC. stgenreg: A Stata package for general
    parametric survival analysis.<i>  Journal of Statistical Software</i> 2013; (To
    Appear).
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>stgenreg postestimation</b>
</pre>