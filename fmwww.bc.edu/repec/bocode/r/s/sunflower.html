<pre>
-------------------------------------------------------------------------------
help for <b>sunflower</b>
-------------------------------------------------------------------------------
<p>
<b><u>Density distribution sunflower plots</u></b> 
<p>
  <b>sunflower</b> <i>yvar</i> <i>xvar</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [, <b><u>bi</u></b><b>nwidth(</b><i>#d</i><b>)</b> <b><u>xc</u></b><b>enter(</b><i>#x</i><b>)</b>
          <b><u>yc</u></b><b>enter(</b><i>#y</i><b>)</b> <b><u>li</u></b><b>ght(</b><i>#a</i><b>)</b> <b><u>da</u></b><b>rk(</b><i>#b</i><b>)</b> <b><u>pe</u></b><b>talweight(</b><i>#w</i><b>)</b> <b><u>po</u></b><b>intsize(</b><i>#</i><b>)</b>
          <b><u>lights</u></b><b>ize(</b><i>#</i><b>)</b> <b><u>darks</u></b><b>ize(</b><i>#</i><b>)</b> <b><u>do</u></b><b>tsize(</b><i>#</i><b>)</b> <b><u>ba</u></b><b>ckground(</b><i>#</i><b>)</b> <b><u>sa</u></b><b>ving(</b><i>filename</i> [<b>,</b>
          <b>replace</b>]<b>)</b> <b><u>xs</u></b><b>ize(</b><i>#</i><b>)</b> <b><u>ys</u></b><b>ize(</b><i>#</i><b>)</b> <b><u>notab</u></b><b>le</b> <b><u>noke</u></b><b>y</b> <i>graph_options</i> ]
<p>
<p>
<b><u>Description</u></b>
<p>
<b>sunflower</b> draws density distribution sunflower plots (Dupont and Plummer 2002).
These plots are useful for displaying bivariate data whose density is too great
for conventional scatter plots to be effective.  A sunflower is a number of
line segments of equal length, called petals, that radiate from a central
point.  There are two varieties of sunflowers: light and dark.  Each petal of a
light sunflower represents one observation.  Each petal of a dark sunflower
represents a specific number of observations specified by the user.  The
program uses dark and light sunflowers to represent high and medium density
regions of the data, and dots or circles to represent individual observations
in low density regions.
<p>
The program first divides the plane defined by the variables <i>yvar</i> and <i>xvar</i> into
contiguous regular hexagonal bins of equal size.  The width of each bin is
given by <i>#d</i> and is specified in the same units as <i>xvar</i>.  The program then
counts the number of data points that fall within each bin.  The user specifies
three values, <i>#a</i>, <i>#b</i>, and <i>#w</i>, that specify how these points are to be
represented:
<p>
1. When there are fewer than <i>#a</i> points in a bin, they are displayed as
   individual dots or circles as in a conventional scatter plot.
<p>
2. When there are at least <i>#a</i> but fewer than <i>#b</i> points in a bin they are
   represented by a light sunflower.
<p>
3. When there are <i>#b</i> or more points in a bin they are represented by a dark
   sunflower.  <i>#w</i> specifies the number of observations represented by each
   petal of a dark sunflower.  More precisely, if a dark sunflower bin contains
   <i>n</i> points then the number of petals on its sunflower will equal <i>n</i> / <i>#w</i>
   rounded to the nearest integer.  A sunflower with one petal is represented
   by a dot in the center of its bin.
<p>
   
<b><u>Running </u></b><b><u>sunflower</u></b><b><u> Under Stata Versions 7 and 8</u></b>
<p>
This program was written to run under Stata version 7.  We recommend that it
only be used by people running version 7.  Stata Corp has released a new
version of this program that runs under version 8.  Their program includes
numerous enhancements over our original program including hexagonal bin
shading, the ability to overlay additional curves on the sunflower plot, and
other graph options that have been added to version 8 programs.  To use their
program you must be running Stata Version 8.2 or later.  Type
<p>
    . help sunflower
<p>
in the version 8 Stata Command window for further details.
<p>
<b><u>Remarks</u></b> 
<p>
<b>sunflower</b> uses pens 1 through 6.  Pen 1 draws and labels the axes of the graph.
Pen 2 draws the circles or dots for individual data points.  Pens 3 and 5 draw
the light and dark sunflowers, respectively.  Pens 4 and 6 draw circular
colored backgrounds behind the light and dark sunflowers, respectively.  The
user should choose the color and thickness of pens 3 through 6 to distinguish
between light and dark sunflowers.  Pens 4 and 6 give additional weight and
contrast to the light and dark sunflowers.  Note that pens 3 and 4 must have
different colors in order for petals on light sunflowers to be visible.
Similarly, pens 5 and 6 must also have different colors.  We recommend that
pens 3 through 6 be chosen so that the color darkness increases with increasing
data density.  An example, called fig2.do, is given below which makes
reasonable choices for these pen colors.
<p>
Frequency weights may be specified.
<p>
All sunflowers should lie entirely above the <i>x</i> axis and to the right of the <i>y</i>
axis.  If you choose a small bin width, or use the default bin width, this
should occur automatically.  With a large bin width and a cluster of points
near an axis, it is possible for a sunflower to intersect the edge of the graph
window.  When this happens an error message occurs.  The problem can be fixed
by using the <b>xlabel</b> and <b>ylabel</b> options to ensure that no sunflower touches an
axis.
<p>
<p>
<b><u>Options</u></b>
 
<b>binwidth(</b><i>#d</i><b>)</b> sets the horizontal width of each bin to <i>#d</i>.  This width is
    specified in the same units as <i>xvar</i>.  The default bin width is set to equal
    (max of <i>xvar</i> - min of <i>xvar</i>) / 40.  The bin height in units of <i>yvar</i> is
    determined by the program and depends on the bin width, the aspect ratio of
    the <i>x</i> and <i>y</i> axes, the range of values observed for <i>xvar</i> and <i>yvar</i>, and the
    aspect ratio of the graph window.  Note that the shape of the bins is
    always that of a regular hexagon.
<p>
<b>xcenter(</b><i>#x</i><b>)</b> and <b>ycenter(</b><i>#y</i><b>)</b> specify the center of a bin to be at (<i>#x</i>, <i>#y</i>).  The
    default values of <i>#x</i> and <i>#y</i> are the median values of <i>xvar</i> and <i>yvar</i>,
    respectively.  The centers of the other bins are implicitly defined by (<i>#x</i>,
    <i>#y</i>) together with the bin width <i>#d</i>.
<p>
<b>light(</b><i>#a</i><b>)</b> specifies <i>#a</i> to be the minimum number of points needed in a bin to
    generate a light sunflower.  The default value of <i>#a</i> is 3.
<p>
<b>dark(</b><i>#b</i><b>)</b> specifies <i>#b</i> to be the minimum number of points needed in a bin to
    generate a dark sunflower.  The default value of <i>#b</i> is 13.
<p>
<b>petalweight(</b><i>#w</i><b>)</b> specifies <i>#w</i> to be the number of observations represented by
    each petal of a dark sunflower.  The default value of <i>#w</i> is chosen so that
    the maximum number of petals on a dark sunflower equals 14.
<p>
<b>pointsize(</b><i>#</i><b>)</b> specifies the size of the circle representing individual points as
    a percent of the default size.  The default is 100 percent.
<p>
<b>lightsize(</b><i>#</i><b>)</b> specifies the size of the light sunflowers as a percent of the
    maximum permitted size, which is <i>#d</i> / 2.  The default is 80 percent, which
    produces light sunflower petals of length 0.8 * <i>#d</i> / 2.
<p>
<b>darksize(</b><i>#</i><b>)</b> specifies the size of the dark sunflowers as a percent of the
    maximum permitted size, which is <i>#d</i> / 2.  The default is 97.5 percent,
    which produces dark sunflower petals of length 0.95 * <i>#d</i> / 2.
<p>
<b>dotsize(</b><i>#</i><b>)</b> specifies the size of the dot drawn at the center of each sunflower
    as a percent of the default size.  The default is 100 percent.
<p>
<b>background(</b><i>#r</i><b>)</b> sets the size of the colored circular background behind
    sunflowers as a number between 0 and 1.  The default is 1, in which case
    the edge of each background passes through the vertices of its bin.  When
    <i>#r</i> = 0 the edge of each background kisses the edges of its bin.  Let <i>r0</i>
    denote the background radius when <i>#r</i> = 0 and let <i>r1</i> denote this radius when
    <i>#r</i> = 1.  Then <i>r0</i> = <i>#d</i> / 2 and <i>r1</i> = <i>r0</i> / cos(pi / 6).  In general, this
    radius equals <i>r0</i> + (<i>#r</i>) * (<i>r1 - r0</i>).
<p>
<b>saving(</b><i>filename</i><b> [, replace])</b> saves the graph in a file.  If you do not specify
    an extension, <b>.gph</b> will be assumed.
<p>
<b>xsize(</b><i>#</i><b>)</b> specifies the width, in inches, of the graph image.  The default is
    the current Stata default size in effect when <b>sunflower</b> is called.
<p>
<b>ysize(</b><i>#</i><b>)</b> specifies the height, in inches, of the graph image.  The default is
    the current Stata default size in effect when <b>sunflower</b> is called.
<p>
<b>notable</b> specifies that the summary table produced by the <b>sunflower</b> command be
    omitted.
<p>
<b>nokey</b> causes the sunflower key at the top of the graph to be omitted.
<p>
<i>graph_options</i> are the same as those allowed for scatter plots with the <b>graph</b>
    command, except that the <b>connect()</b>, <b>symbol()</b>, <b>pen()</b>, <b>trim()</b>, <b>psize()</b>,
    <b>bands()</b>, and <b>jitter()</b> options may not be used.
<p>
<p>
<b><u>Examples</u></b>
<p>
    . sunflower mpg displ
<p>
    . sunflower mpg displ, xc(100) yc(100) binwid(10)
<p>
    . sunflower mpg weight, binwid(300) xlab ylab petal(2) light(3) dark(15)
<p>
    ---- fig2.do ---------------------------
    log using "fig2.log", replace
    *
    * fig2.do
    *
    * N.B.  The gprefs statements given below will
    * override your Custom 1 color settings!
    *
    * This is a Stata program that produces figure 2 from
    *
    * Dupont WD and Plummer WD Jr. (2002) "Density Distribution Sunflower
        Plots"
    * Submitted for publication. URL pending.
    *
    *
    use
        "http://www.mc.vanderbilt.edu/prevmed/wddtext/data/2.20.Framingham.dta"
        &gt; , clear
    *
    * Drop ten extreme outliers.
    *
    drop if bmi&gt;55
    *
    * Color choices for custom1
    *
    * The following color choices attempt to make an analogy between data
        density
    * and a topographical map of an island in the sea.  Hence individual data
        points
    * are blue (the sea), light sunflowers are brown on green (low altitude
        verdant
    * regions), and dark flowers are black on brown (high altitude rocky
        areas).
    *
    *    Pen Color        hue  sat  lum:  red green blue
    *    -----------------------------------------------
    *    1   black:              0    0:    0     0    0
    *    2   true blue:   160  240  120:    0     0  255
    *    3   dark brown:   20  240   60:  128    64    0
    *    4   light green:  50  240  200:  234   255  170
    *    5   black:              0    0:    0     0    0
    *    6   light brown:  20  240  120:  255   128    0
    *
    * All pen widths are 9
    * Background color is white
    * Graph size is 6 x 4 inches
    *
    * Define color scheme custom1 as specified above
    *
    gprefs set window scheme custom1
    gprefs set custom1 background_color 255 255 255
    gprefs set custom1 pen1_color 0 0 0
    gprefs set custom1 pen2_color 0 0 255
    gprefs set custom1 pen3_color 128 64 0
    gprefs set custom1 pen4_color 234 255 170
    gprefs set custom1 pen5_color 0 0 0
    gprefs set custom1 pen6_color 255 128 0
    gprefs set custom1 pen1_thick 9
    gprefs set custom1 pen2_thick 9
    gprefs set custom1 pen3_thick 9
    gprefs set custom1 pen4_thick 9
    gprefs set custom1 pen5_thick 9
    gprefs set custom1 pen6_thick 9
    gprefs set window xsize 6
    gprefs set window ysize 4
    *
    * Draw sunflower plot of diastolic blood pressure by body mass index
    * using the Framingham data (Levy 1999).
    *
    sunflower dbp bmi, bin(.85) xlabel(20 25 to 50) ylabel(50 70 to 150) gap(3)
    log off
    ---- end fig2.do -----------------------
<p>
<p>
<b><u>Authors</u></b>
<p>
    This program was designed by William D. Dupont and W. Dale Plummer Jr.  It
    was written by W. Dale Plummer Jr.
<p>
    It may be downloaded together with documentation from
    http://ideas.repec.org/c/boc/bocode/s430201.html.
<p>
    Address: Division of Biostatistics
             S-2323 Medical Center North
             Vanderbilt University School of Medicine
             Nashville TN, 37232-2158
<p>
    E-mail: william.dupont@vanderbilt.edu
            dale.plummer@vanderbilt.edu
<p>
    URL: http://www.mc.vanderbilt.edu/prevmed/biostatistics.htm
<p>
 
<b><u>Acknowledgements</u></b> 
<p>
The <b>sunflower</b> program is based, in part, on public domain code found in the
program <b>flower</b> (Steichen and Cox 1999).  We thank these authors for making
their code available.
<p>
We also thank Nicholas J. Cox for converting our help file to SMCL and for some
helpful edits.
<p>
We are most grateful to Jeff Pitblado and Stata Corp for releasing the version
8.2 edition of this program.  Jeff has completely rewritten the graphics part
of the program to run under version 8.
<p>
<p>
<b><u>References</u></b>
<p>
Carr, D.B., Littlefield, R.J., Nicholson, W.L., and Littlefield, J.S.  (1987)
Scatterplot matrix techniques for large N.  <i>Journal of the American Statistical</i>
<i>Association</i>, 82: 424-436.
<p>
Cleveland, W.S. and McGill, R. (1984) The many faces of a scatterplot.  <i>Journal</i>
<i>of the American Statistical Association</i>, 79: 807-822.
<p>
Dupont, W.D. and Plummer W.D. Jr. (2003) Density distribution sunflower plots.
<i>Journal of Statistical Software</i>, 8:(3) 1-11. Downloadable from
http://www.jstatsoft.org/index.php?vol=8.  Accessed January 23, 2003.
<p>
Dupont, W.D. and Plummer, W.D. Jr. (2002) sunflower: Stata module to draw
density distribution sunflower plots.  Stata program and help file downloadable
from http://ideas.repec.org/c/boc/bocode/s430201.html.  Accessed December 12,
2002.
<p>
Huang, C., McDonald, J.A, and Stuetzle, W. (1997) Variable resolution bivariate
plots. <i>Journal of Computational and Graphical Statistics</i>, 6:  383-396.
<p>
Levy, D. (1999) <i>50 years of discovery: medical milestones from the National</i>
<i>Heart, Lung, and Blood Institute's Framingham Heart Study.</i> Hackensack, NJ:
Center for Bio-Medical Communication Inc.
<p>
Steichen, T.J. and Cox, N.J. (1999) flower: Stata module to draw sunflower
plots.  Stata program and help file downloadable from
http://ideas.repec.org/c/boc/bocode/s393001.html.  Accessed December 6, 2002.
<p>
<p>
<b><u>Also see</u></b> 
<p>
Manual:  [G] graphics
On-line:  help for graph, functions (for <b>round()</b>)
<p>
</pre>