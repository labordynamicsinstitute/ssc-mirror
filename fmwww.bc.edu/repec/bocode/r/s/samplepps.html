<pre>
-------------------------------------------------------------------------------
help for <b>samplepps</b>       Stephen P. Jenkins (June 2005, help revised May 2008))
-------------------------------------------------------------------------------
<p>
<b><u>Draw random sample, proportional to size, of n cases</u></b>
<p>
    <b>samplepps</b> <i>newvar</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] , <b><u>n</u></b><b>cases(</b><i>integer</i><b>)</b> <b><u>s</u></b><b>ize(</b><i>sizevar</i><b>)</b>
            [<b><u>with</u></b><b>repl</b> ]
<p>
<b><u>Description</u></b>
<p>
    <b>samplepps</b> draws a random sample with <i>ncases</i> observations from the current
    data set, with probabilities proportional to size (`pps'). The default is
    to select cases without replacement; optionally cases may be selected with
    replacement.
<p>
    If sampling is without replacement, the variable <i>newvar</i> is equal to 1 for
    selected cases, and 0 for non-selected cases. The program returns an error
    if either the number of cases to be selected is greater than the number of
    valid observations, or if any observation has <i>newvar</i>/(SUM_i <i>newvar</i>) &gt;=
    1/<i>ncases</i>.
<p>
    If sampling is with replacement, the variable <i>newvar</i> is equal to a positive
    integer for selected cases (the integer is the number of times the case has
    been selected), and 0 for non-selected cases. For both types of sampling,
    <i>newvar</i> is missing if <i>sizevar</i> is missing.
<p>
    If you are serious about drawing random samples, you must first set the
    random number seed; see generate.
<p>
    Methods for sampling with probabilities proportional to size are discussed
    by Lohr (1999). See also Levy and Lemeshow (1991, chapter 11) and Som
    (1973, chapter 5), who focus on the with-replacement case. The algorithm
    used by <b>samplepps</b> for the with-replacement case is the standard `cumulative
    method'.  For the without-replacement case, I used an algorithm described
    by Jean-Yves Pip Courbois (formerly at the University of Washington),
    orginally due to Madow (1949).  For more details, see Brewer and Hanif
    (1983) and Cochran (1977, p. 265) who cites Hartley and Rao (1962) and
    Madow (1949).
<p>
<b><u>Options</u></b>
<p>
    <b>ncases(</b><i>integer</i><b>)</b> specifies the number of observations to be selected.
<p>
    <b>size(</b><i>sizevar</i><b>)</b> specifies the name of the existing variable summarizing
    `size'.
<p>
    <b>withrepl</b> specifies selection with replacement. (If the option is specified,
    a given obs may be selected more than once.)
<p>
<b><u>Saved results</u></b>
<p>
    <b>r(ncases)</b> is the integer <i>ncases</i>.
<p>
    <b>r(nobs)</b> is the number of valid observations at risk of being sampled.
<p>
    <b>r(sizevar)</b> contains the name <i>sizevar</i>.
<p>
    <b>r(withrepl)</b> = 1 if the with-replacement option was specified.
<p>
    <b>r(sample)</b> contains the name <i>newvar</i>.
<p>
<b><u>Examples</u></b>
<p>
        . // select a sample of schools with selection probabilities depending
            on # pupils per school.
<p>
        . use schools.dta, clear
<p>
        . set seed 123517
<p>
        . samplepps pick1, size(n_pupils) n(100)
<p>
        . samplepps pick2, size(n_pupils) n(50) withrepl
<p>
<b><u>Acknowledgements</u></b>
<p>
    Program written with support of ESRC grant number RES-000-22-0995 ("Social
    segregation in UK schools: benchmarking with international comparisons").
    For helpful discussions, I thank project colleagues John Micklewright and
    Sylke Schnepf, and also Philippe Van Kerm. Steven Samuels due my attention
    to the references by Cochran, Hartley and Rao, and Madow. Ben Jann drew my
    attention to the Brewer and Hanif reference.
<p>
<b><u>Author</u></b>
<p>
    Stephen P. Jenkins, ISER, University of Essex, U.K.
    &lt;stephenj@essex.ac.uk&gt;
<p>
<p>
<b><u>References</u></b>
<p>
<p>
    Brewer, K. R. W. and Muhammad Hanif. 1983. Sampling with Unequal
        Probabilities. New York: Springer.
<p>
    Cochran, William G. 1977. <i>Sampling Techniques, 3rd Edition</i>. New York:
        Wiley.
<p>
    Madow, William G. 1949. On the theory of systematic sampling. II. <i>Annals of</i>
        <i>Mathematical Statistics</i>, 19: 535-545.
<p>
    Hartley, H.O. and J.N.K. Rao. 1962. Sampling with unequal probabilities and
        without replacement.  <i>Annals of Mathematical Statistics</i>, 33: 350-374.
<p>
    Levy, Paul S. and Stanley Lemeshow. 1991. <i>Sampling of Populations: Methods</i>
        <i>and Applications, 2nd edition</i>.  New York: John Wiley and Sons.
<p>
    Lohr, Sharon L. 1999. <i>Sampling: Design and Analysis</i>. Pacific Grove CA:
        Duxbury Press.
<p>
    Som, Ranjan K. 1973. <i>Practical Sampling Techniques, second edition, revised</i>
        <i>and expanded</i>.  New York: Marcel Dekker.
<p>
<p>
<b><u>Also see</u></b>
<p>
 Manual:  <b>[S-Z] sample</b>
<p>
On-line:  help for sample, and gsample if installed.
<p>
<p>
<p>
</pre>