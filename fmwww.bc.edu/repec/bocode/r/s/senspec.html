<pre>
-------------------------------------------------------------------------------
help for <b>senspec</b>                                                 (Roger Newson)
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Sensitivity and specificity results saved in generated variables</u></b>
<p>
        <b>senspec</b> <i>refvar</i> <i>classvar</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b>
               <b><u>p</u></b><b>osif(</b><i>relational_operator</i><b>)</b> <b><u>se</u></b><b>nsitivity(</b><i>newvarname</i><b>)</b>
               <b><u>sp</u></b><b>ecificity(</b><i>newvarname</i><b>)</b> <b><u>fp</u></b><b>os(</b><i>newvarname</i><b>)</b> <b><u>fn</u></b><b>eg(</b><i>newvarname</i><b>)</b>
               <b><u>ntp</u></b><b>os(</b><i>newvarname</i><b>)</b> <b><u>ntn</u></b><b>eg(</b><i>newvarname</i><b>)</b> <b><u>nfp</u></b><b>os(</b><i>newvarname</i><b>)</b>
               <b><u>nfn</u></b><b>eg(</b><i>newvarname</i><b>)</b> <b>float</b> ]
<p>
    where <i>refvar</i> and <i>classvar</i> ar names of an existing numeric reference
    variable and an existing numeric classification variable, respectively,
    and <i>relational_operator</i> may be any one of the relational operators <b>&gt;</b>, <b>&lt;</b>,
    <b>&gt;=</b> or <b>&lt;=</b>.
<p>
    <b>aweight</b>s, <b>fweight</b>s, <b>iweight</b>s, and <b>pweight</b>s are allowed, and are all
    treated in the same way. See help for weights.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>senspec</b> inputs a reference variable with two values and a quantitative
    classification variable.  It creates, as output, a set of new variables,
    containing, in each observation, the numbers and/or rates of true
    positives, true negatives, false positives and false negatives observed
    if the classification variable is used to define a diagnostic test, with
    a threshold equal to the value of the classification variable for that
    observation.  The two variables <i>refvar</i> and <i>classvar</i> must be numeric. The
    reference variable <i>refvar</i> indicates the true state of the observation,
    such as diseased and non-diseased, or normal and abnormal. It must have
    only 2 values, for example 0 and 1, of which the lower value identifies
    negative observations and the higher value identifies positive
    observations.  The rating or outcome of the diagnostic test is recorded
    in <i>classvar</i>, which must be at least ordinal.  <b>senspec</b> is similar to 
    roctab, but produces output variables instead of plots and listings, so
    that users can create plots and listings in their own chosen formats.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>posif(</b><i>relational_operator</i><b>)</b> specifies one of the 4 relational operators <b>&gt;</b>,
        <b>&lt;</b>, <b>&gt;=</b> or <b>&lt;=</b>.  These relational operators specify that a positive test
        result is defined as a value of the classification variable above the
        threshold, below the threshold, at or above the threshold, or at or
        below the threshold, respectively.  If <b>posif()</b> is not specified, then
        <b>&gt;=</b> is assumed, and the test is assumed to have a positive result if
        and only if the classification variable is at or above the threshold.
<p>
    <b>sensitivity(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be
        generated, containing, in each observation, the sensitivity of the
        diagnostic test if the threshold is equal to the value of the
        classification variable in that observation.
<p>
    <b>specificity(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be
        generated, containing, in each observation, the specificity of the
        diagnostic test if the threshold is equal to the value of the
        classification variable in that observation.
<p>
    <b>fpos(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the false positive rate of the
        diagnostic test if the threshold is equal to the value of the
        classification variable in that observation.
<p>
    <b>fneg(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the false negative rate of the
        diagnostic test if the threshold is equal to the value of the
        classification variable in that observation.
<p>
    <b>ntpos(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the number of true positives
        (weighted if weights are specified) if the threshold is equal to the
        value of the classification variable in that observation.
<p>
    <b>ntneg(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the number of true negatives
        (weighted if weights are specified) if the threshold is equal to the
        value of the classification variable in that observation.
<p>
    <b>nfpos(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the number of false positives
        (weighted if weights are specified) if the threshold is equal to the
        value of the classification variable in that observation.
<p>
    <b>nfneg(</b><i>newvarname</i><b>)</b> specifies the name of a new variable to be generated,
        containing, in each observation, the number of false negatives
        (weighted if weights are specified) if the threshold is equal to the
        value of the classification variable in that observation.
<p>
    <b>float</b> specifies that the derived variables specified by the
        <b>sensitivity()</b>, {cmf:specificity()}, <b>fpos()</b> and <b>fneg()</b> options will
        have storage type no higher than <b>float</b>. If <b>float</b> is not specified,
        then these derived variables will be created initially as type
        <b>double</b>. Whether or not <b>float</b> is specified, the derived variables are
        compressed to the lowest numeric storage type possible without loss
        of information.
<p>
<p>
<b><u>Equations and formulas</u></b>
<p>
    <b>senspec</b> starts by calculating the numbers (or weighted numbers, if
    weights are specified) of true positives, true negatives, false positives
    and false negatives.  THese are stored in variables that may be saved for
    future use by the <b>ntpos()</b>, <b>nfpos()</b>, <b>ntneg()</b> and <b>nfneg()</b> options,
    respectively. These variables are created as type <b>double</b> if aweights,
    pweights or aweights are specified, or as type <b>long</b> if fweights or no
    weights are specified, and are compressed to the lowest numeric storage
    type possible without loss of information.  <b>senspec</b> then calculates any
    derived variables requested by the options <b>sensitivity()</b>,
    {cmf:specificity()}, <b>fpos()</b> and <b>fneg()</b>, using the following formulas:
<p>
    <b>sensitivity=ntpos/(ntpos+nfneg)</b>
<p>
    <b>specificity=ntneg/(ntneg+nfpos)</b>
<p>
    <b>fpos=nfpos/(ntneg+nfpos)</b>
<p>
    <b>fneg=nfneg/(ntpos+nfneg)</b>
<p>
    The user can calculate other results using other formulas by specifying
    the options <b>ntpos()</b>, <b>nfpos()</b>, <b>ntneg()</b> and <b>nfneg()</b>, and then generating
    further variables from the new variables. Confidence intervals for the
    area under the specificity-sensitivity (or ROC) curve can be calculated
    using the somersd package, downloadable from SSC. The somersd package
    offers a choice of normalizing and/or variance-stabilizing
    transformations, the ability to adjust for clustering, and the ability to
    calculate differences between ROC areas for two alternative
    classification variables using lincom.  (See Newson, 2002.)
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. senspec foreign mpg, sensitivity(sens1) fpos(fpos1)</b>
    <b>. scatter sens1 fpos1, sort(fpos sens1) connect(L) mlab(mpg)</b>
<p>
    The following example will work if the user has installed xcontract
        (downloadable from SSC).
<p>
    <b>. senspec foreign weight, posif(&lt;=) sens(sens2) spec(spec2)</b>
    <b>. xcontract weight sens2 spec2, list(,) format(sens2 spec2 %8.4f)</b>
<p>
<p>
<b><u>Saved results</u></b>
<p>
    <b>Scalars:</b>
<p>
    <b>r(N)</b>           Number of observations
    <b>r(N_pos)</b>       Number of positive observations
    <b>r(N_neg)</b>       Number of negative observations
<p>
<p>
<b><u>Author</u></b>
<p>
Roger Newson, King's College, London, UK.  Email: roger.newson@kcl.ac.uk
<p>
<p>
<b><u>References</u></b>
<p>
Newson R. 2002. Parameters behind "nonparametric" statistics: Kendall's tau,
Somers' D and median differences.  <i>The Stata Journal</i> 2(1): 45-64.  Also
downloadable from Roger Newson's website at
http://www.kcl-phs.org.uk/rogernewson.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Manual:  <b>[R] roc</b>
<p>
    Online:  help for roctab
             help for somersd and xcontract if installed
</pre>