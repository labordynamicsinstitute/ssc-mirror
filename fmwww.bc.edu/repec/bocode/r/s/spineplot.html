<pre>
-------------------------------------------------------------------------------
help for <b>spineplot</b>
-------------------------------------------------------------------------------
<p>
<b><u>Spine plots for two-way categorical data</u></b> 
<p>
        <b>spineplot</b> <i>yvar</i> <i>xvar</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [ <b>,</b>
                 <b>bar1(</b><i>twoway_bar_options</i><b>)</b> ...  <b>bar20(</b><i>twoway_bar_options</i><b>)</b>
                 <b>barall(</b><i>twoway_bar_options</i><b>)</b> <b><u>miss</u></b><b>ing</b> <b><u>perc</u></b><b>ent</b> <b>text(</b><i>textvar</i> [<b>,</b>
                 <i>marker_label_options</i>]<b>)</b> <i>twoway_options</i> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>spineplot</b> produces a spine plot for two-way categorical data.  The
    fractional breakdown of the categories of the first-named variable <i>yvar</i>
    is shown for each category of the second-named variable <i>xvar</i>. Stacked
    bars are drawn with vertical extent showing fraction(<i>yvar</i> category | <i>xvar</i>
    category) and horizontal extent showing fraction in <i>xvar</i> category. Thus
    the areas of tiles formed represent the frequencies, or more generally
    totals, for each cross-combination of <i>yvar</i> and <i>xvar</i>.
<p>
    <b>fweight</b>s and <b>aweight</b>s may be specified.
<p>
<p>
<b><u>Remarks</u></b> 
<p>
    The name "spine plot" is due to Hummel (1996). The term is not yet
    widespread but appears already to be variously understood.  Textbooks and
    monographs with examples of spine plots and related plots include
    Friendly (2000), Venables and Ripley (2002), Robbins (2005), Unwin et al.
    (2006) and Young et al. (2006).  Among several papers, Hofmann's (2000)
    discussion is clear, concise and well-illustrated.
<p>
    Some literature treats spine plots, as understood here, under the heading
    of mosaic plots, variously with and without also using the term spine
    plot.  The original definition of spine plots appears to have allowed at
    most vertical subdivision (e.g. by highlighting) into two categories, but
    this stipulation is also widely ignored as being unduly restrictive.  The
    Stata implementation here under the name <b>spineplot</b> thus implies a broad
    interpretation of the term.  Conversely, this implementation does not
    purport to be a general mosaic plot program.
<p>
    Mosaic plots have been re-invented several times under different names.
    Hartigan and Kleiner (1981, 1984) introduced, or re-introduced, them into
    mainstream statistics. Friendly (2002) cites earlier examples, including
    the work of Georg von Mayr (1877), Karl G. Karsten (1923) and Erwin J.
    Raisz (1934).  Hofmann (2007) discusses a mosaic by Francis A.  Walker
    (1874).  Other early examples are those of Willard C. Brinton (1914,
    quoting earlier work) and Berend G. Escher (1934).
<p>
    Most implementations of mosaic plots omit axes and numerical scales and
    convey a recursive subdivision according to what may be several
    categorical variables by a hierarchy of gaps of various sizes. As the
    plot here is restricted to two variables, this Stata implementation keeps
    axes and numerical scales as defaults.  The distinction between
    categories is conveyed by bar boundaries rather than explicit gaps.
<p>
    A key principle behind any kind of mosaic plot is that a categorical
    classification of independent variables would yield tiles that align
    consistently. Thus departures from independence, or relationships between
    variables, will be shown by failure of alignment.
<p>
    The restriction to two variables is more apparent than real.  Composite
    variables may be created by cross-combination of two or more categorical
    variables. The egen functions <b>group()</b> and <b>axis()</b> may be useful for this
    purpose. <b>axis()</b> is in the <b>egenmore</b> package from SSC and must have been
    installed previously. Compare also what Wilkinson (2005) calls "region
    trees" (and his references).
<p>
    The program works by calculating cumulative frequencies. The plot is then
    produced by overlaying distinct graphs, each a call to <b>twoway bar,</b>
    <b>bartype(spanning)</b> for one category of <i>yvar</i>. By default, each bar is shown
    with <b>blcolor(bg) blw(medium)</b>, which should be sufficient to outline each
    bar distinctly but delicately.  By default also, the categories of <i>yvar</i>
    will be distinguished according to the graph scheme you are using.  With
    the default <b>s2color</b> scheme the effect is reminiscent of tinned fruit
    salad, which may be fine for exploratory work.  For a publishable graph
    you might want to reach for something more subdued, such as various grey
    scales.
<p>
    Options <b>bar1()</b> to <b>bar20()</b> are provided to allow overriding the defaults
    on up to 20 categories, the first, second, etc., shown.  The limit of 20
    is plucked out of the air as more than any user should really want. The
    option <b>barall()</b> is available to override the defaults for all bars. Any
    <b>bar</b>? option always overrides <b>barall()</b>. Thus if you wanted thicker
    <b>blwidth()</b> on all bars you could specify <b>barall(blwidth(thick))</b>. If you
    wanted to highlight the first category only you could specify
    <b>bar1(blwidth(thick))</b>.
<p>
    Other defaults include <b>legend(col(1) pos(3))</b>.  At least with <b>s2color</b> a
    legend on the right implies an approximately square plot region which can
    look quite good. A legend is supplied partly because there is no
    guarantee that all <i>yvar</i> categories will be represented for extreme
    categories of <i>xvar</i>. However, it will often be possible and tasteful to
    omit the legend and show categories as axis label text.  An example is
    given below.
<p>
    Note the possibility of using <b>plotregion(margin(zero))</b> to place axes
    alongside the plot region.
<p>
    As with scatter plots, a response variable is usually better shown on the
    <i>y</i> axis.  If one variable is binary, it is often better to plot that on
    the <i>y</i> axis. Naturally, there can be some tension between these
    suggestions.  For example, in the auto data, <b>foreign</b> is arguably a
    predictor of <b>rep78</b> rather than vice versa, but I suggest that <b>spineplot</b>
    <b>foreign rep78</b> is more congenial than <b>spineplot rep78 foreign</b>.
<p>
    The user may need to experiment with different sort orders for the
    categorical variables. <b>egen, axis()</b> may again be useful here.
<p>
<p>
<b><u>Options</u></b> 
<p>
    <b>bar1(</b><i>twoway_bar_options</i><b>)</b> ...  <b>bar20(</b><i>twoway_bar_options</i><b>)</b> allow
        specification of the appearance of the bars for each category of <i>yvar</i>
        using options of twoway bar.
<p>
    <b>barall(</b><i>twoway_bar_options</i><b>)</b> allows specification of the appearance of the
        bars for all categories of <i>yvar</i> using options of twoway bar.
<p>
    <b>missing</b> specifies that any missing values of either of the variables
        specified should also be included within their own categories.  The
        default is to omit them.
<p>
    <b>percent</b> specifies labelling in terms of percents. The default is
        labelling in terms of fractions.
<p>
    <b>text(</b><i>textvar</i> [<b>,</b> <i>marker_label_options</i>]<b>)</b> specifies a variable to be shown
        as text at the centre of each tile. <i>textvar</i> may be a numeric or
        string variable. It should contain identical values for all
        observations in each cross-combination of <i>yvar</i> and <i>xvar</i>. A simple
        example is the frequency of each cross-combination. To show nothing
        in particular tiles, use a variable with missing values, either
        numeric missing or empty strings, for those tiles.  A numeric
        variable with fractional part will typically look best converted to
        string as (e.g.) <b>string(</b><i>residual</i><b>, "%4.3f")</b>.  Choice of tile colours
        so that text is readable is the user's responsibility. <b>text()</b> may
        also include marker label options tuning the display.
<p>
    <i>twoway_options</i> refers to options of twoway.  Note that by default there
        are two <i>x</i> axes, <b>axis(1)</b> on top and <b>axis(2)</b> on bottom, and two <i>y</i> axes,
        <b>axis(1)</b> on right and <b>axis(2)</b> on left.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. sysuse auto</b>
    <b>. spineplot foreign rep78</b>
    <b>. spineplot foreign rep78, xti(frequency, axis(1)) xla(0(10)60, axis(1))</b>
        <b>xmti(1/69, axis(1))</b>
    <b>. spineplot rep78 foreign</b>
<p>
    <b>. set scheme s1color</b>
    <b>. bysort foreign rep78: gen freq = _N</b>
    <b>. spineplot foreign rep78, text(freq, mlabsize(*1.4)) bar1(color(gs14))</b>
        <b>bar2(color(gs10))</b>
    <b>. spineplot foreign rep78, text(freq, mlabsize(*1.4)) bar1(color(gs14))</b>
        <b>bar2(color(gs10)) legend(off) yla(0.1 "Domestic" 0.9 "Foreign",</b>
        <b>noticks axis(1))</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Nicholas J. Cox, Durham University
    n.j.cox@durham.ac.uk
<p>
         
<b><u>Acknowledgments</u></b> 
<p>
    Matthias Schonlau, Scott Merryman and Maarten Buis provoked this program
    through challenging Statalist postings, which re-awakened a long-standing
    thought that someone, perhaps me, should implement spine plots in Stata.
    A suggestion from Peter Jepsen led to the <b>text()</b> option. Private emails
    from Matthias Schonlau and Antony Unwin highlighted different senses of
    spine plots and the importance of sort order. Vince Wiggins originally
    told me about the undocumented <b>bartype(spanning)</b> option.
<p>
<p>
<b><u>References</u></b>
<p>
    Anderson, M.J. 2001.  Francis Amasa Walker.  In Heyde, C.C. and Seneta,
        E. (eds) <i>Statisticians of the centuries.</i>  New York: Springer,
        216-218.
<p>
    Brinton, W.C. 1914.  <i>Graphic methods for presenting facts.</i>  New York:
        Engineering Magazine Company.
<p>
    Escher, B.G. 1934.  <i>De methodes der grafische voorstelling.</i>  Amsterdam:
        Wereldbibliotheek. [first edition 1924]
<p>
    Friendly, M. 2000.  <i>Visualizing categorical data.</i>  Cary, NC: SAS
        Institute.
<p>
    Friendly, M. 2002.  A brief history of the mosaic display.  <i>Journal of</i>
        <i>Computational and Graphical Statistics</i> 11: 89-107.
<p>
    Hartigan, J.A. and Kleiner, B. 1981.  Mosaics for contingency tables.  In
        Eddy, W.F. (ed.) <i>Computer science and statistics: Proceedings of the</i>
        <i>13th symposium on the interface.</i>  New York: Springer, 268-273.
<p>
    Hartigan, J.A. and Kleiner, B. 1984.  A mosaic of television ratings.
        <i>American Statistician</i> 38: 32-35.
<p>
    Hertz, S. 2001.  Georg von Mayr.  In Heyde, C.C. and Seneta, E. (eds)
        <i>Statisticians of the centuries.</i>  New York: Springer, 219-222.
<p>
    Hofmann, H. 2000.  Exploring categorical data: interactive mosaic plots.
        <i>Metrika</i> 51: 11-26.
<p>
    Hofmann, H. 2007.  Interview with a centennial chart.  <i>Chance</i> 20(2):
        26-35.
<p>
    Hummel, J. 1996.  Linked bar charts: analysing categorical data
        graphically.  <i>Computational Statistics</i> 11: 23-33.
<p>
    Karsten, K.G. 1923.  <i>Charts and graphs: An introduction to graphic</i>
        <i>methods in the control and analysis of statistics.</i>  New York:
        Prentice-Hall.
<p>
    Mayr, G. von. 1877.  <i>Die Gesetzmässigkeit im Gesellschaftleben.</i>  München:
        Oldenbourg.
<p>
    Raisz, E.J. 1934.  The rectangular statistical cartogram.  <i>Geographical</i>
        <i>Review</i> 24: 292-296.
<p>
    Robbins, N.B. 2005.  <i>Creating more effective graphs.</i>  Hoboken, NJ: John
        Wiley.
<p>
    Robinson, A.H. 1970.  Erwin Josephus Raisz, 1893-1968.  <i>Annals,</i>
        <i>Association of American Geographers</i> 60: 189-193.
<p>
    Unwin, A., Theus, M. and Hofmann, H. 2006.  <i>Graphics of large datasets:</i>
        <i>Visualizing a million.</i>  New York: Springer.
<p>
    Venables, W.N. and Ripley, B.D. 2002.  <i>Modern applied statistics with S.</i>
        New York: Springer.
<p>
    Walker, F.A. 1874.  <i>Statistical atlas of the United States based on the</i>
        <i>results of the ninth census 1870.</i>  New York: Census Office.
<p>
    Wilkinson, L. 2005.  <i>The grammar of graphics.</i>  New York: Springer.
<p>
    Young, F.W., Valero-Mora, P.M. and Friendly, M. 2006.  <i>Visual statistics:</i>
        <i>Seeing data with interactive graphics.</i>  Hoboken, NJ: John Wiley.
<p>
<p>
<b><u>Also see</u></b>
<p>
    On-line:  help for histogram, help for catplot (if installed), help for 
             tabplot (if installed), help for egenmore (if installed), help
             for vreverse (if installed)
<p>
</pre>