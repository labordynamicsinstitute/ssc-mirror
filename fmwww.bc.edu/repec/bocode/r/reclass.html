<pre>
-------------------------------------------------------------------------------
help for <b>reclass</b>                                                 John Hendrickx
-------------------------------------------------------------------------------
<p>
<b><u>reclass</u></b>
<p>
        <b>reclass</b> <i>varname</i> , <b>[</b> <b><u>p</u></b><b>cnttab(</b><i>string</i><b>)</b> <b><u>ad</u></b><b>just</b> <b><u>b</u></b><b>estmod</b> <b>q(</b><i>real</i><b>)</b> <b>u(</b><i>real</i><b>)</b>
                           <b><u>d</u></b><b>ist(</b><i>real</i><b>)</b> <b><u>as</u></b><b>soc(</b><i>string</i><b>)</b> <b><u>m</u></b><b>isclass(</b><i>real</i><b>)</b>
                           <b><u>f</u></b><b>ormat(</b><i>string</i><b>)</b> <b><u>v</u></b><b>erbose</b> <b>]</b>
<p>
<b><u>Description</u></b>
<p>
<b>reclass</b> is called by perturb to create a table of reclassification
probabilities for use a perturbation analysis. It can be used separately to
experiment with different association patterns.  <i>varname</i> should refer to a
categorical variable. <b>reclass</b> creates a table of reclassification probabilities
such that the expected frequencies of the reclassified variable will be equal
to the frequency distribution of <i>varname</i>. In addition, an appropriate
association is imposed between the reclassified variable and <i>varname</i>.
<p>
<b><u>Options</u></b>
<p>
<b>pcnttab</b> can be either a single value, a row or column matrix, or a square
    matrix. Usually, a single value between 0 and 100 will be specified
    indicating the percentage cases to be reclassified to the same category.
<p>
    If a row or column matrix is specified its dimensions must correspond with
    the number of categories of <i>varname</i>. Values should be between 0 and 100 and
    indicate the percentage of cases to be reclassified to the same category
    for each category separately.
<p>
    If a square matrix is specified, its dimensions must correspond with the
    number of categories of <i>varname</i>. The matrix should indicate the
    reclassification probabilities with the original variable in the rows and
    the reclassified variables in the columns. Either percentages or
    probabilities may be used. It is not necessary for these to add to 100 or
    to 1 respectively as <b>reclass</b> transforms them into columnwise proportions.
<p>
In most cases, the <b>pcnttab</b> option will suffice. The options below are useful
for users familiar with loglinear models for square tables (mobility models).
<p>
<b>adjust</b> By default, <b>reclass</b> defines reclassification probabilities such that the
    expected frequencies of the reclassified variable are the same as those of
    <i>varname</i> when the <b>pcnttab</b> option is used. Use <b>noadjust</b> to suppress this and
    use the percentages specified in the <b>pcnttab</b> option unmodified.  <b>noadjust</b>
    implies <b>nobestmod</b>.
<p>
<b>bestmod</b> By default, <b>reclass</b> imposes an appropriate pattern of association
    between <i>varname</i> and its reclassified counterpart when the <b>pcnttab</b> option is
    used. Use <b>nobestmod</b> to avoid this. The reclassification probabilities will
    be adjusted to make the expected frequencies of the reclassified variable
    equal to those of <i>varname</i> but they will otherwise be close approximations
    of the values specified in the <b>pcnttab</b> option.
<p>
<b>misclass</b> Maintained for compatiblity with the original version of <b>misclass</b> and 
    perturb. Translated by <b>reclass</b> into <b>pcnttab(100-</b><i>misclass</i><b>) noadjust</b>.
<p>
The options below can be used to specify the parameters of a pattern of
association. They will be ignored if <b>pncttab</b> was specified.
<p>
<b>q</b> the multiplicative parameter of a quasi-independence (constrained) model.
<p>
<b>u</b> the multiplicative parameter of a uniform association model.
<p>
<b>dist</b> the multiplicative parameter of a distance model.
<p>
<b>assoc</b> This allows users familiar with loglinear mobility models to specify an
    association pattern of their own choice. The argument for assoc should
    refer to a Stata program in which the variable <b>paras</b> is defined as a
    function of the row variable <b>orig</b> and the column variable <b>dest</b> to produce a
    loglinear pattern of associaton.
<p>
<b>format </b>Specify a valid format for printing results. The default is %8.3f.
<p>
<b>verbose</b> debugging information.
<p>
<b><u>Remarks</u></b>
<p>
The basic idea of reclassifying cases in a perturbation analysis is that each
case will have a high probability, say 95%, of being reclassified into the same
category. The remaining cases could then be distributed evenly among the
remaining categories. There are two problems with this approach. First, smaller
categories will tend to grow and larger categories will shrink after
reclassification. Second, the association between the original and the
reclassified variable will be arbitrary, with some reclassification categories
being more likely than others. Both problems occur more strongly to the extent
that the variable in question is unevenly distributed.
<p>
<b>reclass</b> solves thes problems by creating an initial table of expected
frequencies for the original by the reclassified variable, given the initial
reclassification probabilities as specified by the <b>pcnttab</b> option. The
parameters for an <i>appropriate</i> pattern of association between the original and
the reclassified variable are derived from this table. Then an adjusted table
of expected frequencies is created with the pattern of a association found,
such that the expected frequency distribution of the reclassified variable is
identical to that of the original.
<p>
When a single percentage is specified in <b>pcnttab</b>, this percentage is used for
the diagonal cells of the initial reclassification probabilities, with the
remaining percentages distributed evenly among the other categories. The
<i>appropriate</i> pattern of association in this case is a "quasi-independence
(constrained)" loglinear mobility model (Hout 1983, Goodman 1984).  The QI-C
model makes the odds of reclassification to the same/different category the
same for all categories. In addition, the reclassified category is independent
of the original category, given that they are not the same. This model is
fitted to the intital table of expected frequencies and a single <b>ln(q)</b>
parameter is reported. This <b>ln(q)</b> parameter is used to create the adjusted
table.
<p>
If the argument to <b>pcnttab</b> consists of a row or column vector of percentages,
<b>reclass</b> assumes uses different odds for reclassification to the same versus
different categories for each category. The <b>pcnttab</b> argument forms the diagonal
of the initial reclassification percentages, the remaining percentages are
distributed evenly among the other categories. A quasi-independence model is
fitted to the initial table of expected frequencies, with separate odds per
category for reclassification to the same versus a different category. An <b>ln(q)</b>
parameter is reported for each category of <i>varname</i>. These parameters are then
used to create the adjusted table.
<p>
If the argument to <b>pncttab</b> consists of a square matrix of percentages, <b>reclass</b>
assumes that <i>varname</i> is an ordered categorical variable. Consequently, the
percentages should be constructed so that short distance reclassification is
more likely than long distance reclassification. <b>reclass</b> fits two models to the
intial table of expected frequencies, a "quasi-distance" model and a
"quasi-uniform association" model.
<p>
Both make short distance reclassification more likely than long distance but
this is even more pronounced for a quasi-uniform association model than for a
quasi-distance model. A quasi-distance model makes the likelihood of
reclassification proportionately lower for each step away from the main
diagonal. A quasi-uniform model on the other hand is equivalent to a squared
distance model, reclassification is proportionately less likely for the squared
number of steps from the main diagonal.
<p>
Both models include an <b>ln(q)</b> parameter that increases the likelihood of
reclassification to the same category without affecting short or long distance
reclassification. The quasi-uniform model also reports an <b>ln(u)</b> parameter,
quasi-distance reports an <b>ln(dist)</b> parameter. The best fitting model is chosen
by <b>reclass</b> and the deviance and df are reported.
<p>
If the patterns of associatioh used by <b>reclass</b> are not in fact appropriate to
the problem at hand, the <b>nobestmod</b> option could be used. The final
reclassification percentages will the be as close as possible to those in the
<b>pcnttab</b> option. The reclassification probabilities will be adjusted to make the
expected frequencies of the reclassified variable equal to those of the
original, leading to some discrepancies.
<p>
Alternatively, <b>reclass</b> could be run using the <b>noadjust</b> option. The returned
result <b>e(gentab)</b> is then equal to the initial table of expected frequencies.
<b>e(gentab)</b> could be used in a loglinear analysis to derive an appropriate model
of association, which could then be specified in the <b>assoc</b> option.
<p>
The adjusted table is created using a loglinear model of equal main effects (a
halfway model) and the appropriate pattern of association as an offset
variable. This is fitted to an arbitrary table with the frequency distribution
of <i>varname</i> as both its row and column marginals. The predicted frequencies of
this model form a symmetric table with the pre-specified marginals and pattern
of association (Hendrickx, 2004; Kaufman &amp; Schervish, 1986).
<p>
If the <b>q</b>, <b>u</b>, or <b>dist</b> parameters are known, these can be specified directly in
the corresponding options. For other patterns of association, the <b>assoc</b> option
could be used. <b>assoc</b> should refer to a small program that defines the variable
<b>paras</b> in terms of <b>orig</b> and <b>dest</b> to produce a loglinear pattern of association.
For example:
<p>
program define q25u5
    gen paras=(orig==dest)*ln(25) + orig*dest*ln(5)
end
<p>
The command <b>reclass </b><i>myvar</i><b>, assoc(q25u5)</b> will produce reclassification
probabilities for the variable <i>myvar</i> using the program q25u5. This is
equivalent to using the options <b>q(25)</b> and <b>u(5)</b>. Other loglinear mobility models
can be defined in a similar fashion.
<p>
<b><u>Saved results</u></b>
<p>
<b>r(gentab)</b>
    the initial expected table for the original by reclassified variable
<p>
<b>r(margin)</b>
    the frequency distribution of <i>varname</i>
<p>
<b>r(classprob)</b>
    the cumulative reclassification probabilities. These will be used by 
    perturb to randomly reclassify <i>varname</i>.
<p>
<b><u>References</u></b>
<p>
Goodman, Leo A. (1984).  <i>The analysis of cross-classified data having ordered</i>
    <i>categories</i>.  Cambridge, Mass.: Harvard University Press.
<p>
Hendrickx, J. (2004). Using standardised tables for interpreting loglinear
    models. Submitted to <i>Quality &amp; Quantity</i>.
<p>
Hout, M. (1983). <i>Mobility tables</i>. Beverly Hills: Sage Publications.
<p>
Kaufman, R.L., &amp; Schervish, P.G. (1986). Using adjusted crosstabulations to
    interpret log-linear relationships.  <i>American Sociological Review</i>
    51:717-733
<p>
http://www.xs4all.nl/~jhckx/perturb/
<p>
Direct comments to: John Hendrickx
<p>
<b>reclass</b> is available at SSC-IDEAS.  Use ssc <b>install perturb</b> to obtain the
latest version.
<p>
<b><u>Also see</u></b>
On-line: help for vif, collin, coldiag, coldiag2, perturb
</pre>