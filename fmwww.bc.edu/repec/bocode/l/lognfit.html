<pre>
-------------------------------------------------------------------------------
help for <b>lognfit</b>                                Stephen P. Jenkins (March 2007)
-------------------------------------------------------------------------------
<p>
<b><u>Fitting a lognormal distribution by ML to unit record data</u></b>
<p>
        <b>lognfit</b> <i>var</i> [<i>weight</i>] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b>,</b> <b><u>m</u></b><b>var(</b><i>varlist1</i><b>)</b>
                 <b><u>v</u></b><b>var(</b><i>varlist2</i><b>)</b> <b>mandv(</b><i>varlist</i><b>)</b> <b><u>st</u></b><b>ats</b> <b><u>f</u></b><b>rom(</b><i>string</i><b>)</b> <b><u>poor</u></b><b>frac(</b><i>#</i><b>)</b>
                 <b>cdf(</b><i>cdfname</i><b>)</b> <b>pdf(</b><i>pdfname</i><b>)</b> <b><u>r</u></b><b>obust</b> <b><u>cl</u></b><b>uster(</b><i>varname</i><b>)</b> <b><u>svy</u></b>
                 <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b> <i>maximize_options</i> <i>svy_options</i> ]
<p>
    <b>by</b> <i>...</i> <b>:</b> may be used with <b>lognfit</b>; see help by.
<p>
    <b>pweight</b>s, <b>aweight</b>s, <b>fweight</b>s, and <b>iweight</b>s are allowed; see help weights.
    To use <b>pweight</b>s, you must first <b>svyset</b> your data and then use the <b>svy</b>
    option.
<p>
<b><u>Description</u></b>
<p>
    <b>lognfit</b> fits by ML the 2 parameter lognormal distribution to sample
    observations on a random variable <i>var</i>. Unit record data are assumed
    (rather than grouped data). For a comprehensive review of the lognormal
    distribution, see Aitchison and Brown (1954).  See also Kleiber and Kotz
    (2003).
<p>
    The likelihood function for a sample of observations on <i>var</i> is specified
    as the product of the densities for each observation (weighted where
    relevant), and is maximized using <b>ml model lf</b>.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>mvar(</b><i>varlist1</i><b>)</b> and <b>vvar(</b><i>varlist2</i><b>)</b> allow the user to specify each
        parameter as a function of the covariates specified in the respective
        variable list. A constant term is always included in each equation.
<p>
    <b>mandv(</b><i>varlist</i><b>)</b> can be used instead of the previous option if the same
        covariates are to appear in each parameter equation.
<p>
    <b>from(</b><i>string</i><b>)</b> specifies initial values for the parameters, and is likely
        to be used only rarely. You can specify the initial values in one of
        three ways: the name of a vector containing the initial values (e.g.,
        from(b0) where b0 is a properly labeled vector); by specifying
        coefficient names with the values (e.g., from(m:_cons=1 v:_cons=5);
        or by specifying an ordered list of values (e.g., from(1 5, copy)).
        Poor values in from() may lead to convergence problems. For more
        details, including the use of copy and skip, see {help:maximize}.
<p>
        If covariates are specified, the next four options are not available.
        Use lognpred to generate statistics at particular values of the
        covariates, or <b>nlcom</b>. <b>predict</b> can be used to generate the
        observation-specific parameters corresponding to the covariate values
        of each sample observation: see Examples below.
<p>
    <b>stats</b> displays selected distributional statistics implied by the
        lognormal parameter estimates:  quantiles, cumulative shares of total
        <i>var</i> at quantiles (i.e. the Lorenz curve ordinates), the mode, mean,
        standard deviation, variance, half the coefficient of variation
        squared, Gini coefficient, and quantile ratios p90/p10, p75/p25.
<p>
    <b>poorfrac(</b><i>#</i><b>)</b> displays the estimated proportion with values of <i>var</i> less
        than the cut-off specified by <i>#</i>. This option may be specified when
        replaying results.
<p>
    <b>cdf(</b><i>cdfname</i><b>)</b> creates a new variable <i>cdfname</i> containing the estimated
        lognormal c.d.f. value F(x) for each x.
<p>
    <b>pdf(</b><i>pdfname</i><b>)</b> creates a new variable <i>pdfname</i> containing the estimated
        lognormal p.d.f. value f(x) for each x.
<p>
<p>
    <b>robust</b> specifies that the Huber/White/sandwich estimator of variance is
        to be used in place of the traditional calculation; see <b>[U] 23.14</b>
        <b>Obtaining robust variance estimates</b>.  <b>robust</b> combined with <b>cluster()</b>
        allows observations which are not independent within cluster
        (although they must be independent between clusters).  If you specify
        pweights, <b>robust</b> is implied.
<p>
    <b>cluster(</b><i>varname</i><b>)</b> specifies that the observations are independent across
        groups (clusters) but not necessarily within groups.  <i>varname</i>
        specifies to which group each observation belongs; e.g.,
        <b>cluster(personid)</b> in data with repeated observations on individuals.
        See <b>[U] 23.14 Obtaining robust variance estimates</b>. <b>cluster()</b> can be
        used with pweights to produce estimates for unstratified
        cluster-sampled data.  Specifying <b>cluster()</b> implies <b>robust</b>.
<p>
    <b>svy</b> indicates that <b>ml</b> is to pick up the <b>svy</b> settings set by <b>svyset</b> and
        use the robust variance estimator. Thus, this option requires the
        data to be <b>svyset</b>; see help svyset. <b>svy</b> may not be combined with
        weights or the <b>strata()</b>, <b>psu()</b>, <b>fpc()</b>, or <b>cluster()</b> options.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, in percent, for the confidence
        intervals of the coefficients; see help level.
<p>
    <b>nolog</b> suppresses the iteration log.
<p>
    <i>maximize_options</i> control the maximization process. The options available
        are those shown by maximize, with the exception of <b>from()</b>.  If you
        are seeing many "(not concave)" messages in the iteration log, using
        the <b>difficult</b> or <b>technique</b> options may help convergence.
<p>
    <i>svy_options</i> specify the options used together with the <b>svy</b> option.
<p>
<p>
<b><u>Saved results</u></b>
<p>
    In addition to the usual results saved after <b>ml</b>, <b>lognfit</b> also saves the
    following, if there are no covariates have been specified and the
    relevant options used:
<p>
    <b>e(bm)</b> and <b>e(bv)</b> are the estimated lognormal parameters.
<p>
    <b>e(cdfvar)</b> and <b>e(pdfvar)</b> are the variable names specified for the c.d.f.
    and the p.d.f.
<p>
    <b>e(mode)</b>, <b>e(mean)</b>, <b>e(var)</b>, <b>e(sd)</b>, <b>e(i2)</b>, and <b>e(gini)</b> are the estimated
    mode, mean, variance, standard deviation, half coefficient of variation
    squared, Gini coefficient. <b>e(pX)</b>, and <b>e(LpX)</b> are the quantiles, and
    Lorenz ordinates, where X = {1, 5, 10, 20, 25, 30, 40, 50, 60, 70, 75,
    80, 90, 95, 99}.
<p>
    The following results are saved regardless of whether covariates have
    been specified or not.
<p>
    <b>e(b_m)</b> and <b>e(b_v)</b> are row vectors containing the parameter estimates from
    each equation.
<p>
    <b>e(length_b_m)</b> and <b>e(length_b_v)</b> contain the lengths of these vectors. If
    no covariates have been specified in an equation, the corresponding
    vector has length equal to 1 (the constant term); otherwise, the length
    is one plus the number of covariates.
<p>
<p>
<b><u>Formulae</u></b>
<p>
    The lognormal distribution has distribution function (c.d.f.)
<p>
        F(x) = 1 - N( (log(x) - m)/v )
<p>
    where m and v are parameters, each positive, for random variable x &gt; 0.
<p>
    the probability density function (p.d.f.) is
<p>
        f(x) = (x*sqrt(2*_pi)*v)^(-1) *exp( -.5*(v^-2)(log(x) - m)^2 ).
<p>
    The likelihood function for a sample of observations on <i>var</i> is specified
    as the product of the densities for each observation (weighted where
    relevant), and is maximized using <b>ml model lf</b>.
<p>
    The formulae used to derive the distributional summary statistics
    presented (optionally) are as follows. The r-th moment about the origin
    is given by
<p>
        exp( r*m + .5*(r^2)*(v^2) )
<p>
    and hence
<p>
        mean = exp(m + .5*(v^2) )
<p>
        variance = q*(q-1)*exp(2*m) where q = exp(v^2)
<p>
    from which the standard deviation and half the squared coefficient of
    variation can be derived. The mode is
<p>
        mode = exp(m - v^2).
<p>
    The quantiles are derived by inverting the distribution function:
<p>
        x_s = exp( m + v*<b>invnorm</b>(s) ) for each s = F(x_s).
<p>
    The Gini coefficient of inequality is given by
<p>
        Gini = 2*<b>norm</b>(v/sqrt(2)) - 1 .
<p>
    The Lorenz curve ordinates at each s = F(x_s) are
<p>
        L(s) = <b>norm</b>(<b>invnorm</b>(s) - v^2).
<p>
        
<b><u>Examples</u></b>
<p>
    . lognfit x [w=wgt]
<p>
    . lognfit
<p>
    . lognfit x, stats poorfrac(100)
<p>
    . lognfit, m(age sex) v(age sex)
<p>
    . lognfit x, mandv(age sex)
<p>
    . predict double m_i, eq(m) xb
<p>
    . predict double v_i, eq(v) xb
<p>
    See also the examples provided in the presentation by Jenkins (2004).
<p>
<b><u>Author</u></b>
<p>
    Stephen P. Jenkins &lt;stephenj@essex.ac.uk&gt;, Institute for Social and
    Economic Research, University of Essex, Colchester CO4 3SQ, U.K.
<p>
<p>
<b><u>Acknowledgements</u></b>
<p>
    N.J. Cox made numerous helpful comments and suggestions, and also wrote
    programs for distributional diagnostic plots (qlogn, plogn).
<p>
<p>
<b><u>References</u></b>
<p>
    Aitchison, J. and Brown, J.A.C. (1957).  <i>The Lognormal Distribution</i>.
        Cambridge: Cambridge University Press.
<p>
    Jenkins, S.P. (2004). Fitting functional forms to distributions, using
        <b>ml</b>. Presentation at Second German Stata Users Group Meeting, Berlin. 
        http://www.stata.com/meeting/2german/Jenkins.pdf
<p>
    Kleiber, C. and Kotz, S. (2003).  <i>Statistical Size Distributions in</i>
        <i>Economics and Actuarial Sciences</i>. Hoboken, NJ: John Wiley.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online: help for lognpred, plogn, qlogn, smfit, dagumfit, gb2fit, if
             installed.
<p>
</pre>