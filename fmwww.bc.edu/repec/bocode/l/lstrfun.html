<pre>
<b>help lstrfun</b>                                                    <b> Dan Blanchette</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
<p>
       <b>lstrfun</b> --     Modify long local macros that contain strings
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>lstrfun</b> <i>local_macro_name</i> [<b>,</b> <i>options</i>]
<p>
    where <i>local_macro_name</i> is a valid name of either an existing local macro
    that will be modified or a valid name of a local macro that will be
    generated by <b>lstrfun</b>.  The strings being modified can be as long as the
    maximum <b>number of characters in a local macro</b> minus about 50 (which is
    about how many characters are used to submit <b>lstrfun</b>).
<p>
    Only one local macro name can be submitted and only one option can be
    specified.
<p>
<a name="options"></a>    <i>options</i>                               Description
    -------------------------------------------------------------------------
    In these descriptions <i>string</i> is referring to the contents of the local
    macro:
<p>
      <b>lower(</b><i>macname</i><b>)</b>                       make string all <b>lowercase</b>.
      <b>proper(</b><i>macname</i><b>)</b>                      make string <b>proper</b> case.
      <b>upper(</b><i>macname</i><b>)</b>                       make string all <b>uppercase</b>.
      <b>ltrim(</b><i>macname</i><b>)</b>                       remove <b>leading blanks</b> from string.
      <b>itrim(</b><i>macname</i><b>)</b>                       replace multiple <b>internal blanks</b>
                                            with a single blank in string.
      <b>rtrim(</b><i>macname</i><b>)</b>                       remove <b>trailing blanks</b> from
                                            string.
      <b>substr(</b><i>macname</i><b>,</b><i> pos</i><b>,</b><i> length</i><b>)</b>         <b>cut string</b> from starting point for
                                            the specified length.
<a name="subinstr"></a>      <b>subinstr(</b><i>macname</i><b>,</b><i> "from"</i><b>,</b><i> "to"</i><b>,</b><i> n</i><b>)</b>   <b>replace "from string" with "to</b>
                                            <b>string"</b> in the string for the
                                            specified number of occurrences.
<a name="subinword"></a>      <b>subinword(</b><i>macname</i><b>,</b><i> "from"</i><b>,</b><i> "to"</i><b>,</b><i> n</i><b>)</b>  <b>replace "from word" with "to word"</b>
                                            in the string for the specified
                                            number of occurrences.
      <b>strdup(</b><i>macname</i><b>,</b><i> n</i><b>)</b>                   <b>duplicate</b> the string the specified
                                            number of times.
      <b>reverse(</b><i>macname</i><b>)</b>                     <b>reverse</b> the string.
      <b>_substr(</b><i>macname</i><b>,</b><i> "tosub"</i><b>,</b><i> pos</i><b>)</b>       <b>substitutes</b> "tosub" into the
                                            string at the specified position.
<p>
<p>
    <b>Submit a new local macro name to be generated when using these options</b>
    <b>since these options return numbers/codes:</b>
<a name="strlen"></a>      <b>strlen(</b><i>macname</i><b>)</b>                      returns the <b>length</b> of the string.
      <b>strpos(</b><i>macname</i><b>,</b><i> "needle"</i><b>)</b>            returns the <b>position</b> of the
                                            specified string.
      <b>strmatch(</b><i>macname</i><b>,</b><i> pattern</i><b>)</b>           returns 1 if the string <b>matches</b>
                                            the specified pattern.
      <b>soundex(</b><i>macname</i><b>)</b>                     returns the <b>soundex</b> code for the
                                            string.
      <b>soundex_nara(</b><i>macname</i><b>)</b>                returns the <b>U.S. Census soundex</b>
                                            code for the string.
      <b>indexnot(</b><i>"characters"</i><b>,</b><i> macname</i><b>)</b>      returns the position of the first
                                            character in the set of
                                            characters specified that is <b>not</b>
                                            <b>found</b> in the string, or it
                                            returns 0 if all characters in
                                            the set of characters specified
                                            are found in the string.
      <b>regexm(</b><i>macname</i><b>,</b><i> pattern</i><b>)</b>             returns either a 1 or a 0 if
                                            <b>regexm</b> finds the pattern in the
                                            macro.
      <b>regexms(</b><i>macname</i><b>,</b><i> pattern with groups defined</i><b>,</b><i> nth_group</i><b>)</b>
                                            returns the nth group if <b>regexm</b>
                                            finds the pattern in the macro.
      <b>regexr(</b><i>macname</i><b>,</b><i> pattern</i><b>,</b><i> what to replace</i><b>)</b>
                                            returns what is wanted to be
                                            replaced if <b>regexr</b> finds the
                                            pattern in the macro.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>lstrfun</b> allows you to modify local <b>macros</b> that contain strings using
    <b>Mata's string functions</b> which are not restricted to the <b>maximum length of</b>
    <b>strings</b> in Stata like the normal <b>string functions</b> in Stata are limited.
    If you are using Stata SE or Stata MP, then your setting of <b>maxvar</b>
    affects the maximum <b>number of characters in a macro</b>.  The maximum number
    of characters in a macro is only 1,081,511 when <b>maxvar</b> is set to 32767.
    When <b>maxvar</b> is set to 5000 (the default value) then the maximum number of
    characters in a macro is 165,200.  The local macro submitted to <b>lstrfun</b>
    will be modified if it already exists or it will be created if it does
    not exist.  <b>lstrfun</b> can be very helpful when trying to modify <b>value</b>
    <b>labels</b> and <b>notes</b> in Stata since <b>value labels</b> and <b>notes</b> are allowed to
    have more characters than normal <b>string functions</b> are allowed to handle.
    The option <b>strlen()</b> has an equivalent function in Stata's <b>extended macro</b>
    <b>functions</b>, but the options <b>subinstr()</b> and <b>subinword()</b> have similar
    functions in Stata's <b>extended macro functions</b> which do not allow you to
    specify a specific number of replacements to make.
<p>
    Local macro strings that are submitted in any of the options have to be
    enclosed in at least double quotes.  It is a good idea to enclose local
    macro strings in compound double <b>quotes</b> in case the macro contains
    quotes.
<p>
    The maximum number of characters submitted to an option of <b>lstrfun</b> in
    total cannot exceed the <b>maximum length of strings</b> in Stata minus about 50
    (which is about how many characters are used to submit <b>lstrfun</b>).  The
    command <b>file read</b> can create local macros with more characters than Stata
    allows.  If you get the following error messages when submitting <b>lstrfun</b>,
    then the submitted macro has too many characters:
<p>
    <b>unmatched quote</b>
    r(198);
    <b>too many macros</b>
    r(920);
    <b>command too long</b>
    r(1004);
<p>
    If you are using Stata SE or Stata MP, then increase your setting of
    <b>maxvar</b> since it affects the maximum <b>number of characters in a macro</b>.
<p>
<b><u>Examples of modifying local macros</u></b>
    It is a good idea to use <b>macval()</b> when submitting a macro so that if the
    submitted macro contains a macro: <i>`something'</i> then it is left as is.
<p>
    <b>. lstrfun mvar, lower(`"`mvar'"')</b>
<p>
    <b>. lstrfun mvar, itrim(`"`macval(mvar)'"')</b>
<p>
    <b>. lstrfun mvar, substr(`"`mvar'"', 332, 3235)</b>
<p>
    <b>. lstrfun mvar, _substr(`"`macval(mvar)'"', "XX", 20345)</b>
<p>
    <b>. lstrfun mvar, regexr(`"`macval(mvar)'"', `"Geo(rgi)e.Boy"', "George's</b>
        <b>son")</b>
<p>
<b><u>Examples of creating new local macros</u></b>
<p>
    <b>. lstrfun new_mvar, strpos(`"`mvar'"', "needle in the haystack")</b>
<p>
    <b>. lstrfun new_mvar, strmatch(`"`mvar'"', "mat*me")</b>
<p>
    <b>. lstrfun new_mvar, strmatch(`"`macval(mvar)'"', `"`macval(mvar2)'"')</b>
<p>
    <b>. lstrfun new_mvar, indexnot("abcdef", `"`mvar'"')</b>
<p>
    <b>. lstrfun new_mvar, regexm(`"`macval(mvar)'"', `".*Georgie.Boy*"')</b>
<p>
    <b>. lstrfun new_mvar, regexms(`"`macval(mvar)'"', `".*Geo(rgi)e.Boy*"', 1)</b>
<p>
<b><u>Author</u></b> 
<p>
    Dan Blanchette
    The Carolina Population Center
    University of North Carolina - Chapel Hill, USA
    dan_blanchette@unc.edu
<p>
<b><u>Note</u></b>
Useful suggestions and feedback by Nick Cox are gratefully acknowledged.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>string functions</b>, <b>Mata string manipulation functions</b>, and
             <b>extended macro functions</b>
<p>
</pre>