<pre>
<p>
<b>help lclogit</b>                                                                   
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>lclogit</b> --  Latent class logit model via EM algorithm
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>lclogit</b> <i>depvar</i> [<i>indepvars</i>] [<i>if</i>] [<i>in</i>]<b>,</b> <b><u>gr</u></b><b>oup(</b><i>varname</i><b>)</b> <b>id(</b><i>varname</i><b>)</b>
               <b><u>ncl</u></b><b>asses(</b>#<b>)</b> [, <b><u>mem</u></b><b>bership(</b><i>varlist</i><b>)</b> <b><u>conv</u></b><b>ergence(</b>#<b>)</b> <b><u>iter</u></b><b>ate(#)</b>
               <b><u>const</u></b><b>raints(</b><i>Class#1 numlist</i>: <i>Class#2 numlist</i>: ...<b>)</b> <b>seed(</b><i>#</i><b>)</b>
               <b><u>no</u></b><b>log</b>]
<p>
<b><u>Description</u></b>
<p>
    <b>lclogit</b> fits latent class conditional logit models through an
    Expectation-Maximisation algorithm proposed in Bhat (1997) and Train
    (2008). The data setup is the same as for <b>clogit</b>.
<p>
    Note: Maartin Buis's <b>fmlogit</b> (findit fmlogit) needs to be installed
    before <b>membership(</b><i>varlist</i><b>)</b> is used to let the class shares depend on the
    choice maker's characteristics.
<p>
<b><u>Options for lclogit</u></b>
<p>
    <b>group(</b><i>varname</i><b>)</b> is required and specifies a numeric identifier variable
        for the choice situations.
<p>
    <b>id(</b><i>varname</i><b>)</b> is required and specifies a numeric identifier variable for
        the choice makers or agents. With cross section data users should
        specify the same variable for both <b>id(</b><i>varname</i><b>)</b> and <b>group(</b><i>varname</i><b>)</b>
<p>
    <b>nclasses(</b><i>#</i><b>)</b> specifies the number of latent classes used in the
        estimation. A minimum of 2 latent classes is required.
<p>
    <b>membership(</b><i>varlist</i><b>)</b> specifies indepedent variables to enter the
        fractional multinomial logit model of class membership.  These
        variables are assumed to be constant across alternatives and choice
        occasions for the same agent, age and household income being typical
        examples.
<p>
    <b>convergence(</b><i>#</i><b>)</b> specfies the tolerance for the log likelihood. When the
        proportional increase in the log likelihood over the last five
        iterations is less than the specified criterion, lclogit declares
        convergence. The default is 0.00001.
<p>
    <b>iterate(</b><i>#</i><b>)</b> specifies the number of maximum iterations. The default is
        150.
<p>
    <b>seed(</b><i>#</i><b>)</b> sets the seed for pseudo uniform random numbers. The default is
        <b>c(seed)</b>.
<p>
        The starting values for the taste coefficients are obtained by
        splitting the sample into <b>nclasses()</b> different subsamples and
        estimating a <b>clogit</b> model for each of them. During this process, a
        pseudo uniform random number is generated for each agent to assign
        the agent into a particular subsample. As for the starting values for
        the class shares, <b>lclogit</b> uses equal shares, i.e. 1/<b>nclasses()</b>.
<p>
    <b>constraints(</b><i>Class#1 numlist</i>: <i>Class#2 numlist</i>: ...<b>)</b> specifies constraints
        to be imposed on the taste coefficients of the desginated classes.
        For instance, suppose that x1 and x2 are attributes included among
        <i>indepvars</i> and the user wishes to restrict the coefficient on x1 to
        zero for Class3 and Class4, and the coefficient on x2 to 2 for
        Class4. The relevant series of commands would look like:
<p>
        <b>constraint</b> 1 x1 = 0
<p>
        <b>constraint</b> 2 x2 = 2
<p>
        <b>lclogit</b> <i>depvar</i> <i>indepvars</i> [<i>if</i>] [<i>in</i>] <b>,</b> <b><u>gr</u></b><b>oup(</b><i>varname</i><b>)</b> <b>id(</b><i>varname</i><b>)</b>
        <b>constraints(</b>Class3 1: Class4 1 2<b>)</b> <b>nclasses(</b><i>8</i><b>)</b>
<p>
    <b>nolog</b> suppresses the display of an iteration log.
<p>
<b><u>Example</u></b>
<p>
    Consider the following example that contains the first rows from the data
    used in Huber and Train (2001).  <b>pid</b> is the agent, <b>gid</b> the choice
    situation, <b>y</b> the dependent variable and<b> contract</b>, <b>local</b>, <b>wknown</b>, <b>tod</b> and
    <b>seasonal</b> are alternative-specific attributes:
<p>
<p>
<b>     pid   gid     y      price   contract   local   wknown   tod   seasonal</b>
<b>      1     1      0        7        5         0       1       0       0</b>
<b>      1     1      0        9        1         1       0       0       0</b>
<b>      1     1      0        0        0         0       0       0       1</b>
<b>      1     1      1        0        5         0       1       1       0</b>
<b>      1     2      0        7        0         0       1       0       0</b>
<b>      1     2      0        9        5         0       1       0       0</b>
<b>      1     2      1        0        1         1       0       1       0</b>
<b>      1     2      0        0        5         0       0       0       1       </b>
<b>&gt;         </b>
<p>
          
    <b>lclogit</b> can be particularly useful for the nonparametric estimation of
    mixing distributions.  Indeed, when the number of latent classes
    increases, the true mixing distribution of the coefficients can be
    approximated nonparametrically.
<p>
    Latent class models have been estimated via gradient-based algorithms,
    such as Newton-Raphson or BHHH. However, the estimation through standard
    optimization techniques becomes difficult when the number of parameters
    increases.  In this case an EM procedure could help as it requires the
    repeated evaluation of a function that is far easier to maximize.
<p>
    Clearly, the first goal when dealing with latent class models is to
    determine the optimal number of latent classes. Train (2008) bases this
    decision on goodness-of-fit measures such as the AIC or the BIC.  Here we
    show how to determine the optimal number of latent classes using <b>lclogit</b>
    and the BIC:
<p>
        <b>. use http://fmwww.bc.edu/repec/bocode/t/traindata.dta, clear</b>
        <b>2. forvalues c=2/11{</b>
        <b>3.  lclogit y price contract local wknown tod seasonal, id(pid)</b>
            <b>gr(gid) ncl(`c')</b>
        <b>4.  scalar bic_`c'=e(bic)</b>
        <b>5. }</b>
        <b>6. forvalues c=2/11{</b>
        <b>7.  display bic_`c'</b>
        <b>8. }</b>
<p>
<b><u>Saved results</u></b>
<p>
    <b>lclogit</b> saves the following in <b>e()</b>:
<p>
    Scalars        
      <b>e(N)</b>                number of observations
      <b>e(N_g)</b>              number of choice situations identifed by <b>group()</b>
      <b>e(N_i)</b>              number of agents identifed by <b>id()</b>
      <b>e(nclasses)</b>         number of latent classes
      <b>e(ll)</b>               log likelihood
      <b>e(bic)</b>              Bayesian information criterion
      <b>e(aic)</b>              Akaike information criterion
      <b>e(caic)</b>             Consistent Akaike information criterion
<p>
    Macros         
      <b>e(cmd)</b>              <b>lclogit</b>
      <b>e(title)</b>            Model estimated via EM algorithm
      <b>e(group)</b>            name of <b>group()</b> variable
      <b>e(id)</b>               name of <b>id()</b> variable
      <b>e(indepvars)</b>        names of independent variables in the choice model
      <b>e(indepvars2)</b>       names of independent variables in the class
                            membership model
      <b>e(seed)</b>             pseudo random number seed
<p>
    Matrices       
      <b>e(b)</b>                vector of taste coefficients followed by class
                            membership model coefficients
      <b>e(B)</b>                matrix of taste coefficients
      <b>e(P)</b>                vector of (estimation sample average) class shares
      <b>e(PB)</b>               vector of weighted average choice model
                            coefficients, where weights = class shares
      <b>e(CB)</b>               (estimation sample average) covariance matrix of
                            choice model coefficients
      <b>e(Cns)</b>              constraints matrix
    Functions      
      <b>e(sample)</b>           marks estimation sample
<p>
<b><u>Reference</u></b>
    Bhat, C., 1997. <i>An endogenous segmentation mode choice model with an</i>
        <i>application to intercity travel</i>. Transportation Science 31, 34-48.
<p>
    Train, K., 2008. <i>EM Algorithms for Nonparametric Estimation of Mixing</i>
        <i>Distributions</i>. Journal of Choice Modelling 1 (1) 40-69.
<p>
    Huber, J. and K. Train, 2001. <i>On the similarity of classical and bayesian</i>
        <i>estimates of individual mean partworths</i>, Marketing Letters 12,
        259-269.
<p>
<b><u>Authors</u></b>
<p>
    This command was written by Daniele Pacifico and Hong il Yoo. Comments
    and suggestions are welcome.
     
    Daniele Pacifico (daniele.pacifico@tesoro.it): Italian Department of the
    Treasury, Italy.
 
    Hong il Yoo (h.yoo@unsw.edu.au):  School of Economics, University of New
    South Wales, Australia.
 
<p>
<b><u>Also see</u></b>
<p>
    Online:  <b>[R] lclogit</b>, <b>lclogit postestimation</b>, <b>fmlogit</b>
</pre>