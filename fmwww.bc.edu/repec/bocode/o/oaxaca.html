<pre>
<b>help oaxaca</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>oaxaca</b> -- Blinder-Oaxaca decomposition of outcome differentials
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>oaxaca</b> <i>depvar</i> [<i>indepvars</i>] [<i>if</i>] [<i>in</i>] [<i>weight</i>] <b>,</b> <b>by(</b><i>groupvar</i><b>)</b> [ <i>options</i>
               ]
<p>
<p>
    where <i>indepvars</i> is  <i>term</i> [<i>term</i> <i>...</i>]
<p>
          with <i>term</i> as  <i>varlist</i>
                    or  <b>(</b>[<i>name</i><b>:</b>] <i>varlist</i><b>)</b>
<p>
    and <i>varlist</i> may contain <b><u>n</u></b><b>ormalize(</b><i>spec</i><b>)</b>
<p>
<p>
<a name="opt"></a>    <i>options</i>                    Description
    -------------------------------------------------------------------------
    Main
      <b>by(</b><i>groupvar</i><b>)</b>             specifies the groups; <b>by()</b> is required
      <b>swap</b>                     swap groups
      <b><u>lin</u></b><b>ear</b>                   linear decomposition; the default
      <b>logit</b>                    logit decomposition
      <b>probit</b>                   probit decomposition
      <b><u>nod</u></b><b>etail</b>                 suppress detailed decomposition
      <b><u>a</u></b><b>djust(</b><i>varlist</i><b>)</b>          adjustment for selection variables
<p>
    Decomposition type
      <b><u>three</u></b><b>fold</b>[<b>(</b><b><u>r</u></b><b>everse)</b>]     three-fold decomposition; the default
      <b><u>w</u></b><b>eight(</b><i># </i>[<i># </i>...]<b>)</b>        two-fold decomposition using specified weights
      <b><u>p</u></b><b>ooled</b>[<b>(</b><i>model_opts</i><b>)</b>]     two-fold decomposition using pooled model
                                 including <i>groupvar</i>
      <b><u>o</u></b><b>mega</b>[<b>(</b><i>model_opts</i><b>)</b>]      two-fold decomposition using pooled model
                                 excluding <i>groupvar</i>
      <b><u>ref</u></b><b>erence(</b><i>name</i><b>)</b>          two-fold decomposition using stored model
      <b>split</b>                    split unexplained part of two-fold
                                 decomposition
<p>
    SE/SVY
      <b>svy</b>[<b>(</b><i>svyspec</i><b>)</b>]           survey data estimation
      <b>vce(</b><i>vcetype</i><b>)</b>             <i>vcetype</i> may be may be <b>analytic</b>, <b><u>r</u></b><b>obust</b>,
                                 <b><u>cl</u></b><b>uster</b> <i>clustvar</i>, <b><u>boot</u></b><b>strap</b>, or <b><u>jack</u></b><b>knife</b>
      <b><u>cl</u></b><b>uster(</b><i>varname</i><b>)</b>         adjust standard errors for intragroup
                                 correlation (Stata 9)
      <b><u>fix</u></b><b>ed</b>[<b>(</b><i>varlist</i><b>)</b>]         assume non-stochastic regressors
      <b>suest</b>[<b>(</b><i>name</i><b>)</b>] | <b>nosuest</b>  do/do not use <b>suest</b> to obtain joint variance
                                 matrix
      <b>nose</b>                     suppress computation of standard errors
<p>
    Models
      <b>model1(</b><i>model_opts</i><b>)</b>       estimation details for the Group 1 model
      <b>model2(</b><i>model_opts</i><b>)</b>       estimation details for the Group 2 model
      <b><u>noi</u></b><b>sily</b>                  display model estimation output
      <b>relax</b>                    do no stop on dropped coefficients/zero
                                 variances
      <i>estopts</i>                  options passed through to all models
<p>
    X-Values (linear decomposition only)
      <b>x1(</b><i>names_and_values</i><b>)</b>     provide custom X-values for Group 1
      <b>x2(</b><i>names_and_values</i><b>)</b>     provide custom X-values for Group 2
<p>
    Reporting
      <b>xb</b>                       display table with coefficients and means
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>                 set confidence level; default is <b>level(95)</b>
      <b>eform</b>                    report exponentiated results
      <b><u>nole</u></b><b>gend</b>                 suppress legend
    -------------------------------------------------------------------------
    <b>bootstrap</b>, <b>by</b>, <b>jackknife</b>, <b>statsby</b>, and <b>xi</b> are allowed; see prefix.
    Weights are not allowed with the <b>bootstrap</b> prefix.
    <b>aweight</b>s are not allowed with the <b>jackknife</b> prefix.
    <b>vce()</b>, <b>cluster()</b>, and weights are not allowed with the <b>svy</b> option.
    <b>fweight</b>s, <b>aweight</b>s, <b>pweight</b>s, and <b>iweight</b> are allowed; see weight;
      <b>aweight</b>s are not allowed with <b>logit</b> or <b>probit</b>
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>oaxaca</b> computes the so-called Blinder-Oaxaca decomposition, which is
    often used to analyze wage gaps by sex or race. <i>depvar</i> is the outcome
    variable of interest (e.g. log wages) and <i>indepvars</i> are predictors (e.g.
    education, work experience, etc.). <i>groupvar</i> identifies the groups to be
    compared. The standard errors of the decomposition components are
    computed using the delta method and take into account the variability
    induced by stochastic regressors. For methods and formulas see Jann
    (2008).
<p>
    <b>oaxaca</b> also supports the non-linear decomposition for binary dependent
    variables proposed by Yun (2004). See the <b>logit</b> and <b>probit</b> options. An
    alternative non-linear decomposition for binary dependent variables,
    suggested by Fairlie (2005), is available as <b>fairlie</b> from the SSC Archive
    (see ssc describe fairlie).
<p>
    <b>oaxaca</b> typed without arguments replays the last results, optionally
    applying <b>xb</b>, <b>level()</b>, <b>eform</b>, or <b>nolegend</b>.
<p>
<a name="subsume"></a><p>
<b><u>Subsume results for sets of variables</u></b>
<p>
    Decomposition results can be aggregated for subsets of variables using
    syntax
<p>
        <i>...</i> <b>(</b>[<i>name</i><b>:</b>] <i>varlist</i><b>)</b> <i>...</i>
<p>
    where <i>name</i> provides a label for the subset (the name of the first
    variable in the subset is used as label if <i>name</i> is omitted). For example,
    you could type
<p>
        . oaxaca lnwage educ (expten: exper tenure), by(female)
<p>
    to subsume the contributions of <b>exper</b> and <b>tenure</b>. Apart from variable
    names, also <b>_cons</b> and <b>_offset</b> can be specified as part of a subset.
<p>
<a name="norm"></a><p>
<b><u>Normalization of categorical variables</u></b>
<p>
    For categorical regressors, the detailed decomposition results depend on
    the choice of the (omitted) base category. A solution is to compute the
    decomposition based on "normalized" effects, i.e. effects that are
    expressed as deviation contrasts from the grand mean (Yun 2005). To
    "normalize" the effects for a set of indicator variables representing a
    categorical variable include the indicator variables in the list of
    regressors using syntax
<p>
        <i>...</i> <b><u>n</u></b><b>ormalize(</b><i>spec</i><b>)</b> <i>...</i>
<p>
    where <i>spec</i> usually simply is the list of indicator variables.  Note that
    an indicator variable has to be supplied for every category (including
    the base category). For example, you could type
<p>
        . tabulate isco, generate(isco) nofreq
        . oaxaca lnwage educ exper normalize(isco1-isco9), by(female)
<p>
    The <b>tablate, generate()</b> command is a convenient way to generate a set of
    indicator variables from a categorical variable (such as the 9 major
    group ISCO-88 job classification). The base category to be omitted from
    model estimation can be designated using the <b>b.</b> operator, but this should
    not affect the decomposition results. For example, you could type
<p>
        ... normalize(married b.single divorced) ...
<p>
    The first variable is taken if no base category is marked.
<p>
    Note that <b>normalize()</b> is allowed within subsumed variable sets. For
    example, you could type
<p>
        ... (family: kids6 normalize(married b.single divorced)) ...
<p>
    Normalization can also be applied to interactions between a categorical
    variable and a continuous variable. In this case, type <b>#</b> followed by the
    name of the continuous variable at the end in <b>normalize()</b>. Because
    usually you would also want to normalize the main effects you should
    supply two <b>normalize()</b> statements, one for the main effects and one for
    the interactions. Example: Suppose <b>d1</b>, <b>d2</b>, and <b>d3</b> are indicator variables
    representing a categorical variable and <b>d1x</b>, <b>d2x</b>, and <b>d3x</b> are
    interactions of these indicators with a continuous variable <b>x</b>. You could
    then type
<p>
        ... normalize(d1 d2 d3) normalize(d1x d2x d3x # x) ...
<p>
<p>
<b><u>Options</u></b>
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>by(</b><i>groupvar</i><b>)</b> specifies the <i>groupvar</i> that defines the two groups that are
        to be compared. <b>by()</b> is required.
<p>
    <b>swap</b> reverses the order of the groups.
<p>
    <b>linear</b> causes the standard linear decomposition to be computed. This is
        the default. The estimation command for the group models defaults to 
        <b>regress</b>.
<p>
    <b>logit</b> causes the non-linear decomposition for a binary dependent variable
        to be computed using the weighting method described by Yun (2004).
        The estimation command for the group models defaults to <b>logit</b>.
<p>
    <b>probit</b> causes the non-linear decomposition for a binary dependent
        variable to be computed using the weighting method described by Yun
        (2004). The estimation command for the group models defaults to 
        <b>probit</b>.
<p>
    Only one of <b>linear</b>, <b>logit</b>, or <b>probit</b> is allowed.
<p>
    <b>nodetail</b> suppresses the detailed results and only computes the overall
        decomposition.
<p>
    <b>adjust(</b><i>varlist</i><b>)</b> causes the group differential to be adjusted by the
        contribution of the specified variables before computing the
        decomposition. This is useful, for example, if the specified
        variables are selection terms. Note that <b>adjust()</b> is not needed if 
        <b>heckman</b> is used to estimate the models. <b>_offset</b> is allowed in
        <b>adjust()</b>.
<p>
        +--------------------+
    ----+ Decomposition type +-----------------------------------------------
<p>
    <b>threefold</b>[<b>(reverse)</b>] computes the three-fold decomposition. This is the
        default. The decomposition is expressed from the viewpoint of Group
        2. Specify <b>threefold(reverse)</b> to express the decomposition from the
        viewpoint of Group 1.
<p>
    <b>weight(</b><i># </i>[<i># </i>...]<b>)</b> computes the two-fold decomposition where <i>#</i> [<i># ...</i>] are
        the weights given to Group 1 relative to Group 2 in determining the
        reference coefficients (weights are recycled if there are more
        coefficients than weights). For example, <b>weight(1)</b> uses the Group 1
        coefficients as the reference coefficients, <b>weight(0)</b> uses the Group
        2 coefficients.
<p>
    <b>pooled</b>[<b>(</b><i>model_opts</i><b>)</b>] computes the two-fold decomposition using the
        coefficients from a pooled model over both groups as the reference
        coefficients. <i>groupvar</i> is included in the pooled model as an
        additional control variable. Estimation details may be specified in
        parentheses; see the <b>model1()</b> option below.
<p>
    <b>omega</b>[<b>(</b><i>model_opts</i><b>)</b>] computes the two-fold decomposition using the
        coefficients from a pooled model over both groups as the reference
        coefficients (without including <i>groupvar</i> as a control variable).
        Estimation details may be specified in parentheses; see the <b>model1()</b>
        option below.
<p>
    <b>reference(</b><i>name</i><b>)</b> computes the two-fold decomposition using the
        coefficients from a stored model. <i>name</i> is the name under which the
        model was stored; see <b>estimates store</b>. It is suggested not to combine
        <b>reference()</b> with <b>vce(bootstrap)</b> or <b>vce(jackknife)</b>.
<p>
    <b>split</b> causes the "unexplained" component in the two-fold decomposition to
        be split into a part related to Group 1 and a part related to Group
        2.
<p>
    Only one of <b>threefold</b>, <b>weight()</b>, <b>pooled</b>, <b>omega</b>, and <b>reference()</b> is
    allowed.
<p>
        +----------+
    ----+ X-Values +---------------------------------------------------------
<a name="x1x2"></a><p>
    <b>x1(</b><i>names_and_values</i><b>)</b> and <b>x2(</b><i>names_and_values</i><b>)</b> provide custom values for
        specific predictors to be used for Group 1 and Group 2 in the
        decomposition (only allowed with linear decomposition). The default
        is to use the group means of the predictors. The syntax for
        <i>names_and_values</i> is
<p>
            <i>varname</i> [<b>=</b>] <i>value</i> [[<b>,</b>] <i>varname</i> [<b>=</b>] <i>value</i> <i>...</i> ]
<p>
        Example: <b>x1(educ 12 exp 30)</b>
<p>
        +--------+
    ----+ SE/SVY +-----------------------------------------------------------
<a name="svy"></a><p>
    <b>svy</b>[<b>(</b>[<i>vcetype</i>] [<b>,</b> <i>svy_options</i>]<b>)</b>] executes <b>oaxaca</b> while accounting for the
        survey settings identified by <b>svyset</b> (this is essentially equivalent
        to applying the <b>svy</b> prefix command, although the <b>svy</b> prefix is not
        allowed with <b>oaxaca</b> due to some technical issues). <i>vcetype</i> and
        <i>svy_options</i> are as described in help <b>svy</b>.
<p>
    <b>vce(</b><i>vcetype</i><b>)</b> specifies the type of standard errors reported. <i>vcetype</i> may
        be may be <b>analytic</b> (the default), <b>robust</b>, <b>cluster</b> <i>clustvar</i>,
        <b>bootstrap</b>, or <b>jackknife</b>; see <b>[R]</b> <i>vce_option</i>.
<p>
    <b>cluster(</b><i>varname</i><b>)</b> adjusts standard errors for intragroup correlation; this
        is Stata 9 syntax for <b>vce(cluster</b> <i>clustvar</i><b>)</b>.
<p>
    <b>fixed</b>[<b>(</b><i>varlist</i><b>)</b>] identifies fixed regressors (all if specified without
        argument; an example for fixed regressors are experimental factors).
        The default is to treat regressors as stochastic. Stochastic
        regressors inflate the standard errors of the decomposition
        components.
<p>
    <b>suest</b>[<b>(</b><i>name</i><b>)</b>] enforces using <b>suest</b> to obtain the covariances between the
        models/groups. <b>suest</b> is implied by <b>pooled</b>, <b>omega</b>, <b>reference()</b>, <b>svy</b>,
        <b>vce(cluster)</b>, and <b>cluster()</b>. Specify <b>suest(</b><i>name</i><b>)</b> to save <b>suest</b>'s
        estimation results under <i>name</i> using <b>estimates store</b>. <b>nosuest</b> prevents
        applying <b>suest</b> (this may cause biased standard errors).
<p>
    <b>nose</b> suppresses the computation of standard errors.
<p>
        +------------------+
    ----+ Model estimation +-------------------------------------------------
<a name="mopts"></a><p>
    <b>model1(</b><i>model_opts</i><b>)</b> and <b>model2(</b><i>model_opts</i><b>)</b> specify the estimation details
        for the two group models. The syntax for <i>model_opts</i> is
<p>
            [<i>estcom</i>] [<b>,</b> <b><u>sto</u></b><b>re(</b><i>name</i><b>)</b> <b><u>add</u></b><b>rhs(</b><i>spec</i><b>)</b> <i>estcom_options</i> ]
<p>
        where <i>estcom</i> is the estimation command to be used and <i>estcom_options</i>
        are options allowed by <i>estcom</i>. <b>store(</b><i>name</i><b>)</b> saves the model's
        estimation results under <i>name</i> using <b>estimates store</b>. <b>addrhs(</b><i>spec</i><b>)</b>
        adds <i>spec</i> to the "right-hand side" of the model. For example, use
        <b>addrhs()</b> to add extra variables to the model. Examples:
<p>
            <b>model1(heckman, select(</b><i>varlist_s</i><b>) twostep)</b>
<p>
            <b>model1(ivregress 2sls, addrhs((</b><i>varlist2</i><b>=</b><i>varlist_iv</i><b>)))</b>
<p>
        Note that <b>oaxaca</b> uses the first equation if a model contains multiple
        equations. Furthermore, coefficients that only occur in one of the
        models are assumed zero in the other model. It is required, however,
        that the associated variables contain non-missing values for all
        observations in both groups.
<p>
    <b>noisily</b> displays the models' estimation output.
<p>
    <b>relax</b> causes <b>oaxaca</b> to continue its computations even if coefficients are
        dropped from the models (e.g. due to collinearity) or if some
        coefficients have zero variances. The default is to return error in
        such a situation.
<p>
    <i>estopts</i> are common options to be passed through to the models.
<p>
        +-----------+
    ----+ Reporting +--------------------------------------------------------
<p>
    <b>xb</b> displays a table containing the regression coefficients and predictor
        values on which the decomposition is based.
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, as a percentage, for confidence
        intervals.  The default is <b>level(95)</b> or as set by <b>set level</b>.
<p>
    <b>eform</b> specifies that the results be displayed in exponentiated form.
<p>
    <b>nolegend</b> suppresses the legend about the sets of independent variables.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . use http://fmwww.bc.edu/RePEc/bocode/o/oaxaca.dta
<p>
        . oaxaca lnwage educ exper tenure, by(female)
<p>
        . oaxaca lnwage educ exper tenure, by(female) weight(1)
<p>
        . oaxaca lnwage educ exper tenure, by(female) pooled
<p>
        . svyset [pw=wt]
        . oaxaca lnwage educ exper tenure, by(female) pooled svy
<p>
        . oaxaca lnwage educ exper tenure, by(female) pooled vce(bootstrap)
<p>
        . tabulate isco, nofreq generate(isco)
        . oaxaca lnwage educ exper tenure normalize(isco?), by(female) pooled
<p>
<p>
        . use http://fmwww.bc.edu/RePEc/bocode/h/homecomp.dta, clear
        
        . oaxaca homecomp female age (educ:hsgrad somecol college)
             (marstat:married prevmar) if white==1|black==1, by(black)
             logit pooled
        
<p>
<b><u>Saved Results</u></b>
<p>
    Scalars   
      <b>e(N)</b>           number of observations
      <b>e(N_1)</b>         number of observations in Group 1
      <b>e(N_2)</b>         number of observations in Group 2
      <b>e(N_clust)</b>     number of clusters
<p>
    Macros    
      <b>e(cmd)</b>         <b>oaxaca</b>
      <b>e(title)</b>       <b>Blinder-Oaxaca decomposition</b>
      <b>e(by)</b>          name group variable
      <b>e(group_1)</b>     value of group variable for Group 1
      <b>e(group_2)</b>     value of group variable for Group 2
      <b>e(depvar)</b>      name of dependent variable
      <b>e(model)</b>       <b>linear</b>, <b>logit</b>, or <b>probit</b>
      <b>e(threefold)</b>   <b>threefold</b>, <b>threefold(reverse)</b>, or empty
      <b>e(weights)</b>     weights specified by <b>weight()</b> or empty
      <b>e(refcoefs)</b>    <b>pooled</b>, <b>omega</b>, name of reference model, or empty
      <b>e(legend)</b>      definitions of regressor sets
      <b>e(normalized)</b>  normalized indicator sets
      <b>e(adjust)</b>      names of adjustment variables
      <b>e(fixed)</b>       <b>fixed</b>, <b>fixed(</b><i>varlist</i><b>)</b>, or empty
      <b>e(suest)</b>       <b>suest</b> or empty
      <b>e(wtype)</b>       weight type
      <b>e(wexp)</b>        weight expression
      <b>e(clustvar)</b>    name of cluster variable
      <b>e(vce)</b>         <i>vcetype</i> specified in <b>vce()</b>
      <b>e(vcetype)</b>     title used to label Std. Err.
      <b>e(properties)</b>  <b>b V</b>
<p>
    Matrices  
      <b>e(b)</b>           decomposition results
      <b>e(V)</b>           variance-covariance matrix of decomposition results
      <b>e(b0)</b>          vector containing coefficients and X-values
      <b>e(V0)</b>          variance-covariance matrix of <b>e(b0)</b>
<p>
    Functions 
      <b>e(sample)</b>      marks estimation sample
<p>
<p>
<b><u>References</u></b>
<p>
    Fairlie, Robert W. (2005). An extension of the Blinder-Oaxaca
        decomposition technique to logit and probit models. Journal of
        Economic and Social Measurement 30: 305-316.
<p>
    Jann, Ben (2008). The Blinder-Oaxaca decomposition for linear regression
        models. The Stata Journal 8(4): 453-479. [Working paper version
        available from: http://ideas.repec.org/p/ets/wpaper/5.html]
<p>
    Yun, Myeong-Su (2004). Decomposing differences in the first moment.
        Economics Letters 82: 275-280.
<p>
    Yun, Myeong-Su (2005). A Simple Solution to the Identification Problem in
        Detailed Wage Decompositions. Economic Inquiry 43: 766-772.
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, Institute of Sociology, University of Bern, jann@soz.unibe.ch
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  help for <b>regress</b>, <b>logit</b>, <b>probit</b>, <b>heckman</b>, <b>suest</b>, <b>svyset</b>; <b>fairlie</b>
</pre>