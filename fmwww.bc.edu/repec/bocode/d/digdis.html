<pre>
<b>help digdis</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>digdis</b> -- Analysis of digit distributions
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>digdis</b> <i>varlist</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <i>options</i> ]
<p>
<p>
        <b>digdis</b> <i>varname</i> [<i>if</i>] [<i>in</i>] [<i>weight</i>] [<b>,</b> <b>by(</b><i>groupvar</i><b>)</b> <i>options</i> ]
<p>
<p>
<a name="opt"></a>    <i>options</i>                Description
    -------------------------------------------------------------------------
    Main
      <b><u>p</u></b><b>osition(</b><i>#</i><b>)</b>          digit position (1st is default); <i>#</i> in [1,6]
      <b><u>b</u></b><b>ase(</b><i>#</i><b>)</b>              base of number system (10 is default); <i>#</i> in [2,10]
      <b><u>d</u></b><b>ecimalplaces(</b><i>#</i><b>)</b>     precision of input values (number of decimal
                             places)
      <b><u>ben</u></b><b>ford</b>              reference is Benford's law (the default)
      <b><u>uni</u></b><b>form</b>              reference distribution is uniform
      <b><u>mat</u></b><b>rix(</b><i>name</i><b>)</b>         user defined reference distribution
      <b>test(</b><i>mgof_opts</i><b>)</b>      options for goodness-of-fit test
      <b>notest</b>               suppress goodness-of-fit test
      <b>nofreq</b>               suppress frequency table
      <b><u>g</u></b><b>enerate(</b><i>newvarlist</i><b>)</b> save variable(s) containing digits
      <b><u>r</u></b><b>eplace</b>              overwrite existing variables
<p>
    Graph
      <b><u>gr</u></b><b>aph</b>                display graph
      <b><u>per</u></b><b>cent</b>              scale is in percent (default)
      <b><u>frac</u></b><b>tion</b>             scale is in proportions
      <b>count</b>                scale is in counts
      <i>bar_options</i>          affect rendition of observed distribution
      <b>ci</b>[<b>(</b><i>type</i><b>)</b>]           include confidence intervals (capped spikes)
      <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>             set confidence level; default is <b>level(95)</b>
      <b><u>ciopt</u></b><b>s(</b><i>rcap_opts</i><b>)</b>    affect rendition of confidence spikes
      <b><u>refopt</u></b><b>s(</b><i>options</i><b>)</b>     affect rendition of reference distribution
      <b>noref</b>                suppress reference distribution
      <b>addplot(</b><i>plot</i><b>)</b>        add other plots to the generated graph
      <i>twoway_options</i>       any options other than <b>by()</b> documented in help 
                             <i>twoway_options</i>
<p>
    By
      <b>by(</b><i>groupvar</i><b>)</b>         repeat results for subgroups
      <b><u>byopt</u></b><b>s(</b><i>by_subopts</i><b>)</b>   graph <i>suboptions</i> for <b>by()</b>
    -------------------------------------------------------------------------
<p>
    <b>by</b> is allowed; see help <b>by</b>.
    <b>fweight</b>s are allowed; see help weight.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>digdis</b> tabulates the distribution of digits of the variables in <i>varlist</i>,
    performs goodness-of-fit tests against a reference distribution and,
    optionally, graphs the distributions. The default is to tabulate the
    first (nonzero) digit; specify, e.g., <b>position(2)</b> to tabulate the second
    digit. The default reference distribution is given by Benford's law.
<p>
    The variables in <i>varlist</i> may be numeric or string (see help data types).
    It is sensible in some situations to use string variables to store the
    numbers to be analyzed, since this ensures that the numbers remain
    exactly as is. Note that, if the storage type is <b>float</b> or <b>double</b> the
    numbers will be right-padded with zeros (i.e. 1.3 is interpreted as
    1.3000...) unless the <b>decimalplaces()</b> option is specified. Using the
    <b>float</b> storage type is strongly discouraged because of it's limited
    precision. For example, the number 1.30 is 1.29999995... in <b>float</b>
    accuracy and <b>digdis</b> will, e.g., read a 2 for the second digit (unless the
    <b>decimalplaces()</b> option is used to round the number).
<p>
    <b>digdis</b> sometimes displays notes such as "x: 7 invalid observations". An
    observation is considered invalid if (1) it's value 0, (2) <b>position(#)</b>&gt;1
    is specified and the value does not have a <i>#</i>-th digit, or (3) the input
    variable is string and contains a nonnumeric value.
<p>
<p>
<b><u>Dependencies</u></b>
<p>
    <b>digdis</b> requires <b>moremata</b> and <b>mgof</b>. Type
<p>
        . ssc describe moremata
<p>
        . ssc describe mgof
<p>
<b><u>Options</u></b>
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>position(</b><i>#</i><b>)</b>, where <i>#</i> in [1,6], specifies the position of the digits to be
        tabulated. <b>position(1)</b> is the default. Examples: The fist digits of
        236, 4.015, and 0.00789 are 1, 4, and 7; the second digits are 3, 0,
        and 8; the third digits are 6, 1, and 9.
<p>
    <b>base(</b><i>#</i><b>)</b>, where <i>#</i> in [2,10], specifies the base of the number system.
        <b>base(10)</b> is the default. This option is rarely used.
<p>
    <b>decimalplaces(</b><i>#</i><b>)</b> specifies the number of decimal places of the input
        values. This option has an effect only if the storage type of the
        variable is <b>float</b> or <b>double</b> (see help data types). <b>decimalplaces(</b><i>#</i><b>)</b>
        rounds the values to <i>#</i> decimal places.
<p>
    <b>benford</b> specifies that the expected distribution be computed according to
        Benford's law (see help for <b>mm_benford()</b>). This is the default.
<p>
    <b>uniform</b> specifies that the expected distribution is uniform.
<p>
    <b>matrix(</b><i>name</i><b>)</b> provides the name of a matrix containing the expected
        distribution. The matrix should be a column vector containing the
        proportions or the expected counts of the digits in ascending order
        (i.e. frequency of 1's in the first column, frequency of 2's in the
        second column, etc., or, if <b>position()</b>&gt;1 is specified, frequency of
        0's in the first column, frequency of 1's in the second column, etc.)
<p>
    <b>test(</b><i>mgof_opts</i><b>)</b> specifies options to be passed through to the <b>mgof</b>
        command, which is used to perform goodness-of-fit tests (see help 
        <b>mgof</b>). For example, type <b>test(mc)</b> to perform exact tests using the
        Monte Carlo method instead of asymptotic tests.
<p>
    <b>notest</b> suppresses the goodness-of-fit tests.
<p>
    <b>nofreq</b> suppresses the frequency table(s).
<p>
    <b>generate(</b><i>newvarlist</i><b>)</b> causes variables to be generated containing the
        extracted digits. Specify one <i>newvar</i> for each input variable.
<p>
    <b>replace</b> allows the <b>generate()</b> option to overwrite existing variables.
<p>
        +-------+
    ----+ Graph +------------------------------------------------------------
<p>
    <b>graph</b> displays the observed digit distribution in a graph as a bar plot
        (see help <b>twoway bar</b>). The reference distribution is overlayed as
        connected-line plot (see help <b>twoway connected</b>). Type <b>noref</b> to omit
        the reference distribution.
<p>
    <b>percent</b> displays percentages. This is the default
<p>
    <b>fraction</b> displays proportions.
<p>
    <b>count</b> displays counts.
<p>
    <i>bar_options</i> affect the rendition of the plotted distribution. See help 
        <b>twoway bar</b>.
<p>
<a name="ci"></a>    <b>ci</b>[<b>(</b><i>type</i><b>)</b>] specifies that pointwise confidence intervals of the observed
        distribution be plotted as capped spikes.  <i>type</i> sets the calculation
        method and may be <b><u>exa</u></b><b>ct</b> (the default), <b><u>wa</u></b><b>ld</b>, <b><u>w</u></b><b>ilson</b>, <b><u>a</u></b><b>gresti</b>, or
        <b><u>j</u></b><b>effreys</b> (see help <b>ci</b>). Alternatively, <i>type</i> may be <b>reference</b> in which
        case point-wise probability intervals are plotted around the
        reference distribution as a connected-line range plot (the intervals
        are the shortest intervals with a probability mass of at least the
        value of the confidence level).
<p>
    <b>level(</b><i>#</i><b>)</b> specifies the confidence level, as a percentage, for the plotted
        confidence intervals. The default is <b>level(95)</b> or as set by <b>set</b>
        <b>level</b>.
<p>
    <b>ciopts(</b><i>options</i><b>)</b> affects the rendition of the confidence spikes. See help 
        <b>twoway rcap</b> or, if <b>ci(reference)</b> is used, help <b>twoway rconnected</b>.
<p>
    <b>noref</b> suppresses plotting the reference distribution.
<p>
    <b>refopts(</b><i>connected_options</i><b>)</b> affects the rendition of the plotted reference
        distribution. See help <b>twoway connected</b>.
<p>
    <b>addplot(</b><i>plot</i><b>)</b> provides a way to add other plots to the generated graph.
        See help addplot_option.
<p>
    <i>twoway_options</i> are any of the options documented in <i>twoway_options</i>,
        excluding <b>by()</b>.
<p>
        +----+
    ----+ By +---------------------------------------------------------------
<p>
    <b>by(</b><i>groupvar</i><b>)</b> repeats the analysis for the groups defined by <i>groupvar</i>. The
        individual goodness-of-fit tests are included in a single table and
        the individual plots are drawn within a single graph. Note that
        <b>digdis</b> also allows the <b>by</b> prefix command, which arranges output
        differently. A difference between the <b>by()</b> option and the <b>by</b> prefix
        is also that <b>by()</b> returns in <b>r()</b> the results for all groups whereas
        the <b>by</b> prefix only returns the results for the last group.
<p>
    <b>byopts(</b><i>by_subopts</i><b>)</b> affects the arrangement of the individual plots in the
        graph. See the <i>suboptions</i> in help <i>by_option</i>. Do not use the <b>total</b>
        suboption.
<p>
<p>
<b><u>Examples</u></b>
<p>
        . sysuse auto
        (1978 Automobile Data)
<p>
        . digdis price
        
        Digit distribution (1st digit)
<p>
               Value |     Count    Percent    Percent      Diff.    P-value
                     |             Observed   Expected      (MAD)
        -------------+------------------------------------------------------
                   1 |        10     13.514     30.103    -16.589     0.0014
                   2 |         0      0.000     17.609    -17.609     0.0000
                   3 |        11     14.865     12.494      2.371     0.4844
                   4 |        26     35.135      9.691     25.444     0.0000
                   5 |        14     18.919      7.918     11.001     0.0018
                   6 |         7      9.459      6.695      2.765     0.3456
                   7 |         2      2.703      5.799     -3.096     0.4482
                   8 |         2      2.703      5.115     -2.413     0.5918
                   9 |         2      2.703      4.576     -1.873     0.7767
        -------------+------------------------------------------------------
               Total |        74    100.000    100.000      9.240
        
        
        Goodness-of-fit tests        method =   approx
                               observations =       74
                                 categories =        9
                                         df =        8
<p>
        ----------------------------------------------
               Test statistic |       Coef.    P-value
        ----------------------+-----------------------
                 Pearson's X2 |    84.35215     0.0000
         Log likelihood ratio |    76.29649     0.0000
        ----------------------------------------------
<p>
        . digdis price, position(2)
        
        Digit distribution (2nd digit)
<p>
               Value |     Count    Percent    Percent      Diff.    P-value
                     |             Observed   Expected      (MAD)
        -------------+------------------------------------------------------
                   0 |         7      9.459     11.968     -2.508     0.5948
                   1 |        13     17.568     11.389      6.179     0.0991
                   2 |         7      9.459     10.882     -1.423     0.8522
                   3 |         7      9.459     10.433     -0.973     1.0000
                   4 |         7      9.459     10.031     -0.571     1.0000
                   5 |         4      5.405      9.668     -4.262     0.3212
                   6 |         4      5.405      9.337     -3.932     0.3182
                   7 |        12     16.216      9.035      7.181     0.0406
                   8 |         9     12.162      8.757      3.405     0.3000
                   9 |         4      5.405      8.500     -3.094     0.5279
        -------------+------------------------------------------------------
               Total |        74    100.000    100.000      3.353
        
        
        Goodness-of-fit tests        method =   approx
                               observations =       74
                                 categories =       10
                                         df =        9
<p>
        ----------------------------------------------
               Test statistic |       Coef.    P-value
        ----------------------+-----------------------
                 Pearson's X2 |    11.75117     0.2277
         Log likelihood ratio |    11.12604     0.2672
        ----------------------------------------------
<p>
        . set seed 3217367
        
        . digdis price, position(2) test(mc) nofreq
        
        Goodness-of-fit tests                                method =       mc
                                                       observations =       74
                                                         categories =       10
                                                       replications =    10000
<p>
        ----------------------------------------------------------------------
               Test statistic |       Coef.    P-value    [99% Conf. Interval]
        ----------------------+-----------------------------------------------
                 Pearson's X2 |    11.75117     0.2234      0.2128      0.2343
         Log likelihood ratio |    11.12604     0.2894      0.2778      0.3012
        ----------------------------------------------------------------------
<p>
        . digdis price, position(2) graph nofreq
          notest ti("Second digit distribution")
        
        . digdis price, position(2) by(foreign) graph
          byopts(ti("Second digit distribution"))
<p>
        -----------------------------------------------------------------------
        -&gt; foreign = 0
        
        Digit distribution (2nd digit)
<p>
               Value |     Count    Percent    Percent      Diff.    P-value
                     |             Observed   Expected      (MAD)
        -------------+------------------------------------------------------
                   0 |         6     11.538     11.968     -0.429     1.0000
                   1 |        10     19.231     11.389      7.842     0.0807
                   2 |         3      5.769     10.882     -5.113     0.3687
                   3 |         6     11.538     10.433      1.106     0.8189
                   4 |         6     11.538     10.031      1.508     0.6448
                   5 |         3      5.769      9.668     -3.898     0.4812
                   6 |         2      3.846      9.337     -5.491     0.2331
                   7 |         7     13.462      9.035      4.426     0.2313
                   8 |         6     11.538      8.757      2.781     0.4576
                   9 |         3      5.769      8.500     -2.731     0.6239
        -------------+------------------------------------------------------
               Total |        52    100.000    100.000      3.533
<p>
        -----------------------------------------------------------------------
        -&gt; foreign = 1
        
        Digit distribution (2nd digit)
<p>
               Value |     Count    Percent    Percent      Diff.    P-value
                     |             Observed   Expected      (MAD)
        -------------+------------------------------------------------------
                   0 |         1      4.545     11.968     -7.422     0.5072
                   1 |         3     13.636     11.389      2.247     0.7331
                   2 |         4     18.182     10.882      7.300     0.2916
                   3 |         1      4.545     10.433     -5.888     0.7224
                   4 |         1      4.545     10.031     -5.485     0.7194
                   5 |         1      4.545      9.668     -5.122     0.7174
                   6 |         2      9.091      9.337     -0.247     1.0000
                   7 |         5     22.727      9.035     13.692     0.0431
                   8 |         3     13.636      8.757      4.879     0.4355
                   9 |         1      4.545      8.500     -3.954     1.0000
        -------------+------------------------------------------------------
               Total |        22    100.000    100.000      5.624
        
        -----------------------------------------------------------------------
<p>
        Goodness-of-fit tests
<p>
             foreign |      Obs.         X2    P-value         LR    P-value
        -------------+------------------------------------------------------
                   0 |        52   8.783497     0.4575   9.041643     0.4334
                   1 |        22   9.744576     0.3716    9.01948     0.4355
        
        . digdis displ, graph ci nofreq notest
        
        . digdis displ, graph ci(ref) nofreq notest
        
<p>
<b><u>Returned results</u></b>
<p>
    <b>digdis</b> saves the following in <b>r()</b>:
<p>
    Scalars
      <b>r(N)</b>         number of observations
      <b>r(position)</b>  digit position
      <b>r(base)</b>      base of number system
      <b>r(mad)</b>       mean average percentage deviation between observed and
                   expected distribution
      <b>r(level)</b>     confidence level as a percentage (if <b>ci</b> is specified)
      <b>r(</b><i>stat</i><b>)</b>      value of test statistic
      <b>r(p_</b><i>stat</i><b>)</b>    p-value of <b>r(</b><i>stat</i><b>)</b>
<p>
                   where <i>stat</i> may be <b>x2</b>, <b>lr</b>, <b>cr</b>, <b>mlnp</b>, or <b>ksmirnov</b>, depending
                   on <b>test()</b>
<p>
    Macros
      <b>r(cmd)</b>       "digdis"
      <b>r(refdist)</b>   type of reference distribution ("Benford", "uniform", or
                   "user")
      <b>r(citype)</b>    confidence interval type (if <b>ci</b> is specified)
      <b>r(byvar)</b>     name of variable specified in <b>by()</b>
<p>
    Matrices
      <b>r(count)</b>     observed and expected counts
      <b>r(pvals)</b>     p-values of individual differences
      <b>r(ci)</b>        pointwise confidence intervals (if <b>ci</b> is specified)
<p>
    <b>r(N)</b>, <b>r(mad)</b>, <b>r(</b><i>stat</i><b>)</b>, and <b>r(p_</b><i>stat</i><b>)</b> are matrices if <b>digdis</b> is used with
    more than one variable or if <b>by()</b> is specified.
<p>
<p>
<b><u>Author</u></b>
<p>
    Ben Jann, ETH Zurich, jann@soz.gess.ethz.ch
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  help for <b>tabulate</b>, <b>graph</b>, <b>ci</b>, <b>mgof</b>, <b>mm_mgof()</b>, <b>mm_benford()</b>, 
</pre>