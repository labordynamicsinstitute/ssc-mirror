<pre>
-------------------------------------------------------------------------------
help for <b>devnplot</b>
-------------------------------------------------------------------------------
<p>
<b><u>Deviation plots</u></b> 
<p>
        <b>devnplot</b><i> yvar</i> [<i>x1var</i> [<i>x2var</i>]] [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>]
<p>
                 [<b>,</b> <b>overall</b> <b>level(</b><i>exp</i><b>)</b> <b>sort(</b><i>varlist</i><b>)</b> <b><u>miss</u></b><b>ing</b>
<p>
                 <b>separate(</b><i>true_or_false_condition</i><b>)</b>
                 <b>separateopts(</b><i>scatter_options</i><b>)</b>
<p>
                 <b>plines</b>[<b>(</b><i>added_line_options</i><b>)</b>]
                 <b>superplines</b>[<b>(</b><i>added_line_options</i><b>)</b>] <b>pgap(</b><i>#</i><b>)</b> <b>superpgap(</b><i>#</i><b>)</b>
<p>
                 <b>lineopts(</b><i>line_options</i><b>)</b> <b>rspikeopts(</b><i>rspike_options</i><b>)</b> <b>clean</b>
<p>
                 <i>scatter_options</i> ]
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>devnplot</b> by default plots the values of numeric variable <i>yvar</i> as
    deviations from the mean in increasing order. That is, each deviation is
    represented as a vertical spike with base given by the mean and with a
    marker symbol showing the value relative to a vertical scale.
<p>
    If one or both of <i>x1var</i> and <i>x2var</i> is also specified, observations are
    grouped by values of <i>x1var</i> (and <i>x2var</i> when specified). Deviations are
    plotted from the means of <i>yvar</i> for each distinct group so defined, unless
    the option <b>overall</b> is also specified. Such distinct groups are considered
    to define distinct "panels".  If both <i>x1var</i> and <i>x2var</i> are specified,
    distinct groups defined by values of <i>x1var</i> are also considered to define
    distinct "superpanels".
<p>
    Further variations from the basic design may be obtained by particular
    option choices.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    The immediate stimulus for this program was provided by Whitlock and
    Schluter (2009, pp.396, 519). Further similar examples are given by
    Grafen and Hails (2002, pp.4-7).  Among antecedents, note various graphs
    in Pearson (1956) and the graph of Fisher (1925, Figure 3 and p.35)
    combining a quantile plot of rainfall and a plot of wheat yield versus
    the rank order of the corresponding rainfall. Not every graph needs a
    distinct name, but every Stata command does. "Deviation plot" is the
    author's suggestion.
<p>
    <i>x1var</i> and <i>x2var</i> may be numeric or string. In either case, missing values
    are ignored unless the <b>missing</b> option is specified.  In either case,
    variables are treated as categorical.
<p>
    Note that the values of <i>yvar</i> are plotted as separate variables if any
    other variable is specified. This allows the use of (e.g.) different
    marker symbols and colours if so desired. The default is to use the same
    marker symbol and colour, and where specified the same line colour, but
    those choices can be overridden. If you wish to show a particular group
    distinctively, that may be easiest to achieve using the Graph Editor.
<p>
    Some may find this a helpful plot for thinking about one-way or two-way
    analysis of variance.
<p>
    This plot is intended to work well with very different group numbers.
<p>
    <b>devnplot</b> is not designed to show scatter plots with regression lines for
    two measured variables with data points represented as deviations. For
    that problem, try code such as
<p>
    <b>. regress y x</b>
    <b>. predict predict</b>
    <b>. scatter y x || rspike y predict x || line predict x, sort ytitle("`:</b>
        <b>var label y'") legend(off)</b>
<p>
<p>
<b><u>Options</u></b> 
<p>
    <i>What is to be plotted</i>
<p>
    <b>overall</b> specifies that deviations are shown from the overall mean,
        regardless of any specification of <i>x1var</i> or <i>x2var</i>.
<p>
    <b>level(</b><i>exp</i><b>)</b> allows the use of any expression to define reference levels,
        rather than means. Commonly, but not necessarily, the expression will
        be either a numeric constant or a variable name. It need not be
        constant in value, even within groups of <i>x1var</i> and/or <i>x2var</i>.
<p>
    <b>sort(</b><i>varlist</i><b>)</b> specifies that values are to be sorted on <i>varlist</i> rather
        than <i>yvar</i>. Usually, but not necessarily, <i>varlist</i> is a single <i>varname</i>.
        As a special case, <b>_n</b> may be specified to insist on respecting
        current sort order. This option does not override any sorting on
        <i>x1var</i> (and <i>x2var</i> when specified).
<p>
    <b>missing</b> specifies that missing values of <i>x1var</i> and <i>x2var</i> are to be
        included as distinct categories. The default is to omit such values.
<p>
    <b>separate(</b><i>true_or_false_condition</i><b>)</b> specifies that observations satisfying
        a <i>true_or_false_condition</i> should be shown differently.
<p>
    <b>separateopts(</b><i>scatter_options</i><b>)</b> are used in conjunction with <b>separate()</b>,
        described above, to indicate how such observations should be shown.
<p>
    <i>Panels and superpanels</i>
<p>
    <b>plines</b> is a convenience option specifying that lines should be drawn
        between panels using <b>xline()</b>. <b>plines</b> may also be specified with 
        added_line_options. The default is <b>lc(gs8)</b>.
<p>
    <b>superplines</b> is a convenience option specifying that lines should be drawn
        between superpanels using <b>xline()</b>. <b>superplines</b> may also be specified
        with added_line_options. The default is <b>lc(gs4) lw(*1.2)</b>.
<p>
    <b>pgap(</b><i>#</i><b>)</b> tunes the space between panels. The default is 2.
<p>
    <b>superpgap(</b><i>#</i><b>)</b> tunes the space between superpanels.  The default is 4.
<p>
    <i>Other graph options</i>
<p>
    <b>lineopts(</b><i>line_options</i><b>)</b> are options of twoway line, which may be used to
        tune the appearance of the horizontal line segments representing the
        mean(s).
<p>
    <b>rspikeopts(</b><i>rspike_options</i><b>)</b> are options of twoway rspike, which may be
        used to tune the appearance of the vertical line segments
        representing deviations.
<p>
        <b>clean</b> is a convenient shorthand for <b>lineopts(lc(none ..))</b>
        <b>rspikeopts(lc(none))</b> and removes the scaffolding emphasising that the
        values are plotted as deviations.
<p>
    <i>scatter_options</i> are options of scatter and may be used to tune the
        appearance of markers or the graph in general.
<p>
<p>
<b><u>Examples</u></b>
<p>
    <b>. set scheme s1color</b>
<p>
    <b>. sysuse auto, clear</b>
<p>
    <b>. devnplot mpg</b>
<p>
    <b>. devnplot mpg foreign</b>
    <b>. devnplot mpg rep78</b>
    <b>. devnplot mpg rep78, pgap(5)</b>
    <b>. devnplot mpg rep78, overall</b>
    <b>. devnplot mpg rep78, overall pgap(3)</b>
    <b>. devnplot mpg rep78, overall plines</b>
    <b>. devnplot mpg rep78, overall plines pgap(3)</b>
    <b>. devnplot price foreign</b>
    <b>. devnplot price foreign, sort(weight)</b>
    <b>. devnplot price rep78, clean</b>
    <b>. devnplot price rep78, clean plines</b>
    <b>. devnplot mpg rep78, clean plines recast(connected)</b>
    <b>. devnplot mpg foreign, pgap(3) plines(lstyle(major_grid) lc(bg) lw(*8))</b>
        <b>plotregion(color(gs15))</b>
<p>
    <b>. devnplot mpg foreign rep78</b>
    <b>. devnplot mpg foreign rep78, superplines(lstyle(yxline)) plines</b>
    <b>. egen median = median(mpg), by(foreign)</b>
    <b>. devnplot mpg foreign rep78, superplines(lstyle(yxline)) level(median)</b>
<p>
    <b>. webuse systolic, clear</b>
<p>
    <b>. version 9: anova systolic drug disease drug*disease</b>
    <b>. predict predict</b>
    <b>. predict residual, residual</b>
    <b>. devnplot systolic drug disease, level(predict) superplines</b>
    <b>. devnplot residual drug disease, level(0) superplines</b>
<p>
    <b>. webuse grunfeld, clear</b>
<p>
    <b>. devnplot invest company, sort(time) clean ysc(log) yla(1000 300 100 30</b>
        <b>10 3 1) recast(line) subtitle(Grunfeld data)</b>
<p>
    <b>. u smoking_oecd, clear</b>
<p>
    <b>. devnplot percent gender period, xla(, labsize(*.8) axis(2))</b>
        <b>recast(line) xti("", axis(2)) xti("", axis(1)) yla(, ang(h))</b>
        <b>superplines(lc(gs14))</b>
 
    <b>. egen nation = group(country)</b>
    <b>. devnplot percent gender period, xla(, labsize(*.8) axis(2))</b>
        <b>recast(line) xti("", axis(2)) xti("", axis(1)) yla(, ang(h))</b>
        <b>superplines(lc(gs14)) separate(nation == 24) separateopts(mcolor(blue</b>
        <b>..) msize(*1.2 ..)) note("USA highlighted")</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Nicholas J. Cox, Durham University
    n.j.cox@durham.ac.uk
<p>
<p>
<b><u>Acknowledgments</u></b>
<p>
    Vince Wiggins and David Airey gave helpful and encouraging suggestions.
<p>
<p>
<b><u>References</u></b>
<p>
    Fisher, R.A. 1925. <i>Statistical Methods for Research Workers</i>.  Edinburgh:
        Oliver and Boyd.
<p>
    Grafen, A. and Hails, R. 2002.  <i>Modern Statistics for the Life Sciences.</i>
        Oxford: Oxford University Press.
<p>
    Pearson, E.S. 1956.  Some aspects of the geometry of statistics: the use
        of visual presentation in understanding the theory and application of
        mathematical statistics.  <i>Journal of the Royal Statistical Society</i> A
        119: 125-146.
<p>
    Whitlock, M.C. and Schluter, D. 2009. <i>The Analysis of Biological Data.</i>
        Greenwood Village, CO: Roberts and Company.
<p>
<p>
<b><u>Also see</u></b> 
<p>
    qplot (if installed); distplot (if installed); stripplot (if installed); 
    dotplot
<p>
<p>
</pre>