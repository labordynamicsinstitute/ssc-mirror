<pre>
-------------------------------------------------------------------------------
help for <b>stkerhaz</b>
-------------------------------------------------------------------------------
<p>
<b><u>Baseline Hazard Estimates via Kernel Smoother and plots</u></b>
<p>
    <b>stkerhaz</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>,</b> <b><u>b</u></b><b>width(</b><i># # #</i><b>)</b> [ <b><u>k</u></b><b>erkode(</b><i>#</i><b>)</b> <b><u>np</u></b><b>oint(</b><i>#</i><b>)</b>
             <b><u>basech</u></b><b>a(</b><i>varname</i><b>)</b> <b>strata(</b><i>varname</i><b>)</b> <b>tmax</b> <b>ci</b> <b><u>l</u></b><b>evel(</b><i>#</i><b>)</b>
             <b><u>out</u></b><b>file(</b><i>filename[,replace]</i><b>)</b> <b>per(</b><i>#</i><b>)</b> <i>graph_options</i> ]
<p>
<p>
<b>stkerhaz</b> is for use with survival-time data; see help st. You must have <b>stset</b>
your data before using this command; see help stset.
 
<b>stkerhaz</b> needs levels7 which you can download by describe
http://www.stata.com/stb/stb60/dm90.  See findit and ssc install to install
user-written additions from the net.
<p>
<p>
Examples:
<p>
    Baseline Hazard Plot with 95% confidence bounds
            . stcox, estimate basech(H)
            . stkerhaz,bwidth(10) ci
<p>
    Baseline Hazard Plot with two curves for 5 and 10 time units bandwidth
            . stcox, estimate basech(H)
            . stkerhaz,bwidth(5 10)
<p>
    Baseline Hazard Plot with as much curves as hormon values. The estimates
    are saved in \currentfolder\myhaz
            . stcox, estimate basech(H) strata(hormon)
    or
            . sts gen H = na, by(hormon)
            . stkerhaz,bwidth(10) strata(hormon) out(myhaz)
<p>
    Adjusted Baseline SMR Plot
            . xi: stcox i.yfecat i.afecat, basech(H) offset(lograte)
            . stkerhaz,b(5)
<p>
<p>
<b><u>Description</u></b>
<p>
<b>stkerhaz</b> computes nonparametric estimates of the baseline hazard or baseline
SMR and draws the graph of the results. This command can be used after <b>stcox</b>.
In this case it requires that you previously specified <b>stcox</b>'s <b>basech()</b> option;
see stcox.  Otherwise in <b>stkerhaz</b>'s <b><u>basech</u></b><b>a</b> option you can specify <i>varname</i>
storing cumulative baseline hazard.
Actually <b>stkerhaz</b> can be used even to smooth a cumulative excess mortality
function, so achieving a smoothed estimate of excess mortality function.
<p>
<p>
<b><u>Options</u></b>
<p>
<b>bwidth(</b><i># # # #</i><b>)</b> specifies the window half-width to be used. <b>bwidth</b> is not
    optional. At least one bandwidth must be specified. Up to four bandwidths
    can be used.  Then, curves are drawn for each bandwidth.
<p>
<b>kerkode(</b><i>#</i><b>)</b> specifies the weight function (kernel) to be used according to the
            following numerical codes:
            1 = Uniform
            2 = Epanechnikov (Default)
            3 = Biweight
<p>
Asymmetric kernel (see <b><u>Remarks</u></b> below) is computed where appropriate.
<p>
<b>npoint(</b><i>#</i><b>)</b> specifies the number of equally spaced points in the range used for
    the estimation. Default is 150. Unless <b>tmax</b> is used, the range of points
    starts at the lowest <i>_t0</i> and stops at the last death time.
<p>
<b>basecha(</b><i>varname</i><b>)</b> specifies the variable storing baseline cumulative hazard.
<p>
<b>strata(</b><i>varname</i><b>)</b> option is intended for use in conjunction with the <b>strata</b>
    option of <b>stcox</b> or <b>by</b> option of <b>sts gen</b>. It enables to calculate and graph
    up to four baseline hazard curves for corresponding numeric values of
    strata or by variable. If there are more values of the strata variable it
    needs to save estimates in a file and then graph them as wished.
<p>
<b>tmax</b> sets the starting point of range at the time of the earliest death.
<p>
<b>ci</b> allows to plot confidence bounds around baseline smoothed hazard. Note that
    they are correct only when Baseline Cumulative Hazard derives from an
    unadjusted model. Multiple curves and <b>ci</b> cannot be plotted at once.
<p>
<b>level(</b><i>#</i><b>)</b> specifies the confidence level, in percent, for the pointwise
    confidence bounds. Default is 95.
<p>
<b>outfile(</b><i>filename[,replace]</i><b>)</b> saves in filename values used to plot. The variable
    containing baseline hazard estimates is prefixed by KS_. If confidence
    bounds are plotted the standard error and pointwise high and low confidence
    interval, based on a log transformation, are saved as well in the variables
    prefixed by KS_SE_, KS_HI_ and KS_LO_. Rest of names specifies bandwidth or
    value of stratavar which they refer to. A variable named Gridpoint saves
    equally spaced data points where estimates are calculated.
<p>
<b>per(</b><i>#</i><b>)</b> defines the time units in which the estimated hazards will be reported.
    If the time analysis is in year, specifying per(1000) results in the graph
    are in rates per 1000 person-years.
<p>
<p>
<b><u>Remarks</u></b>
<p>
The kernel-smoothed hazard estimated by <b>stkerhaz</b> uses the method described by
Breslow and Day (1986, pp 178-229) and by Klein and Moeschberger (2003, pp
166-177) first introduced by Ramlau-Hansen (see formula 5.18).
This estimate is simply a weighted average of the increments in cumulative
baseline hazard, where weights are a kernel function of<i> ((t_target - t_obs) /</i>
<i>bandwidth)</i> defined in the interval<i> [-1,+1]</i>.<i>  t_target</i> are time points at which
baseline hazard is estimated and<i> t_obs</i> are times at which increment of
cumulative baseline hazard is actually observed. Kernel weigths are defined as:
        Uniform          K(z) = 0.5 if |z| &lt; 1 and K(z) = 0 otherwise          
&gt;   
        Epanechnicov     K(z) = 0.75(1-z^2) if |z| &lt; 1 and K(z) = 0 otherwise  
&gt;   
        Biweight         K(z) = 0.975(1-z^2)^2 if |z| &lt; 1 and K(z) = 0 otherwis
&gt; e 
<p>
When<i> t_target</i> or, in the right-hand tail,<i> (last_death_time - t_target)</i> is
smaller than <i>bandwidth</i> asymmetric kernels are computed according to the
formulas in Klein and Moeschberger's book (2003, pp 167-168).
<p>
As pointed out by Breslow and Day, an estimate of cumulative baseline SMR can
be obtained incorporating into a Cox model as an offset term the logarithm of
time-dependent standard rates.  Cumulative SMR can be smoothed using the same
method to yield non parametric estimates of SMR at various points in time
analysis axis.
<p>
They say: "Cumulative baseline mortality or incidence rates are not as
informative as they might appear at first sight. They tend to overemphasize the
jumps at very high times at which the estimate is least stable. Also,
time-specific rates are usually of greater intrinsic interest than the
cumulative rate." Furthermore, graphing baseline hazard or SMR, trend along
time axis can be appreciated showing when a rise or a decline appears and if it
is sharp or gradual.  <b>stcox</b> or <b>sts gen</b> can create new variable containing
cumulative baseline hazard unadjusted or adjusted for covariates or estimated
in separate groups. This command is aimed at easily deriving from this stored
result an estimate of the baseline hazard.
<p>
Klein and Moeschberger also advice to use the kernel smoothing technique to
compute a smoothed estimate of the excess mortality function starting from a
cumulative excess mortality function.
<p>
Bandwidths have to be chosen being aware that small bandwidth (small smoothing)
yields hazard (or SMR) estimates affected by random noise, while large
bandwidth (large smoothing) blurs the structure of the data.  Visual appearance
of the graph can address the selection, although objective criteria exist.
<p>
<p>
<p>
<b><u>Also see</u></b>
<p>
 Manual:  <b>[R] kdensity</b>, <b>[R] st stcox</b> <b>[R] st sts generate</b>, <b>[R] st sts graph</b>
On-line:  help for kernreg, bhcalc, sthaz if installed
<p>
<p>
<b><u>Note</u></b>
<p>
A previous version of stkerhaz computed more kinds of kernel weigths, but it
did not compute asymmetric kernel in the tails of the analysis time. On request
I can provide this old version.
<p>
<p>
<b><u>References</u></b>
<p>
Breslow, N. E. and Day, N. E.  Statistical Methods in Cancer Research. Volume
II - The Design and analysis of cohort studies.  Lyon: International Agency for
Research on Cancer, 1987.
<p>
Klein, J. P. and Moeschberger, M. L. Survival Analysis Techniques fo Censored
and Truncated Data (2nd Edition). New York: Springer-Verlag, 2003.
<p>
<p>
<b><u>Author</u></b>
<p>
        Enzo Coviello, Azienda U.S.L. BA/1, Italy
        enzo.coviello@tin.it
        
 
<p>
</pre>