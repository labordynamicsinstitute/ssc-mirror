<pre>
<b>help stnet</b> 
                                                                also see:  strs
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>stnet</b> -- Estimating net survival
<p>
<b><u>Syntax</u></b>
<p>
    <b>stnet</b> <b>using</b> <i>filename</i> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] [<b><u>iw</u></b><b>eight</b><i>=varname</i>] ,
          <b><u>br</u></b><b>eaks(</b><i>range</i><b>)</b> <b><u>m</u></b><b>ergeby(</b><i>varlist</i><b>)</b> <b><u>diag</u></b><b>date(</b><i>varname</i><b>)</b>
          <b><u>birth</u></b><b>date(</b><i>varname</i><b>)</b> [<b>by(</b><i>varlist</i><b>)</b> <b>attage(</b><i>newvar</i><b>)</b> <b>attyear(</b><i>newvar</i><b>)</b>
          <b>survprob(</b><i>varname</i><b>)</b> <b>maxage(</b><i>int 99</i><b>)</b> <b><u>ed</u></b><b>erer2</b> <b><u>stand</u></b><b>strata(</b><i>varname</i><b>)</b>
          <b><u>li</u></b><b>st(</b><i>varlist</i><b>)</b> <b><u>f</u></b><b>ormat(%</b><i>fmt</i><b>)</b> <b><u>notab</u></b><b>les</b> <b><u>l</u></b><b>evel(</b><i>int</i><b>)</b>
          <b>saving(</b><i>filename</i>[<b>,replace</b>]<b>)</b> <b><u>savst</u></b><b>and(</b><i>filename</i>[<b>,replace</b>]<b>)</b>
<p>
<p>
<b>stnet</b> is for use with survival-time data; see help st.  You must stset your
data with time since entry in years as the timescale before using <b>stnet</b>; see
help stset.
<p>
<b><u>iw</u></b><b>eight</b>s are allowed; see help weights and see example using weights below.
Weights must be specified as [<b>iweight</b><i>=varname</i>]
.
<p>
<p>
<b><u>Description</u></b>
<p>
<b>stnet</b> estimates net survival as proposed by Pohar Perme, Stare and Estève
(Biometrics 2011) by using a life tables approach.  The command displays the
results in life tables stratified by the variables specified in the <b>by</b> option.
Optionally relative survival using the Ederer II method can be calculated.
This command may be used also for period or hybrid analysis and to compute
adjusted (weighted) estimates.
<p>
<b>using</b> <i>filename</i> specifies a file containing general population survival
probabilities (conditional probabilities of surviving one year), typically
stratified by age, sex, and calendar year.  Age must be specified in one year
increments (typically from 0 to 99) and calendar year in one year intervals.
The file must be sorted by the variables specified in <b>mergeby()</b>. Default names
for variables in this file are <i>prob</i> for the survival probabilities (see the
<b>survprob()</b> option), <i>_age</i> for age (see the <b>attage()</b> option), and <i>_year</i> for
calendar year (see the <b>attyear()</b> option).  The maximum age is specified using
the <b>maxage()</b> option (default is 99).
<p>
<p>
<p>
<b><u>Options</u></b>
<p>
<b><u>br</u></b><b>eaks(</b><i>range</i><b>)</b> specifies the cutpoints for the lifetable intervals as <i>range</i> in
    the forvalues command.
<p>
<b><u>m</u></b><b>ergeby(</b><i>varlist</i><b>)</b> specifies the variables by which the file of general
    population survival probabilities is sorted.
<p>
<b>by(</b><i>varlist</i><b>)</b> specifies the life table stratification variables. One life table
    is estimated for each combination of these variables.
<p>
<b><u>diag</u></b><b>date(</b><i>varname</i><b>)</b> specifies the variable containing the date of diagnosis.
<p>
<b><u>birth</u></b><b>date(</b><i>varname</i><b>)</b> specifies the variable containing the date of birth.
<p>
<b>attage(</b><i>newvar</i><b>)</b> specifies the variable containing attained age (i.e., age at the
    time of follow-up). This variable cannot exist in the patient data file (it
    is created from the difference between date of diagnosis and date of birth
    plus follow-up time) but must exist in the using file. Default is <i>_age</i>.
<p>
<b>attyear(</b><i>newvar</i><b>)</b> specifies the variable containing attained calendar year (i.e.
    calendar year at the time of follow-up). This variable cannot exist in the
    patient data file (it is created form the date of diagnosis plus follow-up
    time) but must exist in the using file. Default is <i>_year</i>.
<p>
<b><u>surv</u></b><b>prob(</b><i>varname</i><b>)</b> specifies the variable in the using file that contains the
    general population survival probabilities. Default is <i>prob</i>.
<p>
<b>maxage(</b><i>int 99</i><b>)</b> specifies the maximum age for which general population survival
    probabilities are provided in the using file. Probabilities for individuals
    older than this value are assumed to be the same as for the maximum age.
<p>
<b><u>ed</u></b><b>erer2</b> specifies that Ederer II relative survival estimates be calculated.
    Note that <b>stnet</b> calculates the observed survival by transforming the
    interval specific cumulative hazard. Therefore the results are not exactly
    equal to those obtained by using <b>ltable</b> and <b>strs</b> in the case of cohort
    design (Dickman 2010).
<p>
<b><u>li</u></b><b>st(</b><i>varlist</i><b>)</b> specifies the variables to be listed in the life tables. The
    variables start and end are included by default, but if only one of these
    is specified in the list option then the other is suppressed.
<p>
<b><u>stand</u></b><b>strata(</b><i>varname</i><b>)</b> specifies a variable defining strata across which to
    average the cumulative survival estimate. Weights must be given by
    [<b>iweight</b><i>=varname</i>].
<p>
<b><u>f</u></b><b>ormat(%</b><i>fmt</i><b>)</b> specifies the format for variables containing survival estimates.
    Default is %6.4f.
<p>
<b><u>notab</u></b><b>les</b> suppresses display of the life tables.
<p>
<b><u>l</u></b><b>evel(</b><i>int</i><b>)</b> sets the confidence level; default is based on the value of the
    global macro S_level which, by default, takes the value 95.
<p>
<b>saving</b>[<b>(</b><i>replace</i><b>)</b>] saves in<i> filename</i> a data sets containing one observation for
    each life table interval.
<p>
<b><u>savst</u></b><b>and(</b><i>filename</i>[<i>,replace</i>]<b>)</b> saves in<i> filename</i> standardised estimates.
<p>
<p>
<p>
<b><u>Example: Net survival (Pohar Perme and coll.) by sex</u></b>
<p>
    <b>. stnet using lifetab, br(0(.0833333334)10) mergeby(_year sex _age)</b>
        <b>diagdate(dx) birthdate(bdate) by(sex)</b>
<p>
<p>
<p>
<b><u>Example: Ederer II estimates by sex</u></b>
<p>
    <b>. stnet using lifetab, br(0(0.5)10) mergeby(_year sex _age) diagdate(dx)</b>
        <b>birthdate(bdate) by(sex) ederer2</b>
<p>
<p>
<p>
<b><u>Example: Estimation using a period approach</u></b>
<p>
The approach is to first stset the data with calendar time as the timescale.
For example, we might be interested in the time at risk between 1 January 2005
and 31 December 2007.
<p>
    <b>. stset datafu, fail(status==1 2) origin(dx) enter(time mdy(1,1,2005))</b>
        <b>exit(time mdy(12,31,2007)) scale(365.241)</b>
<p>
We then can use <b>stnet</b> in the usual manner to get net survival and Ederer II est
&gt; imates
<p>
    <b>. stnet using lifetab, br(0(0.083333334)10) mergeby(_year sex _age)</b>
        <b>diagdate(dx) birthdate(bdate) by(sex) ederer2</b>
<p>
<p>
<p>
<b><u>Example: Age-standardised estimates of net survival</u></b>
<p>
To age-standardise using traditional direct standardisation we could specify
the following command
<p>
<b>. stnet using lifetab [iw=standwei], br(0(.083333334)10) mergeby(_year sex</b>
<b>_age) diagdate(dx) birthdate(bdate) by(sex) standstrata(agegroup)</b>
<p>
<b>stnet</b> first constructs life tables for each level of sex and agegroup then
calculates age-standardised estimates for each sex by weighting the
age-specific estimates using the weights specified in the variable <i>standwei</i>.
The strata across which to average are defined using the <b>standstrata(</b><i>varname</i><b>)</b>
option; a variable containing the weights (which must be less than 1) must
exist in the data set and be specified using the <b>iweight=</b> option.
<p>
Standard errors are estimated using the approach described by Corazziari et al
(2004).
<p>
<p>
<p>
<b><u>Example: Saving estimates</u></b>
<p>
Saving estimates is needed to graph net survival estimates
<p>
<b>. stnet using lifetab, br(0(.083333334)10) mergeby(_year sex _age) diagdate(dx)</b>
<b>birthdate(bdate) by(sex) saving(colonnetsurv,replace)</b>
<p>
<p>
<p>
<b><u>Remarks</u></b>
<p>
Net survival is the function of interest for cancer registries because it is
the survival that we can measure if cancer is the only cause of death.
Therefore it is suitable to compare cancer survival among different populations
and to analyze survival trends. Pohar Perme and coll. shown that the
correlation between cancer survival and other causes survival must be taken
into account to properly estimate the net survival. They propose a method based
on the inverse probability weights.  For each individual weights are given by
the inverse of its expected survival probability computed from the survival
probabilities of the general population supplied in the <b>using</b> file.  Danieli
and coll. proven that the method proposed by Pohar Perme and coll. actually
estimates the net survival.
<p>
In <b>stnet</b> we apply a life table approach for the estimation of the net survival.
First we compute for each interval the cumulative weighted excess hazard given
by
                          Hw = <i>k</i> x (dw - d_hatw) / pyw.
<p>
where <i>k</i> is the length of the interval, dw is the weighted number of deaths,
d_hatw is the weighted number of the expected deaths and pyw are the weighted
person-years at risk. Then we transform it in the interval specific net
survival by
                                 NS = exp(-Hw) 
<p>
Finally the cumulative net survival is obtained by the product of the interval
specific estimates.
 
<p>
Results produced by <b>stnet</b> have been checked by comparing them with <i>rs.surv</i> in
<i>relsurv R-package</i>, written by Pohar Perme.  As ancillary file the results of
1000 simulations are provided where bias and coverage probabilities of the
estimates produced by <b>stnet</b> look in good agreement with the simulated net
survival.
<p>
<p>
<p>
<b><u>Authors</u></b>
<p>
Enzo Coviello (enzo.coviello@alice.it).
<p>
<p>
<p>
<b><u>Aknowledgments</u></b>
<p>
I wish to thank Mark Rutherford for making available the code for the
simulations and for testing the command.
<p>
<p>
<p>
<b><u>References</u></b>
<p>
Pohar Perme M, Stare J, Estève J On estimation in relative survival, <i>Biometrics</i>
2012 Mar;68(1):113-20.
<p>
Danieli C, Remontet L, Bossard N, Roche L, Belot A.  Estimating net survival:
the importance of allowing for informative censoring <i>Statistics in Medicine</i>
2012 Apr 13;31(8):775-86
<p>
Dickman P.  Standard errors of observed and relative survival in strs.
<p>
Corazziari I, Quinn M, Capocaccia R.  Standard cancer patient population for
age standardising survival ratios, <i>European Journal of Cancer</i> 2004;40:2307-16.
<p>
<p>
<p>
On-line:  help for stset, strs, ltable
<p>
</pre>