<pre>
<p>
-------------------------------------------------------------------------------
<b>help for splagvar</b> 
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
  <b>splagvar --- Generates spatially lagged variables, constructs the Moran</b>
        <b>scatter plot, and calculates global Moran's I statistics.</b>
<p>
<a name="contents"></a>        +--------------------+
    ----+  Table of Contents +-----------------------------------------------
<p>
  Syntax
  General description
  Description of the options
  Examples
  References
  Author information
  Citation
<p>
-------------------------------------------------------------------------------
<p>
<a name="syntax"></a><b><u>Syntax</u></b>
<p>
    <b>splagvar</b> [<i>varlist1</i>] [if] [in]<b>,</b> [<b><u>wn</u></b><b>ame(</b><i>weights_name</i><b>)</b> <b><u>wf</u></b><b>rom(</b><i>Stata</i>|<i>Mata</i><b>)</b>
        <b>ind(</b><i>varlist2</i><b>)</b> <i>Other_options</i>]
<p>
<p>
    <i>options</i>                    Description
    -------------------------------------------------------------------------
    Options
 
      <b><u>wn</u></b><b>ame(</b><i>weights_name</i><b>)</b>      indicate the name of the spatial weights
                                 matrix to be used
<p>
      <b><u>wf</u></b><b>rom(</b><i>Stata</i>|<i>Mata</i><b>)</b>        indicate source of the spatial weights matrix
  
      <b>ind(</b><i>varlist2</i><b>)</b>            request spatially lagged explanatory variables
<p>
      <b>order(</b><i>#</i><b>)</b>                 indicate the lag order for the spatially
                                 lagged explanatory variables to be created
<p>
      <b><u>equ</u></b><b>ation(</b><i>#</i><b>)</b>              generate spatially lagged variables for a
                                 specific equation
<p>
      <b>plot(</b><i>varname</i><b>)</b>            construct the Moran scatter plot
<p>
      <b>title(</b><i>title_info</i><b>)</b>        indicate a title for the Moran scatter plot
<p>
      <b>saving(</b><i>filename</i><b>, ...)</b>    save the graph to <i>filename</i>
<p>
      <b>note(</b><i>note_info</i><b>)</b>          provide notes about the graph
<p>
      <b>reps(</b><i>#</i><b>)</b>                  set the number of random permutations
<p>
      <b>seed(</b><i>#</i><b>)</b>                  specify a seed number
<p>
      <b>moran(</b><i>varname</i><b>)</b>           request Moran's I statistics
<p>
      <b>qvar(</b><i>varlist3</i><b>)</b>           generate quasi-instrumental variables
<p>
      <b>qname(</b>newvarlist<b>)</b>        provide names for the quasi-instrumental
                                 variables
<p>
      <b>replace</b>                  overwrite existing spatially lagged variables
<p>
      <b>favor(</b><i>speed</i>|<i>space</i><b>)</b>       favor speed or space when calculating the
                                 spatially lagged variables and the Moran's I
                                 statistics
<p>
    -------------------------------------------------------------------------
<p>
<a name="description"></a>        +-------------+
    ----+ Description +------------------------------------------------------
<p>
    <b>splagvar</b> generates spatially lagged variables, constructs the Moran
    scatter plot, and calculates global Moran's I statistics to test for the
    presence of spatial dependence. The Moran's I p-value displayed on the
    Moran scatter plot is calculated using a random permutation procedure.
    Optionally, quasi-instruments can be generated. Unless quasi-instruments
    are requested, <b>splagvar</b> requires a spatial weights matrix which must have
    been created using <b>spwmatrix</b> or any other commands that generate spatial
    weights. The purpose of <b>splagvar</b> is to facilitate estimation by spatial
    two-stage least squares and generalized method of moments of spatial
    econometrics models in Stata (see the example section).
<p>
    While generated spatially lagged dependent variables are prefixed with
    wy_, generated first, second, and third order spatially lagged
    explanatory variables are prefixed with wx_, w2x_, and w3x_ respectively.
    The names of the supplied variables make up the remaining portions. If
    option <b>equation(#)</b> is specified, then the spatially lagged variables are
    prefixed with wy#_, wx#_, w2x#_, and w3x#_, where # stands for the
    equation number.
<p>
        <b>splagvar</b> requires Stata 10.1 or higher.
<p>
<a name="options"></a>        +---------+
    ----+ Options +----------------------------------------------------------
<p>
    <b>wname(</b><i>weights_name</i><b>)</b> specifies the name of the spatial weights matrix to
        be used.
<p>
    <b>wfrom(</b>Stata | Mata<b>)</b> indicates whether the spatial weights matrix is a
        Stata matrix loaded in memory or a Mata file located in the working
        directory. When generated by spwmatrix the spatial weights matrix
        will exist as a Stata matrix or as a Mata file.
<p>
        <b>wname()</b> and <b>wfrom()</b> are required, unless <b>qvar()</b> and <b>qname()</b> are
        specified.
<p>
    <b>ind(</b><i>varlist2</i><b>)</b> specifies a list of explanatory variables whose spatial
        lags need to be taken. Variables deemed dependent or endogenous must
        be supplied in <i>varlist1</i>.
<p>
    <b>order(</b><i>#</i><b>)</b> specifies the spatial lag order (up to 3) for the spatially
        lagged explanatory variables to be created.  By default, first order
        spatial lags are calculated. For dependent or endogenous variables,
        only first order spatial lags may be generated.
<p>
    <b>equation(</b><i>#</i><b>)</b> indicates the number of the equation for which spatially
        lagged variables need to be calculated when generating variables for
        multiple equations.  For example, specifying <b>equation(1)</b> instructs
        Stata to generate spatially lagged variables for the first equation.
        This option is crucial for estimating a spatial simultaneous equation
        model where a different spatial weights matrix is used for each
        equation in Stata.
<p>
    <b>plot(</b><i>varname</i><b>)</b> constructs the Moran scatter plot for the dependent
        variable <i>varname</i> listed in <i>varlist1</i>.  On the plot are reported
        Moran's I statistics and the associated p-value based on a random
        permutation procedure.
 
<p>
    <b>title(</b><i>title_info</i><b>)</b> specifies a title for the Moran scatter plot.
<p>
    <b>note(</b><i>note_info</i><b>)</b> provides notes associated with the graph.
<p>
    <b>saving(</b><i>filename</i><b>,</b><i> </i>...<b>)</b> saves the graph to <i>filename</i>. Specifying the
        suboption <b>replace</b> with the option <b>saving()</b> will replace the graph if
        it already exists.
<p>
    <b>seed(</b><i>#</i><b>)</b> sets the random-number seed, which is defaulted to <b>seed(</b><i>042009</i><b>)</b>.
        This option is useful to ensure replicability of the results.
<p>
    <b>reps(</b><i>#</i><b>)</b> specifies the number of random permutations to be performed. The
        default is <b>reps(</b><i>999</i><b>)</b>.
<p>
    <b>moran(</b><i>varname</i><b>)</b> requests that global Moran's I statistics calculated under
        the assumptions of normal approximation and randomization be
        displayed. Again, <i>varname</i> must be from <i>varlist1</i>.
<p>
        N.B.: If <i>varlist1</i> is not specified, none of the options <b>plot()</b>,
        <b>saving()</b>, <b>title()</b>, <b>moran()</b>, <b>note()</b>, <b>reps()</b>, and <b>seed()</b> may be
        specified.
<p>
    <b>qvar(</b><i>varlist3</i><b>)</b> specifies the variables to be used in generating
        quasi-instrumental variables.
<p>
    <b>qname(</b>newvarlist<b>)</b> specifies a list of variable names for the generated
        quasi-instrumental variables coded 1, 0, and -1 depending on whether
        or not the values of the corresponding variables specified with
        <b>qvar()</b> are in the upper, middle or lower third of values when placed
        in rank order (see Fingle and Le Gallo, 2008).
<p>
    <b>replace</b> overwrites existing spatially lagged or quasi-instrument
        variables.
<p>
    <b>favor(</b><i>speed</i>|<i>space</i><b>)</b> instructs <b>splagvar</b> to favor speed or space when
        calculating the spatially lagged variables or the Moran's I
        statistics.  <b>favor(</b><i>speed</i><b>)</b> is the default. This option provides a
        tradeoff between speed and memory use. See [M-3] mata set.
<p>
<a name="examples"></a>        +----------+
    ----+ Examples +---------------------------------------------------------
<p>
    1) Create a spatial lag for the dependent variable, construct the Moran
        scatter plot, and request Moran's I statistics
<p>
        <b>. splagvar povrate, wname(C:\data/spweight) wfrom(Mata) plot(povrate)</b>
        <b>moran(povrate)</b>
<p>
<p>
    2) Create a spatially lagged dependent variable and request Moran's I
        statistics and p-value under the assumption of normal approximation
        and randomization
<p>
        <b>. splagvar crimerate, wname(spweight) wfrom(Stata) moran(crimerate)</b>
<p>
<p>
    3) Create a spatially lagged dependent variable and first and second
        order spatially lagged independent variables
<p>
        <b>. splagvar houseval, wname(spweight1) wfrom(Mata) ind(income</b>
        <b>population education) order(2)</b>
<p>
<p>
    Now estimating a spatial lag model by <b>spatial 2SLS</b> and <b>GMM</b> using <b>WX</b> and
    <b>(W^2)X</b> as instruments has never been easier.
<p>
        <b>. ivregress 2sls houseval (wy_houseval=wx_* w2x_*) income population</b>
        <b>education, vce(robust)</b>
<p>
        <b>. ivregress gmm houseval (wy_houseval=wx_* w2x_*) income population</b>
        <b>education</b>
<p>
<p>
    Other endogenous variables can be added to the model provided that
    instruments are available.
<p>
        <b>. ivregress gmm houseval (wy_houseval endogvar=wx_* w2x_*</b>
        <b>endogvar_instr) income population education</b>
<p>
<p>
    Education can be considered endogenous if you can find a good instrument.
<p>
        <b>. ivregress gmm houseval (wy_houseval education=wx_* w2x_*</b>
        <b>education_instr) income population</b>
<p>
<p>
    Iterative GMM can be more efficient than two-step GMM.
<p>
        <b>. ivregress gmm houseval (wy_houseval education=wx_* w2x_*</b>
        <b>education_instr) income population, igmm</b>
<p>
    Note: If you want to use the lags of an instrumental variable as
    instruments, then you need to include it in <i>varlist2</i>
<p>
<p>
    4) Create a quasi-instrumental variable to be used as an instrument for
        education
<p>
        <b>. splagvar, qvar(education) qname(educ_qinst)</b>
<p>
  -----------------------------------------------------------------------------
<p>
<p>
<a name="refs"></a><b><u>References</u></b>
<p>
<b>Anselin, L.</b> 2005. <i>Exploring Spatial Data with GeoDaTM : A Workbook.</i> Available a
&gt; t:
http://www.csiss.org/clearinghouse/GeoDa/geodaworkbook.pdf
<p>
<b>Anselin, L.</b> 2007. "Spatial Econometrics". In T. C. Mills and K. Patterson (Eds)
&gt; . <i>Palgrave Handbook of Econometrics</i>. Vol 1, 
Econometric Theory. New York: Palgrave MacMillan, pp. 901-969.
<p>
<b>de Smith, M.J., M.F. Goodchild, and P.A. Longley</b>. 2007. <i>Geospatial Analysis: A </i>
<i>&gt; comprehensive Guide to Principles, Techniques, and Software Tools</i>. 
Matador: Leicester, UK
http://www.spatialanalysisonline.com
<p>
<b>Fingleton. B. and J. Le Gallo</b>. 2008. "Estimating Spatial Models with Endogenous
&gt;  Variables, a Spatial Lag and Spatially
Dependent Disturbances: Finite Sample Properties ", <i>Papers in Regional Science</i> 
&gt; 87(3): 319-339. 
<p>
<b>Gould, W.</b> 2006. "Mata Matters: Creating New Variables—Sounds Boring, Isn't". <i>Th</i>
<i>&gt; e Stata Journal</i> 6: 112-123. 
Available from http://www.stata-journal.com/article.html?article=pr0021
<p>
<b>Klotz, S.</b> 2004. <i>Cross-sectional Dependence in Spatial Econometrics Models: with</i>
<i>&gt;  an Application to German Start-up Activity Data.</i> 
Transaction Publishers, Piscataway, NJ.
<p>
<p>
<a name="author"></a><b><u>Author</u></b>
<p>
    <b>P. Wilner Jeanty</b>, The Kinder Institute for Urban Research/Hobby Center
    for the Study of Texas, Rice University, Houston, Texas
<p>
                        
    Email to pwjeanty@rice.edu
<p>
    <b>N.B.:</b> Previous versions of <b>splagvar</b> were written when the author was a
    Research Economist with the Dept. of Agricultural, Environmental, and
    Development Economics,
    The Ohio State University
<p>
<a name="citation"></a><b><u>Citation</u></b>
<p>
Thanks for citing <b>splagvar</b> as follows:
<p>
<b>Jeanty, P.W.</b>, 2010. <b>splagvar</b>: <i>Stata module to generate spatially lagged variabl</i>
<i>&gt; es, construct the Moran scatter plot, and calculate global Moran's I statisti</i>
<i>&gt; cs</i>
Available from http://ideas.repec.org/c/boc/bocode/s457112.html.
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online: <b>spwmatrix</b>, <b>spatgsa</b>, <b>spatcorr</b> (if installed)
<p>
<p>
</pre>