<pre>
help <b>setpoisson</b>
<p>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
        Selection Endogenous Treatment Poisson Model by MSL
<p>
<b><u>Basic syntax</u></b>
<p>
        <b>setpoisson</b> (<i>Tvar</i> = <i>varlist1</i>) (<i>Pvar</i> = <i>varlist2</i>) (<i>cvar</i> = <i>varlist3</i>) [<b>if</b>
            <i>exp</i>] [<b>in</b> <i>range</i>]<b>,</b> <b>rep(#)</b>
            <b><u>hvec</u></b><b>tor</b>(# # #)
 
<p>
<b><u>Full syntax</u></b>
<p>
        <b>setpoisson</b> (<i>Tvar</i> = <i>varlist1</i>) (<i>Pvar</i> = <i>varlist2</i>) (<i>cvar</i> = <i>varlist13</i>) [<b>if</b>
            <i>exp</i>] [<b>in</b> <i>range</i>]<b>,</b> <b>rep(#)</b>
            <b><u>hvec</u></b><b>tor</b>(# # #) <b><u>meth</u></b><b>od</b>(#) <b>cluster</b>(<i>clustvar</i>) <b><u>constr</u></b><b>aints</b>(<i>clist</i>)
            <b><u>tr</u></b><b>ace</b> <b><u>rob</u></b><b>ust</b> <b><u>hb</u></b><b>ased</b> <b>mloptions</b>
 
<p>
<a name="options"></a>  <i>options</i>                     Description
  -----------------------------------------------------------------------------
  <b>rep(</b><i>#</i><b>)</b>                       Sets the number of random draws that will be
                                  used for calculating the simulated
                                  likelihood.
  <b><u>hvec</u></b><b>tor(</b><i># # #</i><b>)</b>               Controls aspects of the simulation, all three
                                  numbers must be integers. The first number
                                  sets the number of <b>columns</b> that the vector of
                                  random draws will have.  The second number
                                  picks one column. Finally, the third number
                                  sets the number of <b>rows</b> -from the top row
                                  onwards- to be discarded from the chosen
                                  column. For instance, <b>rep(</b><i>400</i><b>)</b> <b>hvec(</b><i>2 1 100</i><b>)</b>
                                  asks for a 500x2 random vector, to take the
                                  first column and to discard the first 100
                                  rows. The resulting 400x1 vector is used for
                                  simulating the likelihood.
  <b><u>meth</u></b><b>od</b>(#)                    Type of random draws to be used for simulating
                                  the likelihood. Option 1 is the default and
                                  indicates that Halton sequences shall be
                                  used. Option 2 indicates that a Hammersley
                                  set should be used.  Finally, option 3
                                  indicates that pseudouniform random numbers
                                  should be used.
  <b><u>rob</u></b><b>ust</b>                       The Eicker-Huber-White (sandwich) estimator of
                                  the covariance matrix is reported. This
                                  option is only valid when used together with
                                  the <b>habased</b> option.
  <b><u>hb</u></b><b>ased</b>                       Maximisation will be performed using analytical
                                  first derivatives and numerical second
                                  derivatives.
  <b>cluster</b>(<i>clustvar</i>)            Clustered sandwich estimator of the covariance
                                  matrix. This option must be used together
                                  with the the <b>habased</b> option.
  <b><u>constr</u></b><b>aints</b>(<i>clist</i>)           Specifies constraints in the usual way.
  <b>trace</b>                        Trace.
  <b>mloptions</b>                    Usual mloptions.
<p>
<b><u>Description</u></b>
<p>
    <b>setpoisson</b> fits a Selection Endogenous Treatment Poisson model for count
    data by Maximum Simulated Likelihood.
<p>
<b><u>Important notes</u></b>
<p>
    The equation for the treatment variable <i>Tvar</i> always comes first, then the
    equation for the selection dummy <i>Pvar</i>, and finally the equation for the
    main count outcome variable <i>cvar</i>. This order should be always observed,
    otherwise the model will not be correctly estimated or it will produce an
    error message.
<p>
    By default the model is fitted by the BHHH method, using analytical first
    derivatives and an outer product gradient (OPG) approximation of the
    covariance matrix. The <b>hbased</b> option modifies this default behaviour.
<p>
    Simulations conducted by the author show that using less than 1,000
    delivers slightly underestimated standard errors and that the coverage of
    the parameters is below the advertised 95%. For these reasons I strongly
    recommend using at least 1,000 Halton draws to simulate the likelihood.
<p>
    If Stata is stopped during maximisation for any reason you'll need to
    drop all macros that are created by petpoisson, otherwise you'll see an
    error message. In that instance type:
 
        . mac drop S_s* S_cat S_x* S_n* S_eqs S_e* S_r* S_i*
<p>
<p>
<b><u>Examples</u></b>
<p>
    . use setpoisson_sdata.dta
<p>
    . setpoisson (T = x1) (P = T x2) (count = T x3), rep(1600) hvec(1 1 100)
<p>
    . setpoisson (T = x1) (P = T x2) (count = T x3), rep(1600) hvec(1 1 100)
        hbased
<p>
<b><u>Marginal effects after estimation</u></b>
<p>
    /* At the mean of explanatory variables */
    . setpoisson_me [<b>if</b> <i>exp</i>] [<b>in</b> <i>exp</i>]
<p>
    /* MEs at the mode of explanatory variables */
    . setpoisson_me, dmode
<p>
    /* MEs at the # quantile of the linear predictor */
    . setpoisson_me, XBQuantile(0.3)
<p>
    /* ME for T when count is 2 (v.g. mode of main count) */
    . setpoisson_me, cmode(T 2)
<p>
<b><u> Author</u></b>
<p>
    Alfonso Miranda (A.Miranda@ioe.ac.uk) as part of join work with
             Massimiliano Bratti.
<p>
<b><u> Conditions of use</u></b>
<p>
    <b>setpoisson</b> is not an official Stata command and is an implementation of
    the methods discussed in Bratti and Miranda (2011). There is no warranty
    and the author cannot accept any responsability for the use of this
    software.  The entire risk as to the quality and performance is with you.
    Should the work prove defective, you assume the cost of all necessary
    servicing, repair, or correction. You may distribute a complete,
    unmodified copy of this sofware as you received it.  No modification or
    partial copy is allowed. Both the software and the main paper should be
    cited together.
<p>
<b><u> Suggested citation</u></b>
<p>
    Please cite as:
<p>
        Miranda, A. 2012. setpoisson: Stata module (Mata) to estimate a
             Selection Endogenous Treatment Poisson Model by MSLL. Available
             at http://ideas.repec.org/e/pmi55.html.
<p>
        Bratti, M. and Miranda, A. 2011. Endogenous treatment effects for
             count data models with endogenous participation or sample
             selection.<i> Health Economics</i> 20 (9):1090-1109. Available at
             http://onlinelibrary.wiley.com/doi/10.1002/hec.1764/abstract.
<p>
<p>
    Sofware and paper should be cited together. A copy of the paper is
    available from the author upon request.
<p>
<b><u>Webpage</u></b>
<p>
    http://ideas.repec.org/e/pmi55.html
<p>
<p>
</pre>