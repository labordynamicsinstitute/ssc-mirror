<pre>
<b>help spmat tobanded</b>
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>spmat tobanded</b> -- Store a general spatial-weighting matrix <b>W</b> in banded
                        form
<p>
<p>
<b><u>Syntax</u></b>
<p>
        <b>spmat</b> <b><u>tob</u></b><b>anded</b> <i>objname1</i> [<i>objname2</i>] [<b>,</b> <i>options</i>]
<p>
    <i>options</i>                       Description
    -------------------------------------------------------------------------
    * <b><u>btr</u></b><b>uncate(</b><i>b B</i><b>)</b>              bin truncation
    * <b><u>dtr</u></b><b>uncate(</b><i>l u</i><b>)</b>              diagonal truncation
    * <b><u>vtr</u></b><b>uncate(</b><i>#</i><b>)</b>                value truncation
      <b>replace</b>                     replace <i>objname1</i> or <i>objname2</i>
    -------------------------------------------------------------------------
    * Only one of <b>btruncate()</b>, <b>dtruncate()</b>, or <b>vtruncate()</b> may be specified.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>spmat tobanded</b> replaces the existing <i>objname1</i> or creates the new <i>objname2</i>
    with the spatial-weighting matrix <b>W</b> stored in a banded form.  By default,
    <b>spmat tobanded</b> assumes that <b>W</b> has already a banded structure and attempts
    to store <b>W</b> in a banded form; see Remarks below for a distinction between
    a banded structure and a banded form.
<p>
    If the matrix cannot be stored in a banded form, <b>spmat tobanded</b> returns
    appropriate summary statistics.
<p>
<p>
<b><u>Options</u></b>
<p>
    <b>truncate()</b> options specify one of the three available truncation
        criteria.  The values of the spatial-weighting matrix <b>W</b> that meet the
        truncation criterion will be changed to zero.
<p>
        <b>btruncate(</b><i>b B</i><b>)</b> partitions the value of <b>W</b> into <i>B</i> bins and truncates to
        zero entries that fall into bin <i>b</i> or below.
<p>
        <b>dtruncate(</b><i>l u</i><b>)</b> truncates to zero the values of <b>W</b> that fall <i>l</i>
        diagonals below and <i>u</i> diagonals above the main diagonal.  Neither
        value can be greater than <b>floor((cols(W)-1)/4)</b>.
<p>
        <b>vtruncate(</b><i>#</i><b>)</b> truncates to zero the values of <b>W</b> that are less than or
        equal to #.
<p>
    <b>replace</b> allows <i>objname1</i> or <i>objname2</i> to be overwritten if it already
        exists.
<p>
<p>
<a name="banded_remarks"></a><b><u>Remarks</u></b>
<p>
    Let W be the spatial-weighting matrix
<p>
            +-             -+
            | <b>0</b>  1  0  0  0 |
            | 1  <b>0</b>  1  0  0 |
            | 0  1  <b>0</b>  1  0 |
            | 0  0  1  <b>0</b>  1 |
            | 0  0  0  1  <b>0</b> |
            +-             -+
<p>
    where we highlighted the main diagonal.  Note that all the 1s are
    clustered around the main diagonal.  A matrix with nonzero elements in
    the diagonals close to the main diagonal and zero elements in all the
    diagonals away from the main diagonal is called a banded matrix.  Note
    that although this matrix has a banded structure, it is still stored in a
    general (<i>n</i> x <i>n</i>) form.  We can store W more efficiently in a banded form
    as
<p>
            +-             -+
            | 0  1  1  1  1 |
            | <b>0</b>  <b>0</b>  <b>0</b>  <b>0</b>  <b>0</b> |
            | 1  1  1  1  0 |
            +-             -+
<p>
    The row dimension of the banded matrix is <i>b</i> = (# of diagonals below the
    main diagonal + main diagonal + # of diagonals above the main diagonal).
    The elements beyond the upper and lower bands are implied to be zero and
    need not be stored.
<p>
    In general, the spatial-weighting matrix for <i>n</i> places is an <i>n</i> x <i>n</i> matrix,
    which implies that memory requirements increase quadratically with data
    size.  For example, a spatial-weighting matrix for <i>n</i> = 50,000 requires
    (50000*50000*8) / 2^30 or 18.63 GB of storage space.
<p>
    As discussed in Drukker et al. (2010a, 2010b), many spatial-weighting
    matrices can be stored in a banded form <i>b</i> x <i>n</i>, <i>b</i> &lt;&lt; <i>n</i>, if the underlying
    data have been sorted in an ascending order from a corner place for a
    given topography.
<p>
    If we construct a contiguity matrix from the sorted data, most
    neighboring observations will cluster around the main diagonal, which
    will allow us to store the matrix in a banded form without any loss of
    information.
<p>
    If we construct an inverse-distance matrix from the sorted data, places
    that are closer to us will be located closer to the main diagonal and
    more distant places will be located farther away from the main diagonal.
    In this case, an inverse-distance matrix can be banded if we assume that
    places that lie outside of a certain perimeter are to be treated as
    non-neighbors.  <b>truncate</b> options provide three ways to exclude "more
    distant" places from our neighborhood.
<p>
    In either case, the banded matrix will be stored in a banded form, which
    will result in substantial storage savings.  For example, if we are able
    to squeeze neighborhood information into the bands of width 500, we can
    store the 50,000 x 50,000 matrix in a 1,001 x 50,000 form, which requires
    only (1001*50000*8) / 2^30 or 0.37 GB of memory.
<p>
<p>
<b><u>Example</u></b>
<p>
    Setup
        <b>. use pollute</b>
        <b>. sort longitude latitude</b>
        <b>. spmat contiguity cobj using c103xy, id(id) norm(minmax)</b>
<p>
    Summarize the matrix contained in the spmat object <b>cobj</b> to see that it is
    stored as a 541 x 541 matrix
        <b>. spmat summarize cobj, links</b>
<p>
    Try to band the matrix
        <b>. spmat tobanded cobj, replace</b>
<p>
    Summarize the matrix to see that it is stored as a 147 x 541 banded
    matrix
        <b>. spmat summarize cobj, links</b>
<p>
<p>
<b><u>References</u></b>
<p>
    Drukker, D. M., H. Peng, I. R. Prucha, and R. Raciborski. 2011a.
        Creating and managing spatial-weighting matrices using the spmat
        command.  Working paper, University of Maryland, Department of
        Economics, http://econweb.umd.edu/~prucha/Papers/WP_spmat_2011.pdf.
<p>
    -----. 2011b. Banded spatial-weighting matrices.  Working paper,
        University of Maryland, Department of Economics,
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  <b>spmat</b>, <b>spreg</b>, <b>spivreg</b>, <b>spmap</b>, <b>shp2dta</b>, <b>mif2dta</b> (if installed)
<p>
</pre>