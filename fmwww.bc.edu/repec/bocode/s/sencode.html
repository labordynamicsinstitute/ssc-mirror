<pre>
-------------------------------------------------------------------------------
help for <b>sencode</b>                                                 (Roger Newson)
-------------------------------------------------------------------------------
<p>
<p>
<b><u>Encode string into numeric in a sequential or other non-alphanumeric order</u></b>
<p>
        <b>sencode</b> <i>varname</i> [<i>if</i>] [<i>in</i>] , [ <b><u>g</u></b><b>enerate(</b><i>newvar</i><b>)</b> | <b>replace</b> ] [
                     <b><u>l</u></b><b>abel(</b>[<i>name</i>][,[<b>replace</b>]]<b>)</b> <b><u>gs</u></b><b>ort(</b><i>gsort_list</i><b>)</b> <b><u>man</u></b><b>yto1</b> <b>fast</b>
                     ]
<p>
    where <i>gsort_list</i> is a list of one or more elements of the form
<p>
        [<b>+</b>|<b>-</b>]<i>varname</i>
<p>
    as used by the <b>gsort</b> command.
<p>
<p>
<b><u>Description</u></b>
<p>
    <b>sencode</b> ("super <b>encode</b>") creates an output numeric variable, with labels
    from the input string variable <i>varname</i>.  The output numeric variable may
    either replace the input string variable or be generated as a new
    variable named <i>newvar</i>.  The labels are specified by creating, adding to,
    or just using (as necessary) the value label <i>newvar</i>, or, if specified,
    the value label <i>name</i>.  Unlike <b>encode</b>, <b>sencode</b> can order the numeric
    values corresponding to the string values in a logical order, instead of
    ordering them in alphanumeric order of the string value, as <b>encode</b> does.
    This logical order defaults to the order of appearance of the string
    values in the dataset, but may be an alternative order specified by the
    user in the <b>gsort</b> option.  The mapping of numeric code values to string
    values may be one-to-one, so that each string value has a single numeric
    code, or many-to-one, so that each string value may have multiple numeric
    codes, corresponding to multiple appearances of the string value in the
    dataset.  <b>sencode</b> may be useful when the input string variable is used as
    a source of axis labels in a Stata graph and the output numeric variable
    is used as the <i>X</i>-variable or <i>Y</i>-variable.
<p>
<p>
<b><u>Options</u></b>
<p>
    Either <b>generate()</b> or <b>replace</b> must be specified, but both options may not
        be specified at the same time.
<p>
    <b>generate(</b><i>newvar</i><b>)</b> specifies the name of a new output numeric variable to
        be created.
<p>
    <b>replace</b> specifies that the output numeric variable will replace the input
        string variable, and have the same name, the same position in the
        dataset, and the same variable label and characteristics if present.
<p>
    <b>label(</b>[<i>name</i>][,[<b>replace</b>]]<b>)</b> is optional.  It specifies the name of the
        value label to be created, or, if the named value label already
        exists, used and added to as necessary.  If <b>label()</b> is not specified,
        or is specified without the <i>name</i>, then <b>sencode</b> uses the same name for
        the label as it uses for the new variable, as specified by the
        <b>generate()</b> or <b>replace</b> option.  If the <b>replace</b> suboption of the
        <b>label()</b> option is specified, then any existing value label with the
        indicated value label name is dropped before the new values are
        added, and the added values range from 1 to the number of distinct
        new labels.
<p>
    <b>gsort(</b><i>gsort_list</i><b>)</b> is optional.  It specifies a generalized sorting order
        for the allocation of code numbers to the non-missing values of the
        input string variable.  If the <b>gsort()</b> option is not specified, then
        it is set to the sequential order of the observation in the dataset.
        The <i>gsort_list</i> is interpreted in the way used by the <b>gsort</b> command.
        Observations are grouped in ascending or descending order of the
        specified <i>varname</i>s.  Each <i>varname</i> in the <b>gsort()</b> option can be
        numeric or string.  Observations are grouped in ascending order of 
        <i>varname</i> if <b>+</b> or nothing is typed in front of the name, and in
        descending order of <i>varname</i> if <b>-</b> is typed in front of the name.  If
        there are multiple non-missing values of the input string variable in
        a group specified by the <b>gsort()</b> option, then the group is split into
        subgroups, one subgroup for each non-missing input string value, and
        these subgroups are ordered alphanumerically within the group by the
        input string values.  If there are multiple groups with the same
        input string value, and the <b>manyto1</b> option is not specified, then
        multiple groups with the same input string value are combined into
        the first group with that input string value.  The ordered groups are
        then allocated integer code values, and these values are stored in
        the output variable specified by the <b>generate()</b> or <b>replace</b> option.
        Note that the dataset remains sorted in its original order, even if
        the user specifies the <b>gsort()</b> option.
<p>
    <b>manyto1</b> is optional. It specifies that the mapping from the numeric codes
        to the possible values of the input string variable <i>varname</i> may be
        many-to-one, so that each string value may have multiple numeric
        codes, corresponding to multiple positions of that string value in
        the dataset.  These multiple positions may correspond to multiple
        observations (if <b>gsort()</b> is not specified), or to multiple groups of
        observations specified by <b>gsort()</b>.  If <b>manyto1</b> is not specified, then
        each string value will have one numeric code, and these numeric codes
        are usually ordered by the position of the first appearance of the
        string value in the dataset.
<p>
    <b>fast</b> is a programmers' option.  It specifies that no action will be taken
        to restore the original data in the memory, if the user presses the
        <b>Break</b> key.
<p>
<p>
<b><u>Technical note</u></b>
<p>
    <b>sencode</b> encodes the string values in the string input variable as
    follows.  First, <b>sencode</b> selects observations in the dataset with
    non-missing values of the input string variable.  If <b>if</b> and/or <b>in</b> is
    specified, then <b>sencode</b> selects the subset of those observations selected
    by <b>if</b> and/or <b>in</b>.  Then, these observations are grouped into ordered
    groups, ordered primarily by the <b>gsort()</b> option and secondarily by the
    value of the input string variable.  (If the <b>gsort()</b> option is not
    specified, then it is set to a single temporary variable, with values set
    to the expression <b>_n</b>, equal in each observation to the sequential order
    of that observation in the dataset, and there is therefore only one
    observation per <b>gsort()</b> group.) Then, if <b>manyto1</b> is not specified, then
    any set of multiple ordered groups with the same value of the input
    string variable is combined into the first group in that set of groups.
    Each of the ordered groups existing at this stage is then allocated an
    integer code value.  These integer code values are usually ordered
    primarily by the <b>gsort()</b> option, and secondarily by the alphanumeric
    order of the input string variable.  The code values are then stored in
    the new variable specified by the <b>generate()</b> or <b>replace</b> option.
<p>
    Usually, the code values range from one to the final number of groups.
    Exceptions arise when the value label implied by the <b>label()</b> option of
    <b>sencode</b> is a pre-existing value label, with pre-existing associations
    between numeric code values and string labels already defined, and the
    <b>replace</b> suboption of the <b>label()</b> option is not specified.  In this case,
    <b>sencode</b> does not modify existing associations.  The consequences of this
    policy depend on whether or not <b>manyto1</b> is specified.  If <b>manyto1</b> is not
    specified, and the input string value of an ordered group has a
    pre-existing numeric code, then that pre-existing numeric code continues
    to be used for that group, and new numeric codes are generated for any
    input string values without existing numeric codes.  If <b>manyto1</b> is
    specified, and there are existing associations, then a new numeric code
    is generated for each ordered group, whether or not the input string
    value for that ordered group has a pre-existing numeric code.  In both
    cases, newly-generated numeric codes are ordered by group, and are chosen
    to be consecutive integers, starting either from 1 or from the smallest
    integer greater than any pre-existing positive non-missing numeric code,
    whichever is greater.
<p>
    These features of <b>sencode</b> may cause problems.  Fortunately, these
    problems can be avoided if a value label name is specified (by the
    <b>label()</b> option) to be different from any pre-existing value label name,
    or if the <b>replace</b> suboption of the <b>label()</b> option is used.
<p>
<p>
<b><u>Remarks</u></b>
<p>
    <b>sencode</b> is a separate package from <b>sdecode</b> ("super <b>decode</b>"), which is
    also downloadable from SSC.  However, the two packages both have the
    alternative <b>generate</b> and <b>replace</b> options.  They are complementary to the 
    <b>destring</b> command (which is part of official Stata) and the <b>tostring</b>
    command (which became part of official Stata in Version 8.1).  <b>tostring</b>
    and <b>destring</b> convert numeric values to and from their formatted string
    values, respectively, but they do not use value labels, and they do
    contain precautionary features to prevent the loss of information.  
    <b>sdecode</b> and <b>sencode</b>, on the other hand, do use value labels, and are
    based on the principle that the mapping from numeric values to string
    values can be many-to-one.
<p>
<p>
<b><u>Examples</u></b>
<p>
    If we type this example in the <b>auto</b> data, then all US-made cars will be
    ordered before all cars from the rest of the world, and each car type (US
    and non-US) will be ordered alphanumerically.  If we used <b>encode</b> instead
    of <b>sencode</b>, then cars would be ordered alphanumerically by make (so Audi
    cars would appear before Ford cars).
<p>
        <b>. sort foreign make</b>
        <b>. sencode make, replace</b>
        <b>. tab make</b>
<p>
    If we type this in the <b>auto</b> data, then a new variable <b>origseq</b> will
    created, with a value for each observation equal to the sequential order
    of that observation in the dataset, and a value label for each value <b>i</b>
    equal to the car origin type (<b>Domestic</b> or <b>Foreign</b>) for the <b>i</b>th car.
<p>
        <b>. decode foreign, gene(orig)</b>
        <b>. sencode orig, gene(origseq) many</b>
        <b>. lab list origseq</b>
        <b>. tab origseq</b>
        <b>. list foreign origseq, nolab</b>
<p>
    If we type this in the <b>auto</b> data, then we will encode <b>make</b> so that all
    non-US cars have lower codes than all US cars (so Volvo cars have lower
    codes than AMC cars), but the data remain sorted as before:
<p>
        <b>. sencode make, gene(makeseq) gsort(-foreign)</b>
        <b>. tab makeseq, m</b>
        <b>. lab list makeseq</b>
        <b>. list make makeseq, nolab</b>
<p>
<p>
<b><u>Author</u></b>
<p>
    Roger Newson, Imperial College London, UK.  Email:
    r.newson@imperial.ac.uk
<p>
<p>
<b><u>Acknowledgement</u></b>
<p>
    This program has benefitted from advice from Nicholas J. Cox, of the
    University of Durham, U.K., and from Patrick Joly of Industry Canada,
    Ontario, Canada.
<p>
<p>
<b><u>Also see</u></b>
<p>
     Manual: <b>[D] compress</b>, <b>[D] destring</b>, <b>[D] encode</b>, <b>[D] generate</b>, <b>[D] gsort</b>,
             <b>[D]label</b>
    Online:  help for <b>compress</b>, <b>decode</b>, <b>destring</b>, <b>encode</b>, <b>generate</b>, <b>gsort</b>, 
             <b>label</b>, <b>tostring</b>
             help for <b>sdecode</b> if installed
</pre>