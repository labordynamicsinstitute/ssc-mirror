<pre>
<b>help stpm2 postestimation</b> 
                                                               also see:  stpm2
-------------------------------------------------------------------------------
<p>
<b><u>Title</u></b>
<p>
    <b>[ST] stpm2 postestimation</b> -- Post-estimation tools for stpm2
<p>
<p>
<b><u>Description</u></b>
<p>
    The following standard post-estimation commands are available:
<p>
    command          description
    -------------------------------------------------------------------------
INCLUDE help post_adjust2
INCLUDE help post_estat
INCLUDE help post_estimates
INCLUDE help post_lincom
INCLUDE help post_lrtest
INCLUDE help post_nlcom
        <b>predict</b>      predictions, residuals etc
INCLUDE help post_predictnl
INCLUDE help post_test
INCLUDE help post_testnl
    -------------------------------------------------------------------------
<p>
<p>
<a name="predict"></a><b><u>Syntax for predict</u></b>
<p>
<p>
        <b>predict</b> <i>newvar</i> [<i>if</i>] [<i>in</i>] [<b>,</b> <i>statistic</i> ]
<p>
<p>
    Note: in the table below, <i>vn</i> is an abbreviation for <i>varname</i>.
<p>
    <i>statistic</i>                        Description
    -------------------------------------------------------------------------
    Main
      <b>abc</b>                            area between log hazard ratio curves
      <b>at(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>            predict at values of specified
                                       covariates
      <b><u>cen</u></b><b>tile(</b><i>#</i><b>)</b>                     #th centile of survival distribution
      <b>ci</b>                             calculate confidence intervals
      <b><u>cumh</u></b><b>azard</b>                      cumulative hazard
      <b><u>cumo</u></b><b>dds</b>                        cumulative odds
      <b>cure</b>                           cure proportion
      <b><u>dens</u></b><b>ity</b>                        density function
      <b><u>fail</u></b><b>ure</b>                        failure function
      <b><u>h</u></b><b>azard</b>                         hazard function
      <b><u>hrn</u></b><b>umerator(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>   numerator for (time-dependent) hazard
                                       ratio
      <b><u>hrd</u></b><b>enominator(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b> denominator for (time-dependent) hazard
                                       ratio
      <b>hdiff1(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>        1st hazard function for difference in
                                       hazard functions
      <b>hdiff2(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>        2nd hazard function for difference in
                                       hazard functions
      <b><u>mart</u></b><b>ingale</b>                     martingale residuals
      <b><u>means</u></b><b>urv</b>                       population averaged survival function
      <b><u>nor</u></b><b>mal</b>                         standard normal deviate of survival
                                       function
      <b>per(</b><i>#</i><b>)</b>                         express hazard rates (and differences)
                                       per # person years
      <b><u>rm</u></b><b>st</b>                           restricted mean survival time
      <b><u>rsd</u></b><b>st</b>                          standard deviation of restricted
                                       survival time
      <b>sdiff1(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>        1st survival curve for difference in
                                       survival functions
      <b>sdiff2(</b><i>vn # </i>[<i>vn # </i>...]<b>)</b>        2nd survival curve for difference in
                                       survival functions
      <b>stdp</b>                           standard error of predicted function
      <b><u>s</u></b><b>urvival</b>                       survival function
      <b><u>time</u></b><b>var(</b><i>vn</i><b>)</b>                    time variable used for predictions
                                       (default <b>_t</b>)
      <b><u>tma</u></b><b>x(</b><i>#</i><b>)</b>                        upper bound of time for <b>rmst</b> and <b>abc</b>
                                       options
      <b><u>tmi</u></b><b>n(</b><i>#</i><b>)</b>                        lower bound of time for <b>rmst</b> and <b>abc</b>
                                       options
      <b>tvc(</b><i>vn</i><b>)</b>                        time-varying coefficient for<i> varname</i>
      <b><u>unc</u></b><b>cured</b>                       obtain survival and hazard functions for
                                       the 'uncured'
      <b>xb</b>                             the linear predictor
      <b><u>xbnob</u></b><b>aseline</b>                   predicts the linear predictor, excluding
                                       the spline function
      <b><u>zero</u></b><b>s</b>                          sets all covariates to zero (baseline
                                       prediction)
<p>
    Subsidiary
      <b>centol(</b><i>#</i><b>)</b>                      tolerance level when estimating centile
      <b><u>dev</u></b><b>iance</b>                       deviance residuals
      <b>dxb</b>                            derivative of linear predictor
      <b><u>lev</u></b><b>el(</b><i>#</i><b>)</b>                       sets confidence level (default 95)
      <b>startunc(</b><i>#</i><b>)</b>                    sets starting value for Newton-Raphson
                                       algorithm for estimating a centile of
                                       the survival distribution of 'uncured'
    -------------------------------------------------------------------------
    Statistics are available both in and out of sample; type <b>predict</b> <i>...</i> <b>if</b>
      <b>e(sample)</b> <i>...</i> if wanted only for the estimation sample.
<p>
<p>
<b><u>Options for predict</u></b>
<p>
    Note that if a relative survival model has been fitted by use of the
    <b>bhazard()</b> option then survival refers to relative survival and hazard
    refers to excess hazard.
<p>
        +------+
    ----+ Main +-------------------------------------------------------------
<p>
    <b>abc</b> evaluates the area between a constant log hazard ratio and a
        time-dependent log hazard ratio curve. It integrates the difference
        between a log HR curve and a constant log HR over the time range
        between <b>tmin()</b> and <b>tmax()</b>. The constant HR is supplied by the <b>hr0()</b>
        option.  The time-dependent log HR curve is determined according to
        <b>hrnumerator()</b>, which must therefore be specified. You may also
        specify <b>hrdenominator()</b>. The <b>n()</b>, <b>at()</b> and <b>zeros</b> options are valid
        with <b>abc</b>.
<p>
    <b>at(</b><i>varname # </i>[<i> varname # </i>...]<b>)</b> requests that the covariates specified by
        the listed <i>varname</i>(s) be set to the listed <i>#</i> values. For example,
        <b>at(x1 1 x3 50)</b> would evaluate predictions at <b>x1</b> = 1 and <b>x3</b> = 50. This
        is a useful way to obtainThis is a useful way to obtain out of sample
        predictions. Note that if <b>at()</b> is used together with <b>zeros</b> all
        covariates not listed in <b>at()</b> are set to zero. If <b>at()</b> is used
        without <b>zeros</b> then all covariates not listed in <b>at()</b> are set to their
        sample values. See also <b>zeros</b>.
<p>
    <b>centile(</b><i>#</i><b>)</b> gives the <i>#</i>th centile of the survival time distribution,
        calculated using a Newton-Raphson algorithm.
<p>
    <b>ci</b> calculate a confidence interval for the requested statistic and stores
        the confidence limits in <i>newvar</i><b>_lci</b> and <i>newvar</i><b>_uci</b>.
<p>
    <b>cumhazard</b> predicts the cumulative hazard function.
<p>
    <b>cumodds</b> predicts the cumulative odds of failure function.
<p>
    <b>cure</b> predicts the cure proportion after fitting a cure model.
<p>
    <b>density</b> predicts the density function.
<p>
    <b>failure</b> predicts the failure function, i.e. F(t) = 1 - S(t).
<p>
    <b>hazard</b> predicts the hazard function.
<p>
    <b>hdiff1(</b><i>varname # </i>...<b>)</b>, <b>hdiff2(</b><i>varname # </i>...<b>)</b> predict the difference in
        hazard functions with the first hazard function defined by the
        covariate values listed for <b>hdiff1()</b> and the second by those listed
        for <b>hdiff2()</b>. By default, covariates not specified using either
        option are set to zero. Note that setting the remaining values of the
        covariates to zero may not always be sensible. If <i>#</i> is set to missing
        (<b>.</b>) then <i>varname</i> takes its observed values in the dataset.
<p>
        Example: <b>hdiff1(hormon 1)</b> (without specifying <b>hdiff2()</b>) computes the
        difference in predicted hazard functions at <b>hormon</b> = 1 compared with
        <b>hormon</b> = 0.
<p>
        Example: <b>hdiff1(hormon 2) hdiff2(hormon 1)</b> computes the difference in
        predicted hazard functions at <b>hormon</b> = 2 compared with <b>hormon</b> = 1.
<p>
        Example: <b>hdiff1(hormon 2 age 50) hdiff2(hormon 1 age 30)</b> computes the
        difference in predicted hazard functions at <b>hormon</b> = 2 and <b>age</b> = 50
        compared with <b>hormon</b> = 1 and <b>age</b> =30.
<p>
    <b>hrdenominator(</b><i>varname # </i>...<b>)</b> specifies the denominator of the hazard
        ratio. By default all covariates other than <i>varname</i> and any other
        variables mentioned are set to zero. See cautionary note in
        <b>hrnumerator</b>.  If <i>#</i> is set to missing (<b>.</b>) then <i>varname</i> takes its
        observed values in the dataset.
<p>
    <b>hrnumerator(</b><i>varname # </i>...<b>)</b> predicts the (time-dependent) hazard ratio
        with the numerator of the hazard ratio. By default all covariates
        other than <i>varname</i> and any other variables mentioned are set to zero.
        Note that setting the remaining values of the covariates to zero may
        not always be sensible, particularly with models other than on the
        cumulative hazard scale, or when more than one variable has a
        time-dependet effect. If <i>#</i> is set to missing (<b>.</b>) then <i>varname</i> takes
        its observed values in the dataset.
<p>
    <b>martingale</b> calculates martingale residuals.
<p>
    <b>meansurv</b> calculate the population average survival curve. Note this
        differs from the predicted survival curve at the mean of all the
        covariates in the model. A predicted survival curve is obtained for
        each subject and all the survival curves are averaged. The process
        can be computationally intensive.  It is recommended that the
        <b>timevar()</b> option is used to reduce the number of survival times at
        which ths survival curves are averaged. Combining this option with
        the <b>at()</b> option enables adjusted survival curves to be estimated.
<p>
    <b>n(</b><i>#</i><b>)</b> [<b>rmst</b> only] defines the number of evaluation points for integrating
        the estimated survival function(s) with respect to time.  The larger
        <i>#</i> is, the more accurate is the estimated restricted mean survival
        time, but the longer the calculation takes. There is no gain by
        setting <i>#</i> above 5000. Default <i>#</i> is 1000.
<p>
    <b>normal</b> predicts the standard normal deviate of the survival function.
<p>
    <b>per(</b><i>#</i><b>)</b> express hazard rates and difference in hazard rates per # person
        years.
<p>
    <b>rmst</b> evaluates the mean or restricted mean survival time. This is done by
        integrating the predicted survival curve from 0 to <b>tmax(</b><i>#</i><b>)</b>; see also
        the <b>n()</b> and <b>tmax()</b> options. Note that the <b>at()</b> and <b>zeros</b> options are
        valid with <b>rmst</b>.
<p>
    <b>rsdst</b> evaluates the standard deviation of the (restricted) survival time.
        For a single sample the SE of the restricted mean survival time may
        be estimated by dividing the SD by the square root of the number of
        observations. See also the <b>rmst</b>, <b>n()</b> and <b>tmax()</b> options.  Note that
        the <b>at()</b> and <b>zeros</b> options are valid with <b>rsdst</b>.
<p>
    <b>sdiff1(</b><i>varname # </i>...<b>)</b>, <b>sdiff2(</b><i>varname # </i>...<b>)</b> predict the difference in
        survival curves with the first survival curve defined by the
        covariate values listed for <b>sdiff1()</b> and the second by those listed
        for <b>sdiff2()</b>. By default, covariates not specified using either
        option are set to zero. Note that setting the remaining values of the
        covariates to zero may not always be sensible. If <i>#</i> is set to missing
        (<b>.</b>) then <i>varname</i> takes its observed values in the dataset.
<p>
        Example: <b>sdiff1(hormon 1)</b> (without specifying <b>sdiff2()</b>) computes the
        difference in predicted survival curves at <b>hormon</b> = 1 compared with
        <b>hormon</b> = 0.
<p>
        Example: <b>sdiff1(hormon 2) sdiff2(hormon 1)</b> computes the difference in
        predicted survival curves at <b>hormon</b> = 2 compared with <b>hormon</b> = 1.
<p>
        Example: <b>sdiff1(hormon 2 age 50) sdiff2(hormon 1 age 30)</b> computes the
        difference in predicted survival curves at <b>hormon</b> = 2 and <b>age</b> = 50
        compared with <b>hormon</b> = 1 and <b>age</b> =30.
<p>
    <b>stdp</b> calculates standard error of prediction and stores it in <i>newvar</i><b>_se</b>.
        Only available for the <b>xb</b>, <b>dxb</b>, <b>xbnobaseline</b> and <b>rmst</b> options.
<p>
    <b>survival</b> predicts the survival function.
<p>
    <b>timevar(</b><i>varname</i><b>)</b> defines the variable used as time in the predictions.
        Default <i>varname</i> is <b>_t</b>. This is useful for large datasets where for
        plotting purposes predictions are only needed for 200 observations
        for example.  Note that some caution should be taken when using this
        option as predictions may be made at whatever covariate values are in
        the first 200 rows of data.  This can be avoided by using the <b>at()</b>
        option and/or the <b>zeros</b> option to define the covariate patterns for
        which you require the predictions.
<p>
    <b>tmax(</b><i>#</i><b>)</b> [<b>rmst</b> and <b>abc</b> only] defines the upper limit of time over which
        the integration of the estimated survival function is to be
        conducted. Default <i>#</i> is 0, meaning an upper limit as close to t =
        infinity as is reasonable (in fact, using the estimated 99.999999th
        centile of the survival distribution).
<p>
    <b>tmin(</b><i>#</i><b>)</b> [<b>rmst</b> and <b>abc</b> only] defines the lower bound of time over which
        the integration of the estimated survival function is to be
        conducted. Default <i>#</i> is -1, taken as 0 and meaning a lower bound of
        0.
<p>
    <b>tvc(</b><i>varname</i><b>)</b> stands for "time-varying coefficient" and computes the
        estimated coefficient for<i> varname</i>, a covariate in stpm2's varlist. If
        <i>varname</i> is "time-fixed", then<i> newvarname</i> will be a constant. If
        <i>varname</i> is included in the <b>tvc()</b> option, then<i> newvarname</i> will depend
        on<b> _t</b> and may be interpreted as the time-varying effect of<i> varname</i> on
        the chosen scale of the model (proportional hazards, proportional
        odds or probit).  For example, in a hazards-scale model (
        <b>scale(hazard)</b>),<i> newvarname</i> multiplied by<i> varname</i> will be an estimate
        of the time-varying log cumulative hazard ratio for<i> varname</i> (compared
        with<i> varname</i> = 0) at every observed value of<i> varname</i>.<i>  newvarname</i>
        alone will give the log cumulative hazard ratio for a one-unit change
        in<i> varname</i>. Note that the time-varying log cumulative hazard ratio
        for<i> varname</i> will NOT be identical to the time- varying log hazard
        ratio for<i> varname</i>.
<p>
<p>
    <b>uncured</b> can be used after fitting a cure model. It can be used with the
        <b>survival</b>, <b>hazard</b> or <b>centile()</b> options to base predictions for the
        'uncured' group.
<p>
    <b>xb</b> predicts the linear predictor, including the spline function.
<p>
    <b>xbnobaseline</b> predicts the linear predictor, excluding the spline function
        - i.e. only the time-fixed part of the model.
<p>
    <b>zeros</b> sets all covariates to zero (baseline prediction). For example,
        <b>predict s0, survival zeros</b> calculates the baseline survival function.
        See also <b>at()</b>.
<p>
        +------------+
    ----+ Subsidiary +-------------------------------------------------------
<p>
    <b>centol(</b><i>#</i><b>)</b> defines the tolerance when searching for predicted suvival time
        at a given centile of the survival distribution. Default <i>#</i> is 0.0001.
<p>
    <b>deviance</b> calculates deviance residuals.
<p>
    <b>dxb</b> calculates the derivative of the linear predictor.
<p>
    <b>level(</b><i>#</i><b>)</b> sets the confidence level; default is <b>level(95)</b> or as set by
        (help set level}.
<p>
    <b>startunc(</b><i>#</i><b>)</b> sets starting value for Newton-Raphson algorithm for
        estimating a centile of the survival time distribution of 'uncured';
        default 12.5th centile of the observed follow-up times.  Examples
<p>
    Setup
        webuse brcancer
        stset rectime, failure(censrec = 1)
<p>
    Proportional hazards model
        stpm2 hormon, scale(hazard) df(4) eform
        predict h, hazard ci
        predict s, survival ci
<p>
    Time-dependent effects on cumulative hazard scale
        stpm2 hormon, scale(hazard) df(4) tvc(hormon) dftvc(3)
        predict hr, hrnumerator(hormon 1) ci
        predict survdiff, sdiff1(hormon 1) ci
        predict hazarddiff, hdiff1(hormon 1) ci
<p>
<p>
    Use of at() option
        stpm2 hormon x1, scale(hazard) df(4) tvc(hormon) dftvc(3)
        predict s60h1, survival at(hormon 1 x1 60) ci
<p>
<p>
<b><u>Also see</u></b>
<p>
    Online:  <b>[ST] stpm2</b>;
<p>
</pre>